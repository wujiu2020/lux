(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["NewReco-csr-movie-video-short-video-tesla-home-tesla-video-video"],{"214d":function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},3052:function(e,t,i){"use strict";i.d(t,"a",(function(){return U})),i.d(t,"b",(function(){return ce})),i.d(t,"c",(function(){return J})),i.d(t,"d",(function(){return qe})),i.d(t,"e",(function(){return at})),i.d(t,"f",(function(){return Jt})),i.d(t,"g",(function(){return ui})),i.d(t,"h",(function(){return gi})),i.d(t,"i",(function(){return jt})),i.d(t,"j",(function(){return Yn})),i.d(t,"k",(function(){return Ri})),i.d(t,"l",(function(){return R})),i.d(t,"m",(function(){return w})),i.d(t,"n",(function(){return D}));var n=i("48d1"),r=i("9869");function a(e){return a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var s=function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function o(e,t,i,n){return new(i||(i=Promise))((function(r,a){function s(e){try{c(n.next(e))}catch(t){a(t)}}function o(e){try{c(n["throw"](e))}catch(t){a(t)}}function c(e){e.done?r(e.value):new i((function(t){t(e.value)})).then(s,o)}c((n=n.apply(e,t||[])).next())}))}function c(e,t){var i,n,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(e){return function(t){return c([e,t])}}function c(a){if(i)throw new TypeError("Generator is already executing.");while(s)try{if(i=1,n&&(r=2&a[0]?n["return"]:a[0]?n["throw"]||((r=n["return"])&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(o){a=[6,o],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function u(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<i;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,r++)n[r]=a[s];return n}var d=Object(n["c"])({props:{src:{type:String,required:!0}},setup:function(e){var t=null,i=!1,r=Object(n["q"])(null);function a(){var t=new Image;t.src=e.src,t.onload=function(){if(r.value){var e=r.value.getContext("2d");e.filter="blur(30px)";var i=r.value.clientWidth,n=r.value.clientHeight;e.drawImage(t,-15,-15,i+30,n+30)}}}return Object(n["l"])((function(){t=new IntersectionObserver((function(e){e&&e.length&&e[0].intersectionRatio>0&&(i||(a(),i=!0))})),r.value&&t.observe(r.value)})),Object(n["j"])((function(){return null===t||void 0===t?void 0:t.disconnect()})),{canvas:r}}});function _(e,t,i,n,r,a,s,o,c,u){"boolean"!==typeof s&&(c=o,o=s,s=!1);var d,_="function"===typeof i?i.options:i;if(e&&e.render&&(_.render=e.render,_.staticRenderFns=e.staticRenderFns,_._compiled=!0,r&&(_.functional=!0)),n&&(_._scopeId=n),a?(d=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},_._ssrRegister=d):t&&(d=s?function(){t.call(this,u(this.$root.$options.shadowRoot))}:function(e){t.call(this,o(e))}),d)if(_.functional){var h=_.render;_.render=function(e,t){return d.call(t),h(e,t)}}else{var l=_.beforeCreate;_.beforeCreate=l?[].concat(l,d):[d]}return i}var h=_,l=d,f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("canvas",{ref:"canvas",staticClass:"blur-canvas"})},p=[];f._withStripped=!0;var v=void 0,m="data-v-27baf302",A=void 0,g=!1,y=h({render:f,staticRenderFns:p},v,l,m,g,A,void 0,void 0),E=!1;function b(e,t,i,r){void 0===i&&(i=1);var a=Object(n["q"])(i);return Object(n["a"])({get:function(){return a.value},set:function(i){r&&r(e,i),e.value&&e.value[t]!==i&&!E&&(e.value[t]=i),a.value=i}})}function T(e,t){var i={volume:b(e,"volume",1,(function(e,t){t>0&&e.value&&(e.value.muted=!1)})),currentTime:b(e,"currentTime",0),playbackRate:b(e,"playbackRate",1),defaultPlaybackRate:b(e,"defaultPlaybackRate",1),duration:Object(n["q"])(NaN),buffered:Object(n["q"])({length:0,end:function(){return 0},start:function(){return 0}}),paused:Object(n["q"])(!0),ended:Object(n["q"])(!0)};function r(n){var r=n.event,a=n.name,s=n.properties,o=void 0===s?[]:s;e.value&&(E=!0,o.forEach((function(t){var n=e.value[t];"undefined"!==typeof i[t].value&&(i[t].value=n)})),E=!1,t(a,r))}return Object(n["l"])((function(){Object.keys(i).forEach((function(t){e.value&&(i[t].value=e.value[t])}))})),{original:i,syncAndEmit:r}}function S(){var e={};function t(t,i){var r;e[t]||(e=s(s({},e),(r={},r[t]=Object(n["q"])(i),r)))}function i(i){return e[i]||t(i,null),e[i]}return{getSetting:i}}function x(e,t,i,n,r){var a=new t(i,n),s=e.$listeners;return s&&Object.keys(s).forEach((function(e){a.on(e,(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];r.apply(void 0,u([e],t))}))})),a}function C(e,t,i){var r=i.computedWidth,a=i.computedHeight,s=i.videoShowStatus,o=Object(n["q"])(null);Object(n["t"])((function(){return o.value}),(function(e){var i;e&&(e.style.width=r,e.style.height=a,s.value="none",null===(i=t.value)||void 0===i||i.appendChild(e))})),Object(n["l"])((function(){Object(n["t"])((function(){return e.value}),(function(e){var i;e?e.on("videoRendererChange",(function(e){var t=e.enabled,i=e.canvas;t&&i&&(o.value=i)})):o.value&&(null===(i=t.value)||void 0===i||i.removeChild(o.value),o.value=null)}))}))}function L(){var e=Object(n["d"])(),t=e;while(t){if("kwai-player"===t.$options.name||"audio-player"===t.$options.name)return t;t=t.$parent}return null}function R(e,t){var i=L(),n=i.getSetting,r=n(e);return null===r.value&&t&&(r.value=t),r}function D(){var e=L();return e.original}function w(e,t){var i=L();Object(n["l"])((function(){null===i||void 0===i||i.$on(e,t)})),Object(n["j"])((function(){null===i||void 0===i||i.$off(e,t)}))}function I(e){var t=Object(n["d"])(),i=t;while(i){if(i.$options.name===e)return i;i=i.$parent}return null}var O=Object(n["c"])({name:"kwai-player",components:{blurImg:y},props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},isLive:{type:Boolean,default:!1},poster:{type:String,default:""},muted:{type:Boolean,default:!1},playlist:{type:Array,default:function(){return[]}},config:{type:Object,default:function(){return{}}},kernel:Function},setup:function(e,t){var i=t.emit,a=Object(n["q"])(""),u=Object(n["q"])(null),d=Object(n["q"])(null),_=Object(n["q"])(!0),h=L(),l=Object(n["q"])(null);function f(t){var n;l.value&&(null===(n=l.value)||void 0===n||n.destroy()),l.value=e.kernel&&u.value?x(h,e.kernel,u.value,s({isLive:e.isLive,src:t},e.config),i):null}var p=T(u,i),v=p.original,m=p.syncAndEmit,A=Object(n["a"])((function(){return e.muted&&0===v.volume.value})),g=Object(n["a"])((function(){return"number"===typeof e.width?e.width+"px":e.width})),y=Object(n["a"])((function(){return"number"===typeof e.height?e.height+"px":e.height}));function E(){var e,t;l.value&&l.value.stopLoad(),a.value="",null===(e=u.value)||void 0===e||e.removeAttribute("src"),null===(t=u.value)||void 0===t||t.load(),i("ended")}function b(){return o(this,void 0,void 0,(function(){return c(this,(function(e){return l.value&&l.value.destroy(),u.value&&(u.value.src="",u.value.load()),[2]}))}))}function R(e){var t,n,s,d=e.resource,_=e.muted,h=e.needPlay,p=void 0===h||h;return o(this,void 0,void 0,(function(){var e,o;return c(this,(function(c){switch(c.label){case 0:return[4,b()];case 1:return c.sent(),u.value&&(_||A.value?(v.volume.value=0,u.value.muted=!0):u.value.muted=!1),a.value=d,f(a.value),l.value?(i("loadstart"),[4,r["default"].nextTick()]):[3,8];case 2:c.sent(),null===(t=u.value)||void 0===t||t.offsetTop,l.value.load(),c.label=3;case 3:return c.trys.push([3,6,,7]),p?[4,null===(n=u.value)||void 0===n?void 0:n.play()]:[3,5];case 4:c.sent(),c.label=5;case 5:return[3,7];case 6:throw e=c.sent(),i("error",e),e;case 7:return[3,14];case 8:return u.value?(u.value.src=d,[4,r["default"].nextTick()]):[3,14];case 9:c.sent(),c.label=10;case 10:return c.trys.push([10,13,,14]),p?[4,null===(s=u.value)||void 0===s?void 0:s.play()]:[3,12];case 11:c.sent(),c.label=12;case 12:return[3,14];case 13:throw o=c.sent(),i("error",o),o;case 14:return[2]}}))}))}function D(){return i("reload"),R({resource:a.value,muted:A.value})}function w(){var t;return o(this,void 0,void 0,(function(){return c(this,(function(i){switch(i.label){case 0:return a.value?e.isLive?[3,2]:[4,null===(t=u.value)||void 0===t?void 0:t.play()]:[2];case 1:return i.sent(),[3,4];case 2:return[4,D()];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))}function I(){var t;return o(this,void 0,void 0,(function(){return c(this,(function(i){switch(i.label){case 0:return e.isLive&&l.value&&l.value.stopLoad(),a.value?[4,null===(t=u.value)||void 0===t?void 0:t.pause()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}var O=Object(n["q"])(0),P=Object(n["q"])(null);function k(e,t){u.value&&(u.value.style.cssText=e&&t?["width: "+t+"px;","height: "+e+"px;","max-height: "+e+"px;"].join(" "):"")}function N(e){var t,i;if(void 0===e&&(e=0),O.value=e,e%180!==0){var n=Number(null===(t=P.value)||void 0===t?void 0:t.clientWidth),r=Number(null===(i=P.value)||void 0===i?void 0:i.clientHeight);n>r&&k(n,r)}else k()}function M(e){i("error",e)}var B=S().getSetting,V=Object(n["q"])("block");return C(l,d,{computedWidth:g.value,computedHeight:y.value,videoShowStatus:V}),{playerContainer:P,rotation:O,getSetting:B,computedMuted:A,video:u,computedWidth:g,computedHeight:y,original:v,syncAndEmit:m,load:R,pause:I,reload:D,stop:E,play:w,rotate:N,src:a,error:M,kernelInstance:l,showVideo:_,resetVideo:b,wrapper:d,videoShowStatus:V,resetVideoCss:k}}}),P=O,k=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"playerContainer",staticClass:"kwai-player-container kwai-player",class:"kwai-player-rotation-"+e.rotation,style:{width:e.computedWidth,height:e.computedHeight}},[i("div",{staticClass:"kwai-player-plugins-top"},[e._t("top")],2),e._v(" "),i("div",{ref:"wrapper",staticClass:"kwai-player-container-video"},[e.poster?i("blur-img",{key:e.poster,staticClass:"kwai-player-blur",attrs:{src:e.poster}}):e._e(),e._v(" "),e.showVideo?i("video",{ref:"video",staticClass:"player-video",style:{display:e.videoShowStatus},attrs:{crossorigin:"anonymous"},domProps:{muted:e.computedMuted},on:{play:function(t){return e.syncAndEmit({name:"play",properties:["paused","ended"],event:t})},playing:function(t){return e.syncAndEmit({name:"playing",properties:["paused","ended"],event:t})},waiting:function(t){return e.$emit("waiting",t)},ended:function(t){return e.syncAndEmit({name:"ended",properties:["paused","ended"],event:t})},pause:function(t){return e.syncAndEmit({name:"pause",properties:["paused","ended"],event:t})},seeking:function(t){return e.$emit("seeking",t)},seeked:function(t){return e.$emit("seeked",t)},timeupdate:function(t){return e.syncAndEmit({name:"timeupdate",properties:["currentTime"],event:t})},ratechange:function(t){return e.syncAndEmit({name:"ratechange",properties:["playbackRate","defaultPlaybackRate"],event:t})},loadstart:function(t){return e.syncAndEmit({name:"loadstart",properties:["buffered"],event:t})},durationchange:function(t){return e.syncAndEmit({name:"durationchange",properties:["duration","buffered"],event:t})},loadedmetadata:function(t){return e.syncAndEmit({name:"loadedmetadata",properties:["buffered"],event:t})},loadeddata:function(t){return e.syncAndEmit({name:"loadeddata",properties:["buffered"],event:t})},progress:function(t){return e.syncAndEmit({name:"progress",properties:["buffered"],event:t})},canplay:function(t){return e.syncAndEmit({name:"canplay",properties:["buffered"],event:t})},canplaythrough:function(t){return e.syncAndEmit({name:"canplaythrough",properties:["buffered"],event:t})},error:function(t){return e.error(t)}}}):e._e(),e._v(" "),i("div",{staticClass:"kwai-player-plugins"},[e._t("default")],2)],1),e._v(" "),i("div",{staticClass:"kwai-player-plugins-bottom"},[e._t("bottom")],2)])},N=[];k._withStripped=!0;var M=void 0,B="data-v-1f8097f1",V=void 0,F=!1,U=h({render:k,staticRenderFns:N},M,P,B,F,V,void 0,void 0),H='<svg viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg" style="width:12px;height:16px"><path d="M1.6.2l9.333 7a1 1 0 010 1.6l-9.333 7A1 1 0 010 15V1A1 1 0 011.6.2z" fill="currentColor" fill-rule="evenodd"/></svg>',j='<svg viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg" style="width:12px;height:16px"><g fill="currentColor" fill-rule="evenodd"><rect x="9" width="3" height="16" rx="1.5"/><rect width="3" height="16" rx="1.5"/></g></svg>',z='<svg viewBox="0 0 160 51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="a" d="M0 .015h34.677V40.52H0z"/><path id="c" d="M0 40.536h155.3V.031H0z"/></defs><g transform="translate(1 5)" fill="none" fill-rule="evenodd"><g transform="translate(0 -8.316)"><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path d="M25.9 25.02c3.093 0 5.6 2.499 5.6 5.58v4.431c0 3.081-2.507 5.58-5.6 5.58h-8.235a5.6 5.6 0 01-5.323-3.842l-4.907 2.45a2.722 2.722 0 01-3.647-1.207A2.7 2.7 0 013.5 36.8v-7.947a2.713 2.713 0 012.718-2.708c.426 0 .847.1 1.227.292l4.885 2.463a5.6 5.6 0 015.335-3.878H25.9zm-.036 2.873h-8.117a2.795 2.795 0 00-2.8 2.743v4.313a2.795 2.795 0 002.754 2.79h8.116a2.795 2.795 0 002.8-2.744v-4.313a2.795 2.795 0 00-2.753-2.79zm-18.74 1.73a.74.74 0 00-.742.725v4.995a.742.742 0 001.065.664l.013-.006 4.604-2.34v-1.656l-4.608-2.303a.743.743 0 00-.332-.079zM13.959 8.61a7.579 7.579 0 016.613 3.863 6.489 6.489 0 014.422-1.73c3.593 0 6.506 2.903 6.506 6.483 0 3.58-2.913 6.482-6.506 6.482a6.504 6.504 0 01-5.258-2.665 7.57 7.57 0 01-5.777 2.665c-4.185 0-7.577-3.38-7.577-7.549 0-4.169 3.392-7.549 7.577-7.549zm0 3.036c-2.502 0-4.53 2.02-4.53 4.513s2.028 4.513 4.53 4.513c2.501 0 4.53-2.02 4.53-4.513 0-2.492-2.029-4.513-4.53-4.513zm11.035 2.134a3.453 3.453 0 00-3.459 3.446 3.453 3.453 0 003.46 3.446 3.453 3.453 0 003.458-3.446 3.453 3.453 0 00-3.459-3.446z" fill="#FFF" mask="url(#b)"/></g><path d="M97.592 17.151a.03.03 0 00-.03-.029H86.366v-4.219h8.47v-2.798a.03.03 0 00-.029-.03h-8.441V5.692c2.58-.101 4.212-.22 5.252-.322.798-.078 3.423-.544 4.248-2.437L93.56 1.925c-.214-.081-.394.019-.599.224-.15.151-.505.425-1.219.508 0 0-2.215.224-7.87.373-5.855.155-10.943.184-10.943.184l.422 2.26a.562.562 0 00.529.46s3.635.011 9.658-.151v4.293h-9.878v2.798c0 .016.013.03.029.03h9.849v4.218H70.902v2.798c0 .016.013.03.03.03h12.605v2.162c0 .77-.627 1.394-1.397 1.394l-3.161.003.482 2.827h2.679a4.225 4.225 0 004.225-4.224V19.95h11.227V17.15zM48.685 1.9h-2.798v24.471c0 .016.013.03.03.03h2.798V1.93a.03.03 0 00-.03-.03M60.704 13.977V7.302h3.533v7.068h-3.539c.004-.13.006-.26.006-.393m7.723.393h-1.363V6.422c0-1.076-.87-1.948-1.946-1.948h-4.414V2.379a.483.483 0 00-.483-.482h-2.345v2.577h-4.441a.483.483 0 00-.483.483v2.345h4.924v6.93l-.001.138h-6.333v2.798c0 .016.013.03.03.03h5.9c-.824 2.986-2.991 5.346-5.93 6.374V26.4c4.074-1 7.134-3.855 8.433-7.678 1.3 3.823 4.36 6.679 8.433 7.678v-2.828c-2.938-1.028-5.106-3.388-5.93-6.375h5.978V14.4a.03.03 0 00-.03-.029M42.27 7.783c-.42 4.793-.48 7.99-.48 7.99h2.419a.482.482 0 00.481-.481c.25-4.678.482-7.99.482-7.99h-2.42c-.266 0-.458.216-.481.481" fill="#FFF"/><path d="M52.196 7.669c-.034-.2-.215-.367-.481-.367H49.36s.37 3.057.705 6.087c.004.202.216.367.482.367h2.344s-.235-3.448-.696-6.087M105.313 21.723h14.207v-2.194h-14.207v-1.61h14.207v-2.194h-14.207v-1.61h14.207V11.92h-14.207v-1.663h15.676v13.251h-15.676v-1.786zm18.4 1.786V9.586a2.052 2.052 0 00-2.052-2.053h-7.532l.148-1.468h10.197V3.34h-9.925l.076-.76a.707.707 0 00-.707-.708h-2.123l-.134 1.468h-9.833v2.725h9.585l-.133 1.468h-7.984a.708.708 0 00-.707.708V23.509h-2.176v2.725h25.476V23.51h-2.176z" fill="#FFF"/><path d="M52.223 7.663c-.035-.2-.216-.368-.483-.368h-2.361s.37 3.066.707 6.106c.004.203.217.368.483.368h2.351s-.235-3.459-.697-6.106M135.798 3.33a.707.707 0 00-.707-.708h-2.209V6.51h-3.092v2.827h3.092v4.594h-2.739v2.828h2.74v5.035a1.68 1.68 0 01-1.68 1.68h-2.12l.707 2.827h2.123a3.885 3.885 0 003.885-3.885V9.337h1.414V6.51h-1.414V3.33zM146.047 22.493l1.413-.816 1.414-.816a.707.707 0 000-1.225l-1.414-.816-1.413-.816a.707.707 0 00-1.06.612V21.881c0 .544.589.884 1.06.612" fill="#FFF"/><path d="M152.055 17.068v6.008a.353.353 0 01-.354.353h-8.069l-2.18 1.414v-7.775c0-.195.159-.354.354-.354h9.895c.196 0 .354.159.354.354zm1.413-10.558h-2.473v1.237h-2.828V5.61a69.51 69.51 0 002.884-.211c.798-.078 3.423-.544 4.248-2.438l-2.306-1.006c-.214-.082-.394.019-.599.224-.15.151-.505.425-1.219.508 0 0-2.215.224-7.87.373a974.99 974.99 0 01-4.382.094l.398 2.103c.069.364.39.625.76.617.933-.02 2.59-.054 2.89-.062l2.37-.077v2.012h-2.828V6.51h-2.474v1.237h-1.414v2.827h1.392a.707.707 0 01-.685.53v2.474h.477a2.704 2.704 0 002.704-2.704v-.3h2.827v3.313h-6.008a.707.707 0 00-.707.707V25.55c0 .39.317.706.707.706h14.843c.39 0 .707-.316.707-.706v-9.542a2.12 2.12 0 00-2.12-2.12h-4.595v-3.314h2.828v.3a2.704 2.704 0 002.703 2.704h.477v-2.474a.707.707 0 01-.684-.53h1.391V7.747h-1.414V6.51z" fill="#FFF"/><mask id="d" fill="#fff"><use xlink:href="#c"/></mask><path d="M45.683 37.632h2.999v-.353h-2.999v.353zm0-.851h2.999v-.326h-2.999v.326zm0-.824h2.999v-.34h-2.999v.34zm.741-2.708a7.71 7.71 0 00.153-.353 39.75 39.75 0 01-2.105.055l-.187-.54c1.952 0 3.6-.131 4.93-.388l.305.52c-.658.138-1.427.242-2.3.311-.048.139-.096.27-.145.395h2.486v.56h-2.749c-.07.119-.131.236-.2.347h3.35v.582h-3.738c-.097.118-.187.235-.277.346h3.358v3.345h-.623v-.264h-2.999v.264h-.623v-2.452c-.318.277-.658.533-1.018.783l-.353-.561a9.66 9.66 0 001.724-1.461H43.87v-.582h2.015c.083-.118.166-.235.236-.346h-1.877v-.56h2.181zM76.22 38.068l-.547.381c-.242-.457-.568-.97-.983-1.523l.526-.34c.436.568.769 1.06 1.004 1.482zm-1.863.194l-.65.153a8.898 8.898 0 00-.492-1.551l.616-.125c.2.47.374.976.526 1.523zm-1.592.014l-.665.153a9.922 9.922 0 00-.325-1.468l.616-.132c.138.443.263.928.374 1.447zm-1.358-2.506h3.414v-1.122h-3.414v1.122zm1.87-3.698v.61h2.638v.616h-2.638v.734h2.202v2.347h-4.722v-2.347h1.87v-1.96h.65zm-1.987 4.805a6.775 6.775 0 01-.88 1.538l-.54-.395c.333-.395.623-.866.873-1.413l.547.27zM100.414 34.883v-.796a7.56 7.56 0 001.004-1.115h-2.313v-.637h3.068v.637c-.326.464-.693.9-1.101 1.316v.595h1.35v.637h-1.35v2.057c0 .512-.201.768-.589.768h-1.025l-.173-.623c.284 0 .596.007.928.007.132 0 .2-.118.2-.353V35.52h-1.502v-.637h1.503zm-2.313-.955h-.644c-.16.678-.325 1.253-.492 1.717.222.152.43.305.617.443.29-.637.464-1.357.519-2.16zm-.284-1.905c-.076.457-.152.88-.228 1.275h1.156v.36c-.049 1.08-.263 2.022-.637 2.825.388.298.7.568.935.803l-.45.52a12.59 12.59 0 00-.797-.742 5.31 5.31 0 01-1.267 1.4l-.45-.555a4.554 4.554 0 001.205-1.267 33.16 33.16 0 00-1.039-.796c.208-.596.388-1.233.554-1.918h-.665v-.63h.804c.083-.43.166-.873.235-1.33l.644.055zM124.898 33.02h3.269v-.623h-3.269v.624zm-.242 1.94v-.645h3.732v.644h-.92v2.507c0 .166.055.256.18.256h.124c.055 0 .104-.027.145-.083.049-.055.084-.367.104-.935l.61.208c-.056.693-.132 1.101-.215 1.226-.097.117-.27.18-.506.18h-.477c-.208 0-.367-.07-.471-.194a.78.78 0 01-.166-.506V34.96h-.686v.485c-.02 1.343-.623 2.32-1.807 2.943l-.492-.436c1.094-.526 1.648-1.357 1.669-2.507v-.485h-.824zm-2.347-1.85v-.609h2.285v.61h-.81v1.405h.664v.603h-.664v1.35c.276-.104.547-.215.803-.326v.672c-.623.291-1.35.568-2.168.817l-.194-.665c.305-.083.603-.173.887-.263V35.12h-.706v-.603h.706v-1.405h-.803zM153.281 36.324l-.519.367c-.263-.457-.623-.963-1.066-1.524l.533-.332c.457.568.81 1.06 1.052 1.489zm1.17 1.274c-.069.498-.401.747-.99.747-.138 0-.387-.013-.734-.034l-.159-.603c.305.014.568.028.79.028.277 0 .436-.145.477-.436.042-.346.063-1.51.076-3.483h-1.738a6.22 6.22 0 01-.678 1.142l-.395-.519c.457-.665.776-1.475.942-2.43l.65.083c-.068.387-.165.747-.276 1.087h2.14c0 2.389-.035 3.864-.104 4.418zm-5.193-.575h1.094v-1.364h-1.094v1.364zm0-1.953h1.094v-1.274h-1.094v1.274zm1.724 2.922h-.63v-.36h-1.094v.561h-.63v-5.02h.658a6.4 6.4 0 00.277-1.157l.658.09a5.61 5.61 0 01-.305 1.067h1.066v4.82z" fill="#FFF" mask="url(#d)"/></g></svg>',G=Object(n["c"])({name:"kwai-player-center-state",setup:function(){var e=Object(n["p"])({type:"",isShow:!1}),t=Object(n["a"])((function(){return"error"===e.type||"ended"===e.type}));function i(i,n){return o(this,void 0,void 0,(function(){return c(this,(function(a){switch(a.label){case 0:return t.value&&e.isShow&&!n?[2]:(e.type=i,e.isShow=!0,[4,r["default"].nextTick()]);case 1:return a.sent(),t.value?[2]:(e.isShow=!1,[2])}}))}))}function a(i){t.value&&e.isShow||(e.type="loading",e.isShow=i)}function u(t){void 0===t&&(t=!0),e.type="error",e.isShow=t}function d(t){void 0===t&&(t=!0),e.type="ended",e.isShow=t}return w("pause",(function(){return i("pause")})),w("play",(function(){return i("play",!0)})),w("playing",(function(){return i("play")})),w("loadstart",(function(){e.type="",a(!0)})),w("waiting",(function(){return a(!0)})),w("load",(function(){e.type="",a(!0)})),w("error",(function(){return u()})),w("ended",(function(){return d()})),s(s({},Object(n["s"])(e)),{playIcon:H,pauseIcon:j,loadingIcon:z})}}),W=G,K=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"center-state"},["loading"===e.type&&e.isShow?i("div",[e._t("loading",[i("div",{staticClass:"loading-con"},[i("span",{domProps:{innerHTML:e._s(e.loadingIcon)}}),e._v(" "),i("div",{staticClass:"loading-bar"})])])],2):e._e(),e._v(" "),"error"===e.type&&e.isShow?i("div",[e._t("error",[e._v("\n            暂时无法播放\n        ")])],2):e._e(),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"ended"===e.type&&e.isShow,expression:"type === 'ended' && isShow"}]},[e._t("ended")],2),e._v(" "),i("transition",{attrs:{name:"state-tip"}},[e._t("play",["play"===e.type&&e.isShow?i("div",{staticClass:"center-state-play",domProps:{innerHTML:e._s(e.playIcon)}}):e._e()])],2),e._v(" "),i("transition",{attrs:{name:"state-tip"}},[e._t("pause",["pause"===e.type&&e.isShow?i("div",{staticClass:"center-state-pause",domProps:{innerHTML:e._s(e.pauseIcon)}}):e._e()])],2),e._v(" "),i("transition",{attrs:{name:"state-tip"}},[e._t("back",["back"===e.type&&e.isShow?i("div",{staticClass:"center-state-back"}):e._e()])],2),e._v(" "),i("transition",{attrs:{name:"state-tip"}},[e._t("forward",["forward"===e.type&&e.isShow?i("div",{staticClass:"center-state-forward"}):e._e()])],2)],1)},Q=[];K._withStripped=!0;var Y=void 0,X="data-v-77f99af2",q=void 0,Z=!1,J=h({render:K,staticRenderFns:Q},Y,W,X,Z,q,void 0,void 0);function $(e,t,i,r){var a;Object(n["l"])((function(){var s;a=e(),"$el"in a?a.$el.addEventListener(t,i,r):Object(n["f"])(a)?null===(s=a.value)||void 0===s||s.addEventListener(t,i,r):a.addEventListener(t,i,r)})),Object(n["j"])((function(){var e;"$el"in a?a.$el.removeEventListener(t,i,r):Object(n["f"])(a)?null===(e=a.value)||void 0===e||e.removeEventListener(t,i,r):a.removeEventListener(t,i,r)}))}var ee=Object(n["c"])({name:"kwai-player-bar",props:{autoHide:{type:Boolean,default:!1},position:{type:String,default:"bottom",validator:function(e){return["top","right","bottom","left"].includes(e)}},delay:{type:Number,default:3e3}},setup:function(e,t){var i,r=t.emit,a=0,s=Object(n["q"])(0),o=Object(n["a"])((function(){return"bottom"===e.position||"top"===e.position}));function c(t){void 0===t&&(t=!0),clearTimeout(i),0!==s.value&&(s.value=0,r("show")),t&&e.autoHide&&u()}function u(t){if(void 0===t&&(t=!1),e.autoHide){if(_(),t)return s.value=a,void r("hide");i=window.setTimeout((function(){e.autoHide&&(s.value=a,r("hide"))}),e.delay)}}var d=Object(n["q"])(null);function _(){d.value&&(a="top"===e.position||"bottom"===e.position?d.value.offsetHeight:d.value.offsetWidth)}Object(n["t"])((function(){return e.autoHide}),(function(e){e&&0===s.value?u():e||0===s.value||c()})),Object(n["i"])((function(){c()})),Object(n["l"])((function(){_()}));var h=L();return h&&($((function(){return h}),"mousemove",(function(){return c(!0)})),$((function(){return h}),"mouseleave",(function(){return u(!0)}))),{container:d,showControlBar:c,displacement:s,horizontal:o}}}),te=ee,ie=function(){var e,t=this,i=t.$createElement,n=t._self._c||i;return n("div",{staticClass:"kwai-player-plugin-bar",class:"kwai-player-plugin-bar-"+t.position},[n("div",{ref:"container",staticClass:"kwai-player-plugin-bar-wrap",style:(e={},e[t.position]="-"+t.displacement+"px",e),on:{mousemove:function(e){return e.stopPropagation(),t.showControlBar(!1)}}},[t.horizontal?[n("div",{staticClass:"top"},[t._t("top")],2),t._v(" "),n("div",{staticClass:"kwai-player-plugin-bar-line"},[n("div",{staticClass:"left"},[t._t("left")],2),t._v(" "),n("div",{staticClass:"right"},[t._t("right")],2)]),t._v(" "),n("div",{staticClass:"bottom"},[t._t("bottom")],2)]:[n("div",{staticClass:"left"},[t._t("left")],2),t._v(" "),n("div",{staticClass:"kwai-player-plugin-bar-line"},[n("div",{staticClass:"top"},[t._t("top")],2),t._v(" "),n("div",{staticClass:"bottom"},[t._t("bottom")],2)]),t._v(" "),n("div",{staticClass:"right"},[t._t("right")],2)]],2)])},ne=[];ie._withStripped=!0;var re=void 0,ae="data-v-56544f8e",se=void 0,oe=!1,ce=h({render:ie,staticRenderFns:ne},re,te,ae,oe,se,void 0,void 0),ue=/^(attrs|props|on|nativeOn|class|style|hook)$/,de=function(e){return e.reduce((function(e,t){var i,n,r,a,s;for(r in t)if(i=e[r],n=t[r],i&&ue.test(r))if("class"===r&&("string"===typeof i&&(s=i,e[r]=i={},i[s]=!0),"string"===typeof n&&(s=n,t[r]=n={},n[s]=!0)),"on"===r||"nativeOn"===r||"hook"===r)for(a in n)i[a]=_e(i[a],n[a]);else if(Array.isArray(i))e[r]=i.concat(n);else if(Array.isArray(n))e[r]=[i].concat(n);else for(a in n)i[a]=n[a];else e[r]=t[r];return e}),{})};function _e(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}}function he(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function le(e){return fe(e)||pe(e)||ve(e)||Ae()}function fe(e){if(Array.isArray(e))return me(e)}function pe(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function ve(e,t){if(e){if("string"===typeof e)return me(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?me(e,t):void 0}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Ae(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ge(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function ye(e){var t=[],i=e.parentNode;while(i&&i!==document.documentElement)ge(i)&&t.push(i),i=i.parentNode;return t.concat(window)}var Ee=["top","left","right","bottom","top-left","top-right","bottom-left","bottom-right"],be=10;function Te(e){return e.getBoundingClientRect()}function Se(e){var t=e.cloneNode(!0);document.body.appendChild(t),t.style.top="-99999px",t.style.position="fixed",t.style.display="block",t.style.width="";var i=t.offsetWidth,n=t.offsetHeight;return document.body.removeChild(t),{width:i,height:n}}function xe(e){var t=e.top,i=e.right,n=e.bottom,r=e.left,a=[];return n.avaliable&&n.space>=t.space&&a.push("bottom"),t.avaliable&&t.space>n.space&&a.push("top"),r.avaliable&&i.avaliable&&a.length?a.join("-"):r.avaliable&&a.length&&!i.avaliable?(a.push("left"),a.join("-")):i.avaliable&&a.length&&!r.avaliable?(a.push("right"),a.join("-")):a.length?a.join("-"):i.avaliable&&i.space>=r.space?"right":r.avaliable&&r.space>i.space?"left":"bottom"}function Ce(e){var t=e.tooltipSize,i=e.triggerRectInfo,n=window.innerWidth,r=window.innerHeight,a={top:{avaliable:i.top>=t.height+be,space:i.top},bottom:{avaliable:r-i.bottom>=t.height+be,space:r-i.bottom},left:{avaliable:i.left>=t.width/2,space:i.left},right:{avaliable:n-i.right>=t.width/2,space:n-i.right}};return xe(a)}function Le(){var e=this.$refs.tooltip,t=this.$slots.default[0].elm;if(e&&t&&this.tooltipInDom){var i=Se(e),n=i.width,r=i.height;e.style.width=Math.ceil(n)+"px";var a=Te(t);switch(this.realPlacement=Ee.includes(this.placement)?this.placement:Ce({tooltipSize:{width:n,height:r},triggerRectInfo:a}),this.realPlacement){case"top":this.positionInfo.left=a.left-n/2+a.width/2,this.positionInfo.top=a.top-r-be,this.arrowLeft=null;break;case"left":this.positionInfo.left=a.left-n-be,this.positionInfo.top=a.top+t.offsetHeight/2-r/2,this.arrowLeft=null;break;case"right":this.positionInfo.left=a.left+t.offsetWidth+be,this.positionInfo.top=a.top+t.offsetHeight/2-r/2,this.arrowLeft=null;break;case"bottom":this.positionInfo.left=a.left-n/2+a.width/2,this.positionInfo.top=a.top+t.offsetHeight+be,this.arrowLeft=null;break;case"top-left":this.positionInfo.left=a.left-n+a.width,this.positionInfo.top=a.top-r-be,this.arrowLeft=n-a.width/2;break;case"top-right":this.positionInfo.left=a.left,this.positionInfo.top=a.top-r-be,this.arrowLeft=a.width/2;break;case"bottom-left":this.positionInfo.left=a.left-n+a.width,this.positionInfo.top=a.top+t.offsetHeight+be,this.arrowLeft=n-a.width/2;break;case"bottom-right":this.positionInfo.left=a.left,this.positionInfo.top=a.top+t.offsetHeight+be,this.arrowLeft=a.width/2;break}}}function Re(e,t){return e?"function"===typeof e&&(e=[e]):e=[],"function"===typeof t?u(e,[t]):Array.isArray(t)?u(e,t):e}function De(e,t){while(e){if(e===t)return t;e=e.parentNode}return null}var we={name:"pl-tooltip",props:{content:{type:String,default:""},placement:{type:String,default:"auto"},maxWidth:{type:Number,default:200},delay:{type:Object,default:function(){return{show:0,hide:200}}},trigger:{default:"hover",validator:function(e){return["click","hover"].includes(e)}},insertToGlobal:{type:Boolean,default:!0},customClass:{type:String,default:""},manual:Boolean},data:function(){return{positionInfo:{top:0,left:0},arrowLeft:null,isShow:!1,realPlacement:"",tooltipInDom:!1,staticClass:"",attrClass:"",scopeId:"",resizeTimer:-1}},methods:{calculatePosition:Le,triggerEvent:function(e){this.$emit(e)},resizeTooltip:function(){var e=this;window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout((function(){e.createTooltip(),e.calculatePosition()}),100)},show:function(){var e=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null,this.isShow)||(this.createTooltip(),this.calculatePosition(),this.delay.show<=0?this.isShow=!0:this.timeoutId=setTimeout((function(){e.isShow=!0,e.timeoutId=null}),this.delay.show))},hide:function(){var e=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.delay.hide<=0?this.isShow=!1:this.timeoutId=setTimeout((function(){e.isShow=!1,e.timeoutId=null}),this.delay.hide)},destroyTooltip:function(){this.triggerEvent("after-hide"),this.tooltipInDom&&(this.$refs.tooltip.parentNode.removeChild(this.$refs.tooltip),this.tooltipInDom=!1)},createTooltip:function(){this.lastInsertToGlobal=this.insertToGlobal,this.lastInsertToGlobal?document.body.appendChild(this.$refs.tooltip):this.$el.insertAdjacentElement("afterend",this.$refs.tooltip),this.tooltipInDom=!0}},beforeCreate:function(){this.tooltip=new this.$root.constructor({data:function(){return{node:""}},parent:this.$parent,render:function(){return this.node}})},beforeUpdate:function(){this.staticClass=this.$vnode.data.staticClass,this.attrClass=this.$vnode.data.class},updated:function(){this.$el.classList.remove(this.$vnode.data.staticClass),this.$el.classList.remove(this.$vnode.data.class)},mounted:function(){var e=this;this.calculatePosition(),this.staticClass=this.$vnode.data.staticClass,this.attrClass=this.$vnode.data.class,this.scopeId=this.$vnode.context.$options._scopeId,this.$el.classList.remove(this.$vnode.data.staticClass),this.$el.classList.remove(this.$vnode.data.class),this.tooltip.$mount(),this.scrollElList=ye(this.$el),this.scrollElList.forEach((function(t){t.addEventListener("scroll",e.calculatePosition,!1)})),window.addEventListener("resize",this.resizeTooltip),"click"===this.trigger&&(this.globalHide=function(t){De(t.target,e.$refs.tooltip)||De(t.target,e.$slots.default[0].elm)||e.manual||e.hide()},window.addEventListener("click",this.globalHide,!0))},beforeDestroy:function(){var e=this;this.scrollElList.forEach((function(t){t.removeEventListener("scroll",e.calculatePosition)})),window.removeEventListener("resize",this.resizeTooltip),this.scrollEl=null,this.destroyTooltip(),this.tooltip.$destroy(),this.tooltip=null,this.timeoutId=null,"click"===this.trigger&&window.removeEventListener("click",this.globalHide,!0)},render:function(){var e=arguments[0],t=this.scopeId?{attrs:he({},this.scopeId,!0)}:{},i=e("div",{class:"pl-tooltip-content",style:{"max-width":this.maxWidth+"px"}},[this.$slots.content?this.$slots.content:this.content]);"hover"!==this.trigger||this.manual||(i.data.on=i.data.on||{},i.data.on.mouseenter=this.show,i.data.on.mouseleave=this.hide),this.tooltip.node=e("transition",{attrs:{name:"scale"},on:{"before-enter":this.triggerEvent.bind(this,"before-show"),"after-enter":this.triggerEvent.bind(this,"after-show"),"before-leave":this.triggerEvent.bind(this,"before-hide"),"after-leave":this.destroyTooltip}},[e("div",de([{class:["pl-tooltip",this.realPlacement,this.staticClass,this.attrClass],ref:"tooltip",directives:[{name:"show",value:this.isShow}],style:{top:this.positionInfo.top+"px",left:this.positionInfo.left+"px"}},t]),[null===this.arrowLeft?e("div",{class:"pl-tooltip-arrow"}):e("div",{class:"pl-tooltip-arrow",style:{left:this.arrowLeft+"px"}}),i])]);var n=this.$slots.default[0];if(!n.tag)throw new Error(["[platform-ui pl-tooltip error]: ","trigger element should not be a text node."].join(""));return n.data=n.data||{},n.data.on=n.data.on||{},this.manual||("hover"===this.trigger?(n.data.on.mouseenter=Re(n.data.on.mouseenter,this.show),n.data.on.mouseleave=Re(n.data.on.mouseleave,this.hide)):"click"!==this.trigger||this.tooltipInDom?"click"===this.trigger&&this.tooltipInDom&&(n.data.on.click=Re(n.data.on.click,this.hide)):n.data.on.click=Re(n.data.on.click,this.show)),n}},Ie=we,Oe=void 0,Pe=void 0,ke=void 0,Ne=void 0,Me=h({},Oe,Ie,Pe,Ne,ke,void 0,void 0),Be='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg" style="width:14px;height:14px"><path d="M12.4 0H14v5h-1.6V2H10V0h2.4zM1.6 0H4v2H1.6v3H0V0h1.6zm10.8 12V9H14v5h-4v-2h2.4zM1.6 12H4v2H0V9h1.6v3z" fill="currentColor" fill-rule="nonzero"/></svg>',Ve='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg" style="width:14px;height:14px"><path d="M2.4 9H4v5H2.4v-3H0V9h2.4zm9.2 0H14v2h-2.4v3H10V9h1.6zM2.4 3V0H4v5H0V3h2.4zm9.2 0H14v2h-4V0h1.6v3z" fill="currentColor" fill-rule="nonzero"/></svg>';function Fe(e,t){return t={exports:{}},e(t,t.exports),t.exports}var Ue=Fe((function(e){
/*!
  * screenfull
  * v4.2.1 - 2019-07-27
  * (c) Sindre Sorhus; MIT License
  */
(function(){var t="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},i=e.exports,n="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,r=function(){for(var e,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,r=i.length,a={};n<r;n++)if(e=i[n],e&&e[1]in t){for(n=0;n<e.length;n++)a[i[0][n]]=e[n];return a}return!1}(),a={change:r.fullscreenchange,error:r.fullscreenerror},s={request:function(e){return new Promise(function(i,a){var s,o=r.requestFullscreen,c=function(){this.off("change",c),i()}.bind(this);this.on("change",c),e=e||t.documentElement,s=/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?e[o]():e[o](n?Element.ALLOW_KEYBOARD_INPUT:{}),Promise.resolve(s).catch(a)}.bind(this))},exit:function(){return new Promise(function(e){if(this.isFullscreen){var i=function(){this.off("change",i),e()}.bind(this);t[r.exitFullscreen](),this.on("change",i)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,i){var n=a[e];n&&t.addEventListener(n,i,!1)},off:function(e,i){var n=a[e];n&&t.removeEventListener(n,i,!1)},raw:r};r?(Object.defineProperties(s,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),i?(e.exports=s,e.exports.default=s):window.screenfull=s):i?e.exports=!1:window.screenfull=!1})()}));function He(e){Object(n["l"])((function(){Ue&&Ue.on("change",e)})),Object(n["j"])((function(){Ue&&Ue.off("change",e)}))}var je=Object(n["c"])({props:{fullscreenComponentName:{type:String,default:""},initFullscreen:Boolean,delay:{type:Object,default:function(){return{show:0,hide:200}}},tipsData:{type:Object}},components:{plTooltip:Me},name:"kwai-player-controls-fullscreen",setup:function(e,t){var i=L(),r=I(e.fullscreenComponentName),a=R("isFullscreen",!1);a.value=!!e.initFullscreen;var s=Object(n["a"])((function(){return r?r.$el:i&&i.$el})),o=Object(n["a"])((function(){var t;return(null===(t=e.tipsData)||void 0===t?void 0:t.fullscreenText)||"全屏模式"})),c=Object(n["a"])((function(){var t;return(null===(t=e.tipsData)||void 0===t?void 0:t.exitFullscreenText)||"正常模式"}));function u(e){var i="boolean"===typeof e?e:!a.value;t.emit("click"),i&&Ue&&s.value?Ue.request(s.value):Ue&&Ue.element&&Ue.exit()}return He((function(){Ue&&(Ue.element&&i&&Ue.element!==s.value||(a.value=Ue.isFullscreen,t.emit("change",Ue.isFullscreen)))})),{fullscreenChange:u,isFullscreen:a,fullScreenIcon:Be,normalScreenIcon:Ve,fullscreenText:o,exitFullscreenText:c}}}),ze=je,Ge=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"kwai-player-fullscreen"},[i("pl-tooltip",{staticClass:"kwai-player-fullscreen-tooltip",attrs:{placement:e.isFullscreen?"auto":"top","insert-to-global":!e.isFullscreen,delay:e.delay},scopedSlots:e._u([{key:"content",fn:function(){return[e._v("\n            "+e._s(e.isFullscreen?e.exitFullscreenText:e.fullscreenText)+"\n        ")]},proxy:!0}])},[i("span",{staticClass:"screen-icon",on:{click:e.fullscreenChange}},[e.isFullscreen?e._t("normal-screen-icon",[i("span",{domProps:{innerHTML:e._s(e.normalScreenIcon)}})]):e._t("full-screen-icon",[i("span",{domProps:{innerHTML:e._s(e.fullScreenIcon)}})])],2)])],1)},We=[];Ge._withStripped=!0;var Ke=void 0,Qe="data-v-79f683ee",Ye=void 0,Xe=!1,qe=h({render:Ge,staticRenderFns:We},Ke,ze,Qe,Xe,Ye,void 0,void 0),Ze=Object(n["c"])({name:"kwai-player-controls-play",props:{disabled:{type:Boolean},tipsData:{type:Object}},setup:function(e,t){var i=D().paused,r=L(),a=R("isFullscreen",!1),s=Object(n["a"])((function(){var t;return(null===(t=e.tipsData)||void 0===t?void 0:t.playText)||"播放"})),o=Object(n["a"])((function(){var t;return(null===(t=e.tipsData)||void 0===t?void 0:t.pauseText)||"暂停"}));function c(){e.disabled||(t.emit("toggle-play"),i.value?null===r||void 0===r||r.play():null===r||void 0===r||r.pause())}return{togglePlay:c,isFullscreen:a,paused:i,playIcon:H,pauseIcon:j,playText:s,pauseText:o}},components:{plTooltip:Me}}),Je=Ze,$e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"kwai-player-play-container"},[i("pl-tooltip",{staticClass:"kwai-player-play-tooltip",attrs:{placement:e.isFullscreen?"auto":"top","insert-to-global":!e.isFullscreen},scopedSlots:e._u([{key:"content",fn:function(){return[e._v("\n            "+e._s(e.paused?e.playText:e.pauseText)+"\n        ")]},proxy:!0}])},[e.paused?i("span",{staticClass:"play-icon",class:{disabled:e.disabled},on:{click:e.togglePlay}},[e._t("play-icon",[i("span",{domProps:{innerHTML:e._s(e.playIcon)}})])],2):i("span",{staticClass:"play-icon",class:{disabled:e.disabled},on:{click:e.togglePlay}},[e._t("pause-icon",[i("span",{domProps:{innerHTML:e._s(e.pauseIcon)}})])],2)])],1)},et=[];$e._withStripped=!0;var tt=void 0,it="data-v-18126825",nt=void 0,rt=!1,at=h({render:$e,staticRenderFns:et},tt,Je,it,rt,nt,void 0,void 0),st=Object(n["c"])({name:"kwai-player-controls-quality",props:{disabled:{type:Boolean,default:!1},playlist:{type:Array,default:function(){return[]}},beforeChange:{type:Function}},setup:function(e,t){var i=t.emit,r=Object(n["q"])("标清"),a=L();function s(t){var n=e.playlist.find((function(e){return e.quality===t})),s=!e.beforeChange||e.beforeChange(n);s&&n&&(i("quality-change",r),a.load({resource:n.url}))}return w("loadstart",(function(){var t,i="string"===typeof a.src?a.src:JSON.stringify(a.src);r.value=(null===(t=e.playlist.find((function(e){var t=e.url;if(t===i||JSON.stringify(t)===i)return!0})))||void 0===t?void 0:t.quality)||"标清"})),{quality:r,qualityChange:s}},components:{plTooltip:Me}}),ot=st,ct=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"kwai-player-quality-container"},[e.playlist.length>1&&!e.disabled?[i("span",{staticClass:"kwai-player-quality-now"},[e._v(" "+e._s(e.quality||"标清")+" ")]),e._v(" "),i("ul",{staticClass:"kwai-player-quality-list"},e._l(e.playlist,(function(t){return i("li",{key:t.quality,class:{actived:e.quality===t.quality},on:{click:function(i){return e.qualityChange(t.quality)}}},[e._v("\n                "+e._s(t.quality)+"\n            ")])})),0)]:i("pl-tooltip",{staticClass:"kwai-player-quality-tip",attrs:{placement:"top"},scopedSlots:e._u([{key:"content",fn:function(){return[e._v("\n            当前无法进行清晰度切换\n        ")]},proxy:!0}])},[i("span",{staticClass:"kwai-player-quality-now no-quality-change"},[e._v(" 标清 ")])])],2)},ut=[];ct._withStripped=!0;var dt=void 0,_t="data-v-00e7b607",ht=void 0,lt=!1,ft=(h({render:ct,staticRenderFns:ut},dt,ot,_t,lt,ht,void 0,void 0),'<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" style="width:18px;height:18px"><g fill="none" fill-rule="evenodd"><path d="M0 0h18v18H0z"/><path d="M4.097 3.325a7.5 7.5 0 0111.045 9.98L12.75 9H15A6 6 0 004.845 4.671l-.748-1.346zm9.806 11.35a7.5 7.5 0 01-11.045-9.98L5.25 9H3a6 6 0 0010.155 4.329l.748 1.346z" fill="currentColor" fill-rule="nonzero"/></g></svg>'),pt=Object(n["c"])({name:"kwai-player-controls-refresh",props:{disabled:{type:Boolean}},setup:function(e,t){var i=t.emit,n=R("isFullscreen",!1),r=L();function a(){e.disabled||(i("click"),null===r||void 0===r||r.reload())}return{refresh:a,isFullscreen:n,refreshIcon:ft}},components:{plTooltip:Me}}),vt=pt,mt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"kwai-player-refresh"},[i("pl-tooltip",{staticClass:"kwai-player-refresh-tooltip",attrs:{placement:e.isFullscreen?"auto":"top","insert-to-global":!e.isFullscreen},scopedSlots:e._u([{key:"content",fn:function(){return[e._v("\n            刷新\n        ")]},proxy:!0}])},[i("span",{staticClass:"refresh-icon",class:{disabled:e.disabled},on:{click:e.refresh}},[e._t("refresh-icon",[i("span",{domProps:{innerHTML:e._s(e.refreshIcon)}})])],2)])],1)},At=[];mt._withStripped=!0;var gt=void 0,yt="data-v-0e2a65a8",Et=void 0,bt=!1,Tt=(h({render:mt,staticRenderFns:At},gt,vt,yt,bt,Et,void 0,void 0),Object(n["c"])({name:"pl-slider",model:{prop:"value",event:"change"},props:{min:{type:Number,default:0},max:{type:Number,default:1},value:{type:Number,default:.15},vertical:{type:Boolean,default:!1},height:{type:Number,default:4},canClick:{type:Boolean,default:!0},isMobile:{type:Boolean,default:!1}},setup:function(e,t){var i,r=t.emit,a=Object(n["q"])(!1),s=Object(n["q"])(null),o=Object(n["a"])((function(){return 100*(e.value-e.min)/e.max}));function c(t){var n,a,o,c,u,d=null!==i&&void 0!==i?i:null===(n=s.value)||void 0===n?void 0:n.getBoundingClientRect();if(d&&(d.height||d.width)){var _=0;if("clientX"in t)_=e.vertical?1-(t.clientY-d.top)/d.height:(t.clientX-d.left)/d.width;else if(e.vertical){var h=null!==(o=null===(a=t.touches.item(0))||void 0===a?void 0:a.clientY)&&void 0!==o?o:0;_=1-(h-d.top)/d.height}else{var l=null!==(u=null===(c=t.touches.item(0))||void 0===c?void 0:c.clientX)&&void 0!==u?u:0;_=(l-d.left)/d.width}_<0?_=0:_>1&&(_=1),r("change",_),r("change-value",_)}}function u(t){var n;r("move-start"),i=null===(n=s.value)||void 0===n?void 0:n.getBoundingClientRect(),a.value=!0,e.canClick&&c(t)}return e.isMobile?($((function(){return s}),"touchstart",(function(e){u(e)}),!0),$((function(){return s}),"touchmove",(function(e){c(e)}),!0),$((function(){return s}),"touchend",(function(){a.value=!1,r("touch-end")}),!0)):($((function(){return s}),"mousedown",(function(e){u(e)}),!0),$((function(){return document}),"mousemove",(function(e){a.value&&c(e)}),!0),$((function(){return document}),"mouseup",(function(){a.value=!1,r("move-end")}),!0)),$((function(){return s}),"click",(function(){r("click-slider")}),!0),{slider:s,startChange:u,currentRate:o}}})),St=Tt,xt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pl-slider",class:{"pl-slider-vertical":e.vertical},style:e.vertical?"width: "+e.height+"px":"height: "+e.height+"px"},[i("div",{ref:"slider",staticClass:"pl-slider-all",style:e.vertical?"width: "+e.height+"px":"height: "+e.height+"px"},[i("div",{staticClass:"pl-slider-active",style:{width:e.vertical?e.height+"px":e.currentRate+"%",height:e.vertical?e.currentRate+"%":e.height+"px",top:e.vertical?100-e.currentRate+"%":0}},[i("div",{staticClass:"pl-slider-ball",style:{right:"-"+e.height+"px",top:"-"+e.height+"px",width:2*e.height+4+"px",height:2*e.height+4+"px"}})])])])},Ct=[];xt._withStripped=!0;var Lt=void 0,Rt=void 0,Dt=void 0,wt=!1,It=h({render:xt,staticRenderFns:Ct},Lt,St,Rt,wt,Dt,void 0,void 0),Ot='<svg viewBox="0 0 17 13" xmlns="http://www.w3.org/2000/svg" style="width:17px"><g fill="currentColor" fill-rule="nonzero"><path d="M12.807 4.33L9.698 7.439l.892.891 3.108-3.109z"/><path d="M10.59 4.33l3.108 3.109-.891.891-3.109-3.109zM6.75 2.749L4.202 4.834H1.5v3h2.702L6.75 9.919v-7.17zM3.667 9.334H.75a.75.75 0 01-.75-.75v-4.5a.75.75 0 01.75-.75h2.917L7.637.085a.375.375 0 01.613.29v11.918a.375.375 0 01-.613.29l-3.97-3.249z"/></g></svg>',Pt='<svg viewBox="0 0 17 13" xmlns="http://www.w3.org/2000/svg" style="width:17px"><path d="M6.75 2.749L4.202 4.834H1.5v3h2.702L6.75 9.919v-7.17zM3.667 9.334H.75a.75.75 0 01-.75-.75v-4.5a.75.75 0 01.75-.75h2.917L7.637.085a.375.375 0 01.613.29v11.918a.375.375 0 01-.613.29l-3.97-3.249zm10.138 3.1l-1.063-1.061A6.733 6.733 0 0015 6.334a6.736 6.736 0 00-2.478-5.226L13.587.043A8.232 8.232 0 0116.5 6.334a8.23 8.23 0 01-2.695 6.1zm-2.658-2.657l-1.066-1.066a2.995 2.995 0 001.169-2.377A2.996 2.996 0 009.84 3.79l1.08-1.08a4.493 4.493 0 011.83 3.624 4.49 4.49 0 01-1.603 3.443z" fill="currentColor" fill-rule="nonzero"/></svg>',kt=Object(n["c"])({name:"kwai-player-controls-volume",props:{initial:{type:Number,default:1},muteTipShowTime:{type:Number,default:3e3},triggerMethod:{type:String,default:"hover"},canChangeVolume:{type:Boolean,default:!0}},setup:function(e,t){var i,r=t.emit,a=R("isFullscreen",!1),s=D().volume,o=Object(n["q"])(!0),c=Object(n["q"])(!1),u=Object(n["q"])(0),d=Object(n["q"])(null);function _(t){var n,r;clearTimeout(i),o.value=!t,t?(null===(n=d.value)||void 0===n||n.show(),i=window.setTimeout((function(){var e;null===(e=d.value)||void 0===e||e.hide()}),e.muteTipShowTime)):null===(r=d.value)||void 0===r||r.hide()}function h(t){e.canChangeVolume&&(t>1&&(t=1),t<0&&(t=0),u.value=s.value,s.value=t,r("change",t),_(!1))}function l(){"click"===e.triggerMethod&&(c.value=!0)}var f=L();return f&&$((function(){return f}),"mouseleave",(function(){_(!1),c.value=!1})),$((function(){return window}),"mouseup",(function(){})),Object(n["l"])((function(){h(e.initial)})),Object(n["j"])((function(){_(!1)})),w("error",(function(e){var t,i;(null===(i=null===(t=e)||void 0===t?void 0:t.message)||void 0===i?void 0:i.indexOf("play() failed because the user didn't interact with the document first"))>-1&&_(!0)})),{volumeChange:h,isFullscreen:a,muteTip:d,volume:s,showVolumeSlide:o,volumeMuteIcon:Ot,volumeIcon:Pt,clickMuteTip:c,handleVolume:l}},components:{plTooltip:Me,plSlider:It}}),Nt=kt,Mt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"kwai-player-volume-container",class:e.showVolumeSlide&&"hover"===e.triggerMethod?"show-volume-slide":""},[i("pl-tooltip",{ref:"muteTip",staticClass:"kwai-player-volume-mutetip",attrs:{placement:"top",manual:"","insert-to-global":!e.isFullscreen},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"kwai-player-volume-mutetip-content"},[i("span",[e._v("点击小喇叭开启声音~")]),e._v(" "),i("div",{staticClass:"kwai-player-volume-mutetip-close",on:{click:function(t){return e.toggleMuteTip(!1)}}})])]},proxy:!0}])},[i("div",{staticClass:"kwai-player-volume-sound",on:{click:e.handleVolume}},[0===e.volume?i("span",{on:{click:function(t){return e.volumeChange(e.initial)}}},[e._t("volume-mute-icon",[i("span",{domProps:{innerHTML:e._s(e.volumeMuteIcon)}})])],2):i("span",{on:{click:function(t){return e.volumeChange(0)}}},[e._t("volume-icon",[i("span",{domProps:{innerHTML:e._s(e.volumeIcon)}})])],2)])]),e._v(" "),i("pl-slider",{staticClass:"volume-slide",class:"click"===e.triggerMethod&&e.clickMuteTip?"show-volume-panel":"",attrs:{value:e.volume,vertical:!0},on:{change:e.volumeChange}})],1)},Bt=[];Mt._withStripped=!0;var Vt=void 0,Ft="data-v-33b577ea",Ut=void 0,Ht=!1,jt=h({render:Mt,staticRenderFns:Bt},Vt,Nt,Ft,Ht,Ut,void 0,void 0);function zt(){var e=D(),t=Object(n["a"])({get:function(){return(null===e||void 0===e?void 0:e.duration.value)?(null===e||void 0===e?void 0:e.currentTime.value)/e.duration.value:0},set:function(t){e&&(e.currentTime.value=t*e.duration.value)}}),i=Object(n["a"])((function(){return(null===e||void 0===e?void 0:e.buffered)&&(null===e||void 0===e?void 0:e.buffered.value.length)?100*(null===e||void 0===e?void 0:e.buffered.value.end(0))/e.duration.value:0}));return{currentRating:t,bufferedRating:i}}var Gt=Object(n["c"])({components:{slider:It},props:{normalHeight:{type:Number,default:2},activeHeight:{type:Number,default:4},normalDelayTime:{type:Number,default:0},canClick:{type:Boolean,default:!0},isMobile:{type:Boolean,default:!1},canKeepActiveBall:{type:Boolean}},setup:function(e,t){var i=t.emit,r=zt(),a=r.bufferedRating,s=r.currentRating,o=-1,c=Object(n["q"])(null);function u(e){s.value=e,i("move-change")}function d(){i("touch-end")}function _(){i("move-start")}function h(){i("click-slider")}var l=Object(n["q"])(e.normalHeight);function f(t){"start"===t&&e.canClick||"move"===t?l.value=e.activeHeight:e.normalDelayTime?(window.clearTimeout(o),o=window.setTimeout((function(){l.value=e.normalHeight}),e.normalDelayTime)):l.value=e.normalHeight}return e.isMobile?($((function(){return c}),"touchstart",(function(){f("start")}),!0),$((function(){return c}),"touchmove",(function(){f("move")}),!0),$((function(){return c}),"touchend",(function(){f("end")}),!0)):($((function(){return c}),"mouseenter",(function(){f("start")}),!0),$((function(){return c}),"mousemove",(function(){f("move")}),!0),$((function(){return c}),"mouseleave",(function(){f("end")}),!0)),{bufferedRating:a,currentRating:s,height:l,progressBar:c,changeCurrentRating:u,handleSliderTouchEnd:d,handleSliderMoveStart:_,handleHeightChange:f,handleClickSlider:h}}}),Wt=Gt,Kt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"progressBar",staticClass:"progress-bar",class:e.canKeepActiveBall?"":"normal-mode",style:{height:e.height+"px"}},[i("div",{staticClass:"progress-bar-buffered",style:{width:e.bufferedRating+"%",height:e.height+"px"}}),e._v(" "),i("div",{staticClass:"progress-bar-current",style:{width:100*e.currentRating+"%",height:e.height+"px"}}),e._v(" "),i("slider",{staticClass:"video-slide",attrs:{height:e.height,"can-click":e.canClick,"is-mobile":e.isMobile},on:{"change-value":e.changeCurrentRating,"touch-end":e.handleSliderTouchEnd,"move-start":e.handleSliderMoveStart,"click-slider":e.handleClickSlider},model:{value:e.currentRating,callback:function(t){e.currentRating=t},expression:"currentRating"}})],1)},Qt=[];Kt._withStripped=!0;var Yt=void 0,Xt="data-v-1ff2f8b5",qt=void 0,Zt=!1,Jt=h({render:Kt,staticRenderFns:Qt},Yt,Wt,Xt,Zt,qt,void 0,void 0);function $t(e){return e<10?"0"+e:e+""}function ei(e){var t=Math.round(e),i=Math.floor(t/3600),n=Math.floor(t%3600/60),r=t%60;return i?$t(i)+":"+$t(n)+":"+$t(r):$t(n)+":"+$t(r)}var ti=Object(n["c"])({setup:function(){var e=D(),t=e.currentTime,i=e.duration;return{currentTime:t,duration:i,formatTime:ei}}}),ii=ti,ni=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:!!e.duration,expression:"!!duration"}],staticClass:"progress-time"},[i("span",{staticClass:"progress-time-current"},[e._v(e._s(e.formatTime(e.currentTime)))]),e._v(" "),i("span",{staticClass:"progress-time-split"},[e._v("/")]),e._v(" "),i("span",{staticClass:"progress-time-total"},[e._v(e._s(e.formatTime(e.duration)))])])},ri=[];ni._withStripped=!0;var ai=void 0,si="data-v-7881eeb2",oi=void 0,ci=!1,ui=h({render:ni,staticRenderFns:ri},ai,ii,si,ci,oi,void 0,void 0),di='<svg viewBox="0 0 23 23" xmlns="http://www.w3.org/2000/svg" style="width:23px;height:23px"><g fill="currentColor" fill-rule="nonzero"><path d="M4.783 9.565v8.609h8.608V9.565H4.783zm-.957-1.913h10.522c.528 0 .956.428.956.957V19.13a.957.957 0 01-.956.957H3.826a.957.957 0 01-.956-.957V8.61c0-.529.428-.957.956-.957z"/><path d="M14.739 3.166a.957.957 0 10-.957-1.657L11.06 3.08c-.986.569-.446 2.11.702 1.894a5.025 5.025 0 015.504 7.047.957.957 0 101.737.802 6.921 6.921 0 00-.289-6.382A6.932 6.932 0 0014.61 3.24l.128-.073z"/></g></svg>',_i=Object(n["c"])({name:"kwai-player-controls-rotate",setup:function(e,t){var i=t.emit,r=Object(n["q"])(0),a=L(),s=R("isFullscreen",!1);function o(e){r.value="number"===typeof e?e:(r.value+90)%360,a.rotate(r.value),i("change",r)}return{rotationChange:o,rotation:r,rotateIcon:di,isFullscreen:s}},components:{plTooltip:Me}}),hi=_i,li=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"kwai-player-rotate"},[i("pl-tooltip",{staticClass:"kwai-player-rotate-tooltip",attrs:{placement:e.isFullscreen?"top-left":"top","insert-to-global":!e.isFullscreen},scopedSlots:e._u([{key:"content",fn:function(){return[e._v("\n            屏幕旋转\n        ")]},proxy:!0}])},[i("span",{staticClass:"rotate-icon",domProps:{innerHTML:e._s(e.rotateIcon)},on:{click:function(t){return e.rotationChange()}}})])],1)},fi=[];li._withStripped=!0;var pi=void 0,vi="data-v-64674f88",mi=void 0,Ai=!1,gi=h({render:li,staticRenderFns:fi},pi,hi,vi,Ai,mi,void 0,void 0),yi=Object(n["c"])({name:"kwai-player-panoramic",setup:function(e,t){var r=t.emit,a=null,s=Object(n["q"])(null),o=L();function c(e){e.addEventListener("mousedown",s);var t,i,n=0,r=0;function s(s){return 0==s.button&&(n=(null===a||void 0===a?void 0:a.yAxis)||0,r=(null===a||void 0===a?void 0:a.xAxis)||0,t=s.pageX-e.offsetLeft+parseInt(getComputedStyle(e)["margin-left"]),i=s.pageY-e.offsetTop+parseInt(getComputedStyle(e)["margin-top"]),document.addEventListener("mousemove",o),document.addEventListener("mouseup",c)),!1}function o(s){return!!a&&(a.yAxis=n-(s.pageX-t)/e.clientWidth*Math.PI/2,a.xAxis=r+(s.pageY-i)/e.clientHeight*Math.PI/2,!1)}function c(e){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",c)}}return Object(n["l"])((function(){var e=i("56ad");a=new e,o&&s.value&&(null===a||void 0===a||a.attachSource(o.$refs.video),null===a||void 0===a||a.attachOutputCanvas(s.value),null===a||void 0===a||a.on("error",(function(e){r("error",e)})),null===a||void 0===a||a.on("ambisonicChange",(function(e){r("error",e),console.log("ambisonic-change",e)})),null===a||void 0===a||a.on("ambisonicFailed",(function(e){console.log("ambisonic-faild",e)})),c(s.value))})),Object(n["j"])((function(){null===a||void 0===a||a.destroy()})),$((function(){return s}),"keydown",(function(e){if(a)switch(e.keyCode){case 38:case 87:a.xAxis+=.02;break;case 40:case 83:a.xAxis-=.02;break;case 37:case 65:a.yAxis-=.02;break;case 39:case 68:a.yAxis+=.02;break}})),w("play",(function(){null===a||void 0===a||a.start()})),{canvas:s}}}),Ei=yi,bi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"kwai-player-panoramic"},[i("canvas",{ref:"canvas",attrs:{tabindex:"-1"}})])},Ti=[];bi._withStripped=!0;var Si=void 0,xi="data-v-7a8504da",Ci=void 0,Li=!1,Ri=h({render:bi,staticRenderFns:Ti},Si,Ei,xi,Li,Ci,void 0,void 0);function Di(e){var t=R("soundEffectInstance"),r=L();function a(){var e,n,a=i("9de5");t.value=new a({analyserByteCount:2048,analyseByChannel:!0}),r&&(null===(e=t.value)||void 0===e||e.init(r.$refs.video),null===(n=t.value)||void 0===n||n.setAnalyzerEnabled(!0))}return w("playing",(function(){t.value&&!e||a()})),w("loadstart",(function(){e||a()})),Object(n["l"])((function(){t.value||e||a()})),Object(n["j"])((function(){t.value=null})),t}function wi(e){for(var t=e.length,i=128,n=128,r=0;r<t;r++){var a=e[r];a<i?i=a:a>n&&(n=a)}return(n-i)/255}function Ii(e){var t=wi(e)*(Math.E-1),i=Math.log1p(t);return i}var Oi='<svg viewBox="0 0 15 6" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient x1="50%" y1=".889%" x2="50%" y2="100%" id="a"><stop stop-color="#E1E1E1" offset="0%"/><stop stop-color="#989898" offset="100%"/></linearGradient><linearGradient x1="50%" y1="1.185%" x2="50%" y2="100%" id="b"><stop stop-color="#646C7D" offset="0%"/><stop stop-color="#32373E" offset="100%"/></linearGradient></defs><g fill="none" fill-rule="evenodd"><rect fill="url(#a)" width="15" height="6" rx="2"/><rect fill="url(#b)" x="2" y="2" width="11" height="2" rx="1"/></g></svg>',Pi=Object(n["c"])({props:{webRtc:Boolean},setup:function(e){var t=Di(e.webRtc),i=Object(n["q"])(null),r=15,a=135,s=null,o=null,c=null,u=0;function d(){if(s&&t.value){s.clearRect(0,0,r,a);var e=t.value.getByteTimeDomainDataByChannel(),i=e[0],n=e[1],_=Ii(i),h=Ii(n);s.fillStyle=o,s.fillRect(1,a,6,-_*(a-3)),s.fillStyle=o,s.fillRect(8,a,6,-h*(a-3));var l=Math.min(-_*(a-3),-h*(a-3)),f=0===l?a-6:a-12+l;s.drawImage(c,0,f),u=requestAnimationFrame(d)}else u=requestAnimationFrame(d)}return Object(n["l"])((function(){var e;c=new Image,c.src="data:image/svg+xml;base64,"+btoa(Oi),s=null===(e=i.value)||void 0===e?void 0:e.getContext("2d"),o=null===s||void 0===s?void 0:s.createLinearGradient(0,0,0,135),null===o||void 0===o||o.addColorStop(0,"#CA8325"),null===o||void 0===o||o.addColorStop(1,"#2CCB2E"),d()})),Object(n["j"])((function(){cancelAnimationFrame(u)})),{canvas:i}}}),ki=Pi,Ni=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("canvas",{ref:"canvas",attrs:{width:"15",height:"135"}})},Mi=[];Ni._withStripped=!0;var Bi=void 0,Vi="data-v-b02056ea",Fi=void 0,Ui=!1,Hi=h({render:Ni,staticRenderFns:Mi},Bi,ki,Vi,Ui,Fi,void 0,void 0),ji=Object(n["c"])({props:{webRtc:Boolean},components:{LevelMeter:Hi},setup:function(e){var t=R("levelMeterSetting",{open:!1}),i=Object(n["q"])(t.value.open);return Object(n["t"])((function(){return t.value.open}),(function(){t.value.open&&!i.value&&(i.value=!0)})),Object(n["l"])((function(){e.webRtc&&(t.value.open=!0)})),{currentOpen:i,levelMeterSetting:t}}}),zi=ji,Gi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.levelMeterSetting.open,expression:"levelMeterSetting.open"}],staticClass:"kwai-player-level-panel"},[e.currentOpen?i("LevelMeter",{staticClass:"level-meter",attrs:{"web-rtc":e.webRtc}}):e._e()],1)},Wi=[];Gi._withStripped=!0;var Ki=void 0,Qi="data-v-5378fe61",Yi=void 0,Xi=!1;h({render:Gi,staticRenderFns:Wi},Ki,zi,Qi,Xi,Yi,void 0,void 0);function qi(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function Zi(e){var t=[],i=e.parentNode;while(i&&i!==document.documentElement)qi(i)&&t.push(i),i=i.parentNode;return t.concat(window)}var Ji=["top","left","right","bottom","top-left","top-right","bottom-left","bottom-right"],$i=10;function en(e){return e.getBoundingClientRect()}function tn(e){var t=e.cloneNode(!0);document.body.appendChild(t),t.style.top="-99999px",t.style.position="fixed",t.style.display="block",t.style.width="";var i=t.offsetWidth,n=t.offsetHeight;return document.body.removeChild(t),{width:i,height:n}}function nn(e){var t=e.top,i=e.right,n=e.bottom,r=e.left,a=[];return n.avaliable&&n.space>=t.space&&a.push("bottom"),t.avaliable&&t.space>n.space&&a.push("top"),r.avaliable&&i.avaliable&&a.length?a.join("-"):r.avaliable&&a.length&&!i.avaliable?(a.push("left"),a.join("-")):i.avaliable&&a.length&&!r.avaliable?(a.push("right"),a.join("-")):a.length?a.join("-"):i.avaliable&&i.space>=r.space?"right":r.avaliable&&r.space>i.space?"left":"bottom"}function rn(e){var t=e.tooltipSize,i=e.triggerRectInfo,n=window,r=n.innerWidth,a=n.innerHeight,s={top:{avaliable:i.top>=t.height+$i,space:i.top},bottom:{avaliable:a-i.bottom>=t.height+$i,space:a-i.bottom},left:{avaliable:i.left>=t.width/2,space:i.left},right:{avaliable:r-i.right>=t.width/2,space:r-i.right}};return nn(s)}function an(){var e=this.$refs.tooltip,t=this.$slots.default[0].elm;if(e&&t&&this.tooltipInDom){var i=tn(e),n=i.width,r=i.height;e.style.width=Math.ceil(n)+"px";var a=en(t);switch(this.realPlacement=Ji.includes(this.placement)?this.placement:rn({tooltipSize:{width:n,height:r},triggerRectInfo:a}),this.realPlacement){case"top":this.positionInfo.left=a.left-n/2+a.width/2,this.positionInfo.top=a.top-r-$i,this.arrowLeft=null;break;case"left":this.isAbsoluteMode?(this.positionInfo.left=-(n+$i),this.positionInfo.top=t.offsetHeight/2-r/2):(this.positionInfo.left=a.left-n-$i,this.positionInfo.top=a.top+t.offsetHeight/2-r/2),this.arrowLeft=null;break;case"right":this.positionInfo.left=a.left+t.offsetWidth+$i,this.positionInfo.top=a.top+t.offsetHeight/2-r/2,this.arrowLeft=null;break;case"bottom":this.positionInfo.left=a.left-n/2+a.width/2,this.positionInfo.top=a.top+t.offsetHeight+$i,this.arrowLeft=null;break;case"top-left":this.positionInfo.left=a.left-n+a.width,this.positionInfo.top=a.top-r-$i,this.arrowLeft=n-a.width/2;break;case"top-right":this.positionInfo.left=a.left,this.positionInfo.top=a.top-r-$i,this.arrowLeft=a.width/2;break;case"bottom-left":this.isAbsoluteMode?(this.positionInfo.left=a.width-n,this.positionInfo.top=t.offsetHeight+$i):(this.positionInfo.left=a.left-n+a.width,this.positionInfo.top=a.top+t.offsetHeight+$i),this.arrowLeft=n-a.width/2;break;case"bottom-right":this.positionInfo.left=a.left,this.positionInfo.top=a.top+t.offsetHeight+$i,this.arrowLeft=a.width/2;break}}}function sn(e,t){return e?"function"===typeof e&&(e=[e]):e=[],"function"===typeof t?[].concat(le(e),[t]):Array.isArray(t)?[].concat(le(e),le(t)):e}function on(e,t){while(e){if(e===t)return t;e=e.parentNode}return null}var cn={name:"pl-tooltip",props:{content:{type:String},placement:{type:String,default:"auto"},maxWidth:{type:Number,default:200},delay:{type:Object,default:function(){return{show:0,hide:200}}},trigger:{default:"hover",validator:function(e){return["click","hover"].includes(e)}},insertToGlobal:{type:Boolean,default:!0},customClass:{type:String,default:""},manual:Boolean,isAbsoluteMode:Boolean},data:function(){return{positionInfo:{top:0,left:0},arrowLeft:null,isShow:!1,realPlacement:"",tooltipInDom:!1,staticClass:"",attrClass:"",scopeId:""}},methods:{calculatePosition:an,triggerEvent:function(e){this.$emit(e)},show:function(){var e=this;if(this.timeoutId)return clearTimeout(this.timeoutId),void(this.timeoutId=null);this.createTooltip(),this.calculatePosition(),this.delay.show<=0?this.isShow=!0:this.timeoutId=setTimeout((function(){e.isShow=!0,e.timeoutId=null}),this.delay.show)},hide:function(){var e=this;this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.delay.hide<=0?this.isShow=!1:this.timeoutId=setTimeout((function(){e.isShow=!1,e.timeoutId=null}),this.delay.hide)},destroyTooltip:function(){this.triggerEvent("after-hide"),this.tooltipInDom&&(this.$refs.tooltip.parentNode.removeChild(this.$refs.tooltip),this.tooltipInDom=!1)},createTooltip:function(){this.lastInsertToGlobal=this.insertToGlobal,this.lastInsertToGlobal?document.body.appendChild(this.$refs.tooltip):this.$el.insertAdjacentElement("afterend",this.$refs.tooltip),this.tooltipInDom=!0}},beforeCreate:function(){this.tooltip=new this.$root.constructor({data:function(){return{node:""}},parent:this.$parent,render:function(){return this.node}})},beforeUpdate:function(){this.staticClass=this.$vnode.data.staticClass,this.attrClass=this.$vnode.data.class},updated:function(){this.$el.classList.remove(this.$vnode.data.staticClass),this.$el.classList.remove(this.$vnode.data.class)},mounted:function(){var e=this;this.calculatePosition(),this.staticClass=this.$vnode.data.staticClass,this.attrClass=this.$vnode.data.class,this.scopeId=this.$vnode.context.$options._scopeId,this.$el.classList.remove(this.$vnode.data.staticClass),this.$el.classList.remove(this.$vnode.data.class),this.tooltip.$mount(),this.scrollElList=Zi(this.$el),this.scrollElList.forEach((function(t){t.addEventListener("scroll",e.calculatePosition,!1)})),"click"===this.trigger&&(this.globalHide=function(t){on(t.target,e.$refs.tooltip)||on(t.target,e.$slots.default[0].elm)||e.manual||e.hide()},window.addEventListener("click",this.globalHide,!0))},beforeDestroy:function(){var e=this;this.scrollElList.forEach((function(t){t.removeEventListener("scroll",e.calculatePosition)})),this.scrollEl=null,this.destroyTooltip(),this.tooltip.$destroy(),this.tooltip=null,this.timeoutId=null,"click"===this.trigger&&window.removeEventListener("click",this.globalHide,!0)},render:function(){var e=arguments[0],t=this.scopeId?{attrs:he({},this.scopeId,!0)}:{},i=e("div",{class:"pl-tooltip-content",style:{"max-width":this.maxWidth+"px"}},[this.$slots.content?this.$slots.content:this.content]);"hover"!==this.trigger||this.manual||(i.data.on=i.data.on||{},i.data.on.mouseenter=this.show,i.data.on.mouseleave=this.hide),this.tooltip.node=e("transition",{attrs:{name:"scale"},on:{"before-enter":this.triggerEvent.bind(this,"before-show"),"after-enter":this.triggerEvent.bind(this,"after-show"),"before-leave":this.triggerEvent.bind(this,"before-hide"),"after-leave":this.destroyTooltip}},[e("div",de([{class:["pl-tooltip",this.realPlacement,this.staticClass,this.attrClass],ref:"tooltip",directives:[{name:"show",value:this.isShow}],style:{top:this.positionInfo.top+"px",left:this.positionInfo.left+"px"}},t]),[null===this.arrowLeft?e("div",{class:"pl-tooltip-arrow"}):e("div",{class:"pl-tooltip-arrow",style:{left:this.arrowLeft+"px"}}),i])]);var n=this.$slots.default[0];if(!n.tag)throw new Error(["[platform-ui pl-tooltip error]: ","trigger element should not be a text node."].join(""));return n.data=n.data||{},n.data.on=n.data.on||{},this.manual||("hover"===this.trigger?(n.data.on.mouseenter=sn(n.data.on.mouseenter,this.show),n.data.on.mouseleave=sn(n.data.on.mouseleave,this.hide)):"click"!==this.trigger||this.tooltipInDom?"click"===this.trigger&&this.tooltipInDom&&(n.data.on.click=sn(n.data.on.click,this.hide)):n.data.on.click=sn(n.data.on.click,this.show)),n}},un=cn,dn=void 0,_n=void 0,hn=void 0,ln=void 0,fn=h({},dn,un,_n,ln,hn,void 0,void 0),pn='<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" style="width:18px;height:18px"><g fill="none" fill-rule="evenodd"><path d="M0 0h18v18H0z"/><path d="M4.628 13.5a2.25 2.25 0 014.245 0H16.5V15H8.873a2.25 2.25 0 01-4.245 0H1.5v-1.5h3.128zm4.5-5.25a2.25 2.25 0 014.245 0H16.5v1.5h-3.127a2.25 2.25 0 01-4.245 0H1.5v-1.5h7.627zM4.627 3a2.25 2.25 0 014.245 0H16.5v1.5H8.873a2.25 2.25 0 01-4.245 0H1.5V3h3.128zM6.75 4.5a.75.75 0 100-1.5.75.75 0 000 1.5zm4.5 5.25a.75.75 0 100-1.5.75.75 0 000 1.5zM6.75 15a.75.75 0 100-1.5.75.75 0 000 1.5z" fill="#FFF" fill-rule="nonzero"/></g></svg>',vn='<svg viewBox="0 0 28 16" xmlns="http://www.w3.org/2000/svg" style="width:28px;height:16px"><g fill="none" fill-rule="evenodd"><path d="M0 8c0-4.418 3.575-8 8.005-8h11.99C24.416 0 28 3.59 28 8c0 4.418-3.575 8-8.005 8H8.005A8 8 0 010 8z" fill="#FF5000"/><path d="M20 14a6 6 0 100-12 6 6 0 000 12z" fill="#FFF"/></g></svg>',mn='<svg viewBox="0 0 28 16" xmlns="http://www.w3.org/2000/svg" style="width:28px;height:16px"><g fill="none" fill-rule="evenodd"><path d="M0 8c0-4.418 3.575-8 8.005-8h11.99C24.416 0 28 3.59 28 8c0 4.418-3.575 8-8.005 8H8.005A8 8 0 010 8z" fill="#FFF"/><path d="M8 14A6 6 0 108 2a6 6 0 000 12z" fill="#FF5000"/></g></svg>',An='<svg viewBox="0 0 7 12" xmlns="http://www.w3.org/2000/svg" style="width:7px;height:12px"><path d="M7 5.972a.834.834 0 00-.245-.591L1.62.245A.836.836 0 10.436 1.428l4.545 4.544-4.545 4.545a.837.837 0 001.183 1.182l5.136-5.135A.834.834 0 007 5.972z" fill="#FFF" fill-rule="nonzero"/></svg>',gn='<svg viewBox="0 0 14 10" xmlns="http://www.w3.org/2000/svg" style="width:14px;height:10px"><path d="M5.513 9.47a.984.984 0 01-.698-.29L.866 5.215a.995.995 0 010-1.402.984.984 0 011.396 0l3.251 3.264L11.725.84a.983.983 0 011.396 0 .994.994 0 010 1.401L6.211 9.18a.985.985 0 01-.698.29z" fill="#FFF" fill-rule="nonzero"/></svg>',yn=[2,1.75,1.5,1.25,1,.75,.5,.25],En=Object(n["c"])({name:"kwai-player-controls-danmaku",setup:function(e,t){t.emit;var i=R("levelMeterSetting",{open:!1}),r=Object(n["q"])(!1),a=D().playbackRate,s=Object(n["q"])(null);return Object(n["t"])((function(){return r.value}),(function(){s.value.calculatePosition()})),{current:gn,playbackRateList:yn,arrow:An,playbackRate:a,settingIcon:pn,levelMeterSetting:i,showPlaybackRate:r,levelMeterOpen:vn,levelMeterClose:mn,tooltip:s}},components:{plTooltip:fn}}),bn=En,Tn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"setting-wrapper"},[i("pl-tooltip",{ref:"tooltip",staticClass:"setting-tooltip",attrs:{placement:"top","insert-to-global":!1},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"setting"},[e.showPlaybackRate?[i("div",{staticClass:"playback-rate-title",on:{click:function(t){e.showPlaybackRate=!1}}},[i("span",{staticClass:"playback-rate-back",domProps:{innerHTML:e._s(e.arrow)}}),e._v("\n                        播放速度\n                    ")]),e._v(" "),i("ul",{staticClass:"playback-rate-content"},e._l(e.playbackRateList,(function(t){return i("li",{key:t,staticClass:"playback-rate-item",on:{click:function(i){e.playbackRate=t}}},[e.playbackRate===t?i("span",{staticClass:"current",domProps:{innerHTML:e._s(e.current)}}):e._e(),e._v("\n                            "+e._s(1===t?"正常":t)+"\n                        ")])})),0)]:[i("div",{staticClass:"setting-line"},[i("span",[e._v("电平条")]),e._v(" "),e.levelMeterSetting.open?i("div",{staticClass:"setting-detail icon",domProps:{innerHTML:e._s(e.levelMeterOpen)},on:{click:function(t){e.levelMeterSetting.open=!e.levelMeterSetting.open}}}):i("div",{staticClass:"setting-detail icon",domProps:{innerHTML:e._s(e.levelMeterClose)},on:{click:function(t){e.levelMeterSetting.open=!e.levelMeterSetting.open}}})]),e._v(" "),i("div",{staticClass:"setting-line"},[i("span",[e._v("播放速度")]),e._v(" "),i("div",{staticClass:"setting-detail icon",on:{click:function(t){e.showPlaybackRate=!0}}},[e._v("\n                            "+e._s(1===e.playbackRate?"正常":e.playbackRate)+"\n                            "),i("span",{staticClass:"playback-rate-arrow",domProps:{innerHTML:e._s(e.arrow)}})])])]],2)]},proxy:!0}])},[i("span",{staticClass:"setting-icon",domProps:{innerHTML:e._s(e.settingIcon)}})])],1)},Sn=[];Tn._withStripped=!0;var xn=void 0,Cn="data-v-158c7f94",Ln=void 0,Rn=!1,Dn=(h({render:Tn,staticRenderFns:Sn},xn,bn,Cn,Rn,Ln,void 0,void 0),"-_"),wn=36;while(wn--)Dn+=wn.toString(36);wn=36;while(wn---10)Dn+=wn.toString(36).toUpperCase();var In=function(e){var t="";wn=e||21;while(wn--)t+=Dn[64*Math.random()|0];return t},On=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Pn=Symbol("stop"),kn={SENDING:0,PAUSE:1,STOP:2},Nn=function(){function e(e,t){var i=this;this.running=!0,this.busyTime=0,this.waitingBusyTime=!1,this.id=e,this.pool=t,this.items=[],this.isStop=new Promise((function(e){i.stopHandler=function(){return e(Pn)}}))}return e.prototype.stop=function(){this.running=!1,this.stopHandler&&this.stopHandler(),this.items=[]},e.prototype.clear=function(){this.items=[]},e.prototype.pause=function(){this.running=!1,this.stopHandler&&this.stopHandler(),this.items.forEach((function(e){e.positionX=e.getCurrentPositionX(),e.scrollTime=0,e.timeoutHandler&&clearTimeout(e.timeoutHandler)}));var e=this.items[this.items.length-1];e&&(this.busyTime=e.canSendNextTime-(e.originInfo.originScrollTime-e.getCurrentScrollTime()),console.log("this.busyTime",this.busyTime))},e.prototype.restart=function(){return o(this,void 0,void 0,(function(){var e,t=this;return c(this,(function(i){switch(i.label){case 0:return this.items.forEach((function(e){e.onHandle||(e.scrollTime=e.getCurrentScrollTime(),e.positionX=e.originInfo.positionX,e.timeoutHandler=t.getDanmakuItemTimeOutHandler(e))})),this.isStop=new Promise((function(e){t.stopHandler=function(){return e(Pn)}})),this.busyTime=this.busyTime<0?0:this.busyTime,this.waitingBusyTime?[3,2]:(this.waitingBusyTime=!0,[4,Promise.race([On(this.busyTime),this.isStop])]);case 1:if(e=i.sent(),this.waitingBusyTime=!1,e===Pn)return[2];this.running=!0,this.start(),i.label=2;case 2:return[2]}}))}))},e.prototype.getDanmakuItemTimeOutHandler=function(e){var t=this;return setTimeout((function(){t.items.splice(t.items.indexOf(e),1),e.finishCallback&&e.finishCallback(e)}),e.scrollTime)},e.prototype.reRenderDanmaku=function(e,t,i){return o(this,void 0,void 0,(function(){var n,r,a=this;return c(this,(function(s){switch(s.label){case 0:return n=this.items[this.items.length-1],r=n.getCurrentPositionX()+n.originInfo.danmukuLength,r>e?(this.busyTime=(r-e)/t*1e3,n.originInfo.originScrollTime=r/t*1e3,i===kn.SENDING&&this.running?(this.running=!1,this.stopHandler&&this.stopHandler(),[4,On(this.busyTime)]):[3,2]):[3,2];case 1:s.sent(),this.isStop=new Promise((function(e){a.stopHandler=function(){return e(Pn)}})),this.running=!0,this.start(),s.label=2;case 2:return[2]}}))}))},e.prototype.start=function(){return o(this,void 0,void 0,(function(){var e,t;return c(this,(function(i){switch(i.label){case 0:return this.running?[4,Promise.race([this.pool.pop(this.id),this.isStop])]:[3,3];case 1:return e=i.sent(),e!==Pn&&e?this.running?(e.lineId=this.id,this.items.push(e),e.sendCallback(),e.timeoutHandler=this.getDanmakuItemTimeOutHandler(e),[4,Promise.race([On(e.canSendNextTime),this.isStop])]):[3,3]:[3,3];case 2:return t=i.sent(),t===Pn?[3,3]:[3,0];case 3:return[2]}}))}))},e}(),Mn=function(){function e(){this.deque=[],this.listeners=[],this.running=!0,this.lines=[]}return e.prototype.scaleLines=function(e){var t,i=this;if(!this.lines.length)return this.lines=u(new Array(e)).map((function(e,t){return new Nn(t,i)})),void this.lines.forEach((function(e){return e.start()}));if(e<this.lines.length)while(this.lines.length>e)this.lines.pop().stop();else if(e>this.lines.length){var n=this.lines.length,r=u(new Array(e-this.lines.length)).map((function(e,t){return new Nn(t+n,i)}));r.forEach((function(e){return e.start()})),(t=this.lines).push.apply(t,r)}},e.prototype.judge=function(){if(this.deque.length&&this.listeners.length&&this.listeners.pop().resolve(this.deque.pop()),this.deque.length>2*this.lines.length){var e=this.deque.reverse().findIndex((function(e){return 1!==e.priority}));this.deque.splice(e,1)}},e.prototype.push=function(e){this.running&&(e.priority=1,this.deque.push(e),this.judge())},e.prototype.unshift=function(e){this.running&&(this.deque.unshift(e),this.judge())},e.prototype.pop=function(e){var t=this;return new Promise((function(i){t.deque.length?i(t.deque.pop()):t.addListener({lineId:e,resolve:i})}))},e.prototype.addListener=function(e){var t=e.lineId,i=e.resolve,n=this.listeners.findIndex((function(e){return e.lineId<=t}));this.listeners.splice(n,0,{lineId:t,resolve:i})},e.prototype.stop=function(){this.deque=[],this.listeners.forEach((function(e){return e.resolve(Pn)})),this.lines.forEach((function(e){e.stop()})),this.lines=[]},e.prototype.pause=function(){var e;this.running=!1,this.lines.forEach((function(e){e.pause()}));while(this.listeners.length)null===(e=this.listeners.pop())||void 0===e||e.resolve(Pn)},e.prototype.restart=function(){this.running=!0,this.lines.forEach((function(e){e.restart()}))},e.prototype.clearDeque=function(){this.deque=[]},e.prototype.reRender=function(e,t,i){this.lines.forEach((function(n){n.reRenderDanmaku(e,t,i)}))},e}(),Bn={small:5,medium:10,large:30,"extra-large":60},Vn={max:{lineHeight:36.4,fontSize:26},min:{lineHeight:22*1.4,fontSize:22}},Fn={SENDING:0,PAUSE:1,STOP:2},Un=Object(n["c"])({props:{canListenPageVisible:{type:Boolean,default:!0},danmakuConfig:{type:Object,default:{fontSize:26,fontFamily:'SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif',lineHeight:36.4,canChangeFont:!0,danmakuLineNum:0}}},setup:function(e,t){var i=Object(n["q"])(new Mn),u=R("danmakuSetting",{isDanmakuOpen:!0,density:"medium",opacity:1}),d=Object(n["a"])((function(){return Bn[u.value.density]})),_=Object(n["p"])({config:Object.assign({lineHeight:30,fontSize:26,fontFamily:'SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif'},e.danmakuConfig),screen:{width:0,height:0},xSpeed:150}),h=Object(n["q"])(Fn.SENDING);function l(){h.value=Fn.SENDING}function f(){h.value=Fn.STOP,m()}function p(){h.value=Fn.PAUSE,i.value.pause()}function v(){h.value=Fn.SENDING,i.value.restart()}function m(){i.value.stop(),i.value=new Mn,b()}var A=Object(n["q"])(null);function g(t,n){var s=this;if(void 0===n&&(n=!1),"object"!==a(t)&&(t={content:t+""}),h.value!==Fn.STOP){var u={id:In(),commentInfo:t,positionX:0,positionY:0,lineId:0,scrollTime:0,type:"comment",canSendNextTime:0,sendCallback:function(){return o(s,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},offsetTop:0,color:"#fff",onHandle:!1,getCurrentPositionX:function(){return 0},originInfo:{positionX:0,danmukuLength:0,originScrollTime:0},getCurrentScrollTime:function(){return 0}},l=d.value*Math.random()*10;u.positionX=_.screen.width+l,u.originInfo.danmukuLength=u.commentInfo.content.length*_.config.fontSize,u.getCurrentScrollTime=function(){return(u.positionX+u.originInfo.danmukuLength)/_.xSpeed*1e3},u.scrollTime=u.getCurrentScrollTime(),u.originInfo.originScrollTime=u.scrollTime,u.canSendNextTime=(u.positionX-_.screen.width+u.originInfo.danmukuLength+d.value+l)/_.xSpeed*1e3,u.sendCallback=function(){var i;return(null===(i=e.danmakuConfig)||void 0===i?void 0:i.itemCallBack)&&e.danmakuConfig.itemCallBack({from:null===t||void 0===t?void 0:t.from}),r["default"].nextTick().then((function(){var e;null===(e=A.value)||void 0===e||e.offsetTop,u.positionX=-u.originInfo.danmukuLength,u.originInfo.positionX=u.positionX}))},u.getCurrentPositionX=function(){var e,t=document.querySelector(".danmaku-"+u.id),i=getComputedStyle(t).transform;if(i){var n=(null===(e=i.split(","))||void 0===e?void 0:e[4])||0;return Number(n)}return u.positionX},n?i.value.push(u):i.value.unshift(u)}}function y(){_.screen.width>=920?Object.assign(_.config,Vn.max):Object.assign(_.config,Vn.min)}function E(){var e=_.config.danmakuLineNum?_.config.danmakuLineNum:Math.ceil(_.screen.height/3/_.config.lineHeight);i.value.scaleLines(e)}function b(){E(),_.config.canChangeFont&&y()}function T(){return e.danmakuConfig.handleHover&&h.value===Fn.SENDING}function S(e,t,i){e.onHandle=!0,T()&&(e.positionX=e.getCurrentPositionX(),e.timeoutHandler&&clearTimeout(e.timeoutHandler))}function x(e,t,i){e.onHandle=!1,T()&&(e.scrollTime=.8*e.getCurrentScrollTime(),e.positionX=e.originInfo.positionX,e.timeoutHandler=t.getDanmakuItemTimeOutHandler(e))}function C(e,i){t.emit("click-danmaku",e,i)}return e.canListenPageVisible&&$((function(){return window}),"visibilitychange",(function(){if(h.value!==Fn.PAUSE){var e=document.visibilityState;"hidden"===e?f():l()}})),w("loadstart",(function(){requestAnimationFrame((function(){var e,t;_.screen.height=(null===(e=A.value)||void 0===e?void 0:e.clientHeight)||660,_.screen.width=(null===(t=A.value)||void 0===t?void 0:t.clientWidth)||1180,b()}))})),$((function(){return window}),"resize",(function(){var e,t;(null===(e=A.value)||void 0===e?void 0:e.clientHeight)===_.screen.height&&(null===(t=A.value)||void 0===t?void 0:t.clientWidth)===_.screen.width||requestAnimationFrame((function(){var e,t;i.value.clearDeque(),_.screen.height=(null===(e=A.value)||void 0===e?void 0:e.clientHeight)||440,_.screen.width=(null===(t=A.value)||void 0===t?void 0:t.clientWidth)||730,b(),i.value.reRender(_.screen.width,_.xSpeed,h.value)}))})),Object(n["l"])((function(){u.value.isDanmakuOpen?l():f()})),Object(n["j"])((function(){f()})),Object(n["t"])((function(){return u.value.isDanmakuOpen}),(function(){u.value.isDanmakuOpen?l():f()})),s(s({danmakuSetting:u,pool:i,danmaku:A,safeSpace:d,status:h,statusMap:Fn,send:g},Object(n["s"])(_)),{pause:p,restart:v,clearAllDanmaku:m,stop:f,start:l,handleMouseEnter:S,handelMouseLeave:x,clickItem:C})}}),Hn=Un,jn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"danmaku",staticClass:"danmaku",on:{contextmenu:function(e){return e.returnValue=!1,e.preventDefault(),!1}}},[e.status!==e.statusMap.STOP?e._l(e.pool.lines,(function(t){return i("div",{key:t.id},[e._l(t.items,(function(n){return["comment"===n.type?i("div",{key:n.id,staticClass:"danmaku-item",class:["self"===n.commentInfo.from?"my-comment":"",n.commentInfo.color?"color-danmaku":"","danmaku-"+n.id,n.commentInfo.isLiked?"danmaku-liked":""],style:{fontFamily:e.config.fontFamily,fontSize:e.config.fontSize+"px",lineHeight:e.config.lineHeight+"px",transform:"translate3D("+n.positionX+"px, "+e.config.lineHeight*n.lineId+"px, 0)",transition:"transform linear "+n.scrollTime+"ms",color:n.commentInfo.color,opacity:e.danmakuSetting.opacity},on:{mouseenter:function(i){return e.handleMouseEnter(n,t,i)},mouseleave:function(i){return e.handelMouseLeave(n,t,i)},click:function(t){return e.clickItem(n,t)}}},[i("div",[e._v("\n                        "+e._s(n.commentInfo.content)+"\n                    ")]),e._v(" "),e._t("danmaku-item",null,{scope:n,line:t})],2):e._e()]}))],2)})):e._e()],2)},zn=[];jn._withStripped=!0;var Gn=void 0,Wn="data-v-564289e0",Kn=void 0,Qn=!1,Yn=h({render:jn,staticRenderFns:zn},Gn,Hn,Wn,Qn,Kn,void 0,void 0),Xn='<svg viewBox="0 0 50 20" xmlns="http://www.w3.org/2000/svg" style="width:50px;height:20px"><g fill="none" fill-rule="evenodd"><rect fill="#FF8000" width="50" height="20" rx="10"/><path d="M6.764 8.084H9.02V4.7H5.816v.756H8.18v1.872H5.996l-.312 3.456H8.3c0 1.44-.06 2.4-.18 2.856-.108.432-.516.66-1.224.66-.3 0-.588-.024-.876-.048l.216.804c.288.024.576.048.852.048 1.068-.048 1.68-.408 1.836-1.104.12-.624.192-1.956.192-3.972H6.56l.204-1.944zm3.288-1.944h3.492c.36-.648.66-1.32.924-2.028l.828.288a9.843 9.843 0 01-.9 1.74h1.56v4.812H13.4v1.164h3.084v.804H13.4v2.304h-.84V12.92H9.524v-.804h3.036v-1.164h-2.508V6.14zm5.124 4.08V8.924H13.4v1.296h1.776zm-2.616 0V8.924h-1.74v1.296h1.74zm-1.74-2.016h1.74V6.872h-1.74v1.332zm2.58-1.332v1.332h1.776V6.872H13.4zm-1.932-2.688c.36.492.672 1.02.936 1.572l-.744.324a9.03 9.03 0 00-.984-1.644l.792-.252zm11.76 7.212h.817v.84h2.772c-.648-.384-1.152-.792-1.512-1.248h-3.108c-.42.456-.948.876-1.584 1.248h2.616v-.84zm0 1.5h-2.267V14.9h-.816v-2.412c-.504.252-1.044.48-1.62.684l-.372-.72c1.296-.408 2.304-.888 3.012-1.464h-2.712v-.72h3.408c.144-.204.264-.408.36-.624h-2.448v-3.18h1.392v-.768h-2.856v-.708h2.856v-.804h.828v.804h3.252v-.804h.828v.804h2.856v.708h-2.856v.768h1.392v3.18h-4.44c-.084.216-.18.42-.3.624h6.048v.72H26.18c.66.588 1.644 1.056 2.94 1.392l-.348.72a12.268 12.268 0 01-1.44-.588v1.452c0 .624-.348.948-1.044.948h-.912l-.18-.72.852.024c.312 0 .468-.144.468-.432v-.888h-2.472V15.2h-.816v-2.304zm2.017-7.2h-3.252v.768h3.252v-.768zm1.404 3.348v-.72h-6.06v.72h6.06zm-6.06-1.284h6.06v-.672h-6.06v.672z" fill="#fff"/><circle fill="#fff" cx="40" cy="10" r="9"/></g></svg>',qn='<svg viewBox="0 0 50 20" xmlns="http://www.w3.org/2000/svg" style="width:50px;height:20px"><g fill="#fff" fill-rule="evenodd"><rect opacity=".2" width="50" height="20" rx="10"/><path d="M21.764 8.084h2.256V4.7h-3.204v.756h2.364v1.872h-2.184l-.312 3.456H23.3c0 1.44-.06 2.4-.18 2.856-.108.432-.516.66-1.224.66-.3 0-.588-.024-.876-.048l.216.804c.288.024.576.048.852.048 1.068-.048 1.68-.408 1.836-1.104.12-.624.192-1.956.192-3.972H21.56l.204-1.944zm3.288-1.944h3.492c.36-.648.66-1.32.924-2.028l.828.288a9.843 9.843 0 01-.9 1.74h1.56v4.812H28.4v1.164h3.084v.804H28.4v2.304h-.84V12.92h-3.036v-.804h3.036v-1.164h-2.508V6.14zm5.124 4.08V8.924H28.4v1.296h1.776zm-2.616 0V8.924h-1.74v1.296h1.74zm-1.74-2.016h1.74V6.872h-1.74v1.332zm2.58-1.332v1.332h1.776V6.872H28.4zm-1.932-2.688c.36.492.672 1.02.936 1.572l-.744.324a9.03 9.03 0 00-.984-1.644l.792-.252zm11.76 7.212h.817v.84h2.772c-.648-.384-1.152-.792-1.512-1.248h-3.108c-.42.456-.948.876-1.584 1.248h2.616v-.84zm0 1.5h-2.267V14.9h-.816v-2.412c-.504.252-1.044.48-1.62.684l-.372-.72c1.296-.408 2.304-.888 3.012-1.464h-2.712v-.72h3.408c.144-.204.264-.408.36-.624h-2.448v-3.18h1.392v-.768h-2.856v-.708h2.856v-.804h.828v.804h3.252v-.804h.828v.804h2.856v.708h-2.856v.768h1.392v3.18h-4.44c-.084.216-.18.42-.3.624h6.048v.72H41.18c.66.588 1.644 1.056 2.94 1.392l-.348.72a12.268 12.268 0 01-1.44-.588v1.452c0 .624-.348.948-1.044.948h-.912l-.18-.72.852.024c.312 0 .468-.144.468-.432v-.888h-2.472V15.2h-.816v-2.304zm2.017-7.2h-3.252v.768h3.252v-.768zm1.404 3.348v-.72h-6.06v.72h6.06zm-6.06-1.284h6.06v-.672h-6.06v.672z"/><circle cx="10" cy="10" r="9"/></g></svg>',Zn=Object(n["c"])({name:"kwai-player-controls-danmaku",setup:function(e,t){t.emit;var i=R("isFullscreen",!1),r=R("danmakuSetting",{isDanmakuOpen:!0,density:"medium",opacity:1}),a=Object(n["q"])(!1),s=0,o=0;function c(e){a.value=!0,s=e.clientX,o=r.value.opacity}var u=Object(n["q"])(null);function d(e,t){var i;if(void 0===t&&(t="mousemove"),"mousemove"!==t||a.value){var n=e.target;if("click"!==t||0===n.clientWidth){var c=(s-e.clientX)/(null===(i=u.value)||void 0===i?void 0:i.clientWidth);c=o-c,c=c>1?1:c,c=c<0?0:c,r.value.opacity=c}else{var d=e.offsetX/n.clientWidth;r.value.opacity=d}}}return $((function(){return window}),"mouseup",(function(){a.value=!1}),!0),{slider:u,setOpacityStart:c,changeOpacity:d,danmakuSetting:r,isFullscreen:i,danmakuOpenIcon:Xn,danmakuCloseIcon:qn}},components:{plTooltip:fn}}),Jn=Zn,$n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"danmaku-wrapper"},[i("pl-tooltip",{staticClass:"tooltip",attrs:{placement:"top","insert-to-global":!1},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"danmaku-setting",on:{mousemove:function(t){return e.changeOpacity(t)}}},[i("div",{staticClass:"danmaku"},[i("span",[e._v("弹幕开关")]),e._v(" "),e.danmakuSetting.isDanmakuOpen?i("div",{staticClass:"danmaku-icon",domProps:{innerHTML:e._s(e.danmakuOpenIcon)},on:{click:function(t){e.danmakuSetting.isDanmakuOpen=!e.danmakuSetting.isDanmakuOpen}}}):i("div",{staticClass:"danmaku-icon",domProps:{innerHTML:e._s(e.danmakuCloseIcon)},on:{click:function(t){e.danmakuSetting.isDanmakuOpen=!e.danmakuSetting.isDanmakuOpen}}})]),e._v(" "),i("div",{staticClass:"danmaku"},[i("span",[e._v("透明度")]),e._v(" "),i("div",{staticClass:"opacity-slide"},[i("div",{ref:"slider",staticClass:"opacity-all",on:{click:function(t){return e.changeOpacity(t,"click")}}},[i("span",{staticClass:"opacity-active",style:{width:100*e.danmakuSetting.opacity+"%"}},[i("span",{staticClass:"opacity-ball",on:{mousedown:function(t){return e.setOpacityStart(t)}}})])])])]),e._v(" "),i("div",[i("span",[e._v("显示密度")]),e._v(" "),i("div",{staticClass:"density"},[i("span",{class:{actived:"small"===e.danmakuSetting.density},on:{click:function(t){e.danmakuSetting.density="small"}}},[e._v("\n                            小\n                        ")]),e._v(" "),i("span",{class:{actived:"medium"===e.danmakuSetting.density},on:{click:function(t){e.danmakuSetting.density="medium"}}},[e._v("\n                            中\n                        ")]),e._v(" "),i("span",{class:{actived:"large"===e.danmakuSetting.density},on:{click:function(t){e.danmakuSetting.density="large"}}},[e._v("\n                            大\n                        ")]),e._v(" "),i("span",{class:{actived:"extra-large"===e.danmakuSetting.density},on:{click:function(t){e.danmakuSetting.density="extra-large"}}},[e._v("\n                            最大\n                        ")])])])])]},proxy:!0}])},[e.danmakuSetting.isDanmakuOpen?i("span",{staticClass:"kwai-player-danmaku"},[e._v(" 弹幕开 ")]):i("span",{staticClass:"kwai-player-danmaku"},[e._v(" 弹幕关 ")])])],1)},er=[];$n._withStripped=!0;var tr=void 0,ir="data-v-ebd0af66",nr=void 0,rr=!1;h({render:$n,staticRenderFns:er},tr,Jn,ir,rr,nr,void 0,void 0)},"33cc":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("c552"),r=function(){function e(e,t){this.dt=e,this.ins=t,this.type="throttle",this.out=null,this.id=null}return e.prototype._start=function(e){this.out=e,this.ins._add(this)},e.prototype._stop=function(){this.ins._remove(this),this.out=null,this.id=null},e.prototype.clearInterval=function(){var e=this.id;null!==e&&clearInterval(e),this.id=null},e.prototype._n=function(e){var t=this,i=this.out;i&&(this.id||(i._n(e),this.id=setInterval((function(){t.clearInterval()}),this.dt)))},e.prototype._e=function(e){var t=this.out;t&&(this.clearInterval(),t._e(e))},e.prototype._c=function(){var e=this.out;e&&(this.clearInterval(),e._c())},e}();function a(e){return function(t){return new n.Stream(new r(e,t))}}t.default=a},5433:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("c552"),r=function(){function e(e,t,i){this.node=e,this.eventType=t,this.useCapture=i,this.type="fromEvent"}return e.prototype._start=function(e){this.listener=function(t){return e._n(t)},this.node.addEventListener(this.eventType,this.listener,this.useCapture)},e.prototype._stop=function(){this.node.removeEventListener(this.eventType,this.listener,this.useCapture),this.listener=null},e}();t.DOMEventProducer=r;var a=function(){function e(e,t){this.node=e,this.eventName=t,this.type="fromEvent"}return e.prototype._start=function(e){this.listener=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.length>1?e._n(t):e._n(t[0])},this.node.addListener(this.eventName,this.listener)},e.prototype._stop=function(){this.node.removeListener(this.eventName,this.listener),this.listener=null},e}();function s(e){return e.emit&&e.addListener}function o(e,t,i){return void 0===i&&(i=!1),s(e)?new n.Stream(new a(e,t)):new n.Stream(new r(e,t,i))}t.NodeEventProducer=a,t.default=o},"56ad":function(e,t,i){(function(e){var i,n,r;function a(e){return a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}(function(s,o){"object"===a(t)&&"object"===a(e)?e.exports=o():(n=[],i=o,r="function"===typeof i?i.apply(t,n):i,void 0===r||(e.exports=r))})(0,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===a(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="./src/index.ts")}({"./node_modules/events/events.js":
/*!***************************************!*\
        !*** ./node_modules/events/events.js ***!
        \***************************************/
/*! no static exports found */
function(e,t,i){"use strict";var n,r="object"===("undefined"===typeof Reflect?"undefined":a(Reflect))?Reflect:null,s=r&&"function"===typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};function o(e){console&&console.warn&&console.warn(e)}n=r&&"function"===typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var c=Number.isNaN||function(e){return e!==e};function u(){u.init.call(this)}e.exports=u,e.exports.once=E,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var d=10;function _(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+a(e))}function h(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function l(e,t,i,n){var r,a,s;if(_(i),a=e._events,void 0===a?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"===typeof s?s=a[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),r=h(e),r>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,o(c)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=f.bind(n);return r.listener=i,n.wrapFn=r,r}function v(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"===typeof r?i?[r.listener||r]:[r]:i?y(r):A(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function A(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function g(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function y(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}function E(e,t){return new Promise((function(i,n){function r(){void 0!==a&&e.removeListener("error",a),i([].slice.call(arguments))}var a;"error"!==t&&(a=function(i){e.removeListener(t,r),n(i)},e.once("error",a)),e.once(t,r)}))}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(e){if("number"!==typeof e||e<0||c(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");d=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||c(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return h(this)},u.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=r[e];if(void 0===c)return!1;if("function"===typeof c)s(c,this,t);else{var u=c.length,d=A(c,u);for(i=0;i<u;++i)s(d[i],this,t)}return!0},u.prototype.addListener=function(e,t){return l(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return l(this,e,t,!0)},u.prototype.once=function(e,t){return _(t),this.on(e,p(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return _(t),this.prependListener(e,p(this,e,t)),this},u.prototype.removeListener=function(e,t){var i,n,r,a,s;if(_(t),n=this._events,void 0===n)return this;if(i=n[e],void 0===i)return this;if(i===t||i.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!==typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():g(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,i,n;if(i=this._events,void 0===i)return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)r=a[n],"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},u.prototype.listeners=function(e){return v(this,e,!0)},u.prototype.rawListeners=function(e){return v(this,e,!1)},u.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},u.prototype.listenerCount=m,u.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},"./node_modules/omnitone/build/omnitone.min.esm.js":
/*!*********************************************************!*\
        !*** ./node_modules/omnitone/build/omnitone.min.esm.js ***!
        \*********************************************************/
/*! exports provided: default */
function(e,t,i){"use strict";i.r(t);
/**
         * @license
         * Copyright 2016 Google Inc. All Rights Reserved.
         * Licensed under the Apache License, Version 2.0 (the "License");
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         *     http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
var n,r,a,s,o,c,u,d,_,h,l,f,p,v,m,A,g,y,E,b,T,S,x,C,L,R,D,w,I,O={};O.log=function(){var e="[Omnitone] ".concat(Array.prototype.slice.call(arguments).join(" ")," (").concat(performance.now().toFixed(2),"ms)");window.console.log(e)},O.throw=function(){var e="[Omnitone] ".concat(Array.prototype.slice.call(arguments).join(" ")," (").concat(performance.now().toFixed(2),"ms)");throw new Error(e)},O.invertMatrix4=function(e,t){return n=t[0],r=t[1],a=t[2],s=t[3],o=t[4],c=t[5],u=t[6],d=t[7],_=t[8],h=t[9],l=t[10],f=t[11],p=t[12],v=t[13],m=t[14],A=t[15],(I=(g=n*c-r*o)*(w=l*A-f*m)-(y=n*u-a*o)*(D=h*A-f*v)+(E=n*d-s*o)*(R=h*m-l*v)+(b=r*u-a*c)*(L=_*A-f*p)-(T=r*d-s*c)*(C=_*m-l*p)+(S=a*d-s*u)*(x=_*v-h*p))?(I=1/I,e[0]=(c*w-u*D+d*R)*I,e[1]=(a*D-r*w-s*R)*I,e[2]=(v*S-m*T+A*b)*I,e[3]=(l*T-h*S-f*b)*I,e[4]=(u*L-o*w-d*C)*I,e[5]=(n*w-a*L+s*C)*I,e[6]=(m*E-p*S-A*y)*I,e[7]=(_*S-l*E+f*y)*I,e[8]=(o*D-c*L+d*x)*I,e[9]=(r*L-n*D-s*x)*I,e[10]=(p*T-v*E+A*g)*I,e[11]=(h*E-_*T-f*g)*I,e[12]=(c*C-o*R-u*x)*I,e[13]=(n*R-r*C+a*x)*I,e[14]=(v*y-p*b-m*g)*I,e[15]=(_*b-h*y+l*g)*I,e):null},O.isDefinedENUMEntry=function(e,t){for(var i in e)if(t===e[i])return!0;return!1},O.isAudioContext=function(e){return e instanceof AudioContext||e instanceof OfflineAudioContext},O.isAudioBuffer=function(e){return e instanceof AudioBuffer},O.mergeBufferListByChannel=function(e,t){for(var i=t[0].length,n=t[0].sampleRate,r=0,a=0;a<t.length;++a)r>32&&O.throw("Utils.mergeBuffer: Number of channels cannot exceed 32.(got "+r+")"),i!==t[a].length&&O.throw("Utils.mergeBuffer: AudioBuffer lengths are inconsistent. (expected "+i+" but got "+t[a].length+")"),n!==t[a].sampleRate&&O.throw("Utils.mergeBuffer: AudioBuffer sample rates are inconsistent. (expected "+n+" but got "+t[a].sampleRate+")"),r+=t[a].numberOfChannels;for(var s=e.createBuffer(r,i,n),o=0,c=0;c<t.length;++c)for(var u=0;u<t[c].numberOfChannels;++u)s.getChannelData(o++).set(t[c].getChannelData(u));return s},O.splitBufferbyChannel=function(e,t,i){t.numberOfChannels<=i&&O.throw("Utils.splitBuffer: Insufficient number of channels. ("+t.numberOfChannels+" splitted by "+i+")");for(var n=0,r=Math.ceil(t.numberOfChannels/i),a=0;a<r;++a)for(var s=e.createBuffer(i,t.length,t.sampleRate),o=0;o<i;++o)n<t.numberOfChannels&&s.getChannelData(o).set(t.getChannelData(n++));return bufferList},O.getArrayBufferFromBase64String=function(e){var t=window.atob(e),i=new Uint8Array(t.length);return i.forEach((function(e,n){return i[n]=t.charCodeAt(n)})),i.buffer};var P={BASE64:"base64",URL:"url"};function k(e,t,i){this._context=O.isAudioContext(e)?e:O.throw("BufferList: Invalid BaseAudioContext."),this._options={dataType:P.BASE64,verbose:!1},i&&(i.dataType&&O.isDefinedENUMEntry(P,i.dataType)&&(this._options.dataType=i.dataType),i.verbose&&(this._options.verbose=Boolean(i.verbose))),this._bufferList=[],this._bufferData=this._options.dataType===P.BASE64?t:t.slice(0),this._numberOfTasks=this._bufferData.length,this._resolveHandler=null,this._rejectHandler=new Function}k.prototype.load=function(){return new Promise(this._promiseGenerator.bind(this))},k.prototype._promiseGenerator=function(e,t){"function"!=typeof e?O.throw("BufferList: Invalid Promise resolver."):this._resolveHandler=e,"function"==typeof t&&(this._rejectHandler=t);for(var i=0;i<this._bufferData.length;++i)this._options.dataType===P.BASE64?this._launchAsyncLoadTask(i):this._launchAsyncLoadTaskXHR(i)},k.prototype._launchAsyncLoadTask=function(e){var t=this;this._context.decodeAudioData(O.getArrayBufferFromBase64String(this._bufferData[e]),(function(i){t._updateProgress(e,i)}),(function(i){t._updateProgress(e,null);var n='BufferList: decoding ArrayByffer("'+e+'" from Base64-encoded data failed. ('+i+")";t._rejectHandler(n),O.throw(n)}))},k.prototype._launchAsyncLoadTaskXHR=function(e){var t=new XMLHttpRequest;t.open("GET",this._bufferData[e]),t.responseType="arraybuffer";var i=this;t.onload=function(){if(200===t.status)i._context.decodeAudioData(t.response,(function(t){i._updateProgress(e,t)}),(function(t){i._updateProgress(e,null);var n='BufferList: decoding "'+i._bufferData[e]+'" failed. ('+t+")";i._rejectHandler(n),O.log(n)}));else{var n='BufferList: XHR error while loading "'+i._bufferData[e]+'". ('+t.status+" "+t.statusText+")";i._rejectHandler(n),O.log(n)}},t.onerror=function(t){i._updateProgress(e,null),i._rejectHandler(),O.log('BufferList: XHR network failed on loading "'+i._bufferData[e]+'".')},t.send()},k.prototype._updateProgress=function(e,t){if(this._bufferList[e]=t,this._options.verbose){var i=this._options.dataType===P.BASE64?"ArrayBuffer("+e+") from Base64-encoded HRIR":'"'+this._bufferData[e]+'"';O.log("BufferList: "+i+" successfully loaded.")}if(0==--this._numberOfTasks){var n=this._options.dataType===P.BASE64?this._bufferData.length+" AudioBuffers from Base64-encoded HRIRs":this._bufferData.length+" files via XHR";O.log("BufferList: "+n+" loaded successfully."),this._resolveHandler(this._bufferList)}};var N={DEFAULT:[0,1,2,3],SAFARI:[2,0,1,3],FUMA:[0,3,1,2]};function M(e,t){this._context=e,this._splitter=this._context.createChannelSplitter(4),this._merger=this._context.createChannelMerger(4),this.input=this._splitter,this.output=this._merger,this.setChannelMap(t||N.DEFAULT)}function B(e){this._context=e,this._splitter=this._context.createChannelSplitter(4),this._inY=this._context.createGain(),this._inZ=this._context.createGain(),this._inX=this._context.createGain(),this._m0=this._context.createGain(),this._m1=this._context.createGain(),this._m2=this._context.createGain(),this._m3=this._context.createGain(),this._m4=this._context.createGain(),this._m5=this._context.createGain(),this._m6=this._context.createGain(),this._m7=this._context.createGain(),this._m8=this._context.createGain(),this._outY=this._context.createGain(),this._outZ=this._context.createGain(),this._outX=this._context.createGain(),this._merger=this._context.createChannelMerger(4),this._splitter.connect(this._inY,1),this._splitter.connect(this._inZ,2),this._splitter.connect(this._inX,3),this._inY.gain.value=-1,this._inX.gain.value=-1,this._inY.connect(this._m0),this._inY.connect(this._m1),this._inY.connect(this._m2),this._inZ.connect(this._m3),this._inZ.connect(this._m4),this._inZ.connect(this._m5),this._inX.connect(this._m6),this._inX.connect(this._m7),this._inX.connect(this._m8),this._m0.connect(this._outY),this._m1.connect(this._outZ),this._m2.connect(this._outX),this._m3.connect(this._outY),this._m4.connect(this._outZ),this._m5.connect(this._outX),this._m6.connect(this._outY),this._m7.connect(this._outZ),this._m8.connect(this._outX),this._splitter.connect(this._merger,0,0),this._outY.connect(this._merger,0,1),this._outZ.connect(this._merger,0,2),this._outX.connect(this._merger,0,3),this._outY.gain.value=-1,this._outX.gain.value=-1,this.setRotationMatrix3(new Float32Array([1,0,0,0,1,0,0,0,1])),this.input=this._splitter,this.output=this._merger}function V(e,t){this._context=e,this._active=!1,this._isBufferLoaded=!1,this._buildAudioGraph(),t&&this.setHRIRBufferList(t),this.enable()}M.prototype.setChannelMap=function(e){Array.isArray(e)&&(this._channelMap=e,this._splitter.disconnect(),this._splitter.connect(this._merger,0,this._channelMap[0]),this._splitter.connect(this._merger,1,this._channelMap[1]),this._splitter.connect(this._merger,2,this._channelMap[2]),this._splitter.connect(this._merger,3,this._channelMap[3]))},M.ChannelMap=N,B.prototype.setRotationMatrix3=function(e){this._m0.gain.value=e[0],this._m1.gain.value=e[1],this._m2.gain.value=e[2],this._m3.gain.value=e[3],this._m4.gain.value=e[4],this._m5.gain.value=e[5],this._m6.gain.value=e[6],this._m7.gain.value=e[7],this._m8.gain.value=e[8]},B.prototype.setRotationMatrix4=function(e){this._m0.gain.value=e[0],this._m1.gain.value=e[1],this._m2.gain.value=e[2],this._m3.gain.value=e[4],this._m4.gain.value=e[5],this._m5.gain.value=e[6],this._m6.gain.value=e[8],this._m7.gain.value=e[9],this._m8.gain.value=e[10]},B.prototype.getRotationMatrix3=function(){return[this._m0.gain.value,this._m1.gain.value,this._m2.gain.value,this._m3.gain.value,this._m4.gain.value,this._m5.gain.value,this._m6.gain.value,this._m7.gain.value,this._m8.gain.value]},B.prototype.getRotationMatrix4=function(){var e=new Float32Array(16);return e[0]=this._m0.gain.value,e[1]=this._m1.gain.value,e[2]=this._m2.gain.value,e[4]=this._m3.gain.value,e[5]=this._m4.gain.value,e[6]=this._m5.gain.value,e[8]=this._m6.gain.value,e[9]=this._m7.gain.value,e[10]=this._m8.gain.value,e},V.prototype._buildAudioGraph=function(){this._splitterWYZX=this._context.createChannelSplitter(4),this._mergerWY=this._context.createChannelMerger(2),this._mergerZX=this._context.createChannelMerger(2),this._convolverWY=this._context.createConvolver(),this._convolverZX=this._context.createConvolver(),this._splitterWY=this._context.createChannelSplitter(2),this._splitterZX=this._context.createChannelSplitter(2),this._inverter=this._context.createGain(),this._mergerBinaural=this._context.createChannelMerger(2),this._summingBus=this._context.createGain(),this._splitterWYZX.connect(this._mergerWY,0,0),this._splitterWYZX.connect(this._mergerWY,1,1),this._splitterWYZX.connect(this._mergerZX,2,0),this._splitterWYZX.connect(this._mergerZX,3,1),this._mergerWY.connect(this._convolverWY),this._mergerZX.connect(this._convolverZX),this._convolverWY.connect(this._splitterWY),this._convolverZX.connect(this._splitterZX),this._splitterWY.connect(this._mergerBinaural,0,0),this._splitterWY.connect(this._mergerBinaural,0,1),this._splitterWY.connect(this._mergerBinaural,1,0),this._splitterWY.connect(this._inverter,1,0),this._inverter.connect(this._mergerBinaural,0,1),this._splitterZX.connect(this._mergerBinaural,0,0),this._splitterZX.connect(this._mergerBinaural,0,1),this._splitterZX.connect(this._mergerBinaural,1,0),this._splitterZX.connect(this._mergerBinaural,1,1),this._convolverWY.normalize=!1,this._convolverZX.normalize=!1,this._inverter.gain.value=-1,this.input=this._splitterWYZX,this.output=this._summingBus},V.prototype.setHRIRBufferList=function(e){this._isBufferLoaded||(this._convolverWY.buffer=e[0],this._convolverZX.buffer=e[1],this._isBufferLoaded=!0)},V.prototype.enable=function(){this._mergerBinaural.connect(this._summingBus),this._active=!0},V.prototype.disable=function(){this._mergerBinaural.disconnect(),this._active=!1};var F=["UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD+/wIA9v8QAPv/CwD+/wcA/v8MAP//AQD7/wEACAAEAPj/+v8YABAA7v/n//v/9P/M/8D//f34/R38EvzxAfEBtA2lDTcBJQFJ9T71FP0D/cD1tfVo/Wv9uPTO9PPmOufc/U/+agL3Aisc/RxuGKEZBv3j/iYMzQ2gAzsEQQUABiQFrASzA5cB2QmyCy0AtgR4AeYGtfgAA2j5OQHP+scArPsMBJgEggIEBtz6+QVq/pj/aPg8BPP3gQEi+jEAof0fA1v9+/7S+8IBjvwd/xD4IADL/Pf9zvs+/l3+wgB7/+L+7fzFADH9kf6A+n3+DP6+/TP9xP68/pn+w/26/i39YgA0/u790Pt9/kD+7v1s/Wb+8f4C/1P+pf/x/cT+6/3p/Xz9ff5F/0f9G/4r/6v/4P5L/sL+ff7c/pj+Ov7X/UT+9P5G/oz+6v6A/2D+9/6P/8r/bP7m/ij+C//e/tj/Gf4e/9v+FwDP/lz/sP7F/2H+rv/G/s7/Hf7y/4P+NAD9/k0AK/6w/zP/hACh/sX/gf44AOP+dgCm/iUAk/5qAOD+PwC+/jEAWP4CAAr/bQBw/vv/zf5iACD/OgCS/uD/Cv9oAAb/CgDK/kwA//5tACH/TgCg/h4AHP9aABP/JADP/hEAYv9gAAj/3f8m/ysAYv8gACX/8/8k/ysAXv8bABH//v8j/ygAa/8qAAD/9f9g/1YAWf8JACH/AgB2/z4AXP/w/z3/FgB2/ykAX//9/z//EwCV/zUAS//n/1T/GACK/x4ATv/0/4P/QQB4//v/WP/2/3X/HAB8//P/V//3/2f/AQBh/9v/Tf/x/5P/IwCI/wMAf/8hAKP/JACZ/xUAiv8nAK//HgCr/yMAm/8uAMz/OACi/yQAqf87AMT/MwCY/yUAtP9FAMH/KgCu/ycAyP85AMv/IwCz/xoA1f8qAMn/FgC8/xQA4/8nAMX/CwDJ/xQA4f8ZAMH/BgDO/xQA4f8WAMP/BwDU/xQA4P8QAMH/AQDb/xQA3P8JAMP/AgDh/xIA2v8EAMj/AgDk/w0A1f/+/8v/AwDm/wwA0v/+/9H/BgDl/wkAzv/8/9T/BwDk/wcAzv/8/9r/CQDi/wQAzf/8/9//CADf////0P/9/+L/BwDd//7/0////+T/BgDb//z/1f8AAOf/BQDZ//v/2v8CAOb/AwDY//v/3v8EAOb/AgDY//3/4f8FAOX/AQDZ//7/5P8GAOP/AADb/wAA5/8GAOH////d/wIA5/8FAOD////f/wMA6P8FAOD////h/wQA6P8EAN7////h/wUA4v8DANv/AQDd/wQA3P8CANn/AgDb/wMA2/8CANv/AgDd/wIA3v8CAOH/AQDj/wEA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAAAA/f8CAP//AQD//wEA//8BAP3/AAACAP7/+f8AAAIA/P8FAAQA8/8AABoA+f/V/wQAHQDO/xoAQQBO/ocA0Px1/ucHW/4UCm8HLO6kAjv8/fCRDdAAYfPiBIgFXveUCM0GBvh6/nz7rf0J/QcQSRVdBgoBSgFR62r9NP8m+LoEAvriBVAAiAPmABEGMf2l+SwBjva6/G4A//8P/CYDMgXm/R0CKAE6/fcBBwAtAND+kQA0A5UDhwFs/8IB8fydAEP/A/8v/e7/mP8j/2YBIwE3Av0AYv+uAOD8lgAg/wwAIf/L/n0Ae//OAJMB3P/XAF//XwCM/08AB/8NAEf/rf4jAT3/lgAJAP4AHgDpAO8AUf9L/07/Qf8KAOD/x/+D/3sATQCDAMoA0f79/+L/EQDt/7EAqv+S/7IAuv/o/wgAc//X//H/SwCm/+3/Yf/B/yoAAADI/7X/AwBg/5EATgCX/xYA/P+q/00AVACY/6v/BADD/zwALQCN/8z/KQDu/ygAEgCZ/6f/VQDC//T/KQCs/7P/UgAfAO7/NgC8/57/awAZAPP/+P/V/8z/bQBBAL//DgD0/+T/TABBAMz/CwAxAPz/SQBqALn/BgALAPz/EAA7AIz/3/8iAAUA//8kALf/y/9VABQA+v81AOj/0P9cAB4A+f8WAOr/vv83ABgAw/8JAOj/4f8nACIAsf/y/w4A3v8gACQAxP/n/ycA7P8WAC0Ayf/U/ycA9v/7/yUA0P/P/zUABADc/xUA5P/J/zcACwDS/xUA9P/m/zAACQDX/+3/9v/2/yQACgDZ/+P/AwAKABYA///b/9j/EQALABkADgD6/+7/GwD4/w4A8P/w//j/EgAEAAUA9f/1/wQAGgD4/wAA5////wAAGQD1////7f8FAAUAFQDv/wAA6v8LAAcAFQDs/wEA9P8SAAYACwDr//7/AQASAAYABQDv/wIAAwAWAAIAAgDv/wAABgATAAEA/f/u/wQABgAQAPr/+P/z/wUACQALAPj/9//4/wgABwAKAPT/+f/5/w4ABwAIAPT/+//9/w4AAwADAPH//f///w8A//8BAPP///8BAA0A/f/+//X/AgACAA0A+//8//b/BAADAAoA+f/7//n/BgADAAcA+P/7//v/BwABAAQA+P/8//3/CQABAAIA9//9////CQD/////+P///wAACAD9//7/+f8AAAAABwD8//3/+v8CAAAABgD7//z//P8EAAAABAD6//3//P8FAP//AgD6//7//v8FAP7/AQD7//////8GAP7/AAD7/wEA//8EAP3/AAD9/wEA/v8DAP3/AAD9/wIA/v8CAP3/AQD9/wIA/v8CAP7/AQD+/wEA"],U={AMBISONIC:"ambisonic",BYPASS:"bypass",OFF:"off"};function H(e,t){this._context=O.isAudioContext(e)?e:O.throw("FOARenderer: Invalid BaseAudioContext."),this._config={channelMap:M.ChannelMap.DEFAULT,renderingMode:U.AMBISONIC},t&&(t.channelMap&&(Array.isArray(t.channelMap)&&4===t.channelMap.length?this._config.channelMap=t.channelMap:O.throw("FOARenderer: Invalid channel map. (got "+t.channelMap+")")),t.hrirPathList&&(Array.isArray(t.hrirPathList)&&2===t.hrirPathList.length?this._config.pathList=t.hrirPathList:O.throw("FOARenderer: Invalid HRIR URLs. It must be an array with 2 URLs to HRIR files. (got "+t.hrirPathList+")")),t.renderingMode&&(Object.values(U).includes(t.renderingMode)?this._config.renderingMode=t.renderingMode:O.log("FOARenderer: Invalid rendering mode order. (got"+t.renderingMode+') Fallbacks to the mode "ambisonic".'))),this._buildAudioGraph(),this._tempMatrix4=new Float32Array(16),this._isRendererReady=!1}function j(e,t,i){this._context=e,this._active=!1,this._isBufferLoaded=!1,this._ambisonicOrder=t,this._numberOfChannels=(this._ambisonicOrder+1)*(this._ambisonicOrder+1),this._buildAudioGraph(),i&&this.setHRIRBufferList(i),this.enable()}function z(e,t){return e===t?1:0}function G(e,t,i,n,r){var a=(n+t)*(2*t+1)+(i+t);e[t-1][a].gain.value=r}function W(e,t,i,n){var r=(n+t)*(2*t+1)+(i+t);return e[t-1][r].gain.value}function K(e,t,i,n,r){return n===r?W(e,1,t,1)*W(e,r-1,i,r-1)-W(e,1,t,-1)*W(e,r-1,i,1-r):n===-r?W(e,1,t,1)*W(e,r-1,i,1-r)+W(e,1,t,-1)*W(e,r-1,i,r-1):W(e,1,t,0)*W(e,r-1,i,n)}function Q(e,t,i,n){return K(e,0,t,i,n)}function Y(e,t,i,n){if(0===t)return K(e,1,1,i,n)+K(e,-1,-1,i,n);if(t>0){var r=z(t,1);return K(e,1,t-1,i,n)*Math.sqrt(1+r)-K(e,-1,1-t,i,n)*(1-r)}var a=z(t,-1);return K(e,1,t+1,i,n)*(1-a)+K(e,-1,-t-1,i,n)*Math.sqrt(1+a)}function X(e,t,i,n){return 0===t?0:t>0?K(e,1,t+1,i,n)+K(e,-1,-t-1,i,n):K(e,1,t-1,i,n)-K(e,-1,1-t,i,n)}function q(e,t,i){var n=z(e,0),r=Math.abs(t)===i?1/(2*i*(2*i-1)):1/((i+t)*(i-t));return[Math.sqrt((i+e)*(i-e)*r),.5*(1-2*n)*Math.sqrt((1+n)*(i+Math.abs(e)-1)*(i+Math.abs(e))*r),-.5*(1-n)*Math.sqrt((i-Math.abs(e)-1)*(i-Math.abs(e)))*r]}function Z(e,t){for(var i=-t;i<=t;i++)for(var n=-t;n<=t;n++){var r=q(i,n,t);Math.abs(r[0])>0&&(r[0]*=Q(e,i,n,t)),Math.abs(r[1])>0&&(r[1]*=Y(e,i,n,t)),Math.abs(r[2])>0&&(r[2]*=X(e,i,n,t)),G(e,t,i,n,r[0]+r[1]+r[2])}}function J(e){for(var t=2;t<=e.length;t++)Z(e,t)}function $(e,t){this._context=e,this._ambisonicOrder=t;var i,n,r,a,s,o=(t+1)*(t+1);this._splitter=this._context.createChannelSplitter(o),this._merger=this._context.createChannelMerger(o),this._gainNodeMatrix=[];for(var c=1;c<=t;c++){i=c*c,n=2*c+1,this._gainNodeMatrix[c-1]=[];for(var u=0;u<n;u++){r=i+u;for(var d=0;d<n;d++)a=i+d,s=u*n+d,this._gainNodeMatrix[c-1][s]=this._context.createGain(),this._splitter.connect(this._gainNodeMatrix[c-1][s],r),this._gainNodeMatrix[c-1][s].connect(this._merger,0,a)}}this._splitter.connect(this._merger,0,0),this.setRotationMatrix3(new Float32Array([1,0,0,0,1,0,0,0,1])),this.input=this._splitter,this.output=this._merger}H.prototype._buildAudioGraph=function(){this.input=this._context.createGain(),this.output=this._context.createGain(),this._bypass=this._context.createGain(),this._foaRouter=new M(this._context,this._config.channelMap),this._foaRotator=new B(this._context),this._foaConvolver=new V(this._context),this.input.connect(this._foaRouter.input),this.input.connect(this._bypass),this._foaRouter.output.connect(this._foaRotator.input),this._foaRotator.output.connect(this._foaConvolver.input),this._foaConvolver.output.connect(this.output),this.input.channelCount=4,this.input.channelCountMode="explicit",this.input.channelInterpretation="discrete"},H.prototype._initializeCallback=function(e,t){(this._config.pathList?new k(this._context,this._config.pathList,{dataType:"url"}):new k(this._context,F)).load().then(function(t){this._foaConvolver.setHRIRBufferList(t),this.setRenderingMode(this._config.renderingMode),this._isRendererReady=!0,O.log("FOARenderer: HRIRs loaded successfully. Ready."),e()}.bind(this),(function(){var e="FOARenderer: HRIR loading/decoding failed.";t(e),O.throw(e)}))},H.prototype.initialize=function(){return O.log("FOARenderer: Initializing... (mode: "+this._config.renderingMode+")"),new Promise(this._initializeCallback.bind(this))},H.prototype.setChannelMap=function(e){this._isRendererReady&&e.toString()!==this._config.channelMap.toString()&&(O.log("Remapping channels (["+this._config.channelMap.toString()+"] -> ["+e.toString()+"])."),this._config.channelMap=e.slice(),this._foaRouter.setChannelMap(this._config.channelMap))},H.prototype.setRotationMatrix3=function(e){this._isRendererReady&&this._foaRotator.setRotationMatrix3(e)},H.prototype.setRotationMatrix4=function(e){this._isRendererReady&&this._foaRotator.setRotationMatrix4(e)},H.prototype.setRotationMatrixFromCamera=function(e){this._isRendererReady&&(O.invertMatrix4(this._tempMatrix4,e.elements),this._foaRotator.setRotationMatrix4(this._tempMatrix4))},H.prototype.setRenderingMode=function(e){if(e!==this._config.renderingMode){switch(e){case U.AMBISONIC:this._foaConvolver.enable(),this._bypass.disconnect();break;case U.BYPASS:this._foaConvolver.disable(),this._bypass.connect(this.output);break;case U.OFF:this._foaConvolver.disable(),this._bypass.disconnect();break;default:return void O.log('FOARenderer: Rendering mode "'+e+'" is not supported.')}this._config.renderingMode=e,O.log("FOARenderer: Rendering mode changed. ("+e+")")}},j.prototype._buildAudioGraph=function(){var e=Math.ceil(this._numberOfChannels/2);this._inputSplitter=this._context.createChannelSplitter(this._numberOfChannels),this._stereoMergers=[],this._convolvers=[],this._stereoSplitters=[],this._positiveIndexSphericalHarmonics=this._context.createGain(),this._negativeIndexSphericalHarmonics=this._context.createGain(),this._inverter=this._context.createGain(),this._binauralMerger=this._context.createChannelMerger(2),this._outputGain=this._context.createGain();for(var t=0;t<e;++t)this._stereoMergers[t]=this._context.createChannelMerger(2),this._convolvers[t]=this._context.createConvolver(),this._stereoSplitters[t]=this._context.createChannelSplitter(2),this._convolvers[t].normalize=!1;for(var i=0;i<=this._ambisonicOrder;++i)for(var n=-i;n<=i;n++){var r=i*i+i+n,a=Math.floor(r/2);this._inputSplitter.connect(this._stereoMergers[a],r,r%2),this._stereoMergers[a].connect(this._convolvers[a]),this._convolvers[a].connect(this._stereoSplitters[a]),n>=0?this._stereoSplitters[a].connect(this._positiveIndexSphericalHarmonics,r%2):this._stereoSplitters[a].connect(this._negativeIndexSphericalHarmonics,r%2)}this._positiveIndexSphericalHarmonics.connect(this._binauralMerger,0,0),this._positiveIndexSphericalHarmonics.connect(this._binauralMerger,0,1),this._negativeIndexSphericalHarmonics.connect(this._binauralMerger,0,0),this._negativeIndexSphericalHarmonics.connect(this._inverter),this._inverter.connect(this._binauralMerger,0,1),this._inverter.gain.value=-1,this.input=this._inputSplitter,this.output=this._outputGain},j.prototype.setHRIRBufferList=function(e){if(!this._isBufferLoaded){for(var t=0;t<e.length;++t)this._convolvers[t].buffer=e[t];this._isBufferLoaded=!0}},j.prototype.enable=function(){this._binauralMerger.connect(this._outputGain),this._active=!0},j.prototype.disable=function(){this._binauralMerger.disconnect(),this._active=!1},$.prototype.setRotationMatrix3=function(e){this._gainNodeMatrix[0][0].gain.value=-e[0],this._gainNodeMatrix[0][1].gain.value=e[1],this._gainNodeMatrix[0][2].gain.value=-e[2],this._gainNodeMatrix[0][3].gain.value=-e[3],this._gainNodeMatrix[0][4].gain.value=e[4],this._gainNodeMatrix[0][5].gain.value=-e[5],this._gainNodeMatrix[0][6].gain.value=-e[6],this._gainNodeMatrix[0][7].gain.value=e[7],this._gainNodeMatrix[0][8].gain.value=-e[8],J(this._gainNodeMatrix)},$.prototype.setRotationMatrix4=function(e){this._gainNodeMatrix[0][0].gain.value=-e[0],this._gainNodeMatrix[0][1].gain.value=e[1],this._gainNodeMatrix[0][2].gain.value=-e[2],this._gainNodeMatrix[0][3].gain.value=-e[4],this._gainNodeMatrix[0][4].gain.value=e[5],this._gainNodeMatrix[0][5].gain.value=-e[6],this._gainNodeMatrix[0][6].gain.value=-e[8],this._gainNodeMatrix[0][7].gain.value=e[9],this._gainNodeMatrix[0][8].gain.value=-e[10],J(this._gainNodeMatrix)},$.prototype.getRotationMatrix3=function(){var e=new Float32Array(9);return e[0]=-this._gainNodeMatrix[0][0].gain.value,e[1]=this._gainNodeMatrix[0][1].gain.value,e[2]=-this._gainNodeMatrix[0][2].gain.value,e[4]=-this._gainNodeMatrix[0][3].gain.value,e[5]=this._gainNodeMatrix[0][4].gain.value,e[6]=-this._gainNodeMatrix[0][5].gain.value,e[8]=-this._gainNodeMatrix[0][6].gain.value,e[9]=this._gainNodeMatrix[0][7].gain.value,e[10]=-this._gainNodeMatrix[0][8].gain.value,e},$.prototype.getRotationMatrix4=function(){var e=new Float32Array(16);return e[0]=-this._gainNodeMatrix[0][0].gain.value,e[1]=this._gainNodeMatrix[0][1].gain.value,e[2]=-this._gainNodeMatrix[0][2].gain.value,e[4]=-this._gainNodeMatrix[0][3].gain.value,e[5]=this._gainNodeMatrix[0][4].gain.value,e[6]=-this._gainNodeMatrix[0][5].gain.value,e[8]=-this._gainNodeMatrix[0][6].gain.value,e[9]=this._gainNodeMatrix[0][7].gain.value,e[10]=-this._gainNodeMatrix[0][8].gain.value,e},$.prototype.getAmbisonicOrder=function(){return this._ambisonicOrder};var ee=["UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD+/wQA8/8YAP3/CgACAAAA//8CAAYA8/8AAPH/CgDv/97/e/+y/9P+UQDwAHUBEwV7/pP8P/y09bsDwAfNBGYIFf/Y+736+fP890Hv8AGcC3T/vwYy+S70AAICA3AD4AagBw0R4w3ZEAcN8RVYAV8Q8P2z+kECHwdK/jIG0QNKAYUElf8IClj7BgjX+/f8j/l3/5f/6fkK+xz8FP0v/nj/Mf/n/FcBPfvH/1H3+gBP/Hf8cfiCAR/54QBh+UQAcvkzAWL8TP13+iD/V/73+wv9Kv+Y/hv+xPz7/UL83//a/z/9AP6R/5L+jf26/P3+rP26/tD8nP7B/Pv+WP1V/sP9gv91/3P9xP3J/nv/GP5S/sb+IP8v/9j/dv7U/pr+6v+u/Z3/sv5cAOr9Q/83/+n/zP5x/57+2//k/nwA/v01//L+SACB/sD/Ff81AJT+TgDp/ocAm/5dAFT+MgD+/pMAW/7o/yH/xQDA/kkA9P6LAL3+pAC0/iQAz/5UALD+UwAt/3UAhf4UAA//pwC+/joAz/5aAAv/fwDY/iMAIf+uAPP+ZAAc/0QAy/4xAB7/TgDs/goADP8wAEL/NwDo/ub/Uf9BAC3/+v9F/y4ARP9HAFP/EQA3/xMATP81AG3/HQAu/wgAaP9FACb/9f9B/y0AUP8rAED/CwBV/z4AW/8TAGH/BQBK/xsAfv8eAFn/AgB3/zwAff8RAGj//v+E/yAAb//0/3n/FwBz/xcAiv8PAHn/FQCJ/xgAg//x/3j/EQCa/ycAff/w/47/HwCI//X/iv/7/43/JQCM/+n/kP8AAJb/JACj//7/oP8ZAML/SwCo/w4Atv8tAMb/PACr/xcAwP9HAMP/OADF/y4A0f9IANL/NwC//zEA0f9LAMb/MAC8/y4A3f9GAMH/FQDQ/yYA2/8sAMT/AwDX/xkA3v8SAM3/9v/c/w8A4f8LAMj/8f/h/xQA2P8CAMn/8//j/xQA0v/7/9H//P/i/xEA0v/1/9L//f/j/w0A0f/x/9f//v/k/wgAz//u/9z/AwDg/wMA0P/v/9//BQDf////0v/y/+D/CADc//3/0v/2/+L/CgDa//r/1v/5/+T/CgDY//j/2f/9/+T/CADY//f/3P8AAOT/BwDY//f/4P8EAOP/BADZ//j/4v8GAOL/AwDa//r/5f8IAOH/AQDc//3/5v8JAOD//v/f////5v8IAOD//v/h/wIA5/8HAOD//f/j/wMA5/8GAOD//f/l/wYA5v8EAOD//v/m/wYA5f8CAOL////n/wYA5P8BAOH/AADl/wUA4f///+H/AQDk/wMA4f///+T/AQDm/wEA5////+r/AADt/wAA7/////P/AAD1////","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD//////v///wAAAAAAAAAAAQAAAAAA///9/wAABAD+//n/AgAJAAAA+v/+//f/DAAdAPv/+v+l/8L+jf/4/vgAdwVPAQACLQBo+Qj/Ev7o/N3/VgCbA08Bxf+L+yn9J/2HCU8FmgBvDe30Rv5h/LT09gi5CxkA5gOi8/30kwEM+4YJMf2nBmkJJAQQBLoFtvvv+m4A7PF6/R0Bif3qAuf8WARAAf4GyABG/BIAwvr4Acv8U//c/yIC8AEn/B8Daf2CAgMBAf3MAN38vgLK/UT/QwCyAPYClPyvAW/+pQAoASD+zP+R/IYC1f7C/nEBQP96AZb+1QAIAM//yQE7/tkAZ/7TAXL/w/8+AIsAtwB7/24A4v9a/z4A7v4iADb/dwCj/23/kgBOANUAIv8lAKEAxP9gAK7/BwCP/5kA7/9v/0wAzv9DAGT/3/9vAHv/6P+q/xUA7P8XAO//uv/g/2UAEgCV/wEATADM/+7/+//j/+D/9v/i//j/IgD+/xoAxf/6/z4A5/+8/9D/QwDq/+3/OQDT/zUAIgA/APP/PgAjAPD/BwAGACAADAC3//b/HAA3AN//RgDN/w8AIAACAN//GQBDACEAIwA+ACoAJQAeAPz/KgAYAPr/DgAEABYAIgAcAMT/7f8OAOL/5P/2//L/9P8GAPT/7v/8/+7/6v/t//z/AgAUAOL//P8VAAMA4/8IAPb/+P8MAAoA5v8NAAsA9v///wEAAAD9//n/9/8JAAYA7v/6/wMA+f8GAAEA7f/7/xgACAD4/w8A///3/w0A+f8BAAIA/P/5/xIA///9//r/7v/+/xYACQD///H/CwDz/wEADgAHAPP/FADn/+3/AQD5//f/AgD7/wEABwAMAAEADQD8//n/8f8OAPX/BAD+//X/+v8WAAQA+f8CAAEA7/8QAAEA/P8DAAUA9f8KAAwA9v8DAAUA+f8OAAoA9f/7/w0A+v8EAAgA8P/6/woA+//8/wkA+P/3/woA+//8/wcA9//1/woAAwD5/wcA/P/3/w0AAwD3/wEABAD2/wkABgD3/wEABQD3/wUABQD3//v/BwD3/wMABQD3//r/CQD7////BQD6//n/CQD9//3/BAD9//j/BwAAAPv/AwD///j/BwABAPn/AQABAPn/BQACAPn///8DAPr/AwADAPr//v8EAPv/AQADAPv//P8FAP3///8DAPz/+/8FAP7//f8CAP7/+/8EAP///P8BAP//+/8DAAEA+/8AAAEA+/8CAAIA+////wIA/f8AAAIA/P/+/wIA/f8AAAIA/f/9/wMA/////wEA///+/wIA/////wAAAAD+/wAAAAD/////AAD//wAA//8AAP//AAD//wAA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD////////+//////8AAP////8AAP//AAAAAPz//f8IAAMA9////w4AAQD6/wwA8//+/y8Afv/0/2H/UP5gAbH+2QG1B2cAVAIh/l32FPyM/nACPQDV/+UEo/Q6AQwCu/oLD9kF8QJA/Uz+Wf2KCOcC+wUKBsL5aQBQ97rwOPiPAvn5CAl8AHEDkQPcAA8Bn/lIAdz7HQF1+xz9cAM4/94E4gDKAun+cgPYAYr9JgJr/bf+ivxz/MoBgv5UA8EBSgAQAJ7/UgEk/cQB7f63/sD/vf4XAhT/BQFCADYAnQGI/9EBtv3hALD/vP+c/3H/TgIN/1sBpf8yAP3/4f8qABr+1f8OAJ3/dwAGADEBnv9JAPz/IQBwAIH/jgAS/4wAsACTAOn/DQDCALn/ZQCSAAIAAwD1/9//jv9aADQA/v9EAB0AfgA8AAQACgB9APr/IAARAPT/5v9xACAABAAHAGUAt/89AC4ACgAjAMP/+v/9/xYA7f/1/+D/7P87AC0Auv8RAAcA9/8FAC8A2//y/xIAEwAaADQAJADp/zoAAgAfABIA2f/e/zUA+P/6/w4A9//A/zcA4//P//T/5f/R////EwDb/w4A8/8BABkANADh/xEA+f/0/wIAHADc//j/GwD1//f/GADs/+v/EAAAAPz/EgD3/+r/FgAMAAkAGAD9/+z/IQAQAPH/GQD3//z/CgAfAOX/AgD8//H/BAATAOv/+v///wIABAAdAOj/BQAPAAcAAQATAOz/8/8JAAkA6f8VAOv/+f8QABUA/v8OAO3/+P8KABUA9f8FAPv/5/8TAA0A7f8XAAkAAQAJABYA4/8WAAcACgANABEA7v8EAP7/AAD+/wMA9//7/xAAAQD8/wQA+f/7/wMABgDq/wAA+v/3/wYACQD1//3/BAD9/wgADgDw//r/AgD6/wEACADv//j/BQD///X/BwDu//j/AgACAPP/BAD2//n/BAAGAPb/BAD8//3/BQAJAPL/AwD+//3/BAAIAPP//f8DAPz/AAAGAPP/+/8CAP7//f8FAPX/+f8DAAAA/P8EAPf/+v8GAAMA+/8EAPv/+/8GAAQA+v8CAP///P8EAAUA+f8AAP///f8CAAUA+P///wEA/v8BAAUA+f/+/wIAAAD//wUA+v/9/wMAAQD9/wQA+//9/wMAAgD8/wMA/P/9/wMAAwD7/wEA/v/+/wIAAwD6/wEA///+/wAABAD6/wAAAQD//wAAAwD7////AQAAAP//AwD8//7/AgABAP3/AgD9//7/AQABAP3/AQD+//7/AAACAPz/AAD+//////8BAP3/AAD//wAA//8BAP7/AAD//wAA/v8AAP7/AAD//wAA//8AAP//","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD//////P/9//3//////wAAAAAAAAIAAgACAP//CAAEAEEA//+cAAUAb/8HAAH9+P9eARkAogQUAJn8BwCd/gX/+QQNAKoC9gFdAtb/b/vd/936TP/6AsD/nfqn/un1W/0dA8IEsQLvAJv2bP72+WMAkP8dAcX+nQO2AIr6bP/EABX+NgK/Bdj2IQv2AE4EUAiD/xQAnwIm/B0B/wGNAoH7sQaP/b8CiQakAqD+R/9xA477KQL//6r75v/O/pcCgQCtAiMCBQAkANAARwHf//39hgBl/kUAJgEtAUEATgA/AgoASADK/zUAJv29/vL+l/9c/0cAUwBBAE8A6QE5/87/Wv9NAOf+5v7P/5P/4/9BAKYAQwDD/zYB5v+r/zYATwAp/1v/WQAEAB0AhwA0AA0AIAA3AAEAzv/u/+//5v9m/zwAIADQ/8T/SABiANb/SwAbAFf/MQDX/7L/hP8TAPr/AgAMAAsAHwAZAI3/VgDC/9v/5//x/6P/AwBlAMv/yf82AB4A+P9WAPj/NwDi/1EA0v9JANj/JwAcAAEADABYANj/4f8MAEwAmP82AN//3P8UADYA7//6/wIACADU/ygAyv82AN7/9v/2/ygAxv/9/+3/5//n/zUA6//g/y4ADgD5/wsABwDv/xIADwAGACoAJQD3/zIA+/8FABsAFgDO/zAAHAAIABQALADp/xcACAAAAPH/GADs/wkACQAFAAgAFQDp/wIAHAD1//P/EQDw/+3/GAD9/+f/HAD8//T/DAAQAPH/HwD4//r/DwAPAOj/EQACAOn/DAAXAOX/BAAOANH/9/8MAO//9f8LANT/9f8EAO//6f8NANb/+P8KAOz/5v8MAOD/7f8UAO//7//+//7/9v8YAPj/9f/z/wsA+v8SAPD/+v/x/xYA+f8SAPb/9//3/xEABQACAPn/9//y/xQACQD///b//v/7/xIACQD9//H/AAD7/xEAAgD5//P/AwD9/w8AAgD3//D/BAD//wUA/v/0//D/BgADAAMA/P/2//f/BwAGAP7/+//2//j/CAAFAPv/+f/5//v/BwAHAPn/9//7//7/BQAFAPf/9//+/wEABAACAPf/+P8BAAIAAgAAAPj/9/8CAAMAAAD+//n/+f8EAAQA/v/8//r/+/8EAAMA/P/7//z//P8EAAIA/P/5//7//v8DAAEA+//5//////8CAAAA+//5/wEAAAABAP//+//6/wIAAQD///3//P/7/wMAAQD///3//f/9/wIAAQD9//3//v/9/wMAAQD9//z/AAD//wEAAAD9//z/AAAAAAAA///9//3/AAD//wAA/v////7/AAD//wAA////////AAD//wAA//8AAP//","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD+////+f////v//v///wAA/////wUAAQAIAAIABwACAHkATAAOAaMAAf9C/9X6QvwhArAAtghABW37nv/y+0wAWQNcAE8JRwSOC6AEJe8P8S/zrPWaBI/+LQA/+0L+P/4K8AgAb/8uCh78BQtC614GaQWfAin5UfzN8Tf+GQizAZ4MCQMbGJ4BoRS7AvcHyQARA6n9ZwHZ/z4DvwAZAlAB6gbNAS4GFADFATL7E/2K+j37C/xp/SD9Uv0VAOsDs//WAd3+bv7F/f79mP2X/KH+FwC0/1n+VgFcATABHQGaAET+nf8Y/hoAovpqAXj9CQKW/lsCl/4RApj+bAHk/RcAlv4BAG/+DgDi//3/GwAOAEIAq/+y/3z/8v8+/7T/Tv8//27/mgDZ/1sA+P+cAAAA/P/i/yMAi/85AMP/KgDM/9MA9P+QABoA4QAiACwACwBdAP7/TQDb/y0Ayf+SAA0AZwDg/4wA+/8/AAMAgQDp/w0ADAAQAAoANgAgAA4AKABIAB4A4v/3/+f/+v/c/+n/EADn/wgAFAAqAOz/IwDc/9//3f8XAND/2v/a/w0A5v8BANb/9P/m/wAA8P8ZAN3/RwAGAEsABgB/AP7/NAASAEgABAA3AP3/KgD9/1sA8P8lAOr/FgD1/xAA4/8kAOv/AwD4/xEA5f8NAPT/+v/3/x8A7f8PAPj/IwD5/yAA9/8ZAAEAGgD4/xoA9f8HAAMACAD0/xgA+P8AAPr/IQDp/w4A8v8HAPX/IgD1/wYA+P8GAPX/GgD3/woABQASAAcAGQDw/+v/9P8bAP3/HADs/+f/7/8LAPr//v/0//T/AgD2/wsA6P///+P/CADY//7/5v/3/wQA/v8LAPD/GgD1/yMA/P8QAOv/LADw/yQA+P8XAO7/MQD9/yEAAQAcAPD/IgD9/xMA+/8OAO//FQABAAoA+/8PAPP/FQABAAQA9/8PAPX/CAADAAEA+P8NAPv/CAAGAAUA9/8JAP//AAAFAPz/+f8HAAQA/f8FAP3//P8FAAYA+P8DAP7/+/8AAAcA9/8BAP///f///wgA9//+/wAA/v/8/wUA9//8/wIA///7/wUA+v/7/wIAAAD6/wMA/P/6/wEAAQD6/wEA/v/7/wIAAgD6////AAD7/wEAAgD7//7/AQD8/wAAAwD8//3/AwD9/wAAAgD9//z/AwD/////AgD+//z/AwAAAP7/AQD///3/AgABAP3/AAAAAP3/AgACAPz///8BAP3/AQACAP3//v8BAP7/AAABAP3//v8CAP7///8BAP7//f8CAP////8AAAAA/v8CAAAAAAAAAAAA/v8BAAAAAAD//wAA//8AAP//AAD//wAA//8AAP//","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAP//AAD//wAA//8AAAAA/////wAAAQD+////AAAGAP3/OAABAIIAAwBv//f/E/0QAK0ADQCzA/7/8P4u/0cBDQCJA6ABbQDg/w7/z/9o+Vn/SPnL/1//Ef+2+jr9RfZgA5QFZwILDFj+PAb2/nEFKgKk/R0Dlv6b/FUDsP6YAoj9SgAT/iL/tAPwAv8A0P6zAr7/dwAnAf39uP22/skA2v///2YCoP4UAUsAZgF2AJH+4P70/rz9+f+U/Xv/8v7CAcb+TACS/kwAv/+x/tX9oP71/oL/1f8nAEUAZwGtAAgAIgC/AD4BaP8GAGH/dQDF/64Arf8nAakAhAH9/+kAQQD3AFb/q/8p/yIAR/8FAPD/ZAA/AIYA3v8tADQADQBp/3f/CwABAP3/Wf8OANj/WwDH/xoAe/8DAKz/zv96/z8A3f/J/5X/IAD5//j/q//c/+//RADq//D/vv8pADUAFQDI/y8ACAAbANb/OwD3/+3/9f/e/wcAIAAeAMH/8/8xAC0AEADW/+3/HAADAPv/8P8DAOL/OwD3/xcACQAHAM//5f8XAAcAz//T/9D/HgD9////yf/e//v/AgD//9H/6/////H/+/8hAAIA9//7/w0AFgAQAPL/2v/8/xsAGQABANz/9P8YAAQA/v/y/wMA5v8YAAkAAAAAAAMA7/8KABgADwDs//j/BwATABsA8P/1//z/BAAMAAAA9P/s/xAA/v8GAAkA/v/p/wMACwALAP7/9P/p/wcADQAFAPb/7//4/w0ACAD8//b//v/1/wMACwD1//T/8P/8/wAACQDz/+f/5P8GAAkABQD5//D/+v8FAA0AAwD///T/AgACABAA/v8CAPD/+/8FAAoA9f/3//f//v8GAP7/9v/t//z/+f8AAPj/+v/3/wEA+v8HAPr//P/5/wQA//8DAPr/+P/3/wYA///+//X/+//5/wQA/f/7//X/+//4/wMA/f/8//j//v/9/wYA///8//f/AgAAAAUA/f/6//n/AwACAAIA/f/7//z/AwACAAAA/f/6//3/AgADAP7//f/7/wAAAwAFAPz////8/wMAAgAEAPv//v/+/wMAAgADAPv//v///wMAAQABAPv//f8AAAIAAAD///v//f8BAAIA///+//z//v8CAAIA/v/9//3///8CAAEA/v/9//7/AAACAAAA/v/9////AAABAAAA/f/9/wAAAQABAP///f/+/wEAAQAAAP///v/+/wEAAQD///7//v///wEAAQD///7//v///wEAAAD+//7///8AAAAAAAD+//7///8AAAAA///+//7///8AAAAA////////AAAAAP////////////8AAP//////////","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAAAAAAABAAAAAAD//////////////v////3/////////+//8////AQD9//z/9f8BAAIA+f8dACgAWQBxAJX/qv+Y/uz9aP9k/7UDUQQBAiQA4Pgi/AkB0gKaBsD/+fxp/vz9CQSp/I/+ywDO+vMD0fzK/PABcgBeBfoBv/+uAuH9Sf5gAy39awMmBWUBuP9fA9/9fgDj/2/+EACaACcCSv9Z/2j/rv7hAA0AWf55/7L84P7E/SIAT/67AMv/tf+FAA7/1v+7/gv/IP+E/sQA+P5aAXz/tP9XAFX/tP8o/4r/j//e/yQAMv9mAJT/rgCr/9X/EwCb//H/9f7F/6D/EAAoAK3//v+e/zsAh/+B/7r/if/C/2r/4P/z/6//HwCy/0IA7/9ZALT/y/80ACgA9v/J/9//DgA5ADUALQARADIACwAfAOf/NgArACMACQBBAEcAGAAjAC4AWQBUAHcAAAAfACEAIAAcAPj/CADk/yQA7v89AEEAFwD5/xYA6f8aAOX/AADF/zQADwAUAOT/BQDr/yUA6P8XAOf/HADR/0AA8P8nAAgACQDt/ycAKAAHAPH/IQDz/xsACADn//n/DgADAA4A8P///8z/GgDN/yMA/f8QANj/MwACAC0ACwAOAO3/JgAZAAUACgAAAA4AIgAaAAkADwACAAAAHQATAAUABQACAAgACwAjAO////8AAA8ABQAPAPL//f8GAAsABgAGAPD/8v8GAPz/CAD6//H/6v8PAAgABgD4//3/9v8aAAgABwD1//7//v8QAAoACAD//wUA9v8QAAoABAAFAAgAAgAJAAoAAwD//w0AAgD//wcA/v8DAAoABQAFABUABAAKAAYABwAHAA8ACgAGAAwADwAMAAkAEAAJAAgADwAMAAgADgAJAAUACQAPAAUACwAHAAEABgAIAAEABAAGAP//AgAJAAAAAgAEAP7///8IAAIA//8GAAEAAQAJAAIA/v8EAAMA//8JAAEA/v8DAAMA/v8HAAMA/f8BAAUA/v8FAAMA/v8BAAcA//8DAAMA/v8BAAYA//8CAAMA/////wcAAAAAAAMAAAD//wYAAQD+/wMAAQD//wUAAQD+/wIAAgD//wQAAgD+/wEAAwD//wMAAwD+/wEAAwD//wIAAwD//wEABAAAAAEABAD//wAABAABAAAAAwAAAAAABAABAP//AwABAAAAAwACAP//AgACAAAAAwACAP//AgACAAAAAgACAAAAAQADAAAAAQACAAAAAQADAAAAAQACAAAAAAACAAEAAAACAAEAAAACAAEAAAABAAEAAAABAAEAAAABAAEAAAABAAEAAAABAAEAAAABAAEAAAAAAAAAAAAAAAAA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAAAAP//AAD//wAA//8AAAAA//8AAP//AAACAAAA+f8BAAYA///4/wIA//8AAA8A/v/V/wEAEwA9AAEBRwA2AF7/kfog/3gBwv99CDYBU/qtAUX/AP7OAfkAX/o9B38FSfwaAuT14/60BAr8CQAI/tfyIQTzAXP+egdUBBwBof7TBMT8bAWi/5EEWwBRAAAKyfxE/8b88vp6ACP+PAF4/qD8MQNM/ygCJ/2XAPD9kP5gAVT/iP9I/lEB4P8qAD0BFAGa/+7/DgB2AOP98gFm/u/+Vv5/AG8ASP9gAM//qv9w//oAcv+2/jIBHgA7/6D/oAAGAKH/lADT/wAAggC8AAYAkP9yAEcAkf8BAOD/RAAr/zUANwDt/xQAJQAkAMT/zwA/AOH/xv9zAGsANQBTAIcALAAvACIATACy/xMADADg/xcAWABvAJL/7f9VAPb/EgDt/wcA4f8kAPP/5P+h/wgACQDy//r/LgAQAMn/8/9CAOX/5v/S/9//3P8pABYAuP/s/w8AFgDt/+3/7v/w/9j/5/8GAOf/2P/2//P//v8kABMAuf/m/xoADADZ/+r/3P8KAAUAKwDe/wsA3P8VAAAADgAfAB0ACAAMAF4AGgAhAPL/MwDz/0kABAAKAPX/LwAbAAkA9v/s/+3/8/8CABAAAADm//n/BQALAAUAAQDj//n/JQAVAPX/9v/+/wIAEQABAPP/8P/1/wAABgD6/+3/7//o//j/DAD8/+b/8P8IAAkABgD4//D/8P8UAAoAAwD4/wAA+f8OAAcAAAAFAPX/9v8TAAkA8v8EAPb/9/8dAA0A7/8CAPn/+f8SAAQA8/8CAOf/+v8DAAgA9P////H//P8IAAUA8//0/wIAAQAGAAgA9//7/wAA+/8EAP//+P/+////AgACAAsA8v/+/wIABQD7/wgA9v/7/wMABAD5/wAA/P/3/wEAAQD7//7//P/1/wQA///3//r////3/wMAAwD1//r/AwD6////AgD4//n/AwD8//7/AgD4//n/AwD+//3/AQD4//n/BQD///n/AAD6//j/BAABAPj/AAD9//v/AwADAPj//v/+//z/AwAEAPj//v8BAP7/AQADAPj//f8CAP////8EAPr//P8DAAAA/v8CAPv//P8DAAEA/f8BAP3//f8DAAIA/P8AAP7//f8DAAIA/P///wAA/f8BAAIA+//+/wEA//8AAAEA+//+/wEA/////wEA/P/+/wEA///+/wAA/f/9/wEAAAD9/wAA/f/+/wEAAQD8/////v/+/wAAAQD8////////////AQD9////AAD/////AAD+////AAAAAP//AAD///////8AAP//AAD//wAA//8AAP//"],te=["UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD+/wQA8/8ZAPr/DAD+/wMA/v8KAAQA/f8DAAMABADs//z/8v/z/8f/R/90/ob+//zAAWsDAwY3DKn9//tu93DvkwI6An4CuwJ0/BH7VPux92X0Gu7N/EX9mgfqCkkIiRMgBd4NQQGL/c0G/xBxAKELZATUA/sIHRSx+fkCyAUmBNEJIARlAdHz2AjNACcIsAW4AlECsvtJ/P/7K/tf++n8aP4W+g0FXAElAMn8nQHn/sT+Zv7N+9X2xvzM/O3+EvpqBBD7SQLd+vb/sPlw/JD72/3n+Rr+L/wS/vz6UQGg/Nf+Av5L/5X9Gv2//SP+mf3j/lf+v/2B/ZH/5P05/iL9MP9F/uf9UP4v/qv9mv7o/Xn+wP2k/8L+uP5J/tD+Dv/Y/bL+mP72/n3+pP+7/hAA+/5zAGH+Z/+u/g8Azv2y/6L+//9o/iIADP8VACz/CwCN/pb/1v4yAFP+wf+4/jsAcf5VAP3+bADa/nMA6f4sAOT+IQBd/v7/7v6aAIL+QADe/nEA0P4yAKz+CQCo/moAuf5xAN7+mAC8/jcANf9eAPX+IAA1/1kAAP9hAMz+PQD5/m0A2/4gAPr+UQDh/jQAEv9BAPH+FABN/zkASv9DADP/BABe/1IAGf8oAE3/RQAw/zIAQf8mADn/GgBE/xIAR/8hAD7/BABy/zEAKP/0/07/GwBX/z4ARf8mAFr/QQBV/zUAVP8eAFz/JABt/0EAUP8MAHz/KgBr/ycAYv8EAH3/MABl/x8Agv8bAIj/GgBv//z/ff8AAJX/IABu/+T/jv/r/4z/9/9n/77/pP8JAJD/EQCJ//r/q/8WAJ//GQCU/xYAtv8qAKr/PQCW/ysAwf8+ALb/OgC3/ygAz/8uAM7/OgDH/ygAz/8kAMz/OgC//xsA1f8qAMn/LwDN/xcA1f8oAMv/JQDR/xMAzf8bAM//HgDU/wUA2v8ZANL/EwDW/wEA1f8ZAMz/BwDX/wIA0v8SANT/BQDW/wMA0/8PANT/AADY/wIA1f8MANX/+f/a/wUA0v8IANf/+//Y/wUA0/8DANr/+f/Y/wQA1v8BANr/+f/Z/wUA1//8/9z/+v/Y/wYA2f/8/93//v/Y/wUA2v/9/93////Z/wUA3P/8/97/AgDa/wMA3v/8/97/AwDb/wIA3//9/97/BADd/wEA4f///9//BQDf/wAA4v8AAN//BQDf/wAA4/8CAN//BADh/wAA4/8DAOD/BADi////4/8DAOH/AwDk/wAA5P8FAOL/AgDl/wEA5P8FAOL/AQDl/wEA4/8EAOL/AQDj/wIA4P8DAN//AADg/wIA3v8CAOD/AADh/wEA4v8AAOP/AADm/wAA6P8AAOz/AADu/wAA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD//////f/+//7///8AAP////8BAAEA/f8AAAEAAQAFAAUA9//6/x0A2f/9/xMA3P+jAE//of9HAKP//gCj/77/Z/vi/28D9/ywDJAJIvr6AsX0Xec4BhcGzf23DZP7yfZ6C1//nwBDBIHyYgob/Tf3sQ41ANoKRA/A+E7yffAa9gD5EQUBDMwMygiqAHMAqPqhAGUB2/gE+a78H/+4APT6DwIUAA0HNwMhBfL8E/90A5n7dP9cALIC+v5C/q0AOv9kAogBHv01/+3/qAQD/ub8T/4vAOUA5P6KATv+ywEYAeT+KP6i/3gCFP6h/hr/+P83ACL/VADn/8UARQJI/4MAu/8qAlj+wf4iAPb/LgFJ/8QAUABAAI4ABf+k/3X/YgFK/ij/j/9HADoAi/+WAA0BVwC/ACL/LACe//cARv9i/xgAUgA0ACj/FgBgAIj/5P9M/7z/zv8/AKz/gv8sAEQA6/+I/yYAawDL/7T/xf8qAOv/FQCu/5n/EgAyAO3/i/9LAE4A+//R//P/FgDe/8z/u/8DADIALAAZALL/TAA8ABwAo//1/xwA/P/L/z0A6P8jAN7/7v+a/zAAwf/7/3//KQAuACwA9v8RAGYAIwBNADgAKgASAF0ADgANACEAMQDH//H/LQACAB0Ay////x0APAABAAQA2v8iAAcAEgDE/+v/FQD+/+P/DAD1/97/6v/4//X/EwD4/+7/5P8cAA0ACQDH//7/CQAXAAEA/P/5//j/CwAWAAEABQD9//n/AQAWAB0A7v/k/wAACQAmAP//9/8AAPn/8/8aAO//6/8fAOv/5v8hAP//5/8PAOf/AAAGAPn/6v8JAAYABgABAOv/1//1//L/+P8DABcA6f/8/wMACgD7/xAA3v/2//z/DADu//z/5v/5/wEA/P/6//7/7v/x/wQABgD5/wAA8v/w/wkAEQD2//j/+v8EAAcAEAD3//v/+v8CAAAACQD3//v//v/9/wUADAD2//X/AgAHAAAABwD2//T/BgAKAP7/AQD4//r/BAAIAPn/AAD3//f/BQAHAPv//v/7//n/BQAJAPj/+v/9//7/AgAGAPj/+f8BAAEAAgAFAPn/+v8BAAIAAAAEAPn/+f8CAAQA/v8BAPr/+v8CAAQA/P////v//P8CAAQA+//+//3//f8CAAUA+v/9//////8AAAQA+v/8////AAD//wIA+//8/wAAAQD+/wEA+//8/wAAAgD9/////P/9/wEAAgD8//7//f/9/wAAAgD8//3//v/+////AQD8//z/////////AAD8//3///8AAP7/AAD9//7///8AAP7////+//////8AAP7////+////////////////////","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD//////v8AAP///////wAAAAAAAP7/AQABAAAABwD///X/BQAjAPL/CQDb/9D/GAAb/7sAYwCW/z0BcP/X/7T/2QDW+wH8yANCCCUJ5QT++UXmhPwhA78FuAxH+p78ifudBlAG9vmu/lAK2fdlB///cfjoCa0E7Akn9Yb/zvba+AkAHPywBGEBFwUNAL8AXAAGA20DFvmR/kz+F/06Ag/+GwHl/5EEKgJd/q0AP/ym/9n6EfxY/2H+/QFtAC4C6QBDAaMCo/20/+3/3f/p/fL9rv9V/6cBhQHuAX4AcwJYAaH/IP/P/gsApP0LAe7/sQBuAI0AAgGDAE4BzACe/5X//v+v/+f+Zf+gAOv/5QBhAOIApAANASYAuP+h/8b/HQBr/9//bACWAGEAFAB5AD0AWQDU/+D/Yf/p//D/s/+R/4QAMQBvABEAkQBfABQAJgDW/wwA8/8XALz/vf8zAFAAKwD1/zEAPwDJ/x0A7/8LAOX/FwDR//H/EQAdAO//6P8QAFEA2f8WABEAMgDy/xIA+f/s/xAALgDv////HQAvAPT/+f8iAAYAEgAFABoAGgD//w0A+f/0/xsAHgDx/9f/GAACAPH/8f8JAPf/GwALABEA7/8cAPT/CgD2//j/BQD8/+3/OgAgAAYA9f8PAN7/DgD9/9r/1//3/+3/9//1//b/8//5//f/AgAJAOf/+v8OAAMACwD9/+7/5f8eAAEA9//q//7/8P8WAP7/+//4/wIA+f8TAAIA9f/5/wcA+P8iAAgA9v/n/xoA//8gAAUABwDj/wAA9v8BAAUAFQDn/wMA7v8QABAAEQDm/wwA8f8aAAAABwDu/wcACgASAAEA7//w//f/BgARAAkA6P/3/wcADgAKAAYA4f/4/wYADgAAAPr/8P/9/xQACgAHAPn/7//9/xEAAgD+//L/8v/8/xUAAwDw//H/9f8CAAsA/v/q//L/+f8FAAYA/P/r//j///8GAAkA+//o//j/AQAIAP//+v/o//v/CAAIAPv/+P/w/wEACQAHAPj/+f/0/wIACwAFAPb/+f/4/wQACwACAPP/+f/+/wYACAD///L/+/8BAAYABQD9//P//P8FAAUAAgD7//T//f8HAAQA///7//f///8IAAMA/P/6//r/AQAIAAEA+v/6//3/AgAHAAAA+f/7/wAAAwAFAP7/+P/8/wIAAgACAP3/+f/9/wMAAwAAAPz/+v/+/wQAAgD+//z/+/8AAAQAAQD8//z//f8BAAQAAAD7//3///8BAAMA///7//3/AAACAAEA/v/7//7/AQABAAAA/v/9////AQAAAP///v/+////AAD/////////////////////////////","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD////////+//////8AAAAA/v/+/wAAAQD8//3/CQAJAP3/+v8PAAcApABlABkBkwCO/i//lfqa/HQAcf/3BdkCzwJcBCMC0wMN/9/9wgI7AaECYfxV/Tf83vhn/xrt8Owx/8n7cgHABYb43QcZDh4WugNrA7P74gHu/9z/zv0t/acCiQHY/iv4qQOl/ysCE/0//XT9Sf4O//j9xfupAn394gHO+rsCXAFIAxQC9wIXBgcD2AQuAnb/9gJh/6wAVfxEAI4Bvf7oAFv/bALsAMQBe/88/joAT/4dAH39/v9LAXn/gwDI//QBdABcAA0A7f4lAMn///+9/tv/iABp/13/pP/dALv/w/8MAHv//f+y/6////7U/5AAZP+Z/8r/nQDR/5r/DwDr/xAA4v+s/3z/+P9uAOv/t/82AGcAHgCb/yQAFQBGAM7/CgD3/xoAegAaAOz/CgBHAA8Adv8/AAAABQC2/xIAAAA7ABQAKgCj/z4AAQAXAJz/JAADAAcA8f/1/2AAAQAlAPD/NgDx/1wA7v/4/wMAZADv//3/HQAkAFoA8P9FAPv/FgBIAPf/WQAHAEUACQD0/xIAQwDu/wMAwP9VALn/XwCw/yEA5f8sAPj/FgDD/1YAyv8rAOX/HQDo//j/IQAQACAAHwD9/yQAHQBAABgABQAiAAUAKAD3/wkACwAKAAMABwAJAPb/+f8GAOr/JQAHABMA6P8TAA4AGgD//woA8/8ZAP//GADu/w0A9v8SAAMABwD4/wQA5P8XAAQACgDq/wUA+/8VAAcACADs/xIAAAATAPH/+v/1//T/7f///+z/+v/y/+//9/8KAAcACgAJAPT/BAAKAAAABgAIAPL/9v8KAAMABAACAPr/9v8OAAIA+P/x//v/+f8MAPb/+P/w/wQA9f8MAPn////7/woA/v8PAAEAAgD1/xAAAQAPAP//AwD//xQABwALAAAABgADABAAAgAHAAAACAABAA8ABQAFAAMABwAEAA4ABwADAAEACQAFAAoAAwD//wAACQADAAUAAQD/////CAABAAMAAAD/////BwACAAEAAAD/////BwACAP7///8BAAAABgABAP7///8CAAAABAAAAP7///8DAAAAAwAAAP3///8DAAAAAQAAAP3//v8EAAAAAAD+//////8EAP/////+/wAA/v8EAP/////+/wEA/v8EAP///v/+/wIA//8DAP///v/+/wIA//8BAP///v/+/wMA//8BAP/////+/wMA//8AAP//AAD+/wQA//8AAP7/AQD//wIA////////AQD//wIA////////AQAAAAEAAAAAAP//AQD//wEAAAAAAP//AQAAAAEAAAAAAAAA","UklGRiQEAABXQVZFZm10IBAAAAABAAIAgLsAAADuAgAEABAAZGF0YQAEAAD+/wAA+v8AAPz/AAD//wAA/f8AAAEAAAD+/wAACQAAAAQAAAAZAAAAtgAAAFsBAABW/gAAH/oAAGcBAABoBwAAlAAAAO3/AAARAQAA+wIAAEoEAACe/gAAiv4AALD0AADJ8wAAkQQAAF34AABi8QAAPQAAAAH2AAD19AAADAMAAJwGAACTEAAA0AwAAJkHAACOBwAAuQEAANcDAAC6AgAAHwUAAHEFAAB0AwAAbgEAADz+AADYAQAAGAAAAJwCAADgAAAA//0AAMn+AAAT/AAAwP8AAOn9AAAJAAAAewEAAOn+AACN/wAAOv0AAO3+AADN/gAAcP8AACj/AACq/gAA+f4AAML9AACa/wAA/f4AAN7/AABo/wAA6/4AAE//AAAC/wAAEQAAAHX/AAB0AAAA5f8AAEwAAAB3AAAA5/8AAMIAAABCAAAAzgAAAE8AAAB3AAAAKAAAADMAAACqAAAALwAAAK4AAAASAAAAVgAAACgAAAAtAAAATAAAAP3/AAA7AAAA2/8AACQAAADw/wAALQAAADEAAAAlAAAAbAAAADMAAABUAAAAEAAAACgAAAD1/wAA9v8AAPr/AADu/wAALgAAABIAAABUAAAARAAAAGUAAABGAAAAOAAAAGAAAAAuAAAARQAAACEAAAAfAAAAAAAAAAkAAAAQAAAAAwAAABIAAADs/wAAEAAAAAYAAAASAAAAIgAAABEAAAADAAAABAAAAA8AAAD4/wAAHQAAAAsAAAAIAAAADgAAAP//AAAcAAAADwAAAAYAAAASAAAAFwAAAAMAAAAYAAAAEgAAAPr/AAAQAAAADQAAAAoAAAD3/wAABgAAAPb/AADf/wAA/v8AAPL/AAD6/wAAFAAAAAQAAAAEAAAAGwAAAAEAAAAMAAAAIAAAAAIAAAAdAAAAGAAAAAIAAAAcAAAAEgAAAAcAAAAeAAAADwAAAAQAAAAeAAAABAAAAAYAAAAZAAAAAQAAAA4AAAATAAAA/v8AAAoAAAAOAAAA+/8AAAsAAAAJAAAA+f8AAAsAAAABAAAA+f8AAAoAAAD9/wAA+v8AAAcAAAD5/wAA+v8AAAUAAAD3/wAA/f8AAAQAAAD2/wAAAAAAAAEAAAD3/wAAAgAAAAAAAAD4/wAAAwAAAP7/AAD6/wAABAAAAP3/AAD8/wAABAAAAPv/AAD+/wAAAwAAAPv/AAD//wAAAQAAAPv/AAAAAAAAAAAAAPv/AAACAAAA//8AAPz/AAACAAAA/v8AAP3/AAACAAAA/f8AAP7/AAABAAAA/f8AAP//AAABAAAA/f8AAAAAAAAAAAAA/v8AAAEAAAAAAAAA//8AAAAAAAAAAAAAAAAAAAAAAAAAAAAA"],ie={AMBISONIC:"ambisonic",BYPASS:"bypass",OFF:"off"},ne=[2,3];function re(e,t){this._context=O.isAudioContext(e)?e:O.throw("HOARenderer: Invalid BaseAudioContext."),this._config={ambisonicOrder:3,renderingMode:ie.AMBISONIC},t&&t.ambisonicOrder&&(ne.includes(t.ambisonicOrder)?this._config.ambisonicOrder=t.ambisonicOrder:O.log("HOARenderer: Invalid ambisonic order. (got "+t.ambisonicOrder+") Fallbacks to 3rd-order ambisonic.")),this._config.numberOfChannels=(this._config.ambisonicOrder+1)*(this._config.ambisonicOrder+1),this._config.numberOfStereoChannels=Math.ceil(this._config.numberOfChannels/2),t&&t.hrirPathList&&(Array.isArray(t.hrirPathList)&&t.hrirPathList.length===this._config.numberOfStereoChannels?this._config.pathList=t.hrirPathList:O.throw("HOARenderer: Invalid HRIR URLs. It must be an array with "+this._config.numberOfStereoChannels+" URLs to HRIR files. (got "+t.hrirPathList+")")),t&&t.renderingMode&&(Object.values(ie).includes(t.renderingMode)?this._config.renderingMode=t.renderingMode:O.log("HOARenderer: Invalid rendering mode. (got "+t.renderingMode+') Fallbacks to "ambisonic".')),this._buildAudioGraph(),this._isRendererReady=!1}re.prototype._buildAudioGraph=function(){this.input=this._context.createGain(),this.output=this._context.createGain(),this._bypass=this._context.createGain(),this._hoaRotator=new $(this._context,this._config.ambisonicOrder),this._hoaConvolver=new j(this._context,this._config.ambisonicOrder),this.input.connect(this._hoaRotator.input),this.input.connect(this._bypass),this._hoaRotator.output.connect(this._hoaConvolver.input),this._hoaConvolver.output.connect(this.output),this.input.channelCount=this._config.numberOfChannels,this.input.channelCountMode="explicit",this.input.channelInterpretation="discrete"},re.prototype._initializeCallback=function(e,t){(this._config.pathList?new k(this._context,this._config.pathList,{dataType:"url"}):2===this._config.ambisonicOrder?new k(this._context,te):new k(this._context,ee)).load().then(function(t){this._hoaConvolver.setHRIRBufferList(t),this.setRenderingMode(this._config.renderingMode),this._isRendererReady=!0,O.log("HOARenderer: HRIRs loaded successfully. Ready."),e()}.bind(this),(function(){var e="HOARenderer: HRIR loading/decoding failed.";t(e),O.throw(e)}))},re.prototype.initialize=function(){return O.log("HOARenderer: Initializing... (mode: "+this._config.renderingMode+", ambisonic order: "+this._config.ambisonicOrder+")"),new Promise(this._initializeCallback.bind(this))},re.prototype.setRotationMatrix3=function(e){this._isRendererReady&&this._hoaRotator.setRotationMatrix3(e)},re.prototype.setRotationMatrix4=function(e){this._isRendererReady&&this._hoaRotator.setRotationMatrix4(e)},re.prototype.setRenderingMode=function(e){if(e!==this._config.renderingMode){switch(e){case ie.AMBISONIC:this._hoaConvolver.enable(),this._bypass.disconnect();break;case ie.BYPASS:this._hoaConvolver.disable(),this._bypass.connect(this.output);break;case ie.OFF:this._hoaConvolver.disable(),this._bypass.disconnect();break;default:return void O.log('HOARenderer: Rendering mode "'+e+'" is not supported.')}this._config.renderingMode=e,O.log("HOARenderer: Rendering mode changed. ("+e+")")}};var ae={getBrowserInfo:function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(i[1]))return{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""};if("Chrome"===i[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/)))return{name:"Opera",version:e[1]};i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/([\d.]+)/i))&&i.splice(1,1,e[1]);var n=t.match(/android|ipad|iphone/i);return n||(n=t.match(/cros|linux|mac os x|windows/i)),{name:i[0],version:i[1],platform:n?n[0]:"unknown"}},patchSafari:function(){window.webkitAudioContext&&window.webkitOfflineAudioContext&&(window.AudioContext=window.webkitAudioContext,window.OfflineAudioContext=window.webkitOfflineAudioContext)}},se={};se.browserInfo=ae.getBrowserInfo(),se.createBufferList=function(e,t,i){return new k(e,t,i||{dataType:"url"}).load()},se.mergeBufferListByChannel=O.mergeBufferListByChannel,se.splitBufferbyChannel=O.splitBufferbyChannel,se.createFOAConvolver=function(e,t){return new V(e,t)},se.createFOARouter=function(e,t){return new M(e,t)},se.createFOARotator=function(e){return new B(e)},se.createHOARotator=function(e,t){return new $(e,t)},se.createHOAConvolver=function(e,t,i){return new j(e,t,i)},se.createFOARenderer=function(e,t){return new H(e,t)},se.createHOARenderer=function(e,t){return new re(e,t)},O.log("Version 1.3.0 (running ".concat(se.browserInfo.name," ").concat(se.browserInfo.version," on ").concat(se.browserInfo.platform,")")),"safari"===se.browserInfo.name.toLowerCase()&&(ae.patchSafari(),O.log("".concat(se.browserInfo.name," detected. Polyfill applied."))),t["default"]=se},"./src/controller/controller.ts":
/*!**************************************!*\
        !*** ./src/controller/controller.ts ***!
        \**************************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(s,o){r=[t,i(
/*! ../utils/math-utils */
"./src/utils/math-utils.ts"),i(
/*! ./device-orientation */
"./src/controller/device-orientation.ts"),i(
/*! ./user-input */
"./src/controller/user-input.ts")],n=o,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e,t,i,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}e.__esModule=!0,e.default=void 0,i=r(i),n=r(n);var o=function(){function e(){this._lookAt=new t.Vector3(0,0,-1),this._up=new t.Vector3(0,1,0),this._q=new t.Quaternion,this._device=new i.default,this._userInput=new n.default,this._player=void 0,this._sensorActive=!1}var r=e.prototype;return r.connect=function(e){this._player=e,this._sensorActive&&this._device.connect()},r.disconnect=function(){this._sensorActive&&this._device.disconnect(),this._player=void 0},r.update=function(){var e=!1;e=this._sensorActive?this._device.update(this._q):this._userInput.update(this._q),this._lookAt.applyQuaternion(this._q),this._up.applyQuaternion(this._q),this._player&&(e?this._player.update([this._lookAt.x,this._lookAt.y,this._lookAt.z],[this._up.x,this._up.y,this._up.z]):this._player.update()),this._q.set(0,0,0,1),this._lookAt.set(0,0,-1),this._up.set(0,1,0)},s(e,[{key:"userInput",get:function(){return this._userInput}},{key:"sensorActive",set:function(e){this._sensorActive=e,e&&this._player&&this.connect(this._player)},get:function(){return this._sensorActive}}]),e}(),c=o;e.default=c}))},"./src/controller/device-orientation.ts":
/*!**********************************************!*\
        !*** ./src/controller/device-orientation.ts ***!
        \**********************************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(s,o){r=[t,i(
/*! ../utils/math-utils */
"./src/utils/math-utils.ts")],n=o,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e,t){"use strict";e.__esModule=!0,e.default=void 0;var i=function(){function e(){var e=this;this._screenOrientation=0,this._deviceOrientation={},this._enabled=!0,this._zee=new t.Vector3(0,0,1),this._euler=new t.Euler,this._q0=new t.Quaternion,this._q1=new t.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._alphaOffset=0,this._onDeviceOrientationChangeEvent=function(t){e._deviceOrientation=t},this._onScreenOrientationChangeEvent=function(){var t=window.orientation;e._screenOrientation="number"===typeof t?t:parseInt(t,10)||0},this._setObjectQuaternion=function(t,i,n,r,a){e._euler.set(n,i,-r,"YXZ"),t.setFromEuler(e._euler),t.multiply(e._q1),t.multiply(e._q0.setFromAxisAngle(e._zee,-a))}}var i=e.prototype;return i.connect=function(){var e=this;this._onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"===typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(window.addEventListener("orientationchange",e._onScreenOrientationChangeEvent,!1),window.addEventListener("deviceorientation",e._onDeviceOrientationChangeEvent,!1))})).catch((function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",this._onScreenOrientationChangeEvent,!1),window.addEventListener("deviceorientation",this._onDeviceOrientationChangeEvent,!1)),this._enabled=!0},i.disconnect=function(){window.removeEventListener("orientationchange",this._onScreenOrientationChangeEvent,!1),window.removeEventListener("deviceorientation",this._onDeviceOrientationChangeEvent,!1),this._enabled=!1},i.update=function(e){if(!1===this._enabled)return!1;var i=this._deviceOrientation;if(i){var n=i.alpha?(0,t.degToRad)(i.alpha)+this._alphaOffset:0,r=i.beta?(0,t.degToRad)(i.beta):0,a=i.gamma?(0,t.degToRad)(i.gamma):0,s=this._screenOrientation?(0,t.degToRad)(this._screenOrientation):0;this._setObjectQuaternion(e,n,r,a,s)}return!0},i.dispose=function(){this.disconnect()},e}(),n=i;e.default=n}))},"./src/controller/user-input.ts":
/*!**************************************!*\
        !*** ./src/controller/user-input.ts ***!
        \**************************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(s,o){r=[t,i(
/*! ../utils/math-utils */
"./src/utils/math-utils.ts")],n=o,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e,t){"use strict";function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}e.__esModule=!0,e.default=void 0;var r=function(){function e(){var e=this;this._zee=new t.Vector3(0,0,1),this._euler=new t.Euler,this._q0=new t.Quaternion,this._q1=new t.Quaternion(0,0,0,1),this._xAxis=0,this._yAxis=0,this._zAxis=0,this._axisUpdate=!0,this._setObjectQuaternion=function(t,i,n,r,a){e._euler.set(n,i,-r,"YXZ"),t.setFromEuler(e._euler),t.multiply(e._q1),t.multiply(e._q0.setFromAxisAngle(e._zee,-a))}}var i=e.prototype;return i.setAxis=function(e,t,i){this._yAxis=t,this._xAxis=Math.min(Math.max(e,-Math.PI/2),Math.PI/2),this._zAxis=i,this._axisUpdate=!0},i.update=function(e){return!!this._axisUpdate&&(this._setObjectQuaternion(e,-this._yAxis,this._xAxis,this._zAxis,0),this._axisUpdate=!1,!0)},n(e,[{key:"yAxis",get:function(){return this._yAxis},set:function(e){this.setAxis(this._xAxis,e,this._zAxis)}},{key:"xAxis",get:function(){return this._xAxis},set:function(e){this.setAxis(e,this._yAxis,this._zAxis)}},{key:"zAxis",get:function(){return this._zAxis},set:function(e){this.setAxis(this._xAxis,this._yAxis,e)}}]),e}(),a=r;e.default=a}))},"./src/errors.ts":
/*!***********************!*\
        !*** ./src/errors.ts ***!
        \***********************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";var t;e.__esModule=!0,e.ErrorCode=void 0,e.ErrorCode=t,function(e){e[e["WEBGL_INIT_ERROR"]=102]="WEBGL_INIT_ERROR",e[e["WEBGL_PROGRAM_ERROR"]=103]="WEBGL_PROGRAM_ERROR"}(t||(e.ErrorCode=t={}))}))},"./src/events.ts":
/*!***********************!*\
        !*** ./src/events.ts ***!
        \***********************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";var t;e.__esModule=!0,e.default=void 0,function(e){e["AMBISONIC_CHANGE"]="ambisonicChange",e["AMBISONIC_FAILED"]="ambisonicFailed",e["ERROR"]="error"}(t||(t={}));var i=t;e.default=i}))},"./src/index.ts":
/*!**********************!*\
        !*** ./src/index.ts ***!
        \**********************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(s,o){r=[t,i(
/*! events */
"./node_modules/events/events.js"),i(
/*! ./controller/controller */
"./src/controller/controller.ts"),i(
/*! ./events */
"./src/events.ts"),i(
/*! ./player/player-webgl */
"./src/player/player-webgl.ts"),i(
/*! ./utils/browser */
"./src/utils/browser.ts"),i(
/*! ./utils/log */
"./src/utils/log.ts"),i(
/*! ./utils/storage */
"./src/utils/storage.ts"),i(
/*! ./utils/webgl-utils */
"./src/utils/webgl-utils.ts")],n=o,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e,t,i,n,r,a,s,o,c){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t,i){return t&&d(e.prototype,t),i&&d(e,i),e}function h(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}e.__esModule=!0,e.default=void 0,i=u(i),n=u(n),r=u(r),a=u(a),o=u(o);var l="main",f=function(e){function u(){var a;return a=e.call(this)||this,a._player=void 0,a._active=!1,a._controller=void 0,a._observer=void 0,a._error=void 0,a._storage=void 0,a._update=function(){a._active&&(requestAnimationFrame(a._update),a._controller.update())},a._observer=new t.EventEmitter,a._observer.on(n.default.ERROR,(function(e){a.stop(),a._error=e,a.emit(n.default.ERROR,e)})),a._observer.on(n.default.AMBISONIC_CHANGE,(function(e){a.emit(n.default.AMBISONIC_CHANGE,e)})),a._observer.on(n.default.AMBISONIC_FAILED,(function(e){a.emit(n.default.AMBISONIC_FAILED,e)})),a._player=new r.default(a._observer),a._controller=new i.default,a._controller.connect(a._player),a._storage=new o.default,a._storage.read("kwai-360-log")&&s.Log.level(s.LOG_LEVEL.LEVEL_VERBOSE),s.Log.i(l,u.version),a}h(u,e),u.isSupported=function(){return!a.default.msie&&(0,c.isSupported)()},_(u,null,[{key:"version",get:function(){return"1.0.6"}},{key:"Events",get:function(){return{ERROR:n.default.ERROR,AMBISONIC_FAILED:n.default.AMBISONIC_FAILED,AMBISONIC_CHANGE:n.default.AMBISONIC_CHANGE}}}]);var d=u.prototype;return d.destroy=function(){s.Log.i(l,"destroy"),this._active=!1,this._player.destroy(),this._observer.removeAllListeners(),this.removeAllListeners()},d.setMediaInfo=function(e){s.Log.i(l,"setMediaInfo",e),e.fps&&this._player.setFPS(e.fps)},d.attachSource=function(e){s.Log.i(l,"attachSource"),this._player.attachSource(e),this.start()},d.attachOutputCanvas=function(e){s.Log.i(l,"attachOutputCanvas"),this._error=void 0,this._player&&this._player.attachOutputCanvas(e),this._active&&this.start()},d.start=function(){s.Log.i(l,"start"),this._active||this._error||(this._active=!0,this._update())},d.stop=function(){s.Log.i(l,"stop"),this._active=!1},d.setAxis=function(e,t,i){this._controller.sensorActive||this._controller.userInput.setAxis(e,t,i)},d.setAudioRenderingMode=function(e){s.Log.i(l,"setAudioRenderingMode",e);var t=!(!(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent)||navigator.userAgent.match("CriOS"));t?this.emit(n.default.AMBISONIC_FAILED,{reason:"safari does not support"}):this._player.setAudioRenderingMode(e)},_(u,[{key:"sensorActive",set:function(e){this._controller.sensorActive=e},get:function(){return this._controller.sensorActive}},{key:"yAxis",get:function(){return this._controller.sensorActive?0:this._controller.userInput.yAxis},set:function(e){this._controller.sensorActive||(this._controller.userInput.yAxis=e)}},{key:"xAxis",get:function(){return this._controller.sensorActive?0:this._controller.userInput.xAxis},set:function(e){this._controller.sensorActive||(this._controller.userInput.xAxis=e)}},{key:"zAxis",get:function(){return this._controller.sensorActive?0:this._controller.userInput.zAxis},set:function(e){this._controller.sensorActive||(this._controller.userInput.zAxis=e)}}]),u}(t.EventEmitter),p=f;e.default=p}))},"./src/player/ambisonic-360.ts":
/*!*************************************!*\
        !*** ./src/player/ambisonic-360.ts ***!
        \*************************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(s,o){r=[t,i(
/*! omnitone/build/omnitone.min.esm.js */
"./node_modules/omnitone/build/omnitone.min.esm.js"),i(
/*! ../events */
"./src/events.ts"),i(
/*! ../types/main */
"./src/types/main.ts")],n=o,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e,t,i,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}e.__esModule=!0,e.default=void 0,t=r(t),i=r(i);var a=function(){function e(e){var t=this;this._source=void 0,this._foaRenderer=void 0,this._audioContext=void 0,this._audioElementSource=void 0,this._mode=n.AudioRenderingMode.BYPASS,this._observer=void 0,this._tryInitFOA=function(){t._source&&!t._foaRenderer&&t._initFOA()},this._connectFOA=function(){t._audioContext&&t._audioElementSource&&t._foaRenderer&&(t._audioElementSource.connect(t._foaRenderer.input),t._foaRenderer.output.connect(t._audioContext.destination))},this._observer=e}var r=e.prototype;return r.setAudioRenderingMode=function(e){this._mode=e,this._foaRenderer?(this._foaRenderer.setRenderingMode(e),this._observer.emit(i.default.AMBISONIC_CHANGE,{mode:e})):this._tryInitFOA()},r.setSource=function(e){this._source=e,this._foaRenderer&&(this._disconnectFOA(),this._foaRenderer=void 0),this._tryInitFOA()},r.setRotationMatrix4=function(e){this._foaRenderer&&this._foaRenderer.setRotationMatrix4(e)},r.close=function(){},r._initFOA=function(){if(this._source&&this._source instanceof HTMLMediaElement)try{if(this._audioContext=new AudioContext,"running"===this._audioContext.state){this._audioElementSource=this._audioContext.createMediaElementSource(this._source);var e=t.default.createFOARenderer(this._audioContext);this._foaRenderer=e,this._foaRenderer.setRenderingMode(this._mode),this._observer.emit(i.default.AMBISONIC_CHANGE,{mode:this._mode}),e.initialize().then(this._connectFOA)}else this._observer.emit(i.default.AMBISONIC_FAILED,{reason:"audiocontext state: "+this._audioContext.state})}catch(n){this._observer.emit(i.default.AMBISONIC_FAILED,{reason:"init foa error: "+n.toString()})}},r._disconnectFOA=function(){this._audioContext&&this._audioElementSource&&this._foaRenderer&&(this._audioElementSource.disconnect(),this._foaRenderer.output.disconnect(),this._audioElementSource.connect(this._audioContext.destination))},e}(),s=a;e.default=s}))},"./src/player/fps-helper.ts":
/*!**********************************!*\
        !*** ./src/player/fps-helper.ts ***!
        \**********************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";e.__esModule=!0,e.default=void 0;var t=2e3,i=25,n=function(){function e(){var e=this;this._video=null,this._isVideoPlaybackQualityAvailable=!1,this._sourceFPS=0,this._lastCalculateFPSFrames=0,this._lastCalculateFPSTime=0,this._lastRenderTime=0,this._frameDuration=Math.floor(1e3/i),this._hasOverriddenFPS=!1,this._skip=0,this._seeked=function(){e._lastCalculateFPSTime=0,e._lastCalculateFPSFrames=0}}var n=e.prototype;return n.destroy=function(){this._video&&this._video.removeEventListener("seeked",this._seeked)},n.attachMedia=function(e){this.destroy();var t=this._video=e instanceof window.HTMLVideoElement?e:null;t&&(this._isVideoPlaybackQualityAvailable="function"===typeof t.getVideoPlaybackQuality,t.addEventListener("seeked",this._seeked))},n.setFPS=function(e){e>0&&(this._hasOverriddenFPS=!0,this._frameDuration=Math.floor(1e3/e))},n.update=function(e){var n=this._video;if(n){var r=performance.now();if(!this._hasOverriddenFPS){var a=0;if(this._isVideoPlaybackQualityAvailable){var s=n.getVideoPlaybackQuality();a=s.totalVideoFrames+s.droppedVideoFrames}else a=n.webkitDecodedFrameCount||0+n.webkitDroppedFrameCount||0;if(this._lastCalculateFPSTime){if(r-this._lastCalculateFPSTime>=t){var o=(a-this._lastCalculateFPSFrames)/(r-this._lastCalculateFPSTime)*1e3;this._frameDuration=Math.floor(1e3/Math.max(i,this._sourceFPS,o)),this._sourceFPS=o,this._lastCalculateFPSFrames=a,this._lastCalculateFPSTime=r}}else this._lastCalculateFPSTime=r,this._lastCalculateFPSFrames=a}if(!this._lastRenderTime||r-this._lastRenderTime>this._frameDuration&&this._skip<=0){this._lastRenderTime=r;var c=performance.now();e();var u=performance.now()-c;return this._skip=Math.ceil(u/this._frameDuration),!0}return this._skip--,!1}return this._sourceFPS=0,!1},e}(),r=n;e.default=r}))},"./src/player/player-webgl.ts":
/*!************************************!*\
        !*** ./src/player/player-webgl.ts ***!
        \************************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(s,o){r=[t,i(
/*! ../errors */
"./src/errors.ts"),i(
/*! ../events */
"./src/events.ts"),i(
/*! ../types/main */
"./src/types/main.ts"),i(
/*! ../utils/log */
"./src/utils/log.ts"),i(
/*! ../utils/m4 */
"./src/utils/m4.ts"),i(
/*! ../utils/make-sphere */
"./src/utils/make-sphere.ts"),i(
/*! ../utils/webgl-utils */
"./src/utils/webgl-utils.ts"),i(
/*! ./ambisonic-360 */
"./src/player/ambisonic-360.ts"),i(
/*! ./fps-helper */
"./src/player/fps-helper.ts")],n=o,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e,t,i,n,r,a,s,o,c,u){"use strict";function d(e){return e&&e.__esModule?e:{default:e}}function _(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return t&&_(e.prototype,t),i&&_(e,i),e}e.__esModule=!0,e.default=void 0,i=d(i),c=d(c),u=d(u);var l="\n    attribute vec4 a_position;\n    attribute vec2 a_texcoord;\n    uniform mat4 u_matrix;\n\n    varying vec2 v_texcoord;\n        \n    void main() {\n        gl_Position = u_matrix * a_position;\n        v_texcoord = a_texcoord;\n    }\n",f="\n    precision mediump float;\n    // Passed in from the vertex shader.\n    varying vec2 v_texcoord;\n\n    // The texture.\n    uniform sampler2D u_texture;\n        \n    void main() {\n       gl_FragColor = texture2D(u_texture, v_texcoord);\n    }\n",p="player",v=function(){function e(e){var t=this;this._source=void 0,this._canvas=void 0,this._xAxis=0,this._yAxis=0,this._zAxis=0,this._axisUpdate=!0,this._vShader=null,this._fShader=null,this._program=null,this._positionBuffer=null,this._texcoordBuffer=null,this._indicesBuffer=null,this._positionLocation=0,this._texcoordLocation=0,this._texture=null,this._matrixLocation=null,this._textureLocation=null,this._gl=null,this._model=void 0,this._lookAt=void 0,this._up=void 0,this._updateTexImage=!0,this._observer=void 0,this._ambisonic360=void 0,this._canvasWidth=0,this._canvasHeight=0,this._fps=void 0,this.draw=function(e){void 0===e&&(e=!0);var i=t._gl;i&&t._source&&(e&&(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t._source),t._updateTexImage=!1),t._updateWebGL(i))},this._observer=e,this._fps=new u.default,this._model=(0,s.makeSphere)(10,50,50)}var d=e.prototype;return d.setFPS=function(e){this._fps.setFPS(e)},d.attachSource=function(e){this._source=e,this._updateTexImage=!0,e instanceof HTMLVideoElement&&this._fps.attachMedia(e),this._ambisonic360&&(e instanceof HTMLVideoElement?this._ambisonic360.setSource(e):this._ambisonic360.close())},d.attachOutputCanvas=function(e){this._canvas=e,this._canvasWidth=0,this._canvasHeight=0,this._gl=e.getContext("webgl"),this._gl?(this._destroyWebGL(),this._initWebGL(this._gl)):this._observer.emit(i.default.ERROR,{code:t.ErrorCode.WEBGL_INIT_ERROR,reason:"unsupported"})},d.setAudioRenderingMode=function(e){this._ambisonic360?this._source&&this._source instanceof HTMLVideoElement&&this._ambisonic360.setAudioRenderingMode(e):this._source&&this._source instanceof HTMLVideoElement&&e===n.AudioRenderingMode.AMBISONIC&&(this._ambisonic360=new c.default(this._observer),this._ambisonic360.setAudioRenderingMode(e),this._ambisonic360.setSource(this._source))},d.setAxis=function(e,t,i){this._yAxis=t,this._xAxis=Math.min(Math.max(e,-Math.PI/2),Math.PI/2),this._zAxis=i,this._axisUpdate=!0},d.update=function(e,t){e&&(this._up=t,this._lookAt=e,this._axisUpdate=!0);var i=this._gl;if(i&&this._isSourceReady()){var n=window.devicePixelRatio,a=i.canvas;this._gl&&this._isCanvasResized(a,n)&&(r.Log.i(p,"canvas resize"),this._recordCanvasSize(),this._destroyWebGL(),this._initWebGL(this._gl),this._axisUpdate=!0,this._updateTexImage=!0),this._axisUpdate&&this._updateView(i),this._source&&this._isActivated&&((this._source instanceof HTMLVideoElement||this._updateTexImage)&&this._fps.update(this.draw)||this._axisUpdate&&this.draw(this._updateTexImage),this._axisUpdate=!1)}},d.destroy=function(){this._destroyWebGL(),this._fps.destroy()},d._isSourceReady=function(){return this._source instanceof HTMLVideoElement?!!(this._source.readyState>1&&this._source.videoWidth):!(this._source instanceof HTMLImageElement)||this._source.complete},d._initWebGL=function(e){r.Log.i(p,"initWebGL");var n=(0,o.createProgramFromSources)(e,l,f);this._vShader=n.vertexShader,this._fShader=n.fragmentShader;var a=this._program=n.program;if(a){e.useProgram(a);var s=this._model;this._positionLocation=e.getAttribLocation(a,"a_position"),this._texcoordLocation=e.getAttribLocation(a,"a_texcoord"),this._matrixLocation=e.getUniformLocation(a,"u_matrix"),this._textureLocation=e.getUniformLocation(a,"u_texture"),this._positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._positionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s.coordinate),e.STATIC_DRAW),e.enableVertexAttribArray(this._positionLocation),e.vertexAttribPointer(this._positionLocation,3,e.FLOAT,!1,0,0),this._texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s.textureCoordinate),e.STATIC_DRAW),e.enableVertexAttribArray(this._texcoordLocation),e.vertexAttribPointer(this._texcoordLocation,2,e.FLOAT,!1,0,0),this._indicesBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.indices),e.STATIC_DRAW),this._texture=this._createAndSetupTexture(e),(0,o.resizeCanvasToDisplaySize)(e.canvas,window.devicePixelRatio),e.viewport(0,0,e.canvas.width,e.canvas.height),this._recordCanvasSize()}else this._observer.emit(i.default.ERROR,{code:t.ErrorCode.WEBGL_PROGRAM_ERROR,reason:"create program error"})},d._updateView=function(e){if(this._canvas){var t=this._yAxis,i=.35*Math.PI,n=this._canvas.clientWidth/this._canvas.clientHeight,r=(0,a.perspective)(i,n,1e-4,500),s=[0,0,0],o=this._lookAt?this._lookAt:[Math.sin(t),Math.sin(this._xAxis),-Math.cos(t)],c=this._up?this._up:[0,1,0],u=(0,a.lookAt)(s,o,c),d=(0,a.inverse)(u),_=(0,a.multiply)(r,d);e.uniformMatrix4fv(this._matrixLocation,!1,_),e.uniform1i(this._textureLocation,0),this._ambisonic360&&this._ambisonic360.setRotationMatrix4(d)}},d._updateWebGL=function(e){this._source&&this._model&&(e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawElements(e.TRIANGLES,this._model.indices.length,e.UNSIGNED_SHORT,0))},d._isCanvasResized=function(e,t){t=t||1;var i=e.clientWidth*t|0,n=e.clientHeight*t|0;return this._canvasWidth!==i||this._canvasHeight!==n},d._destroyWebGL=function(){r.Log.i(p,"destroyWebGL"),this._gl&&(this._gl.disableVertexAttribArray(this._positionLocation),this._gl.disableVertexAttribArray(this._texcoordLocation),this._positionBuffer&&this._gl.deleteBuffer(this._positionBuffer),this._texcoordBuffer&&this._gl.deleteBuffer(this._texcoordBuffer),this._indicesBuffer&&this._gl.deleteBuffer(this._indicesBuffer),this._texture&&this._gl.deleteTexture(this._texture),this._program&&this._gl.deleteProgram(this._program),this._vShader&&this._gl.deleteShader(this._vShader),this._fShader&&this._gl.deleteShader(this._fShader))},d._recordCanvasSize=function(){if(this._canvas){var e=window.devicePixelRatio||1;this._canvasWidth=this._canvas.clientWidth*e|0,this._canvasHeight=this._canvas.clientHeight*e|0}},d._createAndSetupTexture=function(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),t},h(e,[{key:"yAxis",get:function(){return this._yAxis},set:function(e){this.setAxis(this._xAxis,e,this._zAxis)}},{key:"xAxis",get:function(){return this._xAxis},set:function(e){this.setAxis(e,this._yAxis,this._zAxis)}},{key:"zAxis",get:function(){return this._zAxis},set:function(e){this.setAxis(this._xAxis,this._yAxis,e)}},{key:"_isActivated",get:function(){return!(!this._gl||this._gl.getParameter(this._gl.CURRENT_PROGRAM)!==this._program)}}]),e}(),m=v;e.default=m}))},"./src/types/main.ts":
/*!***************************!*\
        !*** ./src/types/main.ts ***!
        \***************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";var t;e.__esModule=!0,e.AudioRenderingMode=void 0,e.AudioRenderingMode=t,function(e){e["AMBISONIC"]="ambisonic",e["BYPASS"]="bypass",e["OFF"]="off"}(t||(e.AudioRenderingMode=t={}))}))},"./src/utils/browser.ts":
/*!******************************!*\
        !*** ./src/utils/browser.ts ***!
        \******************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";e.__esModule=!0,e.default=void 0;var t={};function i(){var e=self.navigator.userAgent.toLowerCase(),i=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],n=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],r={browser:i[5]||i[3]||i[1]||"",version:i[2]||i[4]||"0",majorVersion:i[4]||i[2]||"0",platform:n[0]||""},a={x5:/ tbs\//.test(e)};if(r.browser){a[r.browser]=!0;var s=r.majorVersion.split(".");a.version={major:parseInt(r.majorVersion,10),string:r.version},s.length>1&&(a.version.minor=parseInt(s[1],10)),s.length>2&&(a.version.build=parseInt(s[2],10))}if(r.platform&&(a[r.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),a.rv||a.iemobile){a.rv&&delete a.rv;var o="msie";r.browser=o,a[o]=!0}if(a.edge){delete a.edge;var c="msedge";r.browser=c,a[c]=!0}if(a.opr){var u="opera";r.browser=u,a[u]=!0}if(a.safari&&a.android){var d="android";r.browser=d,a[d]=!0}for(var _ in a.name=r.browser,a.platform=r.platform,t)t.hasOwnProperty(_)&&delete t[_];t=a}i();var n=t;e.default=n}))},"./src/utils/log.ts":
/*!**************************!*\
        !*** ./src/utils/log.ts ***!
        \**************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";e.__esModule=!0,e.LOG_LEVEL=e.Log=void 0;var t,i="kwai-360",n=!0;function r(e,t){return t&&0!==t.length||(t=[e],e=""),e=n?i+(e?"::"+e:""):e||i,t.unshift("["+e+"] > "),t}e.LOG_LEVEL=t,function(e){e["LEVEL_ERROR"]="e",e["LEVEL_WARN"]="w",e["LEVEL_INFO"]="i",e["LEVEL_DEBUG"]="d",e["LEVEL_VERBOSE"]="v"}(t||(e.LOG_LEVEL=t={}));var a=function(){function e(){}return e.level=function(i){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,i){case t.LEVEL_ERROR:e.ENABLE_ERROR=!0;break;case t.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case t.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case t.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case t.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0;break}},e.e=function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.error||console.warn||console.log).apply(console,s)}},e.w=function(t){if(e.ENABLE_WARN){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.warn||console.log).apply(console,s)}},e.i=function(t){if(e.ENABLE_INFO){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.info||console.log).apply(console,s)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.debug||console.log).apply(console,s)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);console.log.apply(console,s)}},e}();e.Log=a,a.ENABLE_ERROR=!0,a.ENABLE_WARN=!1,a.ENABLE_INFO=!1,a.ENABLE_DEBUG=!1,a.ENABLE_VERBOSE=!1}))},"./src/utils/m4.ts":
/*!*************************!*\
        !*** ./src/utils/m4.ts ***!
        \*************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";e.__esModule=!0,e.perspective=i,e.lookAt=n,e.inverse=o,e.multiply=c;var t=Float32Array;function i(e,i,n,r,a){a=a||new t(16);var s=Math.tan(.5*Math.PI-.5*e),o=1/(n-r);return a[0]=s/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(n+r)*o,a[11]=-1,a[12]=0,a[13]=0,a[14]=n*r*o*2,a[15]=0,a}function n(e,i,n,o){o=o||new t(16);var c=a(r(e,i)),u=a(s(n,c)),d=a(s(c,u));return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=0,o[4]=d[0],o[5]=d[1],o[6]=d[2],o[7]=0,o[8]=c[0],o[9]=c[1],o[10]=c[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}function r(e,i,n){return n=n||new t(3),n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function a(e,i){i=i||new t(3);var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return n>1e-5&&(i[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n),i}function s(e,i,n){return n=n||new t(3),n[0]=e[1]*i[2]-e[2]*i[1],n[1]=e[2]*i[0]-e[0]*i[2],n[2]=e[0]*i[1]-e[1]*i[0],n}function o(e,i){i=i||new t(16);var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],c=e[5],u=e[6],d=e[7],_=e[8],h=e[9],l=e[10],f=e[11],p=e[12],v=e[13],m=e[14],A=e[15],g=l*A,y=m*f,E=u*A,b=m*d,T=u*f,S=l*d,x=a*A,C=m*s,L=a*f,R=l*s,D=a*d,w=u*s,I=_*v,O=p*h,P=o*v,k=p*c,N=o*h,M=_*c,B=n*v,V=p*r,F=n*h,U=_*r,H=n*c,j=o*r,z=g*c+b*h+T*v-(y*c+E*h+S*v),G=y*r+x*h+R*v-(g*r+C*h+L*v),W=E*r+C*c+D*v-(b*r+x*c+w*v),K=S*r+L*c+w*h-(T*r+R*c+D*h),Q=1/(n*z+o*G+_*W+p*K);return i[0]=Q*z,i[1]=Q*G,i[2]=Q*W,i[3]=Q*K,i[4]=Q*(y*o+E*_+S*p-(g*o+b*_+T*p)),i[5]=Q*(g*n+C*_+L*p-(y*n+x*_+R*p)),i[6]=Q*(b*n+x*o+w*p-(E*n+C*o+D*p)),i[7]=Q*(T*n+R*o+D*_-(S*n+L*o+w*_)),i[8]=Q*(I*d+k*f+N*A-(O*d+P*f+M*A)),i[9]=Q*(O*s+B*f+U*A-(I*s+V*f+F*A)),i[10]=Q*(P*s+V*d+H*A-(k*s+B*d+j*A)),i[11]=Q*(M*s+F*d+j*f-(N*s+U*d+H*f)),i[12]=Q*(P*l+M*m+O*u-(N*m+I*u+k*l)),i[13]=Q*(F*m+I*a+V*l-(B*l+U*m+O*a)),i[14]=Q*(B*u+j*m+k*a-(H*m+P*a+V*u)),i[15]=Q*(H*l+N*a+U*u-(F*u+j*l+M*a)),i}function c(e,i,n){n=n||new t(16);var r=i[0],a=i[1],s=i[2],o=i[3],c=i[4],u=i[5],d=i[6],_=i[7],h=i[8],l=i[9],f=i[10],p=i[11],v=i[12],m=i[13],A=i[14],g=i[15],y=e[0],E=e[1],b=e[2],T=e[3],S=e[4],x=e[5],C=e[6],L=e[7],R=e[8],D=e[9],w=e[10],I=e[11],O=e[12],P=e[13],k=e[14],N=e[15];return n[0]=r*y+a*S+s*R+o*O,n[1]=r*E+a*x+s*D+o*P,n[2]=r*b+a*C+s*w+o*k,n[3]=r*T+a*L+s*I+o*N,n[4]=c*y+u*S+d*R+_*O,n[5]=c*E+u*x+d*D+_*P,n[6]=c*b+u*C+d*w+_*k,n[7]=c*T+u*L+d*I+_*N,n[8]=h*y+l*S+f*R+p*O,n[9]=h*E+l*x+f*D+p*P,n[10]=h*b+l*C+f*w+p*k,n[11]=h*T+l*L+f*I+p*N,n[12]=v*y+m*S+A*R+g*O,n[13]=v*E+m*x+A*D+g*P,n[14]=v*b+m*C+A*w+g*k,n[15]=v*T+m*L+A*I+g*N,n}}))},"./src/utils/make-sphere.ts":
/*!**********************************!*\
        !*** ./src/utils/make-sphere.ts ***!
        \**********************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";function t(e,t,i){for(var n=[],r=[],a=[],s=Math.PI/2,o=0;o<t;o++)for(var c=0;c<i;c++){var u=2*Math.PI/(i-1)*c,d=Math.PI*o/(t-1)-Math.PI/2,_=Math.cos(u+s)*e*Math.cos(d),h=Math.sin(u+s)*e*Math.cos(d),l=Math.sin(d)*e;r.push(_,l,h),a.push(c/(i-1),1-o/(t-1)),o<t-1&&c<i-1&&(n.push(o*i+c,o*i+c+1,(o+1)*i+c),n.push(o*i+c+1,(o+1)*i+c+1,(o+1)*i+c))}return{coordinate:r,textureCoordinate:a,indices:n}}e.__esModule=!0,e.makeSphere=t}))},"./src/utils/math-utils.ts":
/*!*********************************!*\
        !*** ./src/utils/math-utils.ts ***!
        \*********************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}e.__esModule=!0,e.degToRad=c,e.radToDeg=u,e.Quaternion=e.Euler=e.Vector3=void 0;var n=Math.PI/180,r=180/Math.PI,a=function(){function e(e,t,i,n){this._x=void 0,this._y=void 0,this._z=void 0,this._w=void 0,this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1}var t=e.prototype;return t.set=function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this},t.setFromEuler=function(e){var t=e.x,i=e.y,n=e.z,r=e.order,a=Math.cos,s=Math.sin,o=a(t/2),c=a(i/2),u=a(n/2),d=s(t/2),_=s(i/2),h=s(n/2);switch(r){case"XYZ":this._x=d*c*u+o*_*h,this._y=o*_*u-d*c*h,this._z=o*c*h+d*_*u,this._w=o*c*u-d*_*h;break;case"YXZ":this._x=d*c*u+o*_*h,this._y=o*_*u-d*c*h,this._z=o*c*h-d*_*u,this._w=o*c*u+d*_*h;break;case"ZXY":this._x=d*c*u-o*_*h,this._y=o*_*u+d*c*h,this._z=o*c*h+d*_*u,this._w=o*c*u-d*_*h;break;case"ZYX":this._x=d*c*u-o*_*h,this._y=o*_*u+d*c*h,this._z=o*c*h-d*_*u,this._w=o*c*u+d*_*h;break;case"YZX":this._x=d*c*u+o*_*h,this._y=o*_*u+d*c*h,this._z=o*c*h-d*_*u,this._w=o*c*u-d*_*h;break;case"XZY":this._x=d*c*u-o*_*h,this._y=o*_*u-d*c*h,this._z=o*c*h+d*_*u,this._w=o*c*u+d*_*h;break;default:console.warn("unknown order: "+r)}return this},t.setFromAxisAngle=function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this},t.multiply=function(e,t){return void 0!==t?this.multiplyQuaternions(e,t):this.multiplyQuaternions(this,e)},t.multiplyQuaternions=function(e,t){var i=e._x,n=e._y,r=e._z,a=e._w,s=t._x,o=t._y,c=t._z,u=t._w;return this._x=i*u+a*s+n*c-r*o,this._y=n*u+a*o+r*s-i*c,this._z=r*u+a*c+i*o-n*s,this._w=a*u-i*s-n*o-r*c,this},i(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}},{key:"w",get:function(){return this._w}}]),e}();e.Quaternion=a;var s=function(){function e(e,t,i){this._x=0,this._y=0,this._z=0,this._x=e||0,this._y=t||0,this._z=i||0}var t=e.prototype;return t.set=function(e,t,i){return this._x=e,this._y=t,this._z=i,this},t.applyQuaternion=function(e){var t=this._x,i=this._y,n=this.z,r=e.x,a=e.y,s=e.z,o=e.w,c=o*t+a*n-s*i,u=o*i+s*t-r*n,d=o*n+r*i-a*t,_=-r*t-a*i-s*n;return this._x=c*o+_*-r+u*-s-d*-a,this._y=u*o+_*-a+d*-r-c*-s,this._z=d*o+_*-s+c*-a-u*-r,this},i(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}}]),e}();e.Vector3=s;var o=function(){function e(t,i,n,r){this._x=void 0,this._y=void 0,this._z=void 0,this._order=void 0,this._x=t||0,this._y=i||0,this._z=n||0,this._order=r||e.DefaultOrder}var t=e.prototype;return t.set=function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this},i(e,[{key:"isEuler",get:function(){return!0}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}},{key:"order",get:function(){return this._order}}]),e}();function c(e){return e*n}function u(e){return e*r}e.Euler=o,o.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],o.DefaultOrder="XYZ"}))},"./src/utils/storage.ts":
/*!******************************!*\
        !*** ./src/utils/storage.ts ***!
        \******************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}e.__esModule=!0,e.default=void 0;var n=function(){function e(){this.timeout=6048e5}var t=e.prototype;return t.write=function(t,i){e.available&&localStorage.setItem(t,JSON.stringify({value:i,time:Date.now()}))},t.read=function(t){if(e.available)try{var i=localStorage.getItem(t);if(i){var n=JSON.parse(i),r=n.value,a=n.time,s=void 0===a?0:a;if(Date.now()-s<this.timeout)return r}}catch(o){}},i(e,null,[{key:"available",get:function(){if("undefined"===typeof e._available)try{localStorage.setItem("kwai-h5","test"),e._available=!0}catch(t){e._available=!1}return e._available}}]),e}();n._available=void 0;var r=n;e.default=r}))},"./src/utils/webgl-utils.ts":
/*!**********************************!*\
        !*** ./src/utils/webgl-utils.ts ***!
        \**********************************/
/*! no static exports found */
function(e,t,i){var n,r,a;(function(i,s){r=[t],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";function t(e,t){t=t||1;var i=e.clientWidth*t|0,n=e.clientHeight*t|0;return(e.width!==i||e.height!==n)&&(e.width=i,e.height=n,!0)}function i(e,t,i,n,r){var s=r||a,o=e.createProgram();if(!o)return null;t.forEach((function(t){e.attachShader(o,t)})),i&&i.forEach((function(t,i){e.bindAttribLocation(o,n?n[i]:i,t)})),e.linkProgram(o);var c=e.getProgramParameter(o,e.LINK_STATUS);if(!c){var u=e.getProgramInfoLog(o);return s("Error in program linking:"+u),e.deleteProgram(o),null}return o}function n(e,t,i,n){var r=n||a,s=e.createShader(i);if(!s)return null;e.shaderSource(s,t),e.compileShader(s);var o=e.getShaderParameter(s,e.COMPILE_STATUS);if(!o){var c=e.getShaderInfoLog(s);return r("*** Error compiling shader '"+s+"':"+c),e.deleteShader(s),null}return s}function r(e,t,r,a,s,o){void 0===a&&(a=[]),void 0===s&&(s=[]);var c=[],u=n(e,t,e.VERTEX_SHADER,o),d=n(e,r,e.FRAGMENT_SHADER,o);return u&&c.push(u),d&&c.push(d),{program:i(e,c,a,s,o),vertexShader:u,fragmentShader:d}}function a(e){console&&(console.error?console.error(e):console.log&&console.log(e))}function s(e){var t={antialias:!0};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}function o(){var e,t=document.createElement("canvas");t.width=1,t.height=1;try{e=s(t)}catch(c){return!1}if(e){var i=4,n=4,r=e.createTexture(),a=new Uint8Array(i*n);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,i,n,0,e.LUMINANCE,e.UNSIGNED_BYTE,a);var o=e.getError();return!o}return!1}e.__esModule=!0,e.resizeCanvasToDisplaySize=t,e.createProgramFromSources=r,e.getWebGLRenderingContext=s,e.isSupported=o}))}})["default"]}))}).call(this,i("6984")(e))},"78b8":function(e,t,i){},"9b51":function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var n=i("d2ae");function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}function c(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function d(e){var t=l();return function(){var i,n=f(e);if(t){var r=f(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return _(this,i)}}function _(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}var p=function(e){c(i,e);var t=d(i);function i(){var e;return a(this,i),e=t.apply(this,arguments),e.initKernelTime=0,e.loadedKernelTime=0,e.box={mp4:"mp4",hls:"hls",flv:"flv"},e.ignoreErrorList=["play() failed because the user didn't interact with the document first","play() request was interrupted by a new load request","Failed to load because no supported source was found","The play() request was interrupted by a call to pause()","The operation was aborted","The request is not allowed by the user agent"],e}return o(i,[{key:"summaryQosData",get:function(){var e;return null===(e=this.kernelInstance)||void 0===e?void 0:e.getAudienceStat()}},{key:"kernelInitTime",set:function(e){this.initKernelTime=e},get:function(){return this.initKernelTime}},{key:"kernelLoadedTime",set:function(e){this.loadedKernelTime=e},get:function(){return this.loadedKernelTime}}]),i}(n["a"])},"9de5":function(e,t,i){(function(e){var n,r,a;(function(s,o,c,u,d,_,h,l,f,p,v,m,A,g,y,E,b,T,S,x,C,L,R,D,w,I,O,P,k,N,M,B,V,F,U,H,j,z,G,W,K,Q,Y,X,q,Z,J,$,ee,te,ie,ne,re,ae,se,oe,ce,ue,de,_e,he,le,fe,pe,ve,me,Ae,ge,ye,Ee,be,Te,Se,xe,Ce,Le,Re,De,we,Ie,Oe,Pe,ke,Ne,Me,Be,Ve,Fe,Ue,He,je,ze,Ge,We,Ke,Qe,Ye,Xe,qe,Ze,Je,$e,et,tt,it,nt,rt,at,st,ot,ct,ut,dt,_t,ht,lt,ft,pt,vt,mt,At,gt,yt,Et,bt,Tt,St,xt,Ct,Lt,Rt,Dt,wt,It,Ot,Pt,kt,Nt,Mt,Bt,Vt,Ft,Ut,Ht,jt,zt,Gt,Wt,Kt,Qt,Yt,Xt,qt,Zt,Jt,$t,ei,ti,ii,ni,ri,ai,si,oi,ci,ui,di,_i,hi,li,fi,pi,vi,mi,Ai,gi,yi,Ei,bi,Ti,Si,xi,Ci,Li,Ri,Di,wi,Ii,Oi,Pi,ki,Ni,Mi,Bi,Vi,Fi,Ui,Hi,ji,zi,Gi,Wi,Ki,Qi,Yi,Xi,qi,Zi,Ji,$i,en,tn,nn,rn,an,sn,on,cn,un,dn,_n,hn,ln,fn,pn,vn,mn,An,gn,yn,En,bn,Tn,Sn,xn,Cn,Ln,Rn,Dn,wn,In,On,Pn,kn,Nn,Mn,Bn,Vn,Fn,Un,Hn,jn,zn,Gn,Wn,Kn,Qn,Yn,Xn,qn,Zn,Jn,$n,er,tr,ir,nr,rr,ar,sr,or,cr,ur,dr,_r,hr,lr,fr,pr,vr,mr,Ar,gr,yr,Er,br,Tr,Sr,xr,Cr,Lr,Rr,Dr,wr,Ir,Or,Pr,kr,Nr,Mr,Br,Vr,Fr,Ur,Hr,jr,zr,Gr,Wr,Kr,Qr,Yr,Xr,qr,Zr,Jr,$r,ea,ta,ia,na,ra,aa,sa,oa,ca,ua,da,_a,ha,la,fa,pa,va,ma,Aa,ga,ya,Ea,ba,Ta,Sa,xa,Ca,La,Ra,Da,wa,Ia,Oa,Pa,ka,Na,Ma,Ba,Va,Fa,Ua,Ha,ja,za,Ga,Wa,Ka,Qa,Ya,Xa,qa,Za,Ja,$a,es,ts,is,ns,rs,as,ss,os,cs,us,ds,_s,hs,ls,fs,ps,vs,ms,As,gs,ys,Es,bs,Ts,Ss,xs,Cs,Ls,Rs,Ds,ws,Is,Os,Ps,ks,Ns,Ms,Bs,Vs,Fs,Us,Hs,js,zs,Gs,Ws,Ks,Qs,Ys,Xs,qs,Zs,Js,$s,eo,to,io,no,ro,ao,so,oo,co,uo,_o,ho,lo,fo,po,vo,mo,Ao,go,yo,Eo,bo,To,So,xo,Co,Lo,Ro,Do,wo,Io,Oo,Po,ko,No,Mo,Bo,Vo,Fo,Uo,Ho,jo,zo,Go,Wo,Ko,Qo,Yo,Xo,qo,Zo,Jo,$o,ec,tc,ic,nc,rc,ac,sc,oc,cc,uc,dc,_c,hc,lc,fc,pc,vc,mc,Ac,gc,yc,Ec,bc,Tc,Sc,xc,Cc,Lc,Rc,Dc,wc,Ic,Oc,Pc,kc,Nc,Mc,Bc,Vc,Fc,Uc,Hc,jc,zc,Gc,Wc,Kc,Qc,Yc,Xc,qc,Zc,Jc,$c,eu,tu,iu,nu,ru,au,su,ou,cu,uu,du,_u,hu,lu,fu,pu,vu,mu,Au,gu,yu,Eu,bu,Tu,Su,xu,Cu,Lu,Ru,Du,wu,Iu,Ou,Pu,ku,Nu,Mu,Bu,Vu,Fu,Uu,Hu,ju,zu,Gu,Wu,Ku,Qu,Yu,Xu,qu,Zu,Ju,$u,ed,td,id,nd,rd,ad,sd,od,cd,ud,dd,_d,hd,ld,fd,pd,vd,md,Ad,gd,yd,Ed,bd,Td,Sd,xd,Cd,Ld,Rd,Dd,wd,Id,Od,Pd,kd,Nd,Md){"‮"===s&&function(s,h){o==typeof t&&o==typeof e?e[c]=h():"function"==u&&i("214d")[d]?(r=[],n=h,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)):o==typeof t?t[_]=h():s[_]=h()}(window,(function(){return function(e){var t={};function i(n){if(t[n])return t[n][c];var r=t[n]={i:n,l:!l,exports:{}};return e[n][f](r[c],r,r[c],i),r[p]=!v,r[c]}return i[m]=e,i[A]=t,i[g]=function(e,t,n){i[y](e,t)||Object[E](e,t,{enumerable:!v,get:n})},i[b]=function(e){T!=typeof Symbol&&Symbol[S]&&Object[E](e,Symbol[S],{value:x}),Object[E](e,C,{value:!v})},i[L]=function(e,t){if(l&t&&(e=i(e)),R&t)return e;if(D&t&&o==typeof e&&e&&e[C])return e;var n=Object[w](I);if(i[b](n),Object[E](n,h,{enumerable:!v,value:e}),O&t&&P!=typeof e)for(var r in e)i[g](n,r,function(t){return e[t]}[k](I,r));return n},i[N]=function(e){var t=e&&e[C]?function(){return e[h]}:function(){return e};return i[g](t,M,t),t},i[y]=function(e,t){return Object[V][B][f](e,t)},i[F]=U,i(i[H]=j)}([function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";e[C]=!v,e[z]=void 0;var t=Object[G]||function(e,t){if(I==e)throw new TypeError(W);for(var i=Object(e),n=l;n<arguments[K];n++){var r=arguments[n];if(I!=r)for(var a in r)Object[V][B][f](r,a)&&(i[a]=r[a])}return i};e[z]=t})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";var t;e[C]=!v,e[h]=void 0,function(e){e[Y]=X,e[q]=Z,e[J]=$,e[ee]=te,e[ie]=ne,e[re]=ae,e[se]=oe}(t||(t={}));var i=t;e[h]=i})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";e[C]=!v,e[ce]=function(){return window[ue]||window[de]},e[_e]=function(){return window[he]||window[le]}})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){"use strict";var n,r=o==typeof Reflect?Reflect:I,a=r&&u==typeof r[Q]?r[Q]:function(e,t,i){return Function[V][Q][f](e,t,i)};n=r&&u==typeof r[fe]?r[fe]:Object[pe]?function(e){return Object[me](e)[ve](Object[pe](e))}:function(e){return Object[me](e)};var s=Number[Ae]||function(e){return e!=e};function d(){d[ge][f](this)}e[c]=d,e[c][ye]=function(e,t){return new Promise((function(i,n){function r(){void 0!==a&&e[Ee](oe,a),i([][be][f](arguments))}var a;oe!==t&&(a=function(i){e[Ee](t,r),n(i)},e[ye](oe,a)),e[ye](t,r)}))},d[Te]=d,d[V][Se]=void 0,d[V][xe]=v,d[V][Ce]=void 0;var _=Le;function h(e){if(u!=typeof e)throw new TypeError(Re+typeof e)}function p(e){return void 0===e[Ce]?d[De]:e[Ce]}function m(e,t,i,n){var r,a,s,o;if(h(i),void 0===(a=e[Se])?(a=e[Se]=Object[w](I),e[xe]=v):(void 0!==a[we]&&(e[Ie](we,t,i[Oe]?i[Oe]:i),a=e[Se]),s=a[t]),void 0===s)s=a[t]=i,++e[xe];else if(u==typeof s?s=a[t]=n?[i,s]:[s,i]:n?s[Pe](i):s[ke](i),(r=p(e))>v&&s[K]>r&&!s[Ne]){s[Ne]=!v;var c=new Error(Me+s[K]+Be+String(t)+Ve);c[Fe]=Ue,c[He]=e,c[je]=t,c[ze]=s[K],o=c,console&&console[Ge]&&console[Ge](o)}return e}function A(){if(!this[We])return this[Ke][Ee](this[je],this[Qe]),this[We]=!v,v===arguments[K]?this[Oe][f](this[Ke]):this[Oe][Q](this[Ke],arguments)}function g(e,t,i){var n={fired:!l,wrapFn:void 0,target:e,type:t,listener:i},r=A[k](n);return r[Oe]=i,n[Qe]=r,r}function y(e,t,i){var n=e[Se];if(void 0===n)return[];var r=n[t];return void 0===r?[]:u==typeof r?i?[r[Oe]||r]:[r]:i?function(e){for(var t=new Array(e[K]),i=v;i<t[K];++i)t[i]=e[i][Oe]||e[i];return t}(r):T(r,r[K])}function b(e){var t=this[Se];if(void 0!==t){var i=t[e];if(u==typeof i)return l;if(void 0!==i)return i[K]}return v}function T(e,t){for(var i=new Array(t),n=v;n<t;++n)i[n]=e[n];return i}Object[E](d,De,{enumerable:!v,get:function(){return _},set:function(e){if(Ye!=typeof e||e<v||s(e))throw new RangeError(Xe+e+qe);_=e}}),d[ge]=function(){void 0!==this[Se]&&this[Se]!==Object[Ze](this)[Se]||(this[Se]=Object[w](I),this[xe]=v),this[Ce]=this[Ce]||void 0},d[V][Je]=function(e){if(Ye!=typeof e||e<v||s(e))throw new RangeError($e+e+qe);return this[Ce]=e,this},d[V][et]=function(){return p(this)},d[V][Ie]=function(e){for(var t=[],i=l;i<arguments[K];i++)t[ke](arguments[i]);var n=oe===e,r=this[Se];if(void 0!==r)n=n&&void 0===r[oe];else if(!n)return!l;if(n){var s;if(t[K]>v&&(s=t[v]),s instanceof Error)throw s;var o=new Error(tt+(s?it+s[nt]+rt:U));throw o[at]=s,o}var c=r[e];if(void 0===c)return!l;if(u==typeof c)a(c,this,t);else{var d=c[K],_=T(c,d);for(i=v;i<d;++i)a(_[i],this,t)}return!v},d[V][st]=function(e,t){return m(this,e,t,!l)},d[V][ot]=d[V][st],d[V][ct]=function(e,t){return m(this,e,t,!v)},d[V][ye]=function(e,t){return h(t),this[ot](e,g(this,e,t)),this},d[V][ut]=function(e,t){return h(t),this[ct](e,g(this,e,t)),this},d[V][Ee]=function(e,t){var i,n,r,a,s;if(h(t),void 0===(n=this[Se]))return this;if(void 0===(i=n[e]))return this;if(i===t||i[Oe]===t)v==--this[xe]?this[Se]=Object[w](I):(delete n[e],n[Ee]&&this[Ie](Ee,e,i[Oe]||t));else if(u!=typeof i){for(r=-l,a=i[K]-l;a>=v;a--)if(i[a]===t||i[a][Oe]===t){s=i[a][Oe],r=a;break}if(r<v)return this;v===r?i[dt]():function(e,t){for(;t+l<e[K];t++)e[t]=e[t+l];e[_t]()}(i,r),l===i[K]&&(n[e]=i[v]),void 0!==n[Ee]&&this[Ie](Ee,e,s||t)}return this},d[V][ht]=d[V][Ee],d[V][lt]=function(e){var t,i,n;if(void 0===(i=this[Se]))return this;if(void 0===i[Ee])return v===arguments[K]?(this[Se]=Object[w](I),this[xe]=v):void 0!==i[e]&&(v==--this[xe]?this[Se]=Object[w](I):delete i[e]),this;if(v===arguments[K]){var r,a=Object[ft](i);for(n=v;n<a[K];++n)Ee!==(r=a[n])&&this[lt](r);return this[lt](Ee),this[Se]=Object[w](I),this[xe]=v,this}if(u==typeof(t=i[e]))this[Ee](e,t);else if(void 0!==t)for(n=t[K]-l;n>=v;n--)this[Ee](e,t[n]);return this},d[V][pt]=function(e){return y(this,e,!v)},d[V][vt]=function(e){return y(this,e,!l)},d[mt]=function(e,t){return u==typeof e[mt]?e[mt](t):b[f](e,t)},d[V][mt]=b,d[V][At]=function(){return this[xe]>v?n(this[Se]):[]}},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";e[C]=!v,e[gt]=function(e){return e>l||e<v?v:e<=yt?l:l-O*(e-yt)},e[Et]=function(e){return e>l||e<v?v:e>=yt?l:l-O*(yt-e)},e[bt]=function(e){var t=window[Tt](e),i=new Uint8Array(t[K]);return i[St]((function(e,n){return i[n]=t[xt](n)})),i[Ct]}})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(v),i(Lt),i(Rt),i(Dt),i(R),i(l),i(wt),i(Le),i(It),i(Ot),i(Pt),i(kt),i(Nt),i(Mt),i(Bt),i(Vt),i(Ft),i(Ut),i(O),i(Ht),i(jt)],void 0===(a=u==typeof(n=function(e,t,i,n,r,a,s,o,c,u,d,_,p,m,A,g,y,b,T,S,x,L){"use strict";function R(e){return e&&e[C]?e:{default:e}}function D(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}function P(e,t,i){return t&&D(e[V],t),i&&D(e,i),e}e[C]=!v,e[h]=void 0,n=R(n),s=R(s),o=R(o),b=R(b),L=R(L);var k=Yt,N=function(e){var i,E;function C(i){var a;return(a=e[f](this)||this)[Xt]=void 0,a[qt]=void 0,a[Zt]=void 0,a[Jt]=void 0,a[$t]=void 0,a[ei]=void 0,a[ti]=!l,a[ii]=[],a[ni]=!l,a[ri]=!l,a[ai]=void 0,a[si]=v,a[oi]=void 0,a[ci]=void 0,a[ui]=function(){a[qt]&&a[qt]instanceof HTMLMediaElement&&a[qt][di]&&a[ei]instanceof MediaStreamAudioDestinationNode&&a[qt][di]===a[ei][_i]||(x[li][hi](k,fi),a[qt]&&(a[pi](),a[vi](),a[Xt]&&(a[Xt][mi](),a[Xt]=void 0),a[$t]=void 0,a[ei]=void 0,a[ge](a[qt])))},a[Ai]=function(e){a[Ie](s[h][Y],(0,t[z])({},e))},a[oi]=new o[h],a[oi][ot](s[h][Y],a[Ai]),a[oi][ot](s[h][ee],(function(e){a[Ie](s[h][ee],e)})),a[ht]||(a[ht]=a[Ee]),a[ai]=r[yi][gi](i),a[ti]=a[ai][Ei],a[ii]=[{name:bi,node:new u[Ti],bypass:!v},{name:Si,node:new p[xi],bypass:!v},{name:Ci,node:new A[Li],bypass:!v},{name:Ri,node:new g[Di],bypass:!v},{name:wi,node:new c[Ii],bypass:!v},{name:Oi,node:new m[Pi](a[oi]),bypass:!v},{name:ki,node:new _[Ni](a[ai],a[oi]),bypass:!l},{name:Mi,node:new d[Bi],bypass:!l}],a[Jt]=new n[h](a[ai]),a[ci]=new L[h],a[ci][Vi](Fi)&&x[li][Ui](x[ji][Hi]),x[li][hi](k,C[zi]),a}E=e,(i=C)[V]=Object[w](E[V]),i[V][Gi]=i,i[Wi]=E,C[Ki]=function(e){return void 0===e&&(e=!v),!(!(0,S[ce])()||!(0,S[_e])()||e&&b[h][Qi])},P(C,I,[{key:zi,get:function(){return Yi}}]);var R=C[V];return R[ge]=function(e){return x[li][hi](k,ge,e),e instanceof HTMLMediaElement?this[qt]=e:e instanceof AudioNode?this[$t]=e:this[Ie](s[h][se],{code:a[qi][Xi],reason:Zi}),this[Ji](),!!this[Xt]&&(this[$i](),this[en](this[ti]),!v)},R[tn]=function(){x[li][hi](k,tn),this[vi](),this[Xt]&&(this[Xt][mi](),this[Xt]=void 0),this[pi](),this[qt]=void 0,this[$t]=void 0,this[ei]=void 0,this[ii]=[],this[lt]()},R[nn]=function(e){this[ei]=e},R[en]=function(e){x[li][hi](k,en,e),this[ti]=e,this[Xt]&&(this[ti]?this[rn]():(this[vi](),this[$t]&&this[ei]&&this[$t][an](this[ei])))},R[sn]=function(){this[on]({items:[{name:ki,preset:h},{name:Mi}]})},R[cn]=function(e){void 0===e&&(e=v),this[si]=e,this[Zt]&&this[Xt]&&this[Zt][dn][un]((0,T[_n])(e),this[Xt][hn],ln)},R[fn]=function(){return this[Zt]?(0,T[pn])(this[Zt][dn][Wt]):this[si]},R[vn]=function(){return this[Zt]?this[Zt][mn]:v},R[An]=function(){return this[Xt]?this[Xt][gn]:v},R[yn]=function(){var e={items:[]};return this[ii][St]((function(t){if(!t[En]){var i={name:t[Fe]};if(t[Tn][bn]){var n=t[Tn];n[bn]()?i[Sn]=n[yn]():i[xn]=n[Cn]()}e[Ln][ke](i)}})),e},R[on]=function(e){var t=this;!e[Ln]||e[Ln][K]<=v||(this[ii][St]((function(e){e[En]=!v})),e[Ln][St]((function(e){var i=t[Rn](e[Fe]);i&&(i[En]=!l,e[xn]?i[Tn][Dn](e[xn]):e[Sn]&&i[Tn][on](e[Sn]))})),this[ti]&&this[rn]())},R[wn]=function(){return(0,y[wn])()},R[Dn]=function(e){x[li][hi](k,Dn,e),this[In](e)&&(this[On](!l),this[Ie](s[h][q],{preset:e}))},R[In]=function(e){var t=(0,y[Pn])(e);return!!t&&(this[on](t),!v)},R[kn]=function(e){x[li][hi](k,kn,e),e!==this[ni]&&(this[ni]=e,this[ti]&&this[rn]())},R[Nn]=function(e){this[Jt][Mn]=e},R[Bn]=function(){return this[Jt][Vn]},R[Fn]=function(){return this[Jt][Un]},R[Hn]=function(){return this[Jt][jn]},R[zn]=function(){return this[Jt][Gn]},R[Wn]=function(e){var t=this[Rn](ki);t&&t[Tn][Kn](e)},R[Qn]=function(){var e=this[Rn](ki);return e?e[Tn][Yn]():I},R[Xn]=function(){var e=this[Rn](ki);return e?e[Tn][qn]():[]},R[Zn]=function(e){var t=this[Rn](ki);return t?(t[Tn][Dn](e),t[Tn][yn]()):I},R[On]=function(e){e!==this[ri]&&this[Ie](e?s[h][ie]:s[h][re]),this[ri]=e;var t=this[Rn](Oi);t&&(t[En]=!e,this[ri]=e)},R[Jn]=function(e){this[ri]||(this[In](h),this[Ie](s[h][J]),this[On](!v),this[ti]&&this[rn]());var t=this[Rn](Oi);t&&t[Tn][on]({pitch:e})},R[$n]=function(e){var t=this[Rn](ki);t&&t[Tn][on](e)},R[er]=function(){var e=this[Rn](ki);return e?e[Tn][yn]():I},R[tr]=function(){var e=this[Rn](Ci);return e?e[Tn][qn]():[]},R[ir]=function(e){var t=this[Rn](Ci);t&&t[Tn][Dn](e)},R[nr]=function(e){var t=this[Rn](Ci);t&&t[Tn][on](e)},R[rr]=function(e){var t=this[Rn](Mi);t&&t[Tn][on](e)},R[ar]=function(){return!!this[qt]},R[Ji]=function(){var e=this;if(!this[Xt]){if(this[$t])this[Xt]=this[$t][at],this[Xt][sr]();else{var t=(0,S[ce])();this[Xt]=new t}this[Xt]&&(this[ii][St]((function(t){e[Xt]&&t[Tn][ge](e[Xt])})),this[Zt]=this[Xt][or](),this[Jt][ge](this[Xt]))}},R[$i]=function(){if(this[Xt]&&this[qt])try{var e;if(this[qt][di],this[qt][di]instanceof MediaStream){x[li][hi](k,cr);var t=!this[qt][ur]&&!this[qt][dr],i=this[qt][di];this[$t]=this[Xt][_r](i),e=this[Xt][hr](),i[lr]()[St]((function(t){e&&e[_i][fr](t)})),this[qt][pr](vr,this[ui]),t&&this[qt][mr]()}else{if(l!==this[qt][Ar]&&O!==this[qt][Ar])return x[li][hi](k,gr),this[qt][pr](yr,this[ui]),!l;x[li][hi](k,Er,this[qt][Ar],this[qt][br]),this[$t]=this[Xt][Tr](this[qt])}return this[ei]=this[ei]||e||this[Xt][Sr],this[$t][xr](),!v}catch(e){this[Ie](s[h][se],{code:a[qi][Cr],reason:e})}return!l},R[pi]=function(){this[qt]&&(this[qt][Lr](vr,this[ui]),this[qt][Lr](yr,this[ui]))},R[vi]=function(){this[$t]&&this[$t][xr](),this[ii][St]((function(e){e[Tn][xr]()})),this[Zt]&&this[Zt][xr]()},R[rn]=function(){if(this[vi](),this[$t]&&this[ei]){var e=this[$t];this[ii][St]((function(t){!t[En]&&t[Tn][Rr]&&(e[an](t[Tn][Rr]),e=t[Tn])})),this[Zt]&&(e[an](this[Zt]),e=this[Zt],this[cn](this[si])),this[Jt]&&this[ni]&&this[Jt][Rr]&&e[an](this[Jt][Rr]),e[an](this[ei])}},R[Rn]=function(e){for(var t=v;t<this[ii][K];t++)if(this[ii][t][Fe]===e)return this[ii][t];return I},P(C,[{key:Dr,get:function(){var e=this[Rn](Ci);return e?e[Tn][Dr]:void 0}}]),C}(i[Te]);e[h]=N})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";function t(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}e[C]=!v,e[h]=void 0;var i=[Mt,wr,Ir,Or,Pr,kr,Nr,Mr,Br,Vr,Fr],n=function(){function e(e){this[Xt]=void 0,this[Ur]=void 0,this[Hr]=void 0,this[jr]=void 0,this[zr]=void 0,this[Gr]=!l,this[Wr]=void 0,this[Kr]=void 0,this[Qr]=Nr,this[Qr]=e[Yr],this[Gr]=e[Xr],this[zr]={frequency:[],timeDomain:[]},this[jr]=[]}var n,r,a;return e[V][ge]=function(e){if(this[Xt]=e,this[Ur]=e[or](),this[Hr]=e[qr](),this[Ur][an](this[Hr]),this[Ur][mn]>l&&this[Gr]){var t=e[Zr](this[Ur][mn]);this[Ur][an](t);for(var i=v;i<t[mn];i++){var n=e[qr]();t[an](n,i),this[jr][ke](n)}}this[Mn]=this[Qr]},n=e,(r=[{key:Rr,get:function(){return this[Ur]}},{key:at,get:function(){return this[Xt]}},{key:Mn,set:function(e){-l!==i[Jr](e)&&(this[Qr]=e,this[Hr]&&(this[Hr][$r]=O*e),this[jr][K]&&this[jr][St]((function(t){t[$r]=O*e})))}},{key:Vn,get:function(){return this[Hr]?(this[Wr]&&this[Wr][ea]===this[Hr][ta]||(this[Wr]=new Uint8Array(this[Hr][ta])),this[Hr][Bn](this[Wr]),this[Wr]):I}},{key:Un,get:function(){return this[Hr]?(this[Kr]&&this[Kr][ea]===this[Hr][ta]||(this[Kr]=new Uint8Array(this[Hr][ta])),this[Hr][Fn](this[Kr]),this[Kr]):I}},{key:jn,get:function(){for(var e=this[zr][ia],t=v;t<this[jr][K];t++){var i=this[jr][t];e[t]&&e[t][ea]===i[ta]||(e[t]=new Uint8Array(i[ta])),i[Bn](e[t])}return e}},{key:Gn,get:function(){for(var e=this[zr][na],t=v;t<this[jr][K];t++){var i=this[jr][t];e[t]&&e[t][ea]===i[ta]||(e[t]=new Uint8Array(i[ta])),i[Fn](e[t])}return e}}])&&t(n[V],r),a&&t(n,a),e}();e[h]=n})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(v)],void 0===(a=u==typeof(n=function(e,t){"use strict";e[C]=!v,e[yi]=void 0;var i={EQbands:Le,enabled:!v,analyseByChannel:!l,analyserByteCount:Nr},n=function(){function e(){}return e[gi]=function(e){var n=(0,t[z])({},i);return(0,t[z])(n,e),n},e}();e[yi]=n})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";var t;e[C]=!v,e[qi]=void 0,e[qi]=t,function(e){e[e[Xi]=ra]=Xi,e[e[Cr]=aa]=Cr}(t||(e[qi]=t={}))})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(Lt)],void 0===(a=u==typeof(n=function(e,t){"use strict";e[C]=!v,e[h]=void 0;var i=function(e){var t,i;function n(){return e[Q](this,arguments)||this}return i=e,(t=n)[V]=Object[w](i[V]),t[V][Gi]=t,t[Wi]=i,n[V][sa]=function(t){for(var i,n=arguments[K],r=new Array(n>l?n-l:v),a=l;a<n;a++)r[a-l]=arguments[a];return(i=e[V][Ie])[f][Q](i,[this,t,t][ve](r))},n}(t[Te]);e[h]=i})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";function t(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}e[C]=!v,e[Ii]=void 0;var i=function(){function e(){this[Xt]=void 0,this[oa]=void 0,this[ca]=void 0}var i,n,r,a=e[V];return a[ge]=function(e){this[Xt]=e,this[oa]=e[ua](),this[oa][da]=_a,this[oa][ha]=la,this[oa][fa]=l,this[oa][pa]=va,this[oa][ma]=v,this[oa][Aa]=v},a[an]=function(e){this[oa]&&(this[oa][an](e),this[ga]())},a[xr]=function(){this[oa]&&(this[oa][xr](),this[ya]())},a[ga]=function(){var e=this;if(!this[ca]){var t=v;this[ca]=setInterval((function(){e[oa]&&e[oa][Ea](ba*Math[Ta](t),v,ba*Math[Sa](t)),t+=yt}),xa)}},a[ya]=function(){clearInterval(this[ca]),this[ca]=I},i=e,(n=[{key:Rr,get:function(){return this[oa]}},{key:at,get:function(){return this[Xt]}}])&&t(i[V],n),r&&t(i,r),e}();e[Ii]=i})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";function t(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}e[C]=!v,e[Ti]=void 0;var i=function(){function e(){var e=this;this[Xt]=void 0,this[Ur]=void 0,this[Ca]=void 0,this[La]=void 0,this[Ra]=void 0,this[Da]=void 0,this[wa]=v,this[Ia]=v,this[Oa]=function(t){for(var i=O*Math[Pa](yt,e[Da]),n=v;n<t[Na][ka];n++)for(var r=t[Na][Ma](n),a=t[Ba][Ma](n),s=v;s<e[La];s++)e[wa]+=e[Ra],e[wa]>=l&&(e[wa]-=l,e[Ia]=i*Math[Va](r[s]*(l/i)+yt)),a[s]=e[Ia]},this[La]=kr,this[Ra]=Fa,this[Da]=R}var i,n,r,a=e[V];return a[ge]=function(e){this[Xt]=e,this[Ur]=e[or](),this[Ca]=e[Ua](this[La],l,l),this[Ca][Ha]=this[Oa],this[Ra]/=e[gn]/ja,this[Ur][an](this[Ca])},a[an]=function(e){this[Ca]&&this[Ca][an](e)},a[xr]=function(){this[Ca]&&this[Ca][xr]()},i=e,(n=[{key:Rr,get:function(){return this[Ur]}},{key:at,get:function(){return this[Xt]}}])&&t(i[V],n),r&&t(i,r),e}();e[Ti]=i})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(v)],void 0===(a=u==typeof(n=function(e,t){"use strict";function i(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}e[C]=!v,e[Bi]=void 0;var n={default:{threshold:-jt,knee:za,ratio:Ot,attack:Ga,release:Wa}},r=function(){function e(){this[Xt]=void 0,this[Ka]=void 0,this[Qa]=!l,this[Ya]=h,this[Xa]=void 0,this[Xa]={threshold:-jt,knee:za,ratio:Ot,attack:Ga,release:Wa}}var r,a,s,o=e[V];return o[ge]=function(e){this[Xt]=e,this[Ka]=e[qa](),this[Dn](this[Ya])},o[an]=function(e){this[Ka]&&this[Ka][an](e)},o[xr]=function(){this[Ka]&&this[Ka][xr]()},o[on]=function(e){this[Za](e,!v)},o[yn]=function(){return this[Qa]?(0,t[z])({},this[Xa]):(0,t[z])({},n[this[Ya]])},o[Dn]=function(e){var t=n[e];t&&(this[Ya]=e,this[Za](t,!l))},o[qn]=function(){return Object[ft](n)[be](v)},o[Cn]=function(){return this[Qa]?U:this[Ya]},o[bn]=function(){return this[Qa]},o[Za]=function(e,i){void 0===i&&(i=!v),Object[ft](e)[K]>v&&(this[Qa]=i,(0,t[z])(this[Xa],e),this[Ka]&&(this[Ka][Ja][Wt]=this[Xa][Ja],this[Ka][$a][Wt]=this[Xa][$a],this[Ka][es][Wt]=this[Xa][es],this[Ka][ts][Wt]=this[Xa][ts],this[Ka][is][Wt]=this[Xa][is]))},r=e,(a=[{key:Rr,get:function(){return this[Ka]}},{key:at,get:function(){return this[Xt]}},{key:Ja,get:function(){return this[Xa][Ja]},set:function(e){this[Xa][Ja]=e,this[Ka]&&(this[Ka][Ja][Wt]=e)}},{key:$a,get:function(){return this[Xa][$a]},set:function(e){this[Xa][$a]=e,this[Ka]&&(this[Ka][$a][Wt]=e)}},{key:es,get:function(){return this[Xa][es]},set:function(e){this[Xa][es]=e,this[Ka]&&(this[Ka][es][Wt]=e)}},{key:ts,get:function(){return this[Xa][ts]},set:function(e){this[Xa][ts]=e,this[Ka]&&(this[Ka][ts][Wt]=e)}},{key:is,get:function(){return this[Xa][is]},set:function(e){this[Xa][is]=e,this[Ka]&&(this[Ka][is][Wt]=e)}}])&&i(r[V],a),s&&i(r,s),e}();e[Bi]=r})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(v),i(l)],void 0===(a=u==typeof(n=function(e,t,i){"use strict";function n(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}var r,a;e[C]=!v,e[ns]=e[Ni]=void 0,i=(a=i)&&a[C]?a:{default:a},e[ns]=r,function(e){e[e[rs]=Le]=rs,e[e[as]=j]=as,e[e[ss]=Lt]=ss}(r||(e[ns]=r={}));var s={10:{default:[v,v,v,v,v,v,v,v,v,v],bassBooster:[j,D,Lt,O,l,v,v,v,v,v],bassReducer:[-j,-D,-Lt,-O,-l,v,v,v,v,v],classical:[os,D,Lt,O,-l,-l,v,O,Lt,D],dance:[D,Dt,j,v,O,Lt,j,D,Lt,v],deep:[j,Lt,O,l,Lt,O,l,-O,-D,-j],electronic:[os,cs,l,v,-O,O,yt,l,D,j],hiphop:[j,D,l,Lt,-l,-l,l,-l,O,Lt],jazz:[D,Lt,l,O,-O,-O,v,l,Lt,D],latin:[os,Lt,v,v,-ba,-ba,-ba,v,Lt,os],loudness:[Rt,D,v,v,-O,v,-l,-j,j,l],lounge:[-Lt,-ba,-yt,ba,D,O,v,-ba,O,l],piano:[Lt,O,v,us,Lt,l,cs,D,Lt,cs],pop:[-O,-l,v,O,D,D,O,v,-l,-O],rnb:[Lt,Dt,Rt,O,-Lt,-O,O,Lt,Lt,D],rock:[j,D,Lt,O,-l,-l,l,Lt,D,j],smallSpeakers:[j,D,Lt,O,l,v,-l,-O,-Lt,-D],spokenWord:[-D,-l,v,l,D,j,j,D,O,v],trebleBooster:[v,v,v,v,v,l,O,Lt,D,j],trebleReducer:[v,v,v,v,v,-l,-O,-Lt,-D,-j],vocalBooster:[-O,-Lt,-Lt,l,D,D,Lt,l,v,-O],guitar:[-j,-Lt,-O,O,-yt,v,v,O,Rt,v]},5:{default:[v,v,v,v,v],bassBooster:[Lt,v,v,v,v],bassReducer:[-Lt,v,v,v,v],classical:[us,-l,yt,us,D],dance:[ds,Lt,_s,cs,v],deep:[hs,O,Wa,-Lt,-j],electronic:[ls,O,fs,us,j],hiphop:[ps,-l,yt,yt,Lt],jazz:[vs,-O,Wa,O,D],latin:[ms,-ba,-As,ba,os],loudness:[vs,v,-O,v,l],lounge:[gs,O,-ys,Wa,l],piano:[Es,l,bs,cs,cs],pop:[Ts,D,ba,-yt,-O],rnb:[Lt,-O,Ss,Lt,D],rock:[xs,-l,ba,cs,j],smallSpeakers:[Lt,v,-Cs,-us,-D],spokenWord:[v,j,_s,Lt,v],trebleBooster:[v,l,Ss,cs,j],trebleReducer:[v,-l,-Ss,-cs,-j],vocalBooster:[-Ts,D,us,yt,-O],guitar:[-Ls,v,yt,D,v]},3:{default:[v,v,v],bassBooster:[O,v,v],bassReducer:[-O,v,v],classical:[O,v,Lt],dance:[v,j,Lt],deep:[l,l,-D],electronic:[v,yt,D],hiphop:[Lt,l,O],jazz:[O,v,Lt],latin:[v,-ba,Lt],loudness:[v,-l,j],lounge:[ba,v,O],piano:[us,cs,Lt],pop:[O,O,-l],rnb:[O,O,Lt],rock:[O,l,D],smallSpeakers:[O,-l,-Lt],spokenWord:[l,j,O],trebleBooster:[v,O,D],trebleReducer:[v,-O,-D],vocalBooster:[l,Lt,v],guitar:[O,v,Rt]}},o={10:{frequency:[wr,Ir,Rs,Ds,ws,xa,Is,Os,Ps,ks]},5:{frequency:[Ns,xa,Ms,Bs,ks]},3:{frequency:[Ds,Is,Ps]}},c=function(){function e(e,t){this[Ur]=void 0,this[Vs]=void 0,this[Fs]=void 0,this[Xt]=void 0,this[Us]=void 0,this[Hs]=void 0,this[Ya]=h,this[js]=r[rs],this[Qa]=!l,this[Xa]=void 0,this[oi]=void 0,Lt!==e[zs]&&j!==e[zs]&&Le!==e[zs]||(this[js]=e[zs]),this[Fs]=[],this[Hs]=s[this[js]],this[Us]=o[this[js]],this[Xa]={f:this[Hs][this[Ya]][be](v)},this[oi]=t}var a,c,u,d=e[V];return d[ge]=function(e){this[Xt]=e,this[Ur]=e[or](),this[Vs]=e[or](),this[Gs](this[Us]),this[on](this[Xa])},d[an]=function(e){this[Vs]&&this[Vs][an](e)},d[xr]=function(){this[Vs]&&this[Vs][xr]()},d[Kn]=function(e){if(e&&e!==this[js]&&void 0!==r[e]){this[Hs]=s[e];var t=this[Hs][this[Ya]];t&&(this[Gs](o[e]),this[js]=e,this[Xa][Ws]=t[be](v),this[on](this[Xa]))}},d[on]=function(e){this[Za](e,!v)},d[yn]=function(){return this[Qa]?(0,t[z])({},this[Xa]):{f:this[Hs][this[Ya]]}},d[Dn]=function(e){var t=this[Hs][e];t&&(this[Ya]=e,this[Za]({f:t},!l))},d[qn]=function(){return Object[ft](this[Hs])[be](v)},d[Yn]=function(){return(0,t[z])({},this[Us])},d[Cn]=function(){return this[Qa]?U:this[Ya]},d[bn]=function(){return this[Qa]},d[Gs]=function(e){if(this[Xt]&&this[Ur]&&this[Vs]){this[Us]=e;var t=this[Fs],i=e[ia],n=this[Xt];t[St]((function(e){e[xr]()})),t=[];for(var r=v;r<i[K];r++){var a=void 0;t[r]?a=t[r]:(a=n[Ks](),t[ke](a)),a[ia][Qs](i[r],n[hn]),a[Ys][Wt]=Xs,a[je]=qs}t[v][je]=Zs,t[i[K]-l][je]=Js;for(var s=l;s<i[K];s++)t[s-l][an](t[s]);this[Ur][an](t[v]),t[i[K]-l][an](this[Vs])}},d[Za]=function(e,t){if(e[Ws]&&Array[$s](e[Ws])&&e[Ws][K]&&this[Xt]){this[Qa]=t;for(var n=v;n<this[Us][ia][K];n++)this[Xa][Ws][n]=e[Ws][n],this[Fs][n]&&this[Fs][n][dn][un](e[Ws][n]?e[Ws][n]:v,this[Xt][hn],ln);var r={f:e[Ws]};t||(r[xn]=this[Ya]),this[oi][Ie](i[h][Y],r)}},a=e,(c=[{key:Rr,get:function(){return this[Ur]}},{key:at,get:function(){return this[Xt]}}])&&n(a[V],c),u&&n(a,u),e}();e[Ni]=c})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";function t(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}e[C]=!v,e[xi]=void 0;var i=function(){function e(){this[Xt]=void 0,this[eo]=void 0,this[to]=void 0,this[io]=void 0,this[no]=void 0}var i,n,r,a=e[V];return a[ge]=function(e){this[Xt]=e,this[eo]=e[Ks](),this[eo][je]=ro,this[eo][ia][Wt]=Is,this[to]=e[Ks](),this[to][je]=ro,this[to][ia][Wt]=Is,this[io]=e[Ks](),this[io][je]=ao,this[io][ia][Wt]=ws,this[no]=e[Ks](),this[no][je]=ao,this[no][ia][Wt]=ws,this[eo][an](this[to]),this[to][an](this[io]),this[io][an](this[no])},a[an]=function(e){this[no]&&this[no][an](e)},a[xr]=function(){this[no]&&this[no][xr]()},i=e,(n=[{key:Rr,get:function(){return this[eo]}},{key:at,get:function(){return this[Xt]}}])&&t(i[V],n),r&&t(i,r),e}();e[xi]=i})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(v),i(l)],void 0===(a=u==typeof(n=function(e,t,i){"use strict";function n(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}var r;e[C]=!v,e[Pi]=void 0,i=(r=i)&&r[C]?r:{default:r};var a={default:{pitch:v},raise:{pitch:ms},lower:{pitch:-ms}},s=function(){function e(e){this[Qa]=!l,this[Ya]=h,this[Xa]=void 0,this[oi]=void 0,this[so]=gs,this[oo]=co,this[uo]=Fa,this[Xt]=void 0,this[Ur]=void 0,this[Vs]=void 0,this[_o]=void 0,this[ho]=void 0,this[lo]=void 0,this[fo]=void 0,this[po]=void 0,this[vo]=void 0,this[mo]=void 0,this[Ao]=void 0,this[go]=void 0,this[yo]=void 0,this[Eo]=void 0,this[bo]=void 0,this[To]=void 0,this[So]=void 0,this[xo]=void 0,this[Co]=void 0,this[Xa]=(0,t[z])({},a[h]),this[oi]=e}var r,s,o,c=e[V];return c[ge]=function(e){this[Xt]=e,this[Ur]=e[or](),this[Vs]=e[or]()},c[an]=function(e){this[Vs]&&(this[Lo](),this[Vs][an](e),this[Ro](this[Xa][Oi],!l))},c[xr]=function(){this[Vs]&&this[Vs][xr]()},c[on]=function(e){this[Za](e,!v)},c[yn]=function(){return this[Qa]?(0,t[z])({},this[Xa]):(0,t[z])({},a[this[Ya]])},c[Cn]=function(){return this[Qa]?U:this[Ya]},c[qn]=function(){return Object[ft](a)[be](v)},c[Dn]=function(e){var t=a[e];t&&(this[Ya]=e,this[Za](t,!l))},c[bn]=function(){return this[Qa]},c[Za]=function(e,t){Ye==typeof e[Oi]&&(this[Qa]=t,this[Xa][Oi]=e[Oi],this[Ro](e[Oi],!l),this[oi][Ie](i[h][ee],{pitch:e[Oi]}))},c[Lo]=function(){if(this[Xt]&&this[Ur]&&this[Vs]){var e=this[Xt];this[Ur][xr](),this[To]&&this[To][xr](),this[So]&&this[So][xr]();var t=this[Ur],i=this[Vs],n=e[Do](),r=e[Do](),a=e[Do](),s=e[Do]();this[_o]=this[wo](e,this[uo],this[oo],!l),this[ho]=this[wo](e,this[uo],this[oo],!v),n[Ct]=this[_o],r[Ct]=this[_o],a[Ct]=this[ho],s[Ct]=this[ho],n[Io]=!v,r[Io]=!v,a[Io]=!v,s[Io]=!v;var o=e[or](),c=e[or](),u=e[or]();u[dn][Wt]=v;var d=e[or]();d[dn][Wt]=v,n[an](o),r[an](c),a[an](u),s[an](d);var _=e[or](),h=e[or](),f=e[Oo](j),p=e[Oo](j);o[an](_),c[an](h),u[an](_),d[an](h),_[an](f[Po]),h[an](p[Po]);var m=e[Do](),A=e[Do](),g=this[ko](e,this[uo],this[oo]);m[Ct]=g,A[Ct]=g,m[Io]=!v,A[Io]=!v;var y=e[or](),E=e[or]();y[dn][Wt]=v,E[dn][Wt]=v,m[an](y[dn]),A[an](E[dn]),t[an](f),t[an](p),f[an](y),p[an](E),y[an](i),E[an](i);var b=e[hn]+co,T=b+this[uo]-this[oo];n[No](b),r[No](T),a[No](b),s[No](T),m[No](b),A[No](T),this[lo]=n,this[fo]=r,this[po]=o,this[vo]=c,this[mo]=u,this[Ao]=d,this[go]=_,this[yo]=h,this[Eo]=m,this[bo]=A,this[To]=y,this[So]=E,this[xo]=f,this[Co]=p,this[Mo](this[so])}},c[Mo]=function(e){this[Xt]&&this[go]&&this[yo]&&(this[go][dn][un](yt*e,this[Xt][hn],Bo),this[yo][dn][un](yt*e,this[Xt][hn],Bo))},c[Ro]=function(e,t){this[po]&&this[vo]&&this[mo]&&this[Ao]&&(t&&(e=this[Vo](e/O)),e>v?(this[po][dn][Wt]=v,this[vo][dn][Wt]=v,this[mo][dn][Wt]=l,this[Ao][dn][Wt]=l):(this[po][dn][Wt]=l,this[vo][dn][Wt]=l,this[mo][dn][Wt]=v,this[Ao][dn][Wt]=v),this[Mo](this[so]*Math[Fo](e)))},c[Vo]=function(e){return e<v?e/Ot:v==e?v:Uo+Ho*e+e*e*-jo+e*e*e*zo+e*e*e*e*-Go+e*e*e*e*e*Wo},c[ko]=function(e,t,i){for(var n=t*e[gn],r=n+(t-O*i)*e[gn],a=e[Ko](l,r,e[gn]),s=a[Ma](v),o=i*e[gn],c=o,u=n-o,d=v;d<n;++d){var _;_=d<c?Math[Qo](d/o):d>=u?Math[Qo](l-(d-u)/o):l,s[d]=_}for(d=n;d<r;++d)s[d]=v;return a},c[wo]=function(e,t,i,n){for(var r=t*e[gn],a=r+(t-O*i)*e[gn],s=e[Ko](l,a,e[gn]),o=s[Ma](v),c=v;c<r;++c)o[c]=n?(r-c)/a:c/r;for(c=r;c<a;++c)o[c]=v;return s},r=e,(s=[{key:Rr,get:function(){if(this[Ur])return this[Ur]}},{key:at,get:function(){return this[Xt]}}])&&n(r[V],s),o&&n(r,o),e}();e[Pi]=s})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(v),i(D),i(Yo),i(O)],void 0===(a=u==typeof(n=function(e,t,i,n,r){"use strict";function a(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}e[C]=!v,e[Li]=void 0;var s={default:{mix:v,decay:Xo,fadeIn:Bo,reverse:!l,ir:qo,highCut:Zo,lowCut:v,gain:l},hall:{mix:Ts,decay:Jo,fadeIn:$o,reverse:!l,ir:qo,highCut:Zo,lowCut:v,gain:l},room:{mix:yt,decay:ls,fadeIn:Le,reverse:!l,ir:ec,highCut:Zo,lowCut:tc,gain:l},live:{mix:Xo,decay:Lt,fadeIn:Yo,reverse:!l,ir:ec,highCut:Zo,lowCut:v,gain:l},bathroom:{mix:ic,decay:Ts,fadeIn:D,reverse:!l,ir:ec,highCut:Zo,lowCut:v,gain:O}},o=function(){function e(){this[Xt]=void 0,this[nc]=void 0,this[rc]=void 0,this[ac]=void 0,this[sc]=void 0,this[oc]=void 0,this[cc]=void 0,this[uc]=void 0,this[dc]=void 0,this[Xa]=void 0,this[_c]=hc,this[lc]=xa,this[Qa]=!l,this[Ya]=h,this[Xa]=(0,t[z])({},s[h])}var o,c,u,d=e[V];return d[ge]=function(e){this[Xt]=e,this[nc]=this[Xt][or](),this[ac]=this[Xt][fc](),this[rc]=this[Xt][or](),this[sc]=this[Xt][or](),this[oc]=this[Xt][or](),this[cc]=this[Xt][Ks](),this[uc]=this[Xt][Ks](),this[cc][je]=ro,this[pc]=this[Xa][pc],this[uc][je]=ao,this[vc]=this[Xa][vc],this[nc][an](this[cc]),this[cc][an](this[uc]),this[uc][an](this[ac]),this[ac][an](this[sc]),this[sc][an](this[rc]),this[nc][an](this[oc]),this[oc][an](this[rc]),this[mc]=this[Xa][mc],this[Ac]()},d[an]=function(e){this[rc]&&this[rc][an](e)},d[xr]=function(){this[rc]&&this[rc][xr]()},d[yn]=function(){return this[Qa]?(0,t[z])({},this[Xa]):(0,t[z])({},s[this[Ya]])},d[on]=function(e){this[Za](e,!v)},d[Dn]=function(e){var t=s[e];t&&(this[Ya]=e,this[Za](t,!l))},d[qn]=function(){return Object[ft](s)[be](v)},d[Cn]=function(){return this[Qa]?U:this[Ya]},d[bn]=function(){return this[Qa]},d[Ac]=function(){this[Xt]&&(qo===this[Xa][gc]?this[dc]=(0,n[yc])(this[Xt],this[Xa][Ec],this[Xa][bc],this[Xa][Tc]):this[dc]=(0,n[Sc])(this[Xt],this[Xa][Ec],this[Xa][bc],this[Xa][Tc]),this[xc](this[dc],this[_c]||v,this[lc]||v,this[Xa][Ec]))},d[xc]=function(e,t,i,n){var a=this;if(this[ac])if(v!=t){for(var s=[],o=v;o<e[ka];o++)s[o]=e[Ma](o);var c=new((0,r[_e])())(e[ka],s[v][K],e[gn]),u=c[Do]();u[Ct]=e;var d=c[Ks]();t=Math[Cc](t,e[gn]/O),i=Math[Cc](i,e[gn]/O),d[je]=ro,d[Ys][Wt]=Lc,d[ia][Qs](t,v),d[ia][Rc](i,n),u[an](d),d[an](c[Sr]),u[No](),c[Dc]=function(e){a[ac]&&(a[ac][Ct]=e[wc])},c[Ic]()}else this[ac][Ct]=e},d[Za]=function(e,i){if(Object[ft](e)[K]>v){for(var n in this[Qa]=i,e)mc===n?this[mc]=e[n]:dn===n&&(this[dn]=e[n]),(0,t[z])(this[Xa],e);this[Ac]()}},o=e,(c=[{key:Rr,get:function(){return this[nc]}},{key:at,get:function(){return this[Xt]}},{key:mc,get:function(){return this[Xa][mc]},set:function(e){this[Xa][mc]=e,this[oc]&&this[sc]&&(this[oc][dn][Wt]=(0,i[gt])(this[mc]),this[sc][dn][Wt]=(0,i[Et])(this[mc]))}},{key:Ec,get:function(){return this[Xa][Ec]},set:function(e){this[Xa][Ec]=e,this[Ac]()}},{key:bc,get:function(){return this[Xa][bc]},set:function(e){this[Xa][bc]=e,this[Ac]()}},{key:Tc,get:function(){return this[Xa][Tc]},set:function(e){this[Xa][Tc]=e,this[Ac]()}},{key:gc,get:function(){return this[Xa][gc]},set:function(e){this[Xa][gc]=e,this[Ac]()}},{key:pc,get:function(){return this[Xa][pc]},set:function(e){this[Xa][pc]=e,this[Xt]&&this[cc]&&this[cc][ia][Qs](this[Xa][pc],this[Xt][hn])}},{key:vc,get:function(){return this[Xa][vc]},set:function(e){this[Xa][vc]=e,this[Xt]&&this[uc]&&this[uc][ia][Qs](this[Xa][vc],this[Xt][hn])}},{key:dn,get:function(){return this[Xa][dn]},set:function(e){this[Xa][dn]=e,this[Xt]&&this[rc]&&this[rc][dn][Qs](this[Xa][dn],this[Xt][hn])}},{key:Dr,get:function(){return this[dc]}}])&&a(o[V],c),u&&a(o,u),e}();e[Li]=o})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";e[C]=!v,e[Sc]=function(e,t,i,n){var r,a,s=e[gn]*t,o=e[Ko](O,s,e[gn]),c=o[Ma](v),u=o[Ma](l);for(a=v;a<s;a++)r=n?s-a:a,c[a]=(O*Math[Oc]()-l)*Math[Pa](l-r/s,i),u[a]=(O*Math[Oc]()-l)*Math[Pa](l-r/s,i);return o},e[yc]=function(e,t,i,n){var r,a,s=e[gn],o=ba*t,c=Math[Pc](t*s),u=Math[Pc](o*s),d=Math[Pc]((i||v)*s),_=Math[Pa](kc,l/c),h=e[Ko](O,u,s),f=h[Ma](v),p=h[Ma](l);for(a=v;a<u;a++)r=n?u-a:a,f[a]=(O*Math[Oc]()-l)*Math[Pa](_,r),p[a]=(O*Math[Oc]()-l)*Math[Pa](_,r);for(a=v;a<d;a++)f[r=n?d-a:a]*=r/d,p[r]*=r/d;return h}})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(Nc)],void 0===(a=u==typeof(n=function(e,t){"use strict";function i(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}function n(e,t,n){return t&&i(e[V],t),n&&i(e,n),e}e[C]=!v,e[Di]=void 0;var r=function(){function e(){this[Xt]=void 0,this[Mc]=void 0,this[Bc]=void 0,this[Vc]=void 0,this[Ur]=void 0,this[Vs]=void 0,this[Fc]=v}var i=e[V];return i[ge]=function(e){var i=this;this[Xt]=e,this[Ur]=e[or](),this[Vs]=e[or](),this[Ur][an](this[Vs]),(0,t[Hc])(e[gn],this[Fc])[Uc]((function(t){i[Ur]&&i[Vs]&&t[jc]===i[Fc]&&(i[Ur][xr](),i[Mc]=e[Zr](O),i[Bc]=new a(e,t[p]),i[Vc]=new a(e,t[b]),i[Ur][an](i[Mc]),i[Mc][an](i[Bc][zc],v),i[Mc][an](i[Vc][zc],l),i[Bc][Gc][an](i[Vs]),i[Vc][Gc][an](i[Vs]))}),(function(){})),this[Fc]++},i[an]=function(e){this[Vs]&&this[Vs][an](e)},i[xr]=function(){this[Vs]&&this[Vs][xr]()},n(e,[{key:Rr,get:function(){return this[Ur]}},{key:at,get:function(){return this[Xt]}}]),e}();e[Di]=r;var a=function(){function e(e,t){this[Xt]=void 0,this[Wc]=void 0,this[Kc]=void 0,this[Qc]=void 0,this[Yc]=void 0,this[Ur]=void 0,this[Vs]=void 0,this[Xt]=e,this[Ur]=e[or](),this[Vs]=e[or](),this[Qc]=e[Ks](),this[Qc][ia][Qs](Xc,e[hn]),this[Qc][je]=ro,this[Yc]=e[Ks](),this[Yc][ia][Qs](Xc,e[hn]),this[Yc][je]=ao,this[Wc]=e[fc](),this[Wc][qc]=!l,this[Wc][Zc]=Jc,this[Ur][an](this[Qc]),this[Ur][an](this[Yc]),this[Yc][an](this[Wc]),this[Wc][an](this[Vs]),this[Qc][an](this[Vs]),this[$c](t)}return e[V][$c]=function(e){var t=e[p][K];this[Kc]=this[Xt][Ko](O,t,this[Xt][gn]);for(var i=v;i<t;i++)this[Kc][Ma](v)[i]=e[p][i],this[Kc][Ma](l)[i]=e[b][i];this[Wc][Ct]=this[Kc]},n(e,[{key:zc,get:function(){return this[Ur]}},{key:Gc,get:function(){return this[Vs]}}]),e}()})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t,i(O),i(D)],void 0===(a=u==typeof(n=function(e,t,i){"use strict";e[C]=!v,e[Hc]=function(e,a){return new Promise((function(s,o){var c=new((0,t[_e])())(O,Mr,e),u={id:a},d=function(e,t){u[e]={l:t[Ma](v),r:t[Ma](l)},u[p]&&u[b]&&s(u)};c[eu]((0,i[bt])(n),(function(e){d(p,e)}),o),c[eu]((0,i[bt])(r),(function(e){d(b,e)}),o)}))};var n=tu,r=iu})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";e[C]=!v,e[Pn]=function(e){return-l!==Object[ft](t)[Jr](e)?t[e]:I},e[wn]=function(){return Object[ft](t)};var t={default:{items:[{name:ki,preset:h},{name:Mi}]},bassBooster:{items:[{name:ki,preset:nu},{name:Mi}]},piano:{items:[{name:ki,preset:ru},{name:Ci,preset:au},{name:Mi}]},guitar:{items:[{name:ki,preset:su},{name:Ci,preset:au},{name:Mi}]},dance:{items:[{name:ki,preset:ou},{name:Mi}]},pop:{items:[{name:ki,preset:_t},{name:Mi}]},rnb:{items:[{name:ki,preset:cu},{name:Mi}]},spokenWord:{items:[{name:ki,preset:uu},{name:Mi}]},rock:{items:[{name:ki,preset:du},{name:Ci,preset:_u},{name:Mi}]},concertHall:{items:[{name:Ci,preset:hu},{name:Mi}]},bathroom:{items:[{name:Ci,preset:lu},{name:Mi}]},a3d:{items:[{name:wi},{name:Mi}]},vss:{items:[{name:Ri},{name:Mi}]},phone:{items:[{name:Si},{name:Mi}]},bit8:{items:[{name:bi},{name:Mi}]}}})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";e[C]=!v,e[h]=void 0;var t={};!function(){var e=self[vu][pu][fu](),i=Au[mu](e)||gu[mu](e)||yu[mu](e)||Eu[mu](e)||bu[mu](e)||Tu[mu](e)||Su[mu](e)||xu[mu](e)||Cu[mu](e)||e[Jr](Lu)>=v&&Ru[mu](e)||e[Jr](Du)<v&&wu[mu](e)||[],n=Iu[mu](e)||Ou[mu](e)||Pu[mu](e)||ku[mu](e)||Nu[mu](e)||Mu[mu](e)||Bu[mu](e)||Vu[mu](e)||Fu[mu](e)||Uu[mu](e)||[],r={browser:i[j]||i[Lt]||i[l]||U,version:i[O]||i[D]||Hu,majorVersion:i[D]||i[O]||Hu,platform:n[v]||U},a={};if(r[ju]){a[r[ju]]=!v;var s=r[Gu][zu](qe);a[zi]={major:parseInt(r[Gu],Le),string:r[zi]},s[K]>l&&(a[zi][Wu]=parseInt(s[l],Le)),s[K]>O&&(a[zi][Ku]=parseInt(s[O],Le))}for(var o in r[Qu]&&(a[r[Qu]]=!v),(a[Yu]||a[Xu]||a[Qi])&&(a[qu]=!v),(a[Zu]||a[Ju])&&(a[Zu]&&delete a[Zu],r[ju]=$u,a[$u]=!v),a[ed]&&(delete a[ed],r[ju]=td,a[td]=!v),a[Xu]&&(r[ju]=id,a[id]=!v),a[Qi]&&a[nd]&&(r[ju]=nd,a[nd]=!v),a[Fe]=r[ju],a[Qu]=r[Qu],t)t[B](o)&&delete t[o];t=a}();var i=t;e[h]=i})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";e[C]=!v,e[pn]=function(e){return Vt*(t=e,Math[rd](t)/Math[ad]);var t},e[_n]=function(e){return Math[Pa](Le,e/Vt)}})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";var t;function i(e,t){return t&&v!==t[K]||(t=[e],e=U),e=sd+(e?od+e:U),t[Pe](cd+e+ud),t}e[C]=!v,e[ji]=e[li]=void 0,e[ji]=t,function(e){e[dd]=_d,e[hd]=ld,e[fd]=hi,e[pd]=g,e[Hi]=vd}(t||(e[ji]=t={}));var n=function(){function e(){}return e[Ui]=function(i){switch(e[md]=e[Ad]=e[gd]=e[yd]=e[Ed]=!l,i){case t[dd]:e[md]=!v;break;case t[hd]:e[md]=e[Ad]=!v;break;case t[fd]:e[md]=e[Ad]=e[gd]=!v;break;case t[pd]:e[md]=e[Ad]=e[gd]=e[yd]=!v;break;case t[Hi]:e[md]=e[Ad]=e[gd]=e[yd]=e[Ed]=!v}},e[_d]=function(t){if(e[md]){for(var n=arguments[K],r=new Array(n>l?n-l:v),a=l;a<n;a++)r[a-l]=arguments[a];var s=i(t,r);(console[oe]||console[Ge]||console[rd])[Q](console,s)}},e[ld]=function(t){if(e[Ad]){for(var n=arguments[K],r=new Array(n>l?n-l:v),a=l;a<n;a++)r[a-l]=arguments[a];var s=i(t,r);(console[Ge]||console[rd])[Q](console,s)}},e[hi]=function(t){if(e[gd]){for(var n=arguments[K],r=new Array(n>l?n-l:v),a=l;a<n;a++)r[a-l]=arguments[a];var s=i(t,r);(console[bd]||console[rd])[Q](console,s)}},e[g]=function(t){if(e[yd]){for(var n=arguments[K],r=new Array(n>l?n-l:v),a=l;a<n;a++)r[a-l]=arguments[a];var s=i(t,r);(console[Td]||console[rd])[Q](console,s)}},e[vd]=function(t){if(e[Ed]){for(var n=arguments[K],r=new Array(n>l?n-l:v),a=l;a<n;a++)r[a-l]=arguments[a];var s=i(t,r);console[rd][Q](console,s)}},e}();e[li]=n,n[md]=!v,n[Ad]=!l,n[gd]=!l,n[yd]=!l,n[Ed]=!l})?n[Q](t,r):n)||(e[c]=a)},function(e,t,i){var n,r,a;T!=typeof globalThis?globalThis:T!=typeof self&&self,r=[t],void 0===(a=u==typeof(n=function(e){"use strict";function t(e,t){for(var i=v;i<t[K];i++){var n=t[i];n[zt]=n[zt]||!l,n[Gt]=!v,Wt in n&&(n[Kt]=!v),Object[E](e,n[Qt],n)}}e[C]=!v,e[h]=void 0;var i=function(){function e(){this[Sd]=xd}var i,n,r,a=e[V];return a[Cd]=function(t,i){e[Ld]&&localStorage[Rd](t,JSON[Dd]({value:i,time:Date[wd]()}))},a[Vi]=function(t){if(e[Ld])try{var i=localStorage[Id](t);if(i){var n=JSON[Od](i),r=n[Wt],a=n[Pd],s=void 0===a?v:a;if(Date[wd]()-s<this[Sd])return r}}catch(e){}},i=e,r=[{key:Ld,get:function(){if(void 0===e[kd])try{localStorage[Rd](Nd,Md),e[kd]=!v}catch(t){e[kd]=!l}return e[kd]}}],(n=I)&&t(i[V],n),r&&t(i,r),e}();i[kd]=void 0;var n=i;e[h]=n})?n[Q](t,r):n)||(e[c]=a)}])[h]}))})("‮","object","exports","function","amd","WebSoundEffects","default",1,"call","l",0,"m","c","d","o","defineProperty","r","undefined","toStringTag","Module","__esModule","t",8,4,"create",null,2,"string","bind","n","a","hasOwnProperty","prototype","p","","s",5,"ObjectAssign","assign","Cannot convert undefined or null to object","length","apply","EQ_CHANGE","EQChange","PRESET_SELECTED","presetSelected","PRESET_UNSELECTED","presetUnselected","PITCH_CHANGE","pitchChange","PITCH_SHIFER_SELECTED","pitchShifterSelected","PITCH_SHIFER_UNSELECTED","pitchShifterUnselected","ERROR","error","getAudioContext","AudioContext","webkitAudioContext","getOfflineAudioContext","OfflineAudioContext","webkitOfflineAudioContext","ownKeys","getOwnPropertySymbols","concat","getOwnPropertyNames","isNaN","init","once","removeListener","slice","EventEmitter","_events","_eventsCount","_maxListeners",10,'The "listener" argument must be of type Function. Received type ',"defaultMaxListeners","newListener","emit","listener","unshift","push","warned","Possible EventEmitter memory leak detected. "," "," listeners added. Use emitter.setMaxListeners() to increase limit","name","MaxListenersExceededWarning","emitter","type","count","warn","fired","target","wrapFn","number",'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ',".","getPrototypeOf","setMaxListeners",'The value of "n" is out of range. It must be a non-negative number. Received ',"getMaxListeners","Unhandled error."," (","message",")","context","addListener","on","prependListener","prependOnceListener","shift","pop","off","removeAllListeners","keys","listeners","rawListeners","listenerCount","eventNames","getDryLevel",.5,"getWetLevel","getArrayBufferFromBase64String","atob","forEach","charCodeAt","buffer",3,6,7,9,11,12,13,14,15,16,18,20,21,22,23,24,"enumerable","configurable","value","writable","key","kwai-wae","_ctx","_mediaElement","_gain","_analyser","_source","_destination","_enabled","_effects","_analyserEnabled","_pitchEnabled","_config","_gainValue","_observer","_storage","_refresh","srcObject","stream","i","Log","refresh","_unbindMediaEvent","_disconnect","close","_onEQChange","processConfig","ConfigHelper","enabled","bit","Bit","phone","Phone","reverb","Reverb","vss","VSS","a3d","Audio3D","pitch","PitchShifer","eq","EQ","compressor","Compressor","read","kwai-wae-log","level","LEVEL_VERBOSE","LOG_LEVEL","version","constructor","__proto__","isSupport","safari","1.1.12","INIT_ERROR","ErrorCode","unsupported source","_initAudioContext","_initSource","setEnabled","destroy","setDestination","_connectAll","connect","reset","setData","setGain","setTargetAtTime","gain","db2gain","currentTime",.015,"getGain","gain2db","getChannelCount","channelCount","getSampleRate","sampleRate","getData","bypass","isCustom","node","data","preset","getPresetName","items","_getEffectByName","selectPreset","getPresets","_selectPresetData","_enablePitchData","getPresetDataByName","setAnalyzerEnabled","setAnalyserByteSize","byteSize","getByteFrequencyData","byteFrequencyData","getByteTimeDomainData","byteTimeDomainData","getByteFrequencyDataByChannel","byteFrequencyDataByChannel","getByteTimeDomainDataByChannel","byteTimeDomainDataByChannel","selectEQBand","selectType","getEQSetting","getSetting","getEQPresets","getPresetsList","selectEQPreset","setPitch","setEQData","getEQData","getReverbPresets","selectReverbPreset","setReverbData","setCompressorData","hasSource","resume","createGain","init source mediasource","paused","ended","createMediaStreamSource","createMediaStreamDestination","getTracks","addTrack","addEventListener","emptied","play","networkState","init source empty","playing","init source media","src","createMediaElementSource","destination","disconnect","CREATE_SOURCE_ERROR","removeEventListener","source","dev_reverbIR",32,64,128,256,512,1024,2048,4096,8192,16384,"_input","_main","_analysers","_analyserData","_analyseByChannel","_frequency","_timeDomain","_btyeCount","analyserByteCount","analyseByChannel","createAnalyser","createChannelSplitter","indexOf","fftSize","byteLength","frequencyBinCount","frequency","timeDomain",100,101,"trigger","_panner","_timer","createPanner","panningModel","HRTF","distanceModel","inverse","refDistance","coneInnerAngle",360,"coneOuterAngle","coneOuterGain","_start","_stop","setPosition",1.5,"cos","sin",1e3,"_script","_bufferSize","_normFreq","_bits","_phaser","_last","_scriptProcess","pow","numberOfChannels","inputBuffer","getChannelData","outputBuffer","floor",.2,"createScriptProcessor","onaudioprocess",48e3,30,.003,.25,"_comp","_isCustom","_presetName","_data","createDynamicsCompressor","_setData","threshold","knee","ratio","attack","release","EQBand","EQ_10","EQ_5","EQ_3",4.5,3.5,2.5,3.6,4.75,2.8,1.4,.625,2.4,1.6,1.2,1.125,.1,.375,2.1,3.625,.6,2.25,2.6,1.25,1.7,125,250,500,2e3,4e3,8e3,16e3,400,2500,6e3,"_output","_eq","_eqSetting","_preset","_type","EQbands","_resetEQ","f","createBiquadFilter","setValueAtTime","Q",.7,"peaking","lowshelf","highshelf","isArray","_lowPass","_lowPass2","_highPass","_highPass2","lowpass","highpass","_delayTime","_fadeTime",.05,"_bufferTime","_shiftDownBuffer","_shiftUpBuffer","_mod1","_mod2","_mod1Gain","_mod2Gain","_mod3Gain","_mod4Gain","_modGain1","_modGain2","_fade1","_fade2","_mix1","_mix2","_delay1","_delay2","_initNode","_setPitchOffset","createBufferSource","_createDelayTimeBuffer","loop","createDelay","delayTime","_createFadeBuffer","start","_setDelay",.01,"_transpose","abs",.02278153473118749,.23005591195033048,.014147877819596033,.0009795096626987743,19413043101157434e-21,1.8149080040913423e-7,"createBuffer","sqrt",17,.3,"moorer",7e3,1.21,.02,"simple",80,.65,"_inputNode","_outputNode","_convolverNode","_wetGainNode","_dryGainNode","_highCut","_lowCut","_ir","_lpFreqStart",15e3,"_lpFreqEnd","createConvolver","highCut","lowCut","mix","_updateImpulse","ir","buildMoorerReverbImpulse","decay","fadeIn","reverse","buildSimpleImpulse","_applyGradualLowpass","min",1e-4,"linearRampToValueAtTime","oncomplete","renderedBuffer","startRendering","random","round",.001,19,"_splitter","_vL","_vR","_id","then","buildVSSIR","id","input","output","_convolver","_buffer","_lowpass","_highpass",200,"normalize","channelInterpretation","discrete","update","decodeAudioData","//FQgCtf/N4CAExhdmM1OC4xOC4xMDAAQSg1rCW9EISY/7AtfIAAIdwAAHVPAu55lFc9UX7YKAoAMCxOiJ5lHTPVFpeo6Z6u7T50fqfj3afOj9dXy7v29r6f1s492nzo6Z9kUTzAAFSeYuidUUTz1FE88UTzKKJ1RRPPUUTzxRPPUUTzxRaXqKOqeKLS9RRPPFE89RROqInmUGnESXl0HnRE89RRPPFE89RR1T8YoIq1hacIQQh0Ii0Ik0j/wAAAACHFBU1Q875fseey1qp87aZJ1upkozuvrmqnstaqFg3YYW1hRYMkGFI3QYW1nolysRKvT6GFqLHqLuVN48TL1FzbZm30mpxtBr+Bq8q1z9xp7Kp7+s2+kubasx8jfurWvxLvemxplXIktXo7EuBF8htCERJZCcASiBoDpQMSkLDkZE4kvS0crAAEJTt2AVTtG6Ell9Up2XCIOP/xUIA2X/wghRrWFkpEoPe6WqdegXzKqsoaXeKSkKCSPsL3OkiVu9kz0lTbwv0PFDwuDV1GBREuFPb7DLrYYlvTc9A5dLN1jmuQP9FekRaJUiG9tFe+sshuYN0INxa12ZizvL3QOfI8GXo59HOcc27LnbAEADhNdFDwRFzT0Uc7hZeZo276PRPztGd3PY5X2qNye+LKdpdH0Y58lTtN87yOPN60bk9/KGHm6N3O9ER2qNzzmV/RRueecL5Doo53uUXNPXQ69KpjYiF3DlI2Mmr07Ju937a1vvfxzwL/fzn59z4pfnzR/fXHt1lod9QH3Dvo95QChGMIJW5tMlB+bP7hN3efDrroNWeGRBcgw6YqJYEHuUUldGb9PL+wuPqCsg20haSu5enx+271uqptvim+PbmG8qwmDFAQ4WATdBnH/D1dReP/wf65rD8SHcy/V/6n+vKqcgMeh+sf/bQeXKOc/pfd4LlwcB/8//o/E/5gYKuoK/x76gGb7++tjIsHOff0OyyWeQ2Ez3QMV4eGJiGJDcFpBUylviFcTRgTatfpIQLT6Lk4OMgoPC3Yb9ipAzDc//FQgCUf/CCAGtQmygxa74TPj7X/p/ReWqplUAk03cy5RQouPNiorkEKZmiylKx80Gj0tSzELObGzI4k7ixPXIxOLBTBsxOxOLMyOLu5g1cjv+fs4lIT9czM1vk7ef+QczEduFPhWtD4LM9cjVnusukYIHGk+5Jd15UlKgt1FDwSYKsmeHvTKLvzyfxeuDA8MMsEmAPNJLAy/wMPhfCAhj5n8WKLybDJaWNLAx4MJipGLLDJlokmP4xyYWWXkFMJITf0zadZHV4Fgg9AA6u+Fb3lD+9eT1fuY3yHjcl97SnTbw1oKKBKHGa7BWIhAE+N82+leHRez/tVAdJ+KlIVMW93QEbaMS4GwjUDW8SfTjMHZ8LwfH6f//nXwv5h9nfwzWQKzCYBQA4=","//FQgCtf/N4CAExhdmM1OC4xOC4xMDAAQQRVrC04QghDoRFoRJpH/gAAAAEOKCpqh53y/Y89lrVT520yTrdTJRndfXNVPZa1ULBuwwtrCiwZIMKRugwtrPRLlYiVen0MLUWPUXcqbx4mXqLm2zNvpNTjaDX8DV5Vrn7jT2VT39Zt9Jc21Zj5G/dWtfiXe9NjTKuRJavR2JcCL5DaEIiSyE4AlEDQHSgYlIWHIyJxJelo5WAAISnbsAqnaN0JLL6pTsuEQSg1rCW9EISY/7AtfIAAIdwAAHVPAu55lFc9UX7YKAoAMCxOiJ5lHTPVFpeo6Z6u7T50fqfj3afOj9dXy7v29r6f1s492nzo6Z9kUTzAAFSeYuidUUTz1FE88UTzKKJ1RRPPUUTzxRPPUUTzxRaXqKOqeKLS9RRPPFE89RROqInmUGnESXl0HnRE89RRPPFE89RR1T8YuP/xUIA2X/wglUxsRC7hykbGTV6dk3e79ta33v454F/v5z8+58Uvz5o/vrj26y0O+oD7h30e8oBQjGEErc2mSg/Nn9wm7vPh110GrPDIguQYdMVEsCD3KKSujN+nl/YXH1BWQbaQtJXcvT4/bd63VU23xTfHtzDeVYTBigIcLAJugzj/h6uovH/4P9c1h+JDuZfq/9T/XlVOQGPQ/WP/toPLlHOf0vu8Fy4OA/+f/0fif8wMFXUFf499QDN9/fWxkWDnPv6HZZLPIbCZ7oGK8PDExDEhuC0gqZS3xCuJowJtWv0kIFp9FycHGQUHhbsN+xUgZhoUa1hZKRKD3ulqnXoF8yqrKGl3ikpCgkj7C9zpIlbvZM9JU28L9DxQ8Lg1dRgURLhT2+wy62GJb03PQOXSzdY5rkD/RXpEWiVIhvbRXvrLIbmDdCDcWtdmYs7y90DnyPBl6OfRznHNuy52wBAA4TXRQ8ERc09FHO4WXmaNu+j0T87Rndz2OV9qjcnviynaXR9GOfJU7TfO8jjzetG5Pfyhh5ujdzvREdqjc85lf0UbnnnC+Q6KOd7lFzT10Ovc//FQgCSf/CB/TNp1kdXgWCD0ADq74VveUP715PV+5jfIeNyX3tKdNvDWgooEocZrsFYiEAT43zb6V4dF7P+1UB0n4qUhUxb3dARtoxLgbCNQNbxJ9OMwdnwvB8fp//+dfC/mH2d/DNZArMJgFAB9GtQmpBWEghY7D8fl/p/ReavmgAAAAzL81YlRPIINM123GisfNBo9LUsxCzmxsyVrD1ixPXIxOLA0GzFIxONM1M1Y14SMjbu1lnydaySOasnKnNFNYeDtfF+5NBopaWG1lY0liMzRYnBRmtMpXNBuKUoZNVQYBuloemgaaJGLDA66mR7/BGCr0zpeIgYMNJVgpaVT4HhABlQ+mBl/hTfh8L4ADGpF5NhksmQAxAZLAFGQsqEQHA==","bassBooster","piano","room","guitar","dance","rnb","spokenWord","rock","live","hall","bathroom","toLowerCase","userAgent","navigator","exec",/(edge)\/([\w.]+)/,/(opr)[\/]([\w.]+)/,/(chrome)[ \/]([\w.]+)/,/(iemobile)[\/]([\w.]+)/,/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/,/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/,/(webkit)[ \/]([\w.]+)/,/(opera)(?:.*version|)[ \/]([\w.]+)/,/(msie) ([\w.]+)/,"trident",/(rv)(?::| )([\w.]+)/,"compatible",/(firefox)[ \/]([\w.]+)/,/(ipad)/,/(ipod)/,/(windows phone)/,/(iphone)/,/(kindle)/,/(android)/,/(windows)/,/(mac)/,/(linux)/,/(cros)/,"0","browser","split","majorVersion","minor","build","platform","chrome","opr","webkit","rv","iemobile","msie","edge","msedge","opera","android","log","LN10","kwai-ae","::","[","] > ","LEVEL_ERROR","e","LEVEL_WARN","w","LEVEL_INFO","LEVEL_DEBUG","v","ENABLE_ERROR","ENABLE_WARN","ENABLE_INFO","ENABLE_DEBUG","ENABLE_VERBOSE","info","debug","timeout",6048e5,"write","available","setItem","stringify","now","getItem","parse","time","_available","kwai-h5","test")}).call(this,i("6984")(e))},bf6a:function(e,t,i){"use strict";var n=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=51)}([function(e,t,i){var n,r,a,s,o,c,u,d,_,h,l,f,p,v,m,A;i.d(t,"b",(function(){return n})),i.d(t,"p",(function(){return r})),i.d(t,"o",(function(){return a})),i.d(t,"c",(function(){return s})),i.d(t,"i",(function(){return o})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return u})),i.d(t,"n",(function(){return d})),i.d(t,"m",(function(){return _})),i.d(t,"j",(function(){return h})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return f})),i.d(t,"l",(function(){return p})),i.d(t,"a",(function(){return v})),i.d(t,"k",(function(){return m})),i.d(t,"f",(function(){return A})),function(e){e.unknown="unknown",e.h264="h264",e.hevc="hevc",e.av1="av1",e.kvc3="kvc3",e.kvc4="kvc4",e.kvc5="kvc5",e.kvc6="kvc6",e.aac="aac",e.mp3="mp3",e.opus="opus",e.yuv="yuv",e.rawvideo="rawvideo",e.vvc="vvc",e.bvc2="bvc2",e.kvc30="kvc30"}(n||(n={})),function(e){e.kvc3="kvc3",e.kvc4="kvc4",e.kvc5="kvc5",e.kvc6="kvc6",e.h265="h265",e.kw265="kw265",e.kvc30="kvc30"}(r||(r={})),function(e){e.video="video",e.canvas="canvas"}(a||(a={})),function(e){e.buildin="buildin",e.wasm="wasm",e.none="none",e.unsupported="unsupported"}(s||(s={})),function(e){e.KWAI_FLV_ABR="kwaiFlvAbr",e.KWAI_FLV_MP="kwaiFlvMultipart",e.KWAI="kwai",e.FILE="file",e.OTHERS="others"}(o||(o={})),function(e){e.flv="flv",e.hls="hls",e.hls_ts="hls_ts",e.hls_fmp4="hls_fmp4",e.webrtc="webrtc",e.mp4="mp4",e.raw="raw",e.mp3="mp3",e.aac="aac",e.matroska="matroska",e.ts="ts",e.ivf="ivf",e.yuv="yuv",e.unknown="unknown"}(c||(c={})),function(e){e.LIVE="live_retry",e.RTC="rtc_retry",e.CODEC_AUDIO="codec_audio",e.CODEC_REMUX_TYPE="codec_remux_type",e.HLS_NATIVE="hls_native",e.MSE="mse",e.REMUX="remux",e.HEVC_DEC="hevc_dec",e.FALLBACK_H264="fallback_h264",e.BACKUP="backup"}(u||(u={})),function(e){e.AUTO="auto",e.ALL_NON_REF="allNonRef",e.MIN="min"}(d||(d={})),function(e){e.NONE="none",e.WAITING="waiting"}(_||(_={})),function(e){e.NEXT="next",e.PREV="prev"}(h||(h={})),function(e){e.STANDARD="standard",e.QUERY_START_END="queryStartEnd"}(l||(l={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(f||(f={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(p||(p={})),function(e){e.unknown="unknown",e.native="native",e.mse="mse",e.rtc="rtc"}(v||(v={})),function(e){e[e.Normal=0]="Normal",e[e.V360=1]="V360",e[e.V180=2]="V180"}(m||(m={})),function(e){e[e.normal=0]="normal",e[e.internal=1]="internal",e[e.retry=2]="retry"}(A||(A={}))},function(e,t,i){var n;!function(e){e.METADATA="metadata",e.MEDIA_INFO="mediaInfo",e.PARSING_INIT_SEGMENT="parsingInitSegment",e.PARSING_DATA="parsingData",e.PARSED_DATA="parsedData",e.SCRIPT_PARSED="scriptParsed",e.KEY_FRAME_INDEXS="keyFrameIndexs",e.VIDEO_FRAME_INFO="videoFrameInfo",e.DISCONTINUITY="discontinuity",e.REPORT="report",e.LOAD_END="loadEnd",e.ERROR="error",e.MANIFEST_PARSED="manifestParsed",e.LEVEL_SWITCHING="levelSwitching",e.LEVEL_SWITCHED="levelSwitched",e.LEVEL_SWITCH_PLAYING="levelSwitchPlaying",e.LEVEL_SWITCH_FAILED="levelSwitchFailed",e.LEVEL_LOADED="levelLoaded",e.LEVEL_UPDATED="levelUpdated",e.AUDIO_TRACK_SWITCHING="audioTrackSwitching",e.AUDIO_TRACK_SWITCHED="audioTrackSwitched",e.AUDIO_TRACK_UPDATED="audioTrackUpdated",e.HLS_MANIFEST_PARSED="hlsManifestParsed",e.HLS_KEY_LOADED="hlsKeyLoaded",e.AUDIO_TRACK_LOADED="audioLoaded",e.SUBTITLE_TRACK_LOADED="subtitleTrackLoaded",e.SUBTITLE_LOADED="subtitleLoaded",e.SUBTITLE_TRACK_SWITCHED="subtitleTrackSwitched",e.SUBTITLE_TRACK_UPDATED="subtitleTrackUpdated",e.BUFFER_CLEANING="bufferCleaning",e.VIDEO_SEEK="vdeoSeek",e.PRELOAD_COMPLETE="preloadComplete",e.ABR_NEXT="abrNext",e.PRIV_NAL="privNal",e.SEI="sei",e.RAW_DATA="rawData",e.MP4_NOT_FASTSTART="mp4NotFaststart",e.VIDEO_CODEC_DETECTED="videoCodecChange",e.H265_DETECTED="h265Detected",e.VIDEO_RENDERER_CHANGE="videoRendererChange",e.DEC_LIB_LOADED="decLibLoaded",e.DEC_INIT_COMPLETE="decoderInitComplete",e.DEC_VIDEO_READY="decVideoReady",e.STEP="step",e.RENDERER_BUF_EXPIRED="rendererBufExpired",e.RENDERER_SEEK="rendererSeek",e.RENDERER_BUF_UPDATE="rendererBufUpdate",e.RENDERER_DRAW="rendererDraw",e.DECODER_FRAME="decoderFrame",e.DECODER_IMG="decoderImg",e.DECODER_SEEK="decoderSeek",e.DECODER_SEEK_ABORT="decoderSeekAbort",e.DECODER_WAITING="decoderWaiting",e.DECODER_DATA_END="decoderDataEnd",e.DECODER_BUF_LOW="decoderDataEmpty",e.DECODER_DROP_FRAME="decocerDropFrame",e.MEDIA_CONNECTED="mediaConnected",e.LOADER_CHUNK_ARRIVAL="loaderChunkArrival",e.DEMUXER_DETECTED="demuxerDetected",e.MEDIA_DEMUX="mediaDemux",e.KEY_FRAME="keyFrame",e.USE_BACKUP="useBackup",e.NEW_SOURCE="newSource",e.DOWNLOAD="download",e.STOP_LOAD="stopLoad",e.LOAD="load",e.WAITING="wating",e.LOADEDDATA="loadeddata",e.CANPLAY="canplay",e.SEEKING="seeking",e.SEEK_WITH_LOAD="onSeekWithLoad",e.SEEKED="seeked",e.PLAYING="playing",e.PAUSE="pause",e.PLAY="play",e.ENDED="ended",e.TIMEUPDATE="timeupdate",e.PROGRESS="progress",e.RATE_CHANGE="ratechange",e.DURATION_CHANGE="durationchange",e.HEARTBEAT="heartbeat",e.MSE_UPDATE="mseUpdate",e.MSE_BUFFER_FULL="mseBufferFull",e.RETRY="retry",e.INIT_PTS_FOUND="initPtsFopund",e.FALLBACK_H264="fallbackH264"}(n||(n={})),t.a=n},function(e,t,i){var n;function r(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-k"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),function(e){e.LEVEL_ERROR="e",e.LEVEL_WARN="w",e.LEVEL_INFO="i",e.LEVEL_DEBUG="d",e.LEVEL_VERBOSE="v"}(n||(n={}));var a=function(){function e(){}return e.level=function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case n.LEVEL_ERROR:e.ENABLE_ERROR=!0;break;case n.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case n.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case n.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case n.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}},e.e=function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.error||console.warn||console.log).apply(console,s)}},e.w=function(t){if(e.ENABLE_WARN){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.warn||console.log).apply(console,s)}},e.i=function(t){if(e.ENABLE_INFO){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.info||console.log).apply(console,s)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);(console.debug||console.log).apply(console,s)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=r(t,n);console.log.apply(console,s)}},e}();a.ENABLE_ERROR=!0,a.ENABLE_WARN=!1,a.ENABLE_INFO=!1,a.ENABLE_DEBUG=!1,a.ENABLE_VERBOSE=!1},function(e,t,i){var n,r;i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return a})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e.MSE_ERROR="mseError",e.DECODER_ERROR="decoderError",e.RENDERER_ERROR="rendererError"}(n||(n={})),function(e){e[e.LOAD_ERROR=10]="LOAD_ERROR",e[e.MANIFEST_LOAD_ERROR=11]="MANIFEST_LOAD_ERROR",e[e.LEVEL_LOAD_ERROR=12]="LEVEL_LOAD_ERROR",e[e.AUDIO_TRACK_LOAD_ERROR=13]="AUDIO_TRACK_LOAD_ERROR",e[e.KEY_LOAD_ERROR=14]="KEY_LOAD_ERROR",e[e.KEY_SYSTEM_LICENSE_REQUEST_FAILED=15]="KEY_SYSTEM_LICENSE_REQUEST_FAILED",e[e.DEC_LIB_LOAD_ERROR=16]="DEC_LIB_LOAD_ERROR",e[e.RTC_SDP_LOAD_ERROR=17]="RTC_SDP_LOAD_ERROR",e[e.SUBTITLE_TRACK_LOAD_ERROR=18]="SUBTITLE_TRACK_LOAD_ERROR",e[e.CANNOT_SEEK=100]="CANNOT_SEEK",e[e.VIDEO_ERROR=101]="VIDEO_ERROR",e[e.UNSUPPORTED=102]="UNSUPPORTED",e[e.CONFIG_ERROR=103]="CONFIG_ERROR",e[e.OTHER=104]="OTHER",e[e.UNKNOWN=105]="UNKNOWN",e[e.CANNOT_SEEK_BY_FRAME_INDEX=106]="CANNOT_SEEK_BY_FRAME_INDEX",e[e.SRC_EMPTY=107]="SRC_EMPTY",e[e.VIDEO_ERROR_1=111]="VIDEO_ERROR_1",e[e.VIDEO_ERROR_2=112]="VIDEO_ERROR_2",e[e.VIDEO_ERROR_3=113]="VIDEO_ERROR_3",e[e.VIDEO_ERROR_4=114]="VIDEO_ERROR_4",e[e.MEDIASOURCE_ERROR=200]="MEDIASOURCE_ERROR",e[e.ADDSOURCEBUFFER_ERROR=201]="ADDSOURCEBUFFER_ERROR",e[e.SOURCEBUFFER_ERROR=202]="SOURCEBUFFER_ERROR",e[e.ENDOFSTREAM_ERROR=203]="ENDOFSTREAM_ERROR",e[e.APPENDBUFFER_ERROR=204]="APPENDBUFFER_ERROR",e[e.CHANGETYPE_ERROR=205]="CHANGETYPE_ERROR",e[e.PARSING_ERROR=301]="PARSING_ERROR",e[e.REMUX_ERROR=302]="REMUX_ERROR",e[e.REMUX_ALLOC_ERROR=303]="REMUX_ALLOC_ERROR",e[e.REMUX_WORKER_ERROR=304]="REMUX_WORKER_ERROR",e[e.DEMUX_NOT_FOUND=305]="DEMUX_NOT_FOUND",e[e.MANIFEST_PARSING_ERROR=400]="MANIFEST_PARSING_ERROR",e[e.KEY_SYSTEM_NO_ACCESS=500]="KEY_SYSTEM_NO_ACCESS",e[e.KEY_SYSTEM_NO_SESSION=501]="KEY_SYSTEM_NO_SESSION",e[e.KEY_SYSTEM_URL_ERROR=502]="KEY_SYSTEM_URL_ERROR",e[e.KEY_SYSTEM_NO_KEYS=505]="KEY_SYSTEM_NO_KEYS",e[e.FRAG_DECRYPT_ERROR=506]="FRAG_DECRYPT_ERROR",e[e.KEY_SYSTEM_NO_INIT_DATA=507]="KEY_SYSTEM_NO_INIT_DATA",e[e.KEY_SYSTEM_UNSUPPORTED=508]="KEY_SYSTEM_UNSUPPORTED",e[e.DECODER_LOAD_ERROR=600]="DECODER_LOAD_ERROR",e[e.DECODER_INIT_ERROR=601]="DECODER_INIT_ERROR",e[e.DECODER_DRAW_ERROR=602]="DECODER_DRAW_ERROR",e[e.DECODER_WEBGL_ERROR=603]="DECODER_WEBGL_ERROR",e[e.DECODER_UNSUPPORTED=604]="DECODER_UNSUPPORTED",e[e.PRELOAD_ERROR=700]="PRELOAD_ERROR",e[e.LIVE_DISCONNECTED_ERROR=1009]="LIVE_DISCONNECTED_ERROR",e[e.WEBRTC_DISCONNECTED_ERROR=1010]="WEBRTC_DISCONNECTED_ERROR",e[e.WEBRTC_FAILED_ERROR=1011]="WEBRTC_FAILED_ERROR",e[e.WEBRTC_CLOSED_ERROR=1012]="WEBRTC_CLOSED_ERROR",e[e.WEBRTC_ICE_CANDIDATE_ERROR=1013]="WEBRTC_ICE_CANDIDATE_ERROR",e[e.WEBRTC_ICE_CONNECTION_ERROR=1014]="WEBRTC_ICE_CONNECTION_ERROR",e[e.WEBRTC_OFFER_ERROR=1015]="WEBRTC_OFFER_ERROR",e[e.WEBRTC_ANSWER_ERROR=1016]="WEBRTC_ANSWER_ERROR",e[e.WEBRTC_TRANSMISSION_DATA_NULL=1017]="WEBRTC_TRANSMISSION_DATA_NULL",e[e.WEBRTC_CONNECT_TIMEOUT=1018]="WEBRTC_CONNECT_TIMEOUT",e[e.WEBRTC_CONNECT_FAILED=1019]="WEBRTC_CONNECT_FAILED"}(r||(r={}));var a=[r.VIDEO_ERROR,r.VIDEO_ERROR_1,r.VIDEO_ERROR_2,r.VIDEO_ERROR_3,r.VIDEO_ERROR_4]},function(e,t,i){function n(e,t,i){var n=i?t+i:e.byteLength-1;return String.fromCharCode.apply(null,e.subarray(t,n))}function r(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var n=0;return(n=i?(e[t+1]<<8)+e[t]:(e[t]<<8)+e[t+1])<0?65536+n:n}function a(e,t,i){void 0===i&&(i=0),t.byteLength-i<2||(t[i]=e>>8&255,t[i+1]=255&e)}function s(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var n=0;return(n=i?(e[t+2]<<16)+(e[t+1]<<8)+e[t]:(e[t]<<16)+(e[t+1]<<8)+e[t+2])<0?16777215+n:n}function o(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var n=0;return 8388608&(n=i?(e[t+2]<<16)+(e[t+1]<<8)+e[t]:(e[t]<<16)+(e[t+1]<<8)+e[t+2])&&(n=n-1-16777215),n}function c(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var n=0;return(n=i?e[t+3]*Math.pow(2,24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]:e[t]*Math.pow(2,24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3])<0?4294967296+n:n}function u(e,t,i){void 0===i&&(i=0),t.byteLength-i<4||(t[i]=e>>24&255,t[i+1]=e>>16&255,t[i+2]=e>>8&255,t[i+3]=255&e)}function d(e,t,i){void 0===i&&(i=!1);var n=0;return 2147483648&(n=i?e[t+3]*Math.pow(2,24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]:e[t]*Math.pow(2,24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3])&&(n=n-1-4294967295),n}function _(e,t,i){void 0===i&&(i=0),t.byteLength-i<4||(e<0&&(e+=4294967296),u(e,t,i))}function h(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=!1),i?e[t+7]*Math.pow(2,56)+e[t+6]*Math.pow(2,48)+e[t+5]*Math.pow(2,40)+e[t+4]*Math.pow(2,32)+e[t+3]*Math.pow(2,24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]:e[t]*Math.pow(2,56)+e[t+1]*Math.pow(2,48)+e[t+2]*Math.pow(2,40)+e[t+3]*Math.pow(2,32)+e[t+4]*Math.pow(2,24)+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7]}function l(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}i.d(t,"a",(function(){return n})),i.d(t,"e",(function(){return r})),i.d(t,"j",(function(){return a})),i.d(t,"f",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"g",(function(){return c})),i.d(t,"k",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"i",(function(){return _})),i.d(t,"h",(function(){return h})),i.d(t,"b",(function(){return l}))},function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){i.d(t,"d",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a})),i.d(t,"e",(function(){return s})),i.d(t,"a",(function(){return o})),i.d(t,"l",(function(){return c})),i.d(t,"f",(function(){return u})),i.d(t,"m",(function(){return d})),i.d(t,"j",(function(){return _})),i.d(t,"k",(function(){return h})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return f})),i.d(t,"i",(function(){return p}));var n=1048576,r=10485760,a=25,s=1e3,o=1e3,c=9e4,u=1e3,d=.1,_=240,h=1e3,l=1e3,f=1500,p=2},function(e,t,i){var n;i.d(t,"a",(function(){return n})),function(e){e[e.HEVC_NAL_TRAIL_N=0]="HEVC_NAL_TRAIL_N",e[e.HEVC_NAL_TRAIL_R=1]="HEVC_NAL_TRAIL_R",e[e.HEVC_NAL_TSA_N=2]="HEVC_NAL_TSA_N",e[e.HEVC_NAL_TSA_R=3]="HEVC_NAL_TSA_R",e[e.HEVC_NAL_STSA_N=4]="HEVC_NAL_STSA_N",e[e.HEVC_NAL_STSA_R=5]="HEVC_NAL_STSA_R",e[e.HEVC_NAL_RADL_N=6]="HEVC_NAL_RADL_N",e[e.HEVC_NAL_RADL_R=7]="HEVC_NAL_RADL_R",e[e.HEVC_NAL_RASL_N=8]="HEVC_NAL_RASL_N",e[e.HEVC_NAL_RASL_R=9]="HEVC_NAL_RASL_R",e[e.HEVC_NAL_VCL_N10=10]="HEVC_NAL_VCL_N10",e[e.HEVC_NAL_VCL_R11=11]="HEVC_NAL_VCL_R11",e[e.HEVC_NAL_VCL_N12=12]="HEVC_NAL_VCL_N12",e[e.HEVC_NAL_VCL_R13=13]="HEVC_NAL_VCL_R13",e[e.HEVC_NAL_VCL_N14=14]="HEVC_NAL_VCL_N14",e[e.HEVC_NAL_VCL_R15=15]="HEVC_NAL_VCL_R15",e[e.HEVC_NAL_BLA_W_LP=16]="HEVC_NAL_BLA_W_LP",e[e.HEVC_NAL_BLA_W_RADL=17]="HEVC_NAL_BLA_W_RADL",e[e.HEVC_NAL_BLA_N_LP=18]="HEVC_NAL_BLA_N_LP",e[e.HEVC_NAL_IDR_W_RADL=19]="HEVC_NAL_IDR_W_RADL",e[e.HEVC_NAL_IDR_N_LP=20]="HEVC_NAL_IDR_N_LP",e[e.HEVC_NAL_CRA_NUT=21]="HEVC_NAL_CRA_NUT",e[e.HEVC_NAL_RSV_IRAP_VCL22=22]="HEVC_NAL_RSV_IRAP_VCL22",e[e.HEVC_NAL_RSV_IRAP_VCL23=23]="HEVC_NAL_RSV_IRAP_VCL23",e[e.HEVC_NAL_RSV_VCL24=24]="HEVC_NAL_RSV_VCL24",e[e.HEVC_NAL_RSV_VCL25=25]="HEVC_NAL_RSV_VCL25",e[e.HEVC_NAL_RSV_VCL26=26]="HEVC_NAL_RSV_VCL26",e[e.HEVC_NAL_RSV_VCL27=27]="HEVC_NAL_RSV_VCL27",e[e.HEVC_NAL_RSV_VCL28=28]="HEVC_NAL_RSV_VCL28",e[e.HEVC_NAL_RSV_VCL29=29]="HEVC_NAL_RSV_VCL29",e[e.HEVC_NAL_RSV_VCL30=30]="HEVC_NAL_RSV_VCL30",e[e.HEVC_NAL_RSV_VCL31=31]="HEVC_NAL_RSV_VCL31",e[e.HEVC_NAL_VPS=32]="HEVC_NAL_VPS",e[e.HEVC_NAL_SPS=33]="HEVC_NAL_SPS",e[e.HEVC_NAL_PPS=34]="HEVC_NAL_PPS",e[e.HEVC_NAL_AUD=35]="HEVC_NAL_AUD",e[e.HEVC_NAL_EOS_NUT=36]="HEVC_NAL_EOS_NUT",e[e.HEVC_NAL_EOB_NUT=37]="HEVC_NAL_EOB_NUT",e[e.HEVC_NAL_FD_NUT=38]="HEVC_NAL_FD_NUT",e[e.HEVC_NAL_SEI_PREFIX=39]="HEVC_NAL_SEI_PREFIX",e[e.HEVC_NAL_SEI_SUFFIX=40]="HEVC_NAL_SEI_SUFFIX",e[e.HEVC_NAL_RSV_NVCL41=41]="HEVC_NAL_RSV_NVCL41",e[e.HEVC_NAL_RSV_NVCL42=42]="HEVC_NAL_RSV_NVCL42",e[e.HEVC_NAL_RSV_NVCL43=43]="HEVC_NAL_RSV_NVCL43",e[e.HEVC_NAL_RSV_NVCL44=44]="HEVC_NAL_RSV_NVCL44",e[e.HEVC_NAL_RSV_NVCL45=45]="HEVC_NAL_RSV_NVCL45",e[e.HEVC_NAL_RSV_NVCL46=46]="HEVC_NAL_RSV_NVCL46",e[e.HEVC_NAL_RSV_NVCL47=47]="HEVC_NAL_RSV_NVCL47",e[e.HEVC_NAL_UNSPEC48=48]="HEVC_NAL_UNSPEC48",e[e.HEVC_NAL_UNSPEC49=49]="HEVC_NAL_UNSPEC49",e[e.HEVC_NAL_UNSPEC50=50]="HEVC_NAL_UNSPEC50",e[e.HEVC_NAL_UNSPEC51=51]="HEVC_NAL_UNSPEC51",e[e.HEVC_NAL_UNSPEC52=52]="HEVC_NAL_UNSPEC52",e[e.HEVC_NAL_UNSPEC53=53]="HEVC_NAL_UNSPEC53",e[e.HEVC_NAL_UNSPEC54=54]="HEVC_NAL_UNSPEC54",e[e.HEVC_NAL_UNSPEC55=55]="HEVC_NAL_UNSPEC55",e[e.HEVC_NAL_UNSPEC56=56]="HEVC_NAL_UNSPEC56",e[e.HEVC_NAL_UNSPEC57=57]="HEVC_NAL_UNSPEC57",e[e.HEVC_NAL_UNSPEC58=58]="HEVC_NAL_UNSPEC58",e[e.HEVC_NAL_UNSPEC59=59]="HEVC_NAL_UNSPEC59",e[e.HEVC_NAL_UNSPEC60=60]="HEVC_NAL_UNSPEC60",e[e.HEVC_NAL_UNSPEC61=61]="HEVC_NAL_UNSPEC61",e[e.HEVC_NAL_UNSPEC62=62]="HEVC_NAL_UNSPEC62",e[e.PRIV_NAL_MAGIC_HEVC=63]="PRIV_NAL_MAGIC_HEVC",e[e.NAL_UNIT_INVALID=64]="NAL_UNIT_INVALID"}(n||(n={}))},function(e,t){function i(){return e.exports=i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){i.d(t,"a",(function(){return n}));var n=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};Number.MAX_SAFE_INTEGER},function(e,t,i){var n=i(8),r=i.n(n),a={};!function(e){if("undefined"!=typeof navigator){e=e?e.toLowerCase():navigator.userAgent.toLowerCase();var t=/(edge)\/([\w.]+)/.exec(e)||/(edg)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},s={x5:/ tbs\//.test(e),xweb:/ xweb\//.test(e)};if(n.browser){s[n.browser]=!0;var o=n.majorVersion.split(".");s.version={major:parseInt(n.majorVersion,10),string:n.version},o.length>1&&(s.version.minor=parseInt(o[1],10)),o.length>2&&(s.version.build=parseInt(o[2],10))}for(var c in n.platform&&(s[n.platform]=!0),(s.chrome||s.opr||s.safari)&&(s.webkit=!0),(s.rv||s.iemobile)&&(s.rv&&delete s.rv,n.browser="msie",s.msie=!0),(s.edg||s.edge)&&(delete s.edg,delete s.edge,n.browser="msedge",s.msedge=!0),s.opr&&(n.browser="opera",s.opera=!0),s.safari&&s.android&&(n.browser="android",s.android=!0),(s.android||s.iphone||s.ipad)&&(s.mobile=!0),s.ios=s.iphone||s.ipad,s.name=n.browser,s.platform=n.platform,a)a.hasOwnProperty(c)&&delete a[c];r()(a,s)}}(),t.a=a},function(e,t,i){var n,r,a,s;i.d(t,"d",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return s})),i(0),function(e){e[e.video=1]="video",e[e.audio=2]="audio"}(n||(n={})),function(e){e[e.ADTS=0]="ADTS",e[e.ASC=1]="ASC"}(r||(r={})),function(e){e.videoFrame="videoFrame",e.decoderConfig="decoderConfig"}(a||(a={})),function(e){e.UNKNOWN="unknown",e.FLV="flv",e.FMP4="fmp4",e.TS="ts",e.MP4="mp4",e.RAW="raw",e.IVF="ivf",e.YUV="yuv"}(s||(s={}))},function(e,t,i){var n=i(46);e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){var n;i.d(t,"a",(function(){return n})),function(e){e.INIT_265="init265",e.APPEND_DATA="appendData",e.MEDIA_INFO="mediaInfo",e.UPDATE_STATE="updateState",e.RESET="reset",e.DESTROY="destroy",e.STEP="step",e.SEEK="seek",e.END_OF_DATA="endOfData",e.DEC_DROP_FRAME="dropFrame",e.CLEAN="clean",e.EXPIRED_DATA_SYNC="expiredDataSync",e.INIT_RENDERER="initRenderer"}(n||(n={}))},function(e,t,i){var n=i(38),r=function(){function e(){this.__evt=new n.EventEmitter}var t=e.prototype;return t.on=function(e,t){this.__evt.on(e,t)},t.prependListener=function(e,t){this.__evt.prependListener(e,t)},t.removeAllListeners=function(e){this.__evt.removeAllListeners(e)},t.off=function(e,t){this.__evt.off(e,t)},t.listeners=function(e){return this.__evt.listeners(e)},t.emit=function(e,t){return this.__evt.emit(e,t)},t.listenerCount=function(e){return this.__evt.listenerCount(e)},e}();t.a=r},function(e,t,i){var n,r,a,s,o,c,u;i.d(t,"a",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"c",(function(){return u})),i.d(t,"b",(function(){return d})),i.d(t,"e",(function(){return p})),function(e){e[e.AVCOL_PRI_RESERVED0=0]="AVCOL_PRI_RESERVED0",e[e.AVCOL_PRI_BT709=1]="AVCOL_PRI_BT709",e[e.AVCOL_PRI_UNSPECIFIED=2]="AVCOL_PRI_UNSPECIFIED",e[e.AVCOL_PRI_RESERVED=3]="AVCOL_PRI_RESERVED",e[e.AVCOL_PRI_BT470M=4]="AVCOL_PRI_BT470M",e[e.AVCOL_PRI_BT470BG=5]="AVCOL_PRI_BT470BG",e[e.AVCOL_PRI_SMPTE170M=6]="AVCOL_PRI_SMPTE170M",e[e.AVCOL_PRI_SMPTE240M=7]="AVCOL_PRI_SMPTE240M",e[e.AVCOL_PRI_FILM=8]="AVCOL_PRI_FILM",e[e.AVCOL_PRI_BT2020=9]="AVCOL_PRI_BT2020",e[e.AVCOL_PRI_SMPTE428=10]="AVCOL_PRI_SMPTE428",e[e.AVCOL_PRI_SMPTEST428_1=10]="AVCOL_PRI_SMPTEST428_1",e[e.AVCOL_PRI_SMPTE431=11]="AVCOL_PRI_SMPTE431",e[e.AVCOL_PRI_SMPTE432=12]="AVCOL_PRI_SMPTE432",e[e.AVCOL_PRI_EBU3213=22]="AVCOL_PRI_EBU3213",e[e.AVCOL_PRI_JEDEC_P22=22]="AVCOL_PRI_JEDEC_P22",e[e.AVCOL_PRI_NB=23]="AVCOL_PRI_NB"}(o||(o={})),function(e){e[e.AVCOL_TRC_RESERVED0=0]="AVCOL_TRC_RESERVED0",e[e.AVCOL_TRC_BT709=1]="AVCOL_TRC_BT709",e[e.AVCOL_TRC_UNSPECIFIED=2]="AVCOL_TRC_UNSPECIFIED",e[e.AVCOL_TRC_RESERVED=3]="AVCOL_TRC_RESERVED",e[e.AVCOL_TRC_GAMMA22=4]="AVCOL_TRC_GAMMA22",e[e.AVCOL_TRC_GAMMA28=5]="AVCOL_TRC_GAMMA28",e[e.AVCOL_TRC_SMPTE170M=6]="AVCOL_TRC_SMPTE170M",e[e.AVCOL_TRC_SMPTE240M=7]="AVCOL_TRC_SMPTE240M",e[e.AVCOL_TRC_LINEAR=8]="AVCOL_TRC_LINEAR",e[e.AVCOL_TRC_LOG=9]="AVCOL_TRC_LOG",e[e.AVCOL_TRC_LOG_SQRT=10]="AVCOL_TRC_LOG_SQRT",e[e.AVCOL_TRC_IEC61966_2_4=11]="AVCOL_TRC_IEC61966_2_4",e[e.AVCOL_TRC_BT1361_ECG=12]="AVCOL_TRC_BT1361_ECG",e[e.AVCOL_TRC_IEC61966_2_1=13]="AVCOL_TRC_IEC61966_2_1",e[e.AVCOL_TRC_BT2020_10=14]="AVCOL_TRC_BT2020_10",e[e.AVCOL_TRC_BT2020_12=15]="AVCOL_TRC_BT2020_12",e[e.AVCOL_TRC_SMPTE2084=16]="AVCOL_TRC_SMPTE2084",e[e.AVCOL_TRC_SMPTEST2084=16]="AVCOL_TRC_SMPTEST2084",e[e.AVCOL_TRC_SMPTE428=17]="AVCOL_TRC_SMPTE428",e[e.AVCOL_TRC_SMPTEST428_1=17]="AVCOL_TRC_SMPTEST428_1",e[e.AVCOL_TRC_ARIB_STD_B67=18]="AVCOL_TRC_ARIB_STD_B67",e[e.AVCOL_TRC_NB=19]="AVCOL_TRC_NB"}(c||(c={})),function(e){e[e.AVCOL_SPC_RGB=0]="AVCOL_SPC_RGB",e[e.AVCOL_SPC_BT709=1]="AVCOL_SPC_BT709",e[e.AVCOL_SPC_UNSPECIFIED=2]="AVCOL_SPC_UNSPECIFIED",e[e.AVCOL_SPC_RESERVED=3]="AVCOL_SPC_RESERVED",e[e.AVCOL_SPC_FCC=4]="AVCOL_SPC_FCC",e[e.AVCOL_SPC_BT470BG=5]="AVCOL_SPC_BT470BG",e[e.AVCOL_SPC_SMPTE170M=6]="AVCOL_SPC_SMPTE170M",e[e.AVCOL_SPC_SMPTE240M=7]="AVCOL_SPC_SMPTE240M",e[e.AVCOL_SPC_YCGCO=8]="AVCOL_SPC_YCGCO",e[e.AVCOL_SPC_YCOCG=8]="AVCOL_SPC_YCOCG",e[e.AVCOL_SPC_BT2020_NCL=9]="AVCOL_SPC_BT2020_NCL",e[e.AVCOL_SPC_BT2020_CL=10]="AVCOL_SPC_BT2020_CL",e[e.AVCOL_SPC_SMPTE2085=11]="AVCOL_SPC_SMPTE2085",e[e.AVCOL_SPC_CHROMA_DERIVED_NCL=12]="AVCOL_SPC_CHROMA_DERIVED_NCL",e[e.AVCOL_SPC_CHROMA_DERIVED_CL=13]="AVCOL_SPC_CHROMA_DERIVED_CL",e[e.AVCOL_SPC_ICTCP=14]="AVCOL_SPC_ICTCP",e[e.AVCOL_SPC_NB=15]="AVCOL_SPC_NB"}(u||(u={}));var d,_=((n={})[o.AVCOL_PRI_RESERVED0]="reserved",n[o.AVCOL_PRI_BT709]="bt709",n[o.AVCOL_PRI_UNSPECIFIED]="unknown",n[o.AVCOL_PRI_RESERVED]="reserved",n[o.AVCOL_PRI_BT470M]="bt470m",n[o.AVCOL_PRI_BT470BG]="bt470bg",n[o.AVCOL_PRI_SMPTE170M]="smpte170m",n[o.AVCOL_PRI_SMPTE240M]="smpte240m",n[o.AVCOL_PRI_FILM]="film",n[o.AVCOL_PRI_BT2020]="bt2020",n[o.AVCOL_PRI_SMPTE428]="smpte428",n[o.AVCOL_PRI_SMPTE431]="smpte431",n[o.AVCOL_PRI_SMPTE432]="smpte432",n[o.AVCOL_PRI_EBU3213]="ebu3213",n),h=((r={})[c.AVCOL_TRC_RESERVED0]="reserved",r[c.AVCOL_TRC_BT709]="bt709",r[c.AVCOL_TRC_UNSPECIFIED]="unknown",r[c.AVCOL_TRC_RESERVED]="reserved",r[c.AVCOL_TRC_GAMMA22]="bt470m",r[c.AVCOL_TRC_GAMMA28]="bt470bg",r[c.AVCOL_TRC_SMPTE170M]="smpte170m",r[c.AVCOL_TRC_SMPTE240M]="smpte240m",r[c.AVCOL_TRC_LINEAR]="linear",r[c.AVCOL_TRC_LOG]="log100",r[c.AVCOL_TRC_LOG_SQRT]="log316",r[c.AVCOL_TRC_IEC61966_2_4]="iec61966-2-4",r[c.AVCOL_TRC_BT1361_ECG]="bt1361e",r[c.AVCOL_TRC_IEC61966_2_1]="iec61966-2-1",r[c.AVCOL_TRC_BT2020_10]="bt2020-10",r[c.AVCOL_TRC_BT2020_12]="bt2020-12",r[c.AVCOL_TRC_SMPTE2084]="smpte2084",r[c.AVCOL_TRC_SMPTE428]="smpte428",r[c.AVCOL_TRC_ARIB_STD_B67]="arib-std-b67",r),l=((a={})[u.AVCOL_SPC_RGB]="gbr",a[u.AVCOL_SPC_BT709]="bt709",a[u.AVCOL_SPC_UNSPECIFIED]="unknown",a[u.AVCOL_SPC_RESERVED]="reserved",a[u.AVCOL_SPC_FCC]="fcc",a[u.AVCOL_SPC_BT470BG]="bt470bg",a[u.AVCOL_SPC_SMPTE170M]="smpte170m",a[u.AVCOL_SPC_SMPTE240M]="smpte240m",a[u.AVCOL_SPC_YCGCO]="ycgco",a[u.AVCOL_SPC_BT2020_NCL]="bt2020nc",a[u.AVCOL_SPC_BT2020_CL]="bt2020c",a[u.AVCOL_SPC_SMPTE2085]="smpte2085",a[u.AVCOL_SPC_CHROMA_DERIVED_NCL]="chroma-derived-nc",a[u.AVCOL_SPC_CHROMA_DERIVED_CL]="chroma-derived-c",a[u.AVCOL_SPC_ICTCP]="ictcp",a);!function(e){e[e.AVCOL_RANGE_UNSPECIFIED=0]="AVCOL_RANGE_UNSPECIFIED",e[e.AVCOL_RANGE_MPEG=1]="AVCOL_RANGE_MPEG",e[e.AVCOL_RANGE_JPEG=2]="AVCOL_RANGE_JPEG"}(d||(d={}));var f=((s={})[d.AVCOL_RANGE_UNSPECIFIED]="unknown",s[d.AVCOL_RANGE_MPEG]="tv",s[d.AVCOL_RANGE_JPEG]="pc",s);function p(e){if(e&&"number"==typeof e.colorRange&&"number"==typeof e.matrixCoefficients&&"number"==typeof e.colourPrimaries&&"number"==typeof e.transferCharacteristics){var t=l[e.matrixCoefficients],i=_[e.colourPrimaries],n=h[e.transferCharacteristics];return t===i&&t===n?"("+(e.colorRange?f[e.colorRange]+" ":"")+t+")":"("+(e.colorRange?f[e.colorRange]+" ":"")+t+"/"+i+"/"+n+")"}return""}},function(e,t,i){var n;i.d(t,"f",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return c})),function(e){e[e.AUDIO=8]="AUDIO",e[e.VIDEO=9]="VIDEO",e[e.SCRIPT=18]="SCRIPT"}(n||(n={}));var r=13,a=11,s=4,o=5,c=function(){this.tagType=n.VIDEO,this.dataSize=0,this.timestamp=0,this.size=0,this.cts=0,this.frameType=0,this.codecId=0,this.body=void 0,this.packetType=void 0}},function(e,t,i){var n;i.d(t,"a",(function(){return n})),function(e){e[e.VVC_NAL_UNIT_CODED_SLICE_TRAIL=0]="VVC_NAL_UNIT_CODED_SLICE_TRAIL",e[e.VVC_NAL_UNIT_CODED_SLICE_STSA=1]="VVC_NAL_UNIT_CODED_SLICE_STSA",e[e.VVC_NAL_UNIT_CODED_SLICE_RADL=2]="VVC_NAL_UNIT_CODED_SLICE_RADL",e[e.VVC_NAL_UNIT_CODED_SLICE_RASL=3]="VVC_NAL_UNIT_CODED_SLICE_RASL",e[e.VVC_NAL_UNIT_RESERVED_VCL_4=4]="VVC_NAL_UNIT_RESERVED_VCL_4",e[e.VVC_NAL_UNIT_RESERVED_VCL_5=5]="VVC_NAL_UNIT_RESERVED_VCL_5",e[e.VVC_NAL_UNIT_RESERVED_VCL_6=6]="VVC_NAL_UNIT_RESERVED_VCL_6",e[e.VVC_NAL_UNIT_CODED_SLICE_IDR_W_RADL=7]="VVC_NAL_UNIT_CODED_SLICE_IDR_W_RADL",e[e.VVC_NAL_UNIT_CODED_SLICE_IDR_N_LP=8]="VVC_NAL_UNIT_CODED_SLICE_IDR_N_LP",e[e.VVC_NAL_UNIT_CODED_SLICE_CRA=9]="VVC_NAL_UNIT_CODED_SLICE_CRA",e[e.VVC_NAL_UNIT_CODED_SLICE_GDR=10]="VVC_NAL_UNIT_CODED_SLICE_GDR",e[e.VVC_NAL_UNIT_RESERVED_IRAP_VCL_11=11]="VVC_NAL_UNIT_RESERVED_IRAP_VCL_11",e[e.VVC_NAL_UNIT_OPI=12]="VVC_NAL_UNIT_OPI",e[e.VVC_NAL_UNIT_DCI=13]="VVC_NAL_UNIT_DCI",e[e.VVC_NAL_UNIT_VPS=14]="VVC_NAL_UNIT_VPS",e[e.VVC_NAL_UNIT_SPS=15]="VVC_NAL_UNIT_SPS",e[e.VVC_NAL_UNIT_PPS=16]="VVC_NAL_UNIT_PPS",e[e.VVC_NAL_UNIT_PREFIX_APS=17]="VVC_NAL_UNIT_PREFIX_APS",e[e.VVC_NAL_UNIT_SUFFIX_APS=18]="VVC_NAL_UNIT_SUFFIX_APS",e[e.VVC_NAL_UNIT_PH=19]="VVC_NAL_UNIT_PH",e[e.VVC_NAL_UNIT_ACCESS_UNIT_DELIMITER=20]="VVC_NAL_UNIT_ACCESS_UNIT_DELIMITER",e[e.VVC_NAL_UNIT_EOS=21]="VVC_NAL_UNIT_EOS",e[e.VVC_NAL_UNIT_EOB=22]="VVC_NAL_UNIT_EOB",e[e.VVC_NAL_UNIT_PREFIX_SEI=23]="VVC_NAL_UNIT_PREFIX_SEI",e[e.VVC_NAL_UNIT_SUFFIX_SEI=24]="VVC_NAL_UNIT_SUFFIX_SEI",e[e.VVC_NAL_UNIT_FD=25]="VVC_NAL_UNIT_FD",e[e.VVC_NAL_UNIT_RESERVED_NVCL_26=26]="VVC_NAL_UNIT_RESERVED_NVCL_26",e[e.VVC_NAL_UNIT_RESERVED_NVCL_27=27]="VVC_NAL_UNIT_RESERVED_NVCL_27",e[e.VVC_NAL_UNIT_UNSPECIFIED_28=28]="VVC_NAL_UNIT_UNSPECIFIED_28",e[e.VVC_NAL_UNIT_UNSPECIFIED_29=29]="VVC_NAL_UNIT_UNSPECIFIED_29",e[e.VVC_NAL_UNIT_UNSPECIFIED_30=30]="VVC_NAL_UNIT_UNSPECIFIED_30",e[e.VVC_NAL_UNIT_UNSPECIFIED_31=31]="VVC_NAL_UNIT_UNSPECIFIED_31",e[e.VVC_NAL_UNIT_INVALID=32]="VVC_NAL_UNIT_INVALID"}(n||(n={}))},function(e,t,i){i.d(t,"b",(function(){return u})),i.d(t,"f",(function(){return l})),i.d(t,"g",(function(){return f})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return v})),i.d(t,"c",(function(){return m})),i.d(t,"a",(function(){return A}));var n=i(3),r=i(1),a=i(11),s=i(2),o=i(4),c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];function u(e,t,i){void 0===i&&(i="mp4a.40.2"),i=i||"mp4a.40.2";var n=c.indexOf(e);if(!(n<0||"mp4a.40.5"!==i&&"mp4a.40.2"!==i))return"mp4a.40.5"===i&&(n+=3),new Uint8Array([((31&("mp4a.40.2"===i?2:5))<<3)+(n>>1&7),((1&n)<<7)+((15&t)<<3)])}function d(e,t){return 255===e[t]&&240==(246&e[t+1])}function _(e,t){return 1&e[t+1]?7:9}function h(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function l(e,t){return!!(t+1<e.length&&d(e,t))}function f(e,t){return e.asc!==Object(o.e)(t)}function p(e,t,i,s,c){if(void 0===c&&(c=""),f(e,i)||!e.samplerate||!e.configParsed){var u=s===a.a.ADTS?function(e){return{objectType:1+((192&e[0])>>>6),sampleingIndex:(60&e[0])>>>2,chanelConfig:(1&e[0])<<2|(192&e[1])>>>6}}(i):function(e){return{objectType:e[0]>>>3,sampleingIndex:(7&e[0])<<1|e[1]>>>7,chanelConfig:(120&e[1])>>>3}}(i);if(u.sampleingIndex<0||u.sampleingIndex>=13){var d={type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"invalid sampling index:"+u.sampleingIndex};return void t.emit(r.a.ERROR,d)}if(u.chanelConfig<0||u.chanelConfig>=8){var _={type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"invalid chanelConfig:"+u.chanelConfig};return void t.emit(r.a.ERROR,_)}v(e,u,c),e.asc=Object(o.e)(i),e.configParsed=!0}}function v(e,t,i){void 0===i&&(i="");var n=function(e,t){void 0===t&&(t="");var i,n,r=e.objectType,a=e.sampleingIndex,o=e.chanelConfig,u=navigator.userAgent.toLowerCase(),d=t||"mp4a.40."+r;return s.b.v("manifest codec:"+t+",data:type:"+r+",sampleingIndex:"+a+"["+c[a]+"Hz],channelConfig:"+o),/firefox/i.test(u)?a>=6?(r=5,n=new Array(4),i=a-3):(r=2,n=new Array(2),i=a):-1!==u.indexOf("android")?(r=2,n=new Array(2),i=a):(r=5,n=new Array(4),t&&(-1!==t.indexOf("mp4a.40.29")||-1!==t.indexOf("mp4a.40.5"))||!t&&a>=6?i=a-3:((t&&-1!==t.indexOf("mp4a.40.2")&&(a>=6&&1===o||/vivaldi/i.test(u))||!t&&1===o)&&(r=2,n=new Array(2)),i=a)),n[0]=r<<3,n[0]|=(14&a)>>1,n[1]|=(1&a)<<7,n[1]|=o<<3,5===r&&(n[1]|=(14&i)>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),{config:n,samplerate:c[a],extensionSamplerate:c[i],channelCount:o,codec:"mp4a.40."+r,manifestCodec:d}}(t,i);n&&(e.config=n.config,e.samplerate=n.samplerate,e.extensionSamplerate=n.extensionSamplerate,e.channelCount=n.channelCount,e.codec=n.codec,e.manifestCodec=n.manifestCodec,e.sampleDuration=m(e.samplerate,e.inputTimescale),s.b.v("parsed codec:"+e.codec+",rate:"+n.samplerate+",nb channel:"+n.channelCount))}function m(e,t){return 1024*t/e}function A(e,t,i,n,r){var a=function(e,t,i,n,r){var a,s=e.length,o=_(e,t);return a=h(e,t),(a-=o)>0&&t+o+a<=s?{headerLength:o,frameLength:a,stamp:i+n*r}:null}(t,i,n,r,m(e.samplerate,e.inputTimescale));if(a){var s=a.frameLength,o=a.headerLength,c=a.stamp,u=o+s,d=Math.max(0,i+u-t.length);d?new Uint8Array(u-o).set(t.subarray(i+o,t.length),0):t.subarray(i+o,i+u);var l={unit:t.subarray(i+o,i+o+s),pts:c,dts:c,originDTS:0};return d||e.samples.push(l),{sample:l,length:u,missing:d}}}},function(e,t,i){i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return c}));var n=i(6),r=i(0),a=i(11);function s(e,t,i){return void 0===i&&(i=n.e),{type:e,id:a.d[e],pid:-1,inputTimescale:i,timescale:i,codec:"",sequenceNumber:0,samples:[],mp4Samples:[],duration:t,sampleDuration:0,fillDuration:0}}function o(e,t){void 0===t&&(t=n.e);var i=s(r.l.VIDEO,e,t);return i.width=0,i.height=0,i.rotation=0,i.pixelRatio=[],i.profile="",i.level="",i.chromaFormat="",i.fps=0,i.codecType=r.b.unknown,i.dpb=16,i}function c(e,t){void 0===t&&(t=n.e);var i=s(r.l.AUDIO,e,t);return i.config=[],i.samplerate=0,i.channelCount=0,i.codecType=r.b.unknown,i}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){var n=i(5),r=i.n(n),a=function(){function e(){this._size=0,this._cache=[],this._index=0,this._offset=0}var t=e.prototype;return t.put=function(t){if(this.unreadLen+t.byteLength>=e.MAX_CACHE_SIZE)throw new Error("max cache size");this._cache.push(t),this._size+=t.byteLength},t.get=function(e){if(!(e>this.unreadLen)){var t,i=this._cache[this._index];if(0===this._offset&&e===i.byteLength)e===i.buffer.byteLength?t=i:(t=new Uint8Array(e)).set(i),this._index++,this._offset=0;else{t=new Uint8Array(e);for(var n=0,r=0,a=0;n<e;)a=this._offset,r=Math.min(i.byteLength,e-n+a),0===a&&r===i.byteLength?t.set(i,n):t.set(i.subarray(a,r),n),n+=r-a,r>=i.byteLength?(this._index++,i=this._cache[this._index],this._offset=0):this._offset=r}return this._collateCache(),t}},t.read=function(e){if(!(e>this.unreadLen)){for(var t=new Uint8Array(e),i=this._index,n=0,r=0,a=this._offset;n<e;){var s=this._cache[i];i>0&&(a=0),r=Math.min(s.byteLength,e-n+a),t.set(s.subarray(a,r),n),n+=r-a,i++}return t}},t.skip=function(e){var t=this._offset+e;if(!(t>this._size)){if(t===this._size)this.clear();else for(;t>0;){var i=this._cache[this._index].byteLength;t<i?(this._offset=t,t=0):t===i?(this._offset=0,t=0,this._index++):(this._offset=0,t-=i,this._index++)}this._collateCache()}},t.clear=function(){this._size=0,this._cache=[],this._index=0,this._offset=0},t._collateCache=function(){for(;this._index;){var e=this._cache.shift();e&&(this._size-=e.byteLength),this._index--}},r()(e,[{key:"unreadLen",get:function(){return this._size-this._offset}}]),e}();a.MAX_CACHE_SIZE=104857600,t.a=a},function(e,t,i){var n,r;i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),function(e){e[e.AV_PIX_FMT_MONO=0]="AV_PIX_FMT_MONO",e[e.AV_PIX_FMT_YUV420P=1]="AV_PIX_FMT_YUV420P",e[e.AV_PIX_FMT_YUV422P=2]="AV_PIX_FMT_YUV422P",e[e.AV_PIX_FMT_YUV444P=3]="AV_PIX_FMT_YUV444P"}(n||(n={})),function(e){e[e.normal=0]="normal",e[e.fill=1]="fill"}(r||(r={}))},function(e,t,i){var n=i(36),r=i(0),a=i(2),s=i(18),o={chanelConfig:2,objectType:2,sampleingIndex:7},c="audio-helper",u=function(){function e(){}return e.initAudioForFillSilent=function(e,t){void 0===t&&(t=""),e.codec||(s.e(e,o,t||(/firefox/.test(navigator.userAgent.toLowerCase())?"mp4a.40.2":"mp4a.40.5")),e.codecType=r.b.aac)},e.fillAACFrameByCount=function(t,i,r,a,o){void 0===a&&(a=0),void 0===o&&(o=""),e.initAudioForFillSilent(t,o);var c=n.a.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(c&&r>0){for(var u=s.c(t.samplerate,t.inputTimescale),d=i*t.inputTimescale||0,_=0;_<r;_++)t.samples.push({unit:c,pts:d,dts:d,duration:u,originDTS:a*t.inputTimescale+u*_}),d+=u;return t.fillDuration+=u*r,d/t.inputTimescale}return i},e.ensureAudioFrame=function(t,i,n,r){if(void 0===n&&(n=""),i.samples.length){if(0===t.samples.length){var s=i.samples[0].dts/i.inputTimescale;a.b.i(c,"fill audio before remux frame @"+s+". audio sample num:"+t.samples.length+" video sample num:"+i.samples.length),e.fillAACFrameByCount(t,s,1,i.samples[0].originDTS/i.inputTimescale,n)}var o=i.samples[i.samples.length-1],u=o.dts/i.inputTimescale-(t.samples.length?t.samples[t.samples.length-1].dts/t.inputTimescale:i.samples[0].dts/i.inputTimescale);r&&u>1&&(a.b.i(c,"fill audio @end:"+o.dts/i.inputTimescale+". diff:"+u),e.fillAACFrameByCount(t,o.dts/i.inputTimescale,1,o.originDTS/i.inputTimescale,n))}},e.alignStartByVideo=function(e,t){if(t.samples.length&&e.active&&e.samples.length){var i=s.c(e.samplerate,e.inputTimescale),r=t.samples[0],o=e.samples[0],u=r.pts/t.inputTimescale*e.inputTimescale;if(o.pts-u<i)return;var d=n.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);d&&(a.b.i(c,"align start by video. fill audio "+r.pts/t.inputTimescale+". gap:"+(r.pts/t.inputTimescale-o.pts/e.inputTimescale)),e.samples.unshift({unit:d,pts:u,dts:u,duration:i,originDTS:r.originDTS/t.inputTimescale*e.inputTimescale}))}},e}();t.a=u},function(e,t,i){i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return c}));var n,r=i(8),a=i.n(r),s={preferLowPowerToHighPerformance:!0,preserveDrawingBuffer:!0};function o(e){return e.getContext("webgl",s)||e.getContext("experimental-webgl",s)}function c(){if(!n){var e="undefined"==typeof HTMLCanvasElement?new OffscreenCanvas(1,1):document.createElement("canvas");u(e,n={webGL:!1,performance:!1},!0)||u(e,n,!1)}return n}function u(e,t,i){void 0===i&&(i=!1);var n=!1,r=a()({failIfMajorPerformanceCaveat:i},s);try{var o=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);if(o){var c=o.getExtension("WEBGL_debug_renderer_info");t.webGL=!0,t.performance=i,null!=c&&c.UNMASKED_VENDOR_WEBGL&&(t.vendor=o.getParameter(null==c?void 0:c.UNMASKED_VENDOR_WEBGL)),null!=c&&c.UNMASKED_RENDERER_WEBGL&&(t.renderer=o.getParameter(null==c?void 0:c.UNMASKED_RENDERER_WEBGL)),n=!0;var u=o.getExtension("WEBGL_lose_context");u&&u.loseContext()}}catch(e){}return n}},function(e,t,i){var n=i(48),r=i(49),a=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,s=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,c=/:\d+$/,u=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,d=/^[a-zA-Z]:/;function _(e){return(e||"").toString().replace(a,"")}var h=[["#","hash"],["?","query"],function(e,t){return p(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],l={hash:1,query:1};function f(e){var t,i=("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}).location||{},n={},r=typeof(e=e||i);if("blob:"===e.protocol)n=new m(unescape(e.pathname),{});else if("string"===r)for(t in n=new m(e,{}),l)delete n[t];else if("object"===r){for(t in e)t in l||(n[t]=e[t]);void 0===n.slashes&&(n.slashes=o.test(e.href))}return n}function p(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function v(e,t){e=(e=_(e)).replace(s,""),t=t||{};var i,n=u.exec(e),r=n[1]?n[1].toLowerCase():"",a=!!n[2],o=!!n[3],c=0;return a?o?(i=n[2]+n[3]+n[4],c=n[2].length+n[3].length):(i=n[2]+n[4],c=n[2].length):o?(i=n[3]+n[4],c=n[3].length):i=n[4],"file:"===r?c>=2&&(i=i.slice(2)):p(r)?i=n[4]:r?a&&(i=i.slice(2)):c>=2&&p(t.protocol)&&(i=n[4]),{protocol:r,slashes:a||p(r),slashesCount:c,rest:i}}function m(e,t,i){if(e=(e=_(e)).replace(s,""),!(this instanceof m))return new m(e,t,i);var a,o,c,u,l,A,g=h.slice(),y=typeof t,E=this,b=0;for("object"!==y&&"string"!==y&&(i=t,t=null),i&&"function"!=typeof i&&(i=r.parse),a=!(o=v(e||"",t=f(t))).protocol&&!o.slashes,E.slashes=o.slashes||a&&t.slashes,E.protocol=o.protocol||t.protocol||"",e=o.rest,("file:"===o.protocol&&(2!==o.slashesCount||d.test(e))||!o.slashes&&(o.protocol||o.slashesCount<2||!p(E.protocol)))&&(g[3]=[/(.*)/,"pathname"]);b<g.length;b++)"function"!=typeof(u=g[b])?(c=u[0],A=u[1],c!=c?E[A]=e:"string"==typeof c?~(l="@"===c?e.lastIndexOf(c):e.indexOf(c))&&("number"==typeof u[2]?(E[A]=e.slice(0,l),e=e.slice(l+u[2])):(E[A]=e.slice(l),e=e.slice(0,l))):(l=c.exec(e))&&(E[A]=l[1],e=e.slice(0,l.index)),E[A]=E[A]||a&&u[3]&&t[A]||"",u[4]&&(E[A]=E[A].toLowerCase())):e=u(e,E);i&&(E.query=i(E.query)),a&&t.slashes&&"/"!==E.pathname.charAt(0)&&(""!==E.pathname||""!==t.pathname)&&(E.pathname=function(e,t){if(""===e)return t;for(var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=i.length,r=i[n-1],a=!1,s=0;n--;)"."===i[n]?i.splice(n,1):".."===i[n]?(i.splice(n,1),s++):s&&(0===n&&(a=!0),i.splice(n,1),s--);return a&&i.unshift(""),"."!==r&&".."!==r||i.push(""),i.join("/")}(E.pathname,t.pathname)),"/"!==E.pathname.charAt(0)&&p(E.protocol)&&(E.pathname="/"+E.pathname),n(E.port,E.protocol)||(E.host=E.hostname,E.port=""),E.username=E.password="",E.auth&&(~(l=E.auth.indexOf(":"))?(E.username=E.auth.slice(0,l),E.username=encodeURIComponent(decodeURIComponent(E.username)),E.password=E.auth.slice(l+1),E.password=encodeURIComponent(decodeURIComponent(E.password))):E.username=encodeURIComponent(decodeURIComponent(E.auth)),E.auth=E.password?E.username+":"+E.password:E.username),E.origin="file:"!==E.protocol&&p(E.protocol)&&E.host?E.protocol+"//"+E.host:"null",E.href=E.toString()}m.prototype={set:function(e,t,i){var a=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(i||r.parse)(t)),a[e]=t;break;case"port":a[e]=t,n(t,a.protocol)?t&&(a.host=a.hostname+":"+t):(a.host=a.hostname,a[e]="");break;case"hostname":a[e]=t,a.port&&(t+=":"+a.port),a.host=t;break;case"host":a[e]=t,c.test(t)?(t=t.split(":"),a.port=t.pop(),a.hostname=t.join(":")):(a.hostname=t,a.port="");break;case"protocol":a.protocol=t.toLowerCase(),a.slashes=!i;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";a[e]=t.charAt(0)!==s?s+t:t}else a[e]=t;break;case"username":case"password":a[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(a.username=t.slice(0,o),a.username=encodeURIComponent(decodeURIComponent(a.username)),a.password=t.slice(o+1),a.password=encodeURIComponent(decodeURIComponent(a.password))):a.username=encodeURIComponent(decodeURIComponent(t))}for(var u=0;u<h.length;u++){var d=h[u];d[4]&&(a[d[1]]=a[d[1]].toLowerCase())}return a.auth=a.password?a.username+":"+a.password:a.username,a.origin="file:"!==a.protocol&&p(a.protocol)&&a.host?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=r.stringify);var t,i=this,n=i.host,a=i.protocol;a&&":"!==a.charAt(a.length-1)&&(a+=":");var s=a+(i.protocol&&i.slashes||p(i.protocol)?"//":"");return i.username?(s+=i.username,i.password&&(s+=":"+i.password),s+="@"):i.password?(s+=":"+i.password,s+="@"):"file:"!==i.protocol&&p(i.protocol)&&!n&&"/"!==i.pathname&&(s+="@"),(":"===n[n.length-1]||c.test(i.hostname)&&!i.port)&&(n+=":"),s+=n+i.pathname,(t="object"==typeof i.query?e(i.query):i.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),i.hash&&(s+=i.hash),s}},m.extractProtocol=v,m.location=f,m.trimLeft=_,m.qs=r,e.exports=m},function(e,t,i){i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return o}));var n=i(6);function r(e,t,i,n){void 0===i&&(i=1),void 0===n&&(n=!1);var r=e*t*i;return n?Math.round(r):r}function a(e,t,i){return void 0===i&&(i=!1),r(e,t,.001,i)}function s(e,t,i){return void 0===i&&(i=!1),r(e,1e3,1/t,i)}function o(e,t){return void 0===t&&(t=1),r(e,n.l,1/t)}},function(e,t,i){var n;i.d(t,"a",(function(){return n})),function(e){e.INIT="init",e.FLUSH="flush",e.LOAD_END="loadEnd",e.DESTROY="destroy",e.PUSH="push",e.UPDATE_CONFIG="updateConfig"}(n||(n={}))},function(e,t,i){var n,r,a,s,o;n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var n=o.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var c=r.exec(s.path);s.netLoc=c[1],s.path=c[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var d=s.path,_=d.substring(0,d.lastIndexOf("/")+1)+a.path;u.path=o.normalizePath(_)}else u.path=s.path,a.params||(u.params=s.params,a.query||(u.query=s.query));return null===u.path&&(u.path=i.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},function(e,t,i){i.d(t,"a",(function(){return K}));var n=i(8),r=i.n(n),a=i(5),s=i.n(a),o=i(3),c=i(1),u=i(23),d=i(0),_=i(11),h=i(10),l=i(2),f=i(26),p=i(36),v=i(19),m=Object(v.b)(0);m.bitDepth=8,m.chromaFormat="4:2:0",m.codec="avc1.64000a",m.colorInfo={colorRange:1,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},m.fps=15,m.height=48,m.id=1,m.level="1.0",m.pixelRatio=[1,1],m.profile="High",m.width=64,m.decConf=new Uint8Array([1,100,0,10,255,225,0,24,103,100,0,10,172,114,4,68,122,16,0,0,3,0,16,0,0,3,3,32,241,34,88,70,1,0,6,104,232,67,143,44,139]);var A=[{type:5,data:new Uint8Array([101,136,129,0,5,127,254,246,115,124,10,107,109,176,149,46,5,118,246,150,55,45,60,239,89,160,124,49,129])}],g=function(){function e(){}return e.getFillTrackBySamples=function(e,t){if(t.length){e.bitDepth=m.bitDepth,e.chromaFormat=m.chromaFormat,e.codec=m.codec,e.colorInfo=m.colorInfo,e.fps=e.fps||m.fps,e.id=m.id,e.level=m.level,e.pixelRatio=m.pixelRatio,e.profile=m.profile,e.width=m.width,e.height=m.height,e.duration=1/0,e.decConf=m.decConf,e.outputRaw=!1;for(var i=e.sampleDuration=e.inputTimescale/e.fps||Object(f.c)(1,e.inputTimescale),n=t[0].dts,r=t[0].originDTS,a=0;n<=t[t.length-1].dts;)e.samples.push({cts:0,dts:n,key:!0,pts:n,originDTS:r,units:A}),n+=i,r+=i,a++;return e.fillDuration+=i*a,e}},e}(),y=i(4),E=Math.pow(2,32)-1,b={video:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])},T=new Uint8Array([0,0,0,24,102,116,121,112,105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),S=new Uint8Array([0,0,0,16,115,116,116,115,0,0,0,0,0,0,0,0]),x=new Uint8Array([0,0,0,16,115,116,115,99,0,0,0,0,0,0,0,0]),C=new Uint8Array([0,0,0,16,115,116,99,111,0,0,0,0,0,0,0,0]),L=new Uint8Array([0,0,0,20,115,116,115,122,0,0,0,0,0,0,0,0,0,0,0,0]),R=new Uint8Array([0,0,0,36,100,105,110,102,0,0,0,28,100,114,101,102,0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),D=new Uint8Array([0,0,0,20,118,109,104,100,0,0,0,1,0,0,0,0,0,0,0,0]),w=new Uint8Array([0,0,0,16,115,109,104,100,0,0,0,0,0,0,0,0]),I=new Uint8Array([0,0,0,120,109,118,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),O=new Uint8Array([0,0,0,104,116,107,104,100,1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]),P=new Uint8Array([0,0,0,32,116,114,101,120,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]),k=new Uint8Array([0,0,0,44,109,100,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,172,68,0,0,0,0,0,0,0,0,85,196,0,0]),N=new Uint8Array([0,0,0,93,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,77,109,112,52,97,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,172,68,0,0,0,0,0,41,101,115,100,115,0,0,0,0,3,27,0,1,0,4,19,64,21,0,0,0,0,0,0,0,0,0,0,0,5]),M=new Uint8Array([0,0,0,52,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,36,46,109,112,51,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,0,0,0,0]),B=new Uint8Array([0,0,0,71,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,55,79,112,117,115,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,0,0,0,0,0,0,0,19,100,79,112,115,0,2,0,0,0,0,0,0,0,0,0]),V=new Uint8Array([0,0,0,0,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,0,97,118,48,49,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,2,208,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,107,119,97,105,45,118,105,100,101,111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),F=new Uint8Array([255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64]),U=new Uint8Array([0,0,0,0,0,1,0,0,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64]),H=new Uint8Array([0,0,0,0,255,255,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64]),j=function(){function e(){}return e.moov=function(t,i){for(var n=T,r=t.length,a=e.types.avc1;r--;)t[r].type===d.l.VIDEO&&(0===t[r].codec.indexOf("hev1")?a=e.types.hev1:0===t[r].codec.indexOf("av01")&&(a=e.types.av01));var s=n.byteLength+e._getMoovLen(t,i),o={data:new Uint8Array(s),offset:0};return o.data.set(n,0),o.data.set(a,16),o.offset+=n.byteLength,e._writeMoov(o,t,i),o.data},e.videoMediaSegment=function(t,i,n,r){var a=0===n.codec.indexOf("av01")?0:4,s=8+n.mp4Samples.reduce((function(e,t){return e+t.units.reduce((function(e,t){return e+t.data.byteLength+a}),0)}),0),o=e._getMediaSegmentData(n,s,r);return e._mediaSegmentHead(o,t,i,n,s,r),n.samples.forEach((function(e){e.units.forEach((function(e){var t=e.data.byteLength;a?(Object(y.k)(t,o.data,o.offset),o.data.set(e.data,o.offset+a),o.offset+=a+t):(o.data.set(e.data,o.offset),o.offset+=t)}))})),o.data},e.audioMediaSegment=function(t,i,n,r){var a=8+n.mp4Samples.reduce((function(e,t){return e+t.unit.byteLength}),0),s=e._getMediaSegmentData(n,a,r);return e._mediaSegmentHead(s,t,i,n,a,r),n.mp4Samples.forEach((function(e){s.data.set(e.unit,s.offset),s.offset+=e.unit.byteLength})),s.data},e.audioRawMpeg=function(t){var i=8+t.mp4Samples.reduce((function(e,t){return e+t.unit.byteLength}),0),n={data:new Uint8Array(i),offset:0};return e._writeBoxHead(n,e.types.mdat,i),t.mp4Samples.forEach((function(e){n.data.set(e.unit,n.offset),n.offset+=e.unit.byteLength})),n.data},e._getMoovLen=function(t,i){var n=t.reduce((function(t,i){return t+e._getTrakLen(i)}),0),r=i?i.reduce((function(e,t){return e+t.byteLength+8}),0):0;return 8+I.byteLength+n+e._getMvexLen(t)+r},e._writeMoov=function(t,i,n){var r=this,a=e._getMoovLen(i,n);e._writeBoxHead(t,e.types.moov,a),e._writeMvhd(t,i[0].timescale,i[0].duration),i.forEach((function(i){e._writeTrak(t,i)})),e._writeMvex(t,i),n&&n.forEach((function(e){r._writePssh(t,e)}))},e._writePssh=function(t,i){this._writeBoxHead(t,e.types.pssh,i.byteLength+8),t.data.set(i,t.offset),t.offset+=i.byteLength},e._getMoofLen=function(e){return 104+17*e.mp4Samples.length+this._getEncLen(e)},e._writeEnc=function(t,i,n){if(this._getEncLen(i)){var r=this._getSaizLen(i);this._writeBoxHead(t,e.types.saiz,r),t.offset+=5;var a=i.samples.length;Object(y.k)(a,t.data,t.offset),t.offset+=4,i.samples.forEach((function(e){e.auxiliaryInfo&&(t.data[t.offset]=e.auxiliaryInfo.enc.byteLength),t.offset++}));var s=this._getSaioLen();this._writeBoxHead(t,e.types.saio,s),t.offset+=4,t.data[t.offset+3]=1,t.offset+=4;var o=t.offset-n+4+16;Object(y.k)(o,t.data,t.offset),t.offset+=4;var c=this._getSencLen(i);this._writeBoxHead(t,e.types.senc,c),i.useSubSampleEnc&&(t.data[t.offset+3]=2),t.offset+=4,Object(y.k)(a,t.data,t.offset),t.offset+=4,i.samples.forEach((function(e){e.auxiliaryInfo&&(t.data.set(e.auxiliaryInfo.enc,t.offset),t.offset+=e.auxiliaryInfo.enc.byteLength)}))}},e._getEncLen=function(e){var t=this._getSencLen(e);return t?t+this._getSaizLen(e)+this._getSaioLen():0},e._getSaizLen=function(e){return 17+e.samples.length},e._getSencLen=function(e){var t=e.samples.reduce((function(e,t){return e+(t.auxiliaryInfo?t.auxiliaryInfo.enc.byteLength:0)}),0);return t?16+t:0},e._getSaioLen=function(){return 20},e._mediaSegmentHead=function(t,i,n,r,a,s){s&&(t.data.set(s),t.offset=s.byteLength),e._writeMoof(t,i,n,r),e._writeBoxHead(t,e.types.mdat,a)},e._getMediaSegmentData=function(t,i,n){var r=e._getMoofLen(t);return{data:new Uint8Array(r+i+(n?n.byteLength:0)),offset:0}},e._writeMvhd=function(e,t,i){var n=Math.floor(i/(E+1)),r=Math.floor(i%(E+1)),a=I;Object(y.k)(t,a,28),Object(y.k)(n,a,32),Object(y.k)(r,a,36),e.data.set(a,e.offset),e.offset+=I.byteLength},e._writeTkhd=function(e,t){var i=t.id,n=Math.floor(t.duration/(E+1)),r=Math.floor(t.duration%(E+1)),a=0,s=0;t.hasOwnProperty("width")&&(a=t.width),t.hasOwnProperty("height")&&(s=t.height);var o=O;Object(y.k)(i,o,28),Object(y.k)(n,o,36),Object(y.k)(r,o,40),90===t.rotation?U.forEach((function(e,t){return o[60+t]=e})):180===t.rotation?F.forEach((function(e,t){return o[60+t]=e})):270===t.rotation&&H.forEach((function(e,t){return o[60+t]=e})),Object(y.j)(a,o,96),Object(y.j)(s,o,100),e.data.set(o,e.offset),e.offset+=O.byteLength},e._getTrakLen=function(t){return 8+O.byteLength+e._getMdiaLen(t)},e._writeTrak=function(t,i){var n=e._getTrakLen(i);this._writeBoxHead(t,e.types.trak,n),this._writeTkhd(t,i),this._writeMdia(t,i)},e._getMdiaLen=function(t){return 8+k.byteLength+b[t.type].byteLength+e._getMinfLen(t)},e._writeMdia=function(t,i){var n=e._getMdiaLen(i);this._writeBoxHead(t,e.types.mdia,n),this._writeMdhd(t,i.timescale,i.duration),t.data.set(b[i.type],t.offset),t.offset+=b[i.type].byteLength,this._writeMinf(t,i)},e._writeMdhd=function(e,t,i){var n=Math.floor(i/(E+1)),r=Math.floor(i%(E+1)),a=k;Object(y.k)(t,a,28),Object(y.k)(n,a,32),Object(y.k)(r,a,36),e.data.set(a,e.offset),e.offset+=a.byteLength},e._getMinfLen=function(t){return t.type===d.l.AUDIO?8+w.byteLength+R.byteLength+e._getStblLen(t):8+D.byteLength+R.byteLength+e._getStblLen(t)},e._writeMinf=function(t,i){if(this._writeBoxHead(t,e.types.minf,e._getMinfLen(i)),i.type===d.l.AUDIO)return t.data.set(w,t.offset),t.offset+=w.byteLength,t.data.set(R,t.offset),t.offset+=R.byteLength,void this._writeStbl(t,i);t.data.set(D,t.offset),t.offset+=D.byteLength,t.data.set(R,t.offset),t.offset+=R.byteLength,this._writeStbl(t,i)},e._getStblLen=function(e){return 8+this._getStsdLen(e)+S.byteLength+x.byteLength+L.byteLength+C.byteLength},e._writeStbl=function(t,i){var n=this._getStblLen(i);this._writeBoxHead(t,e.types.stbl,n),this._writeStsd(t,i),t.data.set(S,t.offset),t.offset+=S.byteLength,t.data.set(x,t.offset),t.offset+=x.byteLength,t.data.set(L,t.offset),t.offset+=L.byteLength,t.data.set(C,t.offset),t.offset+=C.byteLength},e._getStsdLen=function(t){return t.stsd?t.stsd.byteLength+8:t.type===d.l.AUDIO?e._getAudioStsdLen(t):e._getVideoStsdLen(t)},e._writeStsd=function(t,i){if(i.stsd)return this._writeBoxHead(t,e.types.stsd,i.stsd.byteLength+8),t.data.set(i.stsd,t.offset),void(t.offset+=i.stsd.byteLength);i.type!==d.l.AUDIO?e._writeVideoStsd(t,i):this._writeAudioStsd(t,i)},e._getDecConfLen=function(e){return e.decConf?8+e.decConf.byteLength:0},e._getVideoStsdLen=function(t){return V.byteLength+e._getDecConfLen(t)},e._writeVideoStsd=function(t,i){var n=this._getDecConfLen(i),r=this._getVideoStsdLen(i),a=V,s=r-16,o=e.types.avc1,c=e.types.avcC;0===i.codec.indexOf("hev1")?(o=e.types.hev1,c=e.types.hvcC):0===i.codec.indexOf("av01")&&(o=e.types.av01,c=e.types.av1C);var u=i.width,d=i.height;Object(y.k)(r,a,0),this._writeBoxHeadAt(a,o,s,16),Object(y.j)(u,a,48),Object(y.j)(d,a,50),t.data.set(a,t.offset),t.offset+=a.byteLength,this._writeBoxHead(t,c,n),i.decConf&&(t.data.set(i.decConf,t.offset),t.offset+=i.decConf.byteLength)},e._getMp4aEsdsLen=function(e){return 33+e.config.length+4},e._getMp4aStsdLen=function(t){return 52+e._getMp4aEsdsLen(t)},e._writeMp4aStsd=function(t,i){var n=i.config.length,r=e._getMp4aEsdsLen(i),a=e._getMp4aStsdLen(i),s=a-16,o=N;Object(y.k)(a,o,0),Object(y.k)(s,o,16),o[41]=i.channelCount,Object(y.j)(i.samplerate,o,48),Object(y.k)(r,o,52),o[65]=23+n,o[70]=15+n,t.data.set(o,t.offset),t.offset+=o.byteLength;var c=[n].concat(i.config).concat([6,1,2]);t.data.set(c,t.offset),t.offset+=c.length},e._writeOpusStsd=function(e,t){var i=B;i[41]=i[61]=t.channelCount,Object(y.j)(t.samplerate,i,48),Object(y.j)(t.samplerate,i,66),e.data.set(i,e.offset),e.offset+=i.byteLength},e._writeMp3Stsd=function(e,t){var i=M;i[41]=t.channelCount,Object(y.j)(t.samplerate,i,48),e.data.set(i,e.offset),e.offset+=i.byteLength},e._getAudioStsdLen=function(t){return"mp3"===t.codec?M.length:"opus"===t.codec?B.length:e._getMp4aStsdLen(t)},e._writeAudioStsd=function(t,i){"mp3"===i.codec?e._writeMp3Stsd(t,i):"opus"===i.codec?e._writeOpusStsd(t,i):e._writeMp4aStsd(t,i)},e._getMvexLen=function(e){return 8+e.length*P.byteLength},e._writeMvex=function(t,i){var n=e._getMvexLen(i);this._writeBoxHead(t,e.types.mvex,n),i.forEach((function(i){e._writeTrex(t,i)}))},e._writeTrex=function(e,t){var i=t.id,n=P;Object(y.k)(i,n,12),e.data.set(n,e.offset),e.offset+=n.byteLength},e._writeMoof=function(t,i,n,r){var a=r.mp4Samples.length,s=t.offset,o=e._getMoofLen(r),c=o-24,u=12+a,d=20+16*a,_=o+8,h=r.id,l=r.mp4Samples||[],f=Math.floor(n/(E+1)),p=Math.floor(n%(E+1));e._writeBoxHead(t,e.types.moof,o),e._writeBoxHead(t,e.types.mfhd,16),Object(y.k)(i,t.data,t.offset+4),t.offset+=8,e._writeBoxHead(t,e.types.traf,c),e._writeBoxHead(t,e.types.tfhd,20),t.data[t.offset+1]=2,t.data[t.offset+3]=2,Object(y.k)(h,t.data,t.offset+4),t.data[t.offset+11]=r.sampleDescIndex||1,t.offset+=12,e._writeBoxHead(t,e.types.tfdt,20),t.data[t.offset]=1,Object(y.k)(f,t.data,t.offset+4),Object(y.k)(p,t.data,t.offset+8),t.offset+=12,e._writeBoxHead(t,e.types.sdtp,u),t.offset+=4,l.forEach((function(e,i){var n=e.flags;t.data[t.offset+i]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy})),t.offset+=a,e._writeBoxHead(t,e.types.trun,d),t.data[t.offset]=1,t.data[t.offset+2]=15,t.data[t.offset+3]=1,Object(y.k)(a,t.data,t.offset+4),Object(y.k)(_,t.data,t.offset+8),t.offset+=12,l.forEach((function(e,i){if(e){var n=t.offset+16*i;Object(y.k)(e.duration,t.data,n),Object(y.k)(e.len,t.data,n+4),t.data[n+8]=e.flags.isLeading<<2|e.flags.dependsOn,t.data[n+9]=e.flags.isDependedOn<<6|e.flags.hasRedundancy<<4|e.flags.isNonSync,t.data[n+10]=61440&e.flags.degradPrio,t.data[n+11]=15&e.flags.degradPrio,Object(y.i)(e.cts,t.data,n+12)}})),t.offset+=16*a,this._getEncLen(r)&&this._writeEnc(t,r,s)},e._writeBoxHead=function(t,i,n){e._writeBoxHeadAt(t.data,i,n,t.offset),t.offset+=8},e._writeBoxHeadAt=function(e,t,i,n){Object(y.k)(i,e,n),e.set(t,n+4)},e}();j.types={avc1:[97,118,99,49],avcC:[97,118,99,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stsz:[115,116,115,122],stts:[115,116,116,115],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100],smhd:[115,109,104,100],hvcC:[104,118,99,67],pssh:[112,115,115,104],saiz:[115,97,105,122],saio:[115,97,105,111],senc:[115,101,110,99],av1C:[97,118,49,67],hev1:[104,101,118,49],av01:[97,118,48,49]};var z=j,G="remuxer",W=function(){function e(e,t,i,n){var r=this;void 0===n&&(n=""),this._evt=void 0,this._config=void 0,this._typeSupported=void 0,this._isSafari=void 0,this._forceFirstIDR=void 0,this._rawVideoTimeOffset=0,this._ISGenerated=!1,this._lastVideoCodec="",this._transmuxData=void 0,this._aNextPTS=void 0,this._vNextDTS=void 0,this._initPTS=void 0,this._initDTS=void 0,this._initSegment={},this._pssh=void 0,this._videoTrack=void 0,this._vLastSample=void 0,this._onError=function(e){r._evt.emit(c.a.ERROR,e)},this._evt=e,this._config=t,this._typeSupported=i;var a=navigator.userAgent;this._isSafari=!(!(n&&n.indexOf("Apple")>-1&&a)||a.match("CriOS")),this._ISGenerated=!1,this._forceFirstIDR=!!(h.a.chrome&&h.a.version.major<70),this._vLastSample={}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){l.b.i(G,"reset timestamp",e),this._initPTS=this._initDTS=e},t.resetInitSegment=function(e){this._ISGenerated=!1,this._initSegment={},this._transmuxData=e,this._rawVideoTimeOffset=0,this._pssh=void 0,this._lastVideoCodec="",this._vLastSample={}},t.getLastDTS=function(){return{video:this._vNextDTS,audio:this._aNextPTS}},t.flush=function(e){var t;if(void 0===e&&(e=!0),l.b.i(G,"flush ",!!this._vLastSample.sample),this._vLastSample.sample&&this._videoTrack&&(this._videoTrack.samples=[this._vLastSample.sample],this._vLastSample.sample=void 0,t=this._remuxVideo(this._videoTrack,this._vNextDTS||0,!0,!1)),t&&e){var i=[t];this._evt.emit(c.a.PARSING_DATA,{segments:i,extra:this._transmuxData})}return t},t.remux=function(e,t,i,n,r,a,s){var o,d,h,f;if(void 0===a&&(a=!1),s&&(this._pssh=s),this._videoTrack=t,n||(this._vNextDTS=this._aNextPTS=void 0),t.active&&!t.outputRaw&&(this._vLastSample.sample&&(n&&t.samples.unshift(this._vLastSample.sample),this._vLastSample.sample=void 0),!this._config.gopRemux&&n&&t.samples.length>1&&!a&&(this._vLastSample.sample=t.samples.pop())),e.active&&u.a.ensureAudioFrame(e,t,null==(f=this._transmuxData)?void 0:f.audioCodec,a),t.active)if(!this._ISGenerated&&t.outputRaw&&(d=this._getRawVideoInfo(t)),n||u.a.alignStartByVideo(e,t),t.outputRaw&&t.samples.length){if(o=t.samples,t.samples=[],t.mp4Samples=[],this._config.ensureVideo&&e.samples.length&&e.samplerate){var p=this._fillVideoByAudio(t,e);p&&(t=p,h=!0,l.b.i(G,"fill black video. raw output."))}}else if((this._config.isLive||!n)&&a&&!t.outputRaw&&0===t.samples.length&&e.samples.length&&e.samplerate&&(!this._ISGenerated||(e.samples[e.samples.length-1].pts-e.samples[0].pts)/e.inputTimescale>=1)){var v=this._fillVideoByAudio(t,e);v&&(t=v,h=!0,l.b.i(G,"fill black video, no video samples."))}if(this._lastVideoCodec=t.codec,this._ISGenerated||this._generateIS(e,t,i,d,h),!n&&t.samples.length&&(t.samples[0].pts=t.samples[0].dts),this._ISGenerated){var m,A,g=i,y=i;if(e.samples.length&&t.samples.length)if(!n&&r){if(e.samples[0].pts-t.samples[0].pts<0){var E=t.samples[0];E.pts=e.samples[0].pts,E.dts=E.pts-E.cts}}else{var b=(e.samples[0].pts-t.samples[0].pts)/t.inputTimescale;g+=Math.max(0,b),y+=Math.max(0,-b)}m=this._remuxAudio(e,g,n,r),A=this._remuxVideo(t,y,n,r,a),h&&(this._ISGenerated=!1);var T=[];if(m&&(T.push(m),o&&(this._rawVideoTimeOffset=m.startDTS-m.originFirstDTS)),A&&T.push(A),T.length&&this._evt.emit(c.a.PARSING_DATA,{segments:T,extra:this._transmuxData}),o){var S=Math.abs(this._rawVideoTimeOffset)>.001?this._rawVideoTimeOffset*t.inputTimescale:0;o.forEach((function(e){e.dts=Math.max(0,e.dts+S)/t.inputTimescale,e.cts=e.cts/t.inputTimescale,e.pts=e.dts+e.cts,e.originDTS=e.originDTS/t.inputTimescale})),this._evt.emit(c.a.RAW_DATA,{type:_.c.videoFrame,samples:o,extra:this._transmuxData})}}},t._getRawVideoInfo=function(e){if(e.codec)return{container:"video/mp4",codec:e.codec,codecType:e.codecType||d.b.unknown,metadata:{width:e.width,height:e.height,rotation:e.rotation,fps:e.fps,profile:e.profile,level:e.level,chromaFormat:e.chromaFormat,bitDepth:e.bitDepth,colorInfo:e.colorInfo,videoBitrate:e.bitrate,videoMaxBitrate:e.maxBitrate}}},t._generateIS=function(e,t,i,n,r){var a,s,u=this._evt,_=e.samples,h=t.samples,f=this._typeSupported,p={},v={tracks:p},m=void 0===this._initPTS,A="audio/mp4";if(m&&(a=s=1/0),e.config&&_.length&&(e.duration=e.duration/e.timescale*e.samplerate,e.timescale=e.samplerate,l.b.v(G,"audio sampling rate : "+e.samplerate),e.codecType===d.b.mp3?f.mpeg?(A="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3"):e.codecType===d.b.opus&&(e.codec="opus"),this._initSegment.audio=e.codecType===d.b.mp3&&f.mpeg?new Uint8Array:z.moov([e],this._pssh),p.audio={container:A,codec:e.codec,codecType:e.codecType||d.b.unknown,metadata:{channel:e.channelCount,audioSampleRate:e.extensionSamplerate||e.samplerate,audioBitrate:e.bitrate,audioMaxBitrate:e.maxBitrate}},m&&(a=s=_[0].pts/e.inputTimescale-i)),t.codec&&h.length){var g=t.inputTimescale;t.timescale=g,t.duration<=0&&(l.b.i(G,"videoTrack.duration === 0"),t.duration=1),t.outputRaw||(this._initSegment.video=z.moov([t],this._pssh)),p.video={container:"video/mp4",codec:t.codec,codecType:t.codecType||d.b.unknown,metadata:{width:t.width,height:t.height,rotation:t.rotation,fps:t.fps,profile:t.profile,level:t.level,chromaFormat:t.chromaFormat,bitDepth:t.bitDepth,colorInfo:t.colorInfo,videoBitrate:t.bitrate,videoMaxBitrate:t.maxBitrate,isFillVideo:r}},m&&(a=Math.min("number"==typeof a?a:1/0,h[0].pts/g-i),s=Math.min("number"==typeof s?s:1/0,h[0].dts/g-i))}n&&(p.rawVideo=n),Object.keys(p).length?(u.emit(c.a.PARSING_INIT_SEGMENT,v),this._ISGenerated=!0,m&&(this._initPTS=a,this._initDTS=s,l.b.i(G,"init pts:"+a+" dts:"+s+" offset:"+i))):this._onError({type:o.b.MUX_ERROR,details:o.a.PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t._remuxVideo=function(e,t,i,n,r){var a=this;if(void 0===n&&(n=!1),void 0===r&&(r=!1),e.samples.length&&void 0!==this._initPTS&&void 0!==this._initDTS){var s,o,c=e.inputTimescale,u=e.samples,_=[],h=this._initDTS*c,p=this._initPTS*c,v=Object(f.c)(1,c),m=0,A=0,g=0,y=u.length,E=this._vNextDTS?this._vNextDTS*c:0,b=this._isSafari;if(0!==y&&0!==c&&(b&&(i=i||!!(y&&E&&(n&&Math.abs(t-E/c)<.1||Math.abs(u[0].pts-E-h)<c/5))),i||(E=t*c),void 0!==E)){u.forEach((function(e){e.pts=K(e.pts-p,E),e.dts=K(e.dts-p,E)})),u.sort((function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n}));var T=u.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-.2*c)}),0);if(T<0){l.b.i(G,"PTS < DTS detected in video samples, shifting DTS by "+Math.round(Object(f.b)(T,c))+" ms to overcome this issue");for(var S=0;S<y;S++)u[S].dts+=T}g=Math.max(u[0].dts,0),A=Math.max(u[0].pts,0);var x=g-E;if(i&&x){if(A-=x,g=E,u[0].dts=g,u[0].pts=A,x<0)for(var C=1;u[C]&&u[C].dts<=u[C-1].dts;){var L=u[C-1].dts+v-u[C].dts;u[C].dts+=L,u[C].pts+=L,C++}l.b.v(G,"Video/PTS/DTS adjusted: "+Object(f.b)(A,c,!0)+"/"+Object(f.b)(g,c,!0))}o=Math.max(u[y-1].dts,0),s=Math.max(u[y-1].pts,0,o),b&&(m=Math.round((o-g)/(y-1)));for(var R=0;R<y;R++){var D=u[R];D.dts=b?g+R*m:Math.max(D.dts,g),D.pts=Math.max(D.pts,D.dts)}for(var w=function(t){var n,s,o=u[t];if(!b)if(t<y-1)m=Math.round(u[t+1].dts-o.dts);else{if(a._vLastSample.sample){var d=K(a._vLastSample.sample.dts-p,E);m=d-o.dts}else m=e.sampleDuration||m;if(r){var h=!1;if(a._aNextPTS){var l=a._aNextPTS*c-o.pts;l>.5*e.inputTimescale&&(m=l-m,h=!0)}!h&&1===y&&x&&(m+=x)}}if(s=o.pts-o.dts,m<0||isNaN(m)||!isFinite(m)){var f=i&&y<2?x:0;m=Math.round(Math.max(e.sampleDuration-f,v)),console.log("debug mp4 sample du",m);var A=u[t+1];A&&(A.dts=o.dts+m,A.pts=A.dts+A.cts)}var g=0===e.codec.indexOf("av01")?0:4;n=o.units.reduce((function(e,t){return t.data.byteLength+g+e}),0),_.push({len:n,units:o.units,duration:m,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:o.key?2:1,isNonSync:o.key?0:1},auxiliaryInfo:o.auxiliaryInfo})},I=0;I<y;I++)w(I);if(this._vNextDTS=(o+m)/c,_.length&&this._forceFirstIDR){var O=_[0].flags;O.dependsOn=2,O.isNonSync=0}e.mp4Samples=_;var P=z.videoMediaSegment(e.sequenceNumber++,g,e,this._getMoovByType(d.l.VIDEO));this._videoTrack&&(this._videoTrack.sequenceNumber=e.sequenceNumber);var k={payload:P,adjustedStart:x/c,startPTS:A/c,endPTS:(s+m)/c,startDTS:g/c,endDTS:this._vNextDTS,type:d.l.VIDEO,originFirstDTS:u[0].originDTS/c,firstParseTime:u[0].parseTime,fillDuration:e.fillDuration/c};return e.fillDuration=0,e.samples=[],e.mp4Samples=[],k}}},t._remuxAudio=function(e,t,i,n){if(void 0===n&&(n=!1),e.samples.length&&void 0!==this._initPTS){var r,a,s,o=e.inputTimescale,c=e.timescale,u=o/c,_=e.codecType===d.b.aac?1024:1152,h=_*u,v=this._initPTS*o,m=[],A=e.codecType===d.b.mp3&&this._typeSupported.mpeg,g=0,y=e.samples,E=this._aNextPTS?this._aNextPTS*o:this._aNextPTS,b=!1;if(i=i||!!(y.length&&E&&(n&&Math.abs(t-E/o)<.1||Math.abs(y[0].pts-E-v)<20*h)),y.forEach((function(e){e.pts=e.dts=K(e.pts-v,t*o)})),0!==(y=y.filter((function(e){return e.pts>=0}))).length&&(i&&void 0!==E||(E=n?t*o:y[0].pts,b=!0),void 0!==E)){if(e.codecType===d.b.aac)for(var T=this._config.maxAudioFramesDrift,S=0,x=E;S<y.length;){var C=y[S],L=C.pts-x;if(L<=-T*h)y.splice(S,1);else if(L>=T*h&&L<100*o&&x){var R=Math.round(L/h);l.b.i(G,"Injecting "+R+" audio frame @ "+(x/o).toFixed(3)+"s due to "+Math.round(Object(f.b)(L,o))+" ms gap. "+S+" "+e.manifestCodec+" "+e.codec);for(var D=0;D<R;D++){var w=Math.max(x,0);(a=p.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(l.b.v(G,"Unable to get silent frame for given audio codec; duplicating last frame instead."),a=C.unit.subarray()),y.splice(S,0,{unit:a,pts:w,dts:w,originDTS:C.originDTS-(R-D)*h}),x+=h,S++}C.pts=C.dts=x,x+=C.duration||h,S++}else C.pts=C.dts=x,x+=C.duration||h,S++}for(var I=y.length,O=0,P=y.length;O<P;O++){var k=y[O],N=k.unit,M=k.duration?Math.round(k.duration/u):_,B=k.pts;if(void 0!==s&&r)r.duration=Math.round((B-s)/u);else{var V=Math.round(B-E),F=0;if(i&&e.codecType===d.b.aac&&V){if(V>0&&V<100*o)F=Math.round((B-E)/h),l.b.v(G,V+" ms hole between AAC samples detected,filling it");else if(V<-.012*o){l.b.v(G,"drop overlapping AAC sample, expected/parsed/delta:"+(E/o).toFixed(3)+"s/"+(B/o).toFixed(3)+"s/"+-V/o*1e3+"ms");continue}B=E}g=B;for(var U=0;U<F;U++){var H=_;(a=p.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(l.b.v(G,"Unable to get silent frame for given audio codec; duplicating this frame instead."),a=N.subarray(),k.duration&&(H=M)),r={len:a.byteLength,cts:0,duration:H,unit:a,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0},auxiliaryInfo:k.auxiliaryInfo},m.push(r)}}r={len:N.byteLength,cts:0,duration:M,unit:N,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0},auxiliaryInfo:k.auxiliaryInfo},m.push(r),s=B}if(I=m.length,r){if(I&&"number"==typeof s){var j;r&&0===r.duration&&(r.duration=_),E=s+u*r.duration,e.mp4Samples=m,j=A?z.audioRawMpeg(e):z.audioMediaSegment(e.sequenceNumber++,g/u,e,this._getMoovByType(d.l.AUDIO)),e.samples=[],e.mp4Samples=[];var W=g/o,Q=this._aNextPTS=E/o,Y={payload:j,startPTS:W,endPTS:Q,startDTS:W,endDTS:Q,type:d.l.AUDIO,originFirstDTS:y[0].originDTS/o,firstParseTime:y[0].parseTime,fillDuration:e.fillDuration/o};return A&&(Y.updateTimestampOffset=!0),e.fillDuration=0,Y}b&&delete this._aNextPTS,e.samples=[],e.mp4Samples=[]}}}},t._getMoovByType=function(e){var t;return this._initSegment&&this._initSegment[e]&&(t=this._initSegment[e],delete this._initSegment[e]),t},t._fillVideoByAudio=function(e,t){var i=r()({},e);i.samples=[],i.codecType=d.b.h264,i.inputTimescale=e.inputTimescale,i.timescale=e.timescale;var n=g.getFillTrackBySamples(i,t.samples);return n&&(this._ISGenerated=i.codec===this._lastVideoCodec),n},s()(e,[{key:"ISGenerated",get:function(){return this._ISGenerated}}]),e}();function K(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}t.b=W},function(e,t,i){function n(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var n=i(i.s=ENTRY_MODULE);return n.default||n}function r(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,n){var a={};a[n]=[];var s=t.toString(),o=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var c,u=o[1],d=new RegExp("(\\\\n|\\W)"+r(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");c=d.exec(s);)"dll-reference"!==c[3]&&a[n].push(c[3]);for(d=new RegExp("\\("+r(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");c=d.exec(s);)e[c[2]]||(a[n].push(c[1]),e[c[2]]=i(c[1]).m),a[c[2]]=a[c[2]]||[],a[c[2]].push(c[4]);for(var _,h=Object.keys(a),l=0;l<h.length;l++)for(var f=0;f<a[h[l]].length;f++)_=a[h[l]][f],isNaN(1*_)||(a[h[l]][f]=1*a[h[l]][f]);return a}function s(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var r={main:i.m},o=t.all?{main:Object.keys(r.main)}:function(e,t){for(var i={main:[t]},n={main:[]},r={main:{}};s(i);)for(var o=Object.keys(i),c=0;c<o.length;c++){var u=o[c],d=i[u].pop();if(r[u]=r[u]||{},!r[u][d]&&e[u][d]){r[u][d]=!0,n[u]=n[u]||[],n[u].push(d);for(var _=a(e,e[u][d],u),h=Object.keys(_),l=0;l<h.length;l++)i[h[l]]=i[h[l]]||[],i[h[l]]=i[h[l]].concat(_[h[l]])}}return n}(r,e),c="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",c=c+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+r[e][t].toString()})).join(",")+"});\n"})),c=c+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+r.main[e].toString()})).join(",")+"}))(self);";var u=new window.Blob([c],{type:"text/javascript"});if(t.bare)return u;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),_=new window.Worker(d);return _.objectURL=d,_}},function(e,t,i){var n=i(2),r=i(18),a=i(23),s=function(){function e(){this._lastEndTime=-1}var t=e.prototype;return t.reset=function(){this._lastEndTime=-1},t.update=function(e,t){if(t.samples.length){var i=t.samples.reduce((function(e,i,n){return t.samples[e].pts>i.pts?e:n}),0),s=t.samples[0].dts/t.inputTimescale,o=t.samples[0].originDTS/t.inputTimescale,c=t.samples[i],u=(c.pts+(c.duration||0))/t.inputTimescale,d=r.c(e.samplerate,1),_=u;e.samples.length&&(_=Math.min(e.samples[0].dts/e.inputTimescale,u)),-1===this._lastEndTime?this._lastEndTime=s:(o=this._lastEndTime-s+o,s=this._lastEndTime);var h=Math.max(0,Math.ceil((_-s)/d));h>0&&(n.b.i("slient-audio","fill cnt: "+h+"@"+s+" duration: "+(_-s)),this._lastEndTime=a.a.fillAACFrameByCount(e,s,h,o))}},e}();t.a=s},function(e,t){e.exports=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){function n(e,t){var i=[];return e.samples.forEach((function(t){var n=e.inputTimescale;i.push({index:0,dts:t.dts/n,pts:t.pts/n,duration:(t.duration||0)/n})})),i.sort((function(e,t){return e.pts-t.pts})),i.forEach((function(e,i){e.index=t+i})),i}i.d(t,"a",(function(){return n}))},function(e,t,i){var n=i(5),r=i.n(n),a=i(12),s=i.n(a),o=i(0),c=i(22),u=i(2),d=i(24),_=i(39),h="canvas-output-vpp",l=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._vppList=[],t._originSizeCanvas=void 0,t._originSizeGL=null,t._video=void 0,t._webGLFrameSink=void 0,t._inputRendererType=o.o.video,t._draw=function(){t._vppList.forEach((function(e){return e.vpp.draw()}))},t}s()(t,e);var i=t.prototype;return i.reset=function(){e.prototype.reset.call(this),this._destroyOriginSizeCanvas(),this._webGLFrameSink=void 0,this._inputRendererType=o.o.video},i.updateFormatSize=function(e,t,i){var n=!1,r=i%180==90||i%180==-90,a=r?t:e,s=r?e:t;return a===this._fSize.w&&s===this._fSize.h||(n=!0,this._fSize.w=a,this._fSize.h=s,this._calculateUpperSize(),this._originSizeCanvas&&(u.b.i(h,"updateFormatSize. w:"+e+" h:"+t+" rotation:"+i),this._originSizeCanvas.width=e,this._originSizeCanvas.height=t,this._originSizeGL&&(this._originSizeGL.canvas.width=e,this._originSizeGL.canvas.height=t)),this._calculateDisplaySize()),n},i.setVideo=function(e){u.b.i(h,"setVideo",e),this._video=e,this._applayVPP()},i.setWebGLFrameSink=function(e){u.b.i(h,"setWebGLFrameSink"),this._webGLFrameSink=e,this._applayVPP(),e.afterDraw(this._draw)},i.updateRendererType=function(e){u.b.i(h,"updateRendererType: "+e);var t=this.rendererType;return e!==o.o.canvas&&!this.hasVPP||this._canvas||this._createOutputCanvas(),this._inputRendererType=e,this._applayVPP(),t!==this.rendererType},i.bindVPP=function(e){u.b.i(h,"bind vpp");for(var t=this.rendererType,i=0;i<this._vppList.length;i++)if(this._vppList[i].vpp===e)return u.b.i(h,"vpp has been bound."),!1;return this._vppList.push({vpp:e,originSize:e.originalSizeInput}),this._canvas||this._createOutputCanvas(),this._applayVPP(),t!==this.rendererType},i.unbindVPP=function(e){u.b.i(h,"unbind vpp");var t=this.rendererType;if(!this.hasVPP)return!1;if(e){for(var i=0;i<this._vppList.length;i++)if(e===this._vppList[i].vpp){var n=this._vppList.splice(i,1);n.length&&(n[0].vpp.detachSource(),n[0].vpp.detachOutputCanvas());break}}else this._vppList.forEach((function(e){e.vpp.detachSource(),e.vpp.detachOutputCanvas()})),this._vppList.splice(0);return this.hasVPP?this._applayVPP():(u.b.i(h,"unbind all vpp"),this._inputRendererType===o.o.video&&this._canvas&&this._destroyCanvas(),this._inputRendererType===o.o.canvas&&this._webGLFrameSink&&(this.webgl&&this._webGLFrameSink.setWebGLCtx(this.webgl,c.b.normal),this._webGLFrameSink.drawToCanvas(),this._webGLFrameSink.reDraw())),t!==this.rendererType},i.destroy=function(){e.prototype.destroy.call(this),this._destroyOriginSizeCanvas()},i._calculateUpperSize=function(){e.prototype._calculateUpperSize.call(this),this._draw()},i._applayVPP=function(){var e=this;if(this._canvas&&this.hasVPP){var t,i=this.webgl;if(this._inputRendererType===o.o.canvas){if(!this._webGLFrameSink)return;t=this._canvas}else this._inputRendererType===o.o.video&&(t=this._video);if(t&&i){if(this._inputRendererType===o.o.canvas)if(this._vppList[0].originSize){var n,r;this._originSizeGL||this._createOriginSizeCanvas(),this._originSizeGL&&(u.b.i(h,"webgl set origin size",this._originSizeGL),null==(n=this._webGLFrameSink)||n.setWebGLCtx(this._originSizeGL,c.b.fill),null==(r=this._webGLFrameSink)||r.drawToCanvas()),t=this._originSizeCanvas}else{var a,s;null==(a=this._webGLFrameSink)||a.setWebGLCtx(i,c.b.normal),null==(s=this._webGLFrameSink)||s.drawToFBO()}u.b.i(h,"apply vpp",t,i,JSON.stringify(this._fSize)),this._vppList.forEach((function(n,r){t&&(n.vpp.attachOutputCanvas(i),n.vpp.attachSource(t),r<e._vppList.length-1&&(t=n.vpp.drawToFBO())),n.vpp.draw()}))}}},i._createOriginSizeCanvas=function(){this._originSizeCanvas=this._createCanvas(this._fSize),!this._originSizeGL&&this._originSizeCanvas&&(this._originSizeGL=Object(d.b)(this._originSizeCanvas))},i._destroyOriginSizeCanvas=function(){if(u.b.i(h,"destroy origin size canvas"),this._originSizeGL){u.b.i(h,"origin size lose ctx");var e=this._originSizeGL.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._originSizeGL=null}this._originSizeCanvas&&(this._originSizeCanvas=void 0)},r()(t,[{key:"rendererType",get:function(){return this._inputRendererType===o.o.video?this.hasVPP?o.o.canvas:o.o.video:o.o.canvas}},{key:"output",get:function(){return this.rendererType===o.o.video?this._video:this._canvas}},{key:"hasVPP",get:function(){return this._vppList.length>0}}]),t}(_.a);t.a=l},function(e,t,i){t.a={search:function(e,t){for(var i=0,n=e.length-1,r=null,a=null;i<=n;){var s=t(a=e[r=(i+n)/2|0]);if(s>0)i=r+1;else{if(!(s<0))return a;n=r-1}}return null},searchIndex:function(e,t){for(var i=0,n=e.length-1,r=null;i<=n;){var a=t(e[r=(i+n)/2|0]);if(a>0)i=r+1;else{if(!(a<0))return r;n=r-1}}return-1}}},function(e,t,i){var n=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.a=n},function(e,t,i){function n(e){for(var t=[],i=0,n=e.byteLength;i<n;){if(e[i]<128)t.push(e[i]);else if(e[i]<192);else if(e[i]<224){if(i<n-1&&e[i+1]>>6==2){t.push((31&e[i])<<6|63&e[i+1]),i+=2;continue}}else if(e[i]<240){if(i<n-2&&e[i+1]>>6==2&&e[i+2]>>6==2){t.push((15&e[i])<<12|(63&e[i+1])<<6|63&e[i+2]),i+=3;continue}}else if(e[i]<248&&i<n-3&&e[i+1]>>6==2&&e[i+2]>>6==2&&e[i+3]>>6==2){t.push((7&e[i])<<18|(63&e[i+1])<<12|(63&e[i+2])<<6|63&e[i+3]),i+=4;continue}i++}return(String.fromCodePoint||r).apply(null,t)}function r(){for(var e=[],t=0,i="",n=0,r=arguments.length;n!==r;++n){var a=+arguments[n];if(!(a<1114111&&a>>>0===a))throw RangeError("Invalid code point: "+a);a<=65535?t=e.push(a):(a-=65536,t=e.push(55296+(a>>10),a%1024+56320)),t>=16383&&(i+=String.fromCharCode.apply(null,e),e.length=0)}return i+String.fromCharCode.apply(null,e)}i.d(t,"a",(function(){return n}))},function(e,t,i){var n,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(i,n){function r(i){e.removeListener(t,a),n(i)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",r),i([].slice.call(arguments))}m(e,t,a,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&m(e,"error",t,i)}(e,r,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function _(e,t,i,n){var r,a,s,o;if(u(i),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=d(e))>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,o=c,console&&console.warn&&console.warn(o)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=h.bind(n);return r.listener=i,n.wrapFn=r,r}function f(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):v(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function v(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function m(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(a){n.once&&e.removeEventListener(t,r),i(a)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var u=c.length,d=v(c,u);for(i=0;i<u;++i)a(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return _(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return _(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,n,r,a,s;if(u(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){var n=i(5),r=i.n(n),a=i(2),s=i(24),o="canvas-output",c=function(){function e(e){this._canvas=void 0,this._gl=null,this._cSize={w:0,h:0},this._fSize={w:0,h:0},this._dSize={w:0,h:0},a.b.i(o,"constructor"),this._canvas=e}var t=e.prototype;return t.reset=function(){a.b.i(o,"reset"),this._destroyCanvas()},t.updateCanvasSize=function(e,t){var i=!1;return e===this._cSize.w&&t===this._cSize.h||(i=!0,this._cSize.w=e,this._cSize.h=t,this._calculateUpperSize()),this._calculateDisplaySize(),i},t.updateFormatSize=function(e,t,i){var n=!1,r=i%180==90||i%180==-90,a=r?t:e,s=r?e:t;return a===this._fSize.w&&s===this._fSize.h||(n=!0,this._fSize.w=a,this._fSize.h=s,this._calculateUpperSize(),this._calculateDisplaySize()),n},t.destroy=function(){a.b.i(o,"destroy"),this._destroyCanvas()},t._calculateUpperSize=function(){if(this._canvas&&this._cSize.h){var e=this._cSize,t=e.w,i=e.h,n=this._fSize,r=n.w,s=n.h;if(s){var c=t/i;c>r/s?i>s&&(t=(i=s)*c):t>r&&(i=(t=r)/c)}this._canvas.width=t,this._canvas.height=i,a.b.i(o,"update canvas size",t,i)}},t._calculateDisplaySize=function(){var e,t,i=(null==(e=this._canvas)?void 0:e.width)||this._cSize.w,n=(null==(t=this._canvas)?void 0:t.height)||this._cSize.h,r=this._fSize,a=r.w/r.h;a>i/n?(this._dSize.w=i,this._dSize.h=Math.round(i/a)):(this._dSize.w=Math.round(n*a),this._dSize.h=n)},t._createCanvas=function(e){a.b.i(o,"create canvas");var t=document.createElement("canvas");return e.w?(t.width=e.w,t.height=e.h):(e.w=t.width,e.h=t.height),t},t._createOutputCanvas=function(){this._canvas||(this._canvas=this._createCanvas(this._cSize))},t._destroyCanvas=function(){if(a.b.i(o,"destroy canvas"),this._gl){var e=this._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}this._gl=null,this._canvas&&("undefined"!=typeof HTMLCanvasElement&&this._canvas instanceof HTMLCanvasElement&&this._canvas.remove(),this._canvas=void 0)},r()(e,[{key:"canvas",get:function(){return this._canvas}},{key:"webgl",get:function(){return!this._gl&&this._canvas&&(this._gl=Object(s.b)(this._canvas)),this._gl}},{key:"canvasSize",get:function(){return this._cSize}},{key:"formatSize",get:function(){return this._fSize}},{key:"displaySize",get:function(){return this._dSize}}]),e}();t.a=c},function(e,t,i){var n=function(){function e(){}return e.getPosByTime=function(e,t){if(e){if(e[0]&&t<=e[0].time)return e[0];if(e[e.length-1]&&t>=e[e.length-1].time)return e[e.length-1];for(var i=0,n=e.length-1,r=0,a=0;i<=n;)if(t>(a=e[1+(r=(i+n)/2|0)]?e[r+1].time:Number.MAX_SAFE_INTEGER))i=r+1;else{if(!(t<e[r].time))return t===a?e[r+1]:e[r];n=r-1}return e[0]}},e}();t.a=n},function(e,t,i){var n=i(3),r=i(1),a=i(2);function s(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}var o=function(){function e(e,t){this._subtle=void 0,this._aesIV=void 0,this._subtle=e,this._aesIV=t}return e.prototype.decrypt=function(e,t){return this._subtle.decrypt({name:"AES-CBC",iv:this._aesIV},t,e)},e}(),c=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),n=0;n<4;n++)i[n]=t.getUint32(4*n);return i},t.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],r=i[1],a=i[2],s=i[3],o=this.invSubMix,c=o[0],u=o[1],d=o[2],_=o[3],h=new Uint32Array(256),l=0,f=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var v=f^f<<1^f<<2^f<<3^f<<4;v=v>>>8^255&v^99,e[l]=v,t[v]=l;var m=h[l],A=h[m],g=h[A],y=257*h[v]^16843008*v;n[l]=y<<24|y>>>8,r[l]=y<<16|y>>>16,a[l]=y<<8|y>>>24,s[l]=y,y=16843009*g^65537*A^257*m^16843008*l,c[v]=y<<24|y>>>8,u[v]=y<<16|y>>>16,d[v]=y<<8|y>>>24,_[v]=y,l?(l=m^h[h[h[g^m]]],f^=h[h[f]]):l=f=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,n=0;n<t.length&&i;)i=t[n]===this.key[n],n++;if(!i){this.key=t;var r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var a,s,o=this.ksRows=4*(r+6+1),c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),d=this.sBox,_=this.rcon,h=this.invSubMix,l=h[0],f=h[1],p=h[2],v=h[3],m=0,A=0;for(a=0;a<o;a++)a<r?m=c[a]=t[a]:(A=m,a%r==0?(A=d[(A=A<<8|A>>>24)>>>24]<<24|d[A>>>16&255]<<16|d[A>>>8&255]<<8|d[255&A],A^=_[a/r|0]<<24):r>6&&a%r==4&&(A=d[A>>>24]<<24|d[A>>>16&255]<<16|d[A>>>8&255]<<8|d[255&A]),c[a]=m=(c[a-r]^A)>>>0);for(s=0;s<o;s++)a=o-s,A=3&s?c[a]:c[a-4],u[s]=s<4||a<=4?A:l[d[A>>>24]]^f[d[A>>>16&255]]^p[d[A>>>8&255]]^v[d[255&A]],u[s]=u[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,i){for(var n,r,a,s,o,c,u,d,_,h,l,f,p,v,m=this.keySize+6,A=this.invKeySchedule,g=this.invSBox,y=this.invSubMix,E=y[0],b=y[1],T=y[2],S=y[3],x=this.uint8ArrayToUint32Array_(i),C=x[0],L=x[1],R=x[2],D=x[3],w=new Int32Array(e),I=new Int32Array(w.length),O=this.networkToHostOrderSwap;t<w.length;){for(_=O(w[t]),h=O(w[t+1]),l=O(w[t+2]),f=O(w[t+3]),o=_^A[0],c=f^A[1],u=l^A[2],d=h^A[3],p=4,v=1;v<m;v++)n=E[o>>>24]^b[c>>16&255]^T[u>>8&255]^S[255&d]^A[p],r=E[c>>>24]^b[u>>16&255]^T[d>>8&255]^S[255&o]^A[p+1],a=E[u>>>24]^b[d>>16&255]^T[o>>8&255]^S[255&c]^A[p+2],s=E[d>>>24]^b[o>>16&255]^T[c>>8&255]^S[255&u]^A[p+3],o=n,c=r,u=a,d=s,p+=4;n=g[o>>>24]<<24^g[c>>16&255]<<16^g[u>>8&255]<<8^g[255&d]^A[p],r=g[c>>>24]<<24^g[u>>16&255]<<16^g[d>>8&255]<<8^g[255&o]^A[p+1],a=g[u>>>24]<<24^g[d>>16&255]<<16^g[o>>8&255]<<8^g[255&c]^A[p+2],s=g[d>>>24]<<24^g[o>>16&255]<<16^g[c>>8&255]<<8^g[255&u]^A[p+3],p+=3,I[t]=O(n^C),I[t+1]=O(s^L),I[t+2]=O(a^R),I[t+3]=O(r^D),C=_,L=h,R=l,D=f,t+=4}return I.buffer},e}(),u=function(){function e(e,t){this._subtle=void 0,this._key=void 0,this._subtle=e,this._key=t}return e.prototype.expandKey=function(){return this._subtle.importKey("raw",this._key,{name:"AES-CBC",length:128},!1,["encrypt","decrypt"])},e}(),d=function(){function e(e,t){var i=(void 0===t?{}:t).removePKCS7Padding,n=void 0===i||i;if(this._logEnabled=!0,this._config=void 0,this._removePKCS7Padding=void 0,this._subtle=null,this._softwareDecrypter=null,this._key=null,this._fastAesKey=null,this._remainderData=null,this._currentIV=null,this._currentResult=null,this._config=e,this._removePKCS7Padding=n,n)try{var r=self.crypto;r&&(this._subtle=r.subtle||r.webkitSubtle)}catch(e){}null===this._subtle&&(this._config.enableSoftwareAES=!0)}var t=e.prototype;return t.isSync=function(){return this._config.enableSoftwareAES},t.flush=function(){var e=this._currentResult;if(e){var t,i,n,r=new Uint8Array(e);return this.reset(),this._removePKCS7Padding?(i=(t=r).byteLength,(n=i&&new DataView(t.buffer).getUint8(i-1))?s(t,0,i-n):t):r}this.reset()},t.reset=function(){this._currentResult=null,this._currentIV=null,this._remainderData=null,this._softwareDecrypter&&(this._softwareDecrypter=null)},t.decrypt=function(e,t,i,n){if(this._config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(e),t,i);var r=this.flush();r&&n(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(e),t,i).then(n)},t.softwareDecrypt=function(e,t,i){var n,r,a,o=this._currentIV,u=this._currentResult,d=this._remainderData;this.logOnce("JS AES decrypt"),d&&(n=d,r=e,(a=new Uint8Array(n.length+r.length)).set(n),a.set(r,n.length),e=a,this._remainderData=null);var _=this.getValidChunk(e);if(!_.length)return null;o&&(i=o);var h=this._softwareDecrypter;h||(h=this._softwareDecrypter=new c),h.expandKey(t);var l=u;return this._currentResult=h.decrypt(_.buffer,0,i),this._currentIV=s(_,-16).buffer,l||null},t.webCryptoDecrypt=function(e,t,i){var n=this,r=this._subtle;return this._key===t&&this._fastAesKey||(this._key=t,this._fastAesKey=new u(r,t)),this._fastAesKey.expandKey().then((function(t){return r?new o(r,i).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))})).catch((function(r){return n.onWebCryptoError(r,e,t,i)}))},t.onWebCryptoError=function(e,t,i,n){return a.b.w("decrypter","[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",e),this._config.enableSoftwareAES=!0,this._logEnabled=!0,this.softwareDecrypt(t,i,n)},t.getValidChunk=function(e){var t=e,i=e.length-e.length%16;return i!==e.length&&(t=s(e,0,i),this._remainderData=s(e,i)),t},t.logOnce=function(e){this._logEnabled&&(a.b.i("decrypter","[decrypter.ts]: "+e),this._logEnabled=!1)},e}(),_=i(21),h=i(29),l=i(11),f=i(8),p=i.n(f),v=i(5),m=i.n(v),A=i(6);function g(e,t,i){return void 0===i&&(i=0),e.forEach((function(e){e.dts=Math.max(0,e.dts+i)/t,e.cts=e.cts/t,e.pts=e.dts+e.cts,e.originDTS=e.originDTS/t})),e}var y=i(0),E=function(){function e(){}return e.parse=function(t,i){void 0===i&&(i=!0);var n={},r=new DataView(t.buffer,t.byteOffset).getUint32(0)!==(i?525030175:2113995134),a=6,s=new Uint8Array(1024);s.set(t.slice(0,6),0);for(var o=t.byteLength,c=[t[o-2],t[o-1]],u=6;u<o;){var d=t[u];0===c[0]&&0===c[1]&&3===d||(s[a++]=d),c[0]=c[1],c[1]=d,++u}for(var _=6,h=new DataView(s.buffer);_<a;){var l=_,f=h.getUint16(l,r);l+=2;var p=h.getUint16(l,r);l+=2;var v=h.getUint16(l,r);if(l+=2,e._readElem(h,n,l,v,f,p,r),l+=v,_+=p,!p)break}return n},e._readElem=function(t,i,n,r,a,s,o){var c=e._readString(t,n,r);switch(n+=r,a){case 1:break;case 2:i[c]=e._readString(t,n,s-4);break;case 3:i[c]=t.getUint32(n,o);break;case 4:var u=t.getUint32(n+4,o),d=t.getUint32(n,o);i[c]=Math.pow(2,32)*u+d;break;case 5:i[c]=t.getFloat32(n,o);break;case 6:i[c]=t.getFloat64(n,o)}},e._readString=function(e,t,i){for(var n="",r=t;r<t+i;r++)n+=String.fromCharCode(e.getUint8(r));return n},e}(),b=i(4),T=i(18),S=i(23),x=null,C=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],D=[0,1,1,4];function w(e,t,i,n,r){if(!(i+24>t.length)){var a=I(t,i);if(a&&i+a.frameLength<=t.length){var s=n+r*(a.samplesPerFrame*A.e/a.sampleRate),o={unit:t.subarray(i,i+a.frameLength),pts:s,dts:s,originDTS:n};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function I(e,t){var i=e[t+1]>>3&3,n=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==i&&0!==r&&15!==r&&3!==a){var s=e[t+2]>>1&1,o=e[t+3]>>6,c=1e3*C[14*(3===i?3-n:3===n?3:4)+r-1],u=L[3*(3===i?0:2===i?1:2)+a],d=3===o?1:2,_=R[i][n],h=D[n],l=8*_*h,f=Math.floor(_*c/u+s)*h;if(null===x){var p=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);x=p?parseInt(p[1]):0}return!!x&&x<=87&&2===n&&c>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:d,frameLength:f,samplesPerFrame:l}}}function O(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function P(e,t){return t+1<e.length&&O(e,t)}var k,N=i(31),M=i(19),B=i(37),V=/\0/g,F=function(){function e(){}return e.parseMetadata=function(t){var i={};try{var n=e.parseScript(t,0),r=e.parseScript(t,n.size);i[n.data]=r.data}catch(e){a.b.e("AMF",e.toString())}return i},e.parseObject=function(t,i){var n=e.parseString(t,i),r=e.parseScript(t,i+n.size),a=r.objectEnd;return{data:{name:n.data,value:r.data},size:r.size,objectEnd:a}},e.parseVariable=function(t,i){return e.parseObject(t,i)},e.parseLongString=function(e,t){var i=new DataView(e,t).getUint32(0);return{data:i>0?Object(B.a)(new Uint8Array(e,t+4,i)).replace(V," ").trim():"",size:4+i}},e.parseDate=function(e,t){var i=new DataView(e,t),n=i.getFloat64(0),r=i.getInt16(8);return{data:new Date(n+=60*r*1e3),size:10}},e.parseString=function(e,t){var i=new DataView(e,t).getUint16(0);return{data:i>0?Object(B.a)(new Uint8Array(e,t+2,i)).replace(V," ").trim():"",size:2+i}},e.parseScript=function(t,i){var n=t.byteLength,r=i,s=t,o=new DataView(s,0),c=null,u=o.getUint8(r);r+=1;var d=!1;switch(u){case 0:c=o.getFloat64(r),r+=8;break;case 1:c=!!o.getUint8(r),r+=1;break;case 2:var _=e.parseString(s,r);c=_.data,r+=_.size;break;case 3:for(c={},9==(16777215&o.getUint32(n-4))&&3;r<n-4;){var h=e.parseObject(s,r);if(h.objectEnd)break;c[h.data.name]=h.data.value,r=h.size}r<=n-3&&9===(16777215&o.getUint32(r-1))&&(r+=3);break;case 8:for(c={},r+=4,9==(16777215&o.getUint32(n-4))&&3;r<n-8;){var l=e.parseVariable(s,r);if(l.objectEnd)break;c[l.data.name]=l.data.value,r=l.size}r<=n-3&&9===(16777215&o.getUint32(r-1))&&(r+=3);break;case 9:c=void 0,r=1,d=!0;break;case 10:c=[];var f=o.getUint32(r);r+=4;for(var p=0;p<f;p++){var v=e.parseScript(s,r);c.push(v.data),r=v.size}break;case 11:var m=e.parseDate(s,r+1);c=m.data,r+=m.size;break;case 12:var A=e.parseString(s,r+1);c=A.data,r+=A.size;break;default:r=n,a.b.v("AMF","AMF","Unsupported AMF value type "+u)}return{data:c,size:r,objectEnd:d}},e}(),U=i(16),H=function(){function e(e){this._evt=void 0,this._cache=void 0,this._tag=void 0,this._result={tags:[]},this._parseLen=0,this._parseFunc=void 0,this._hasVideo=void 0,this._hasAudio=void 0,this._evt=e,this._cache=new _.a,this._parseLen=U.a,this._parseFunc=this._parseFlvHead}var t=e.prototype;return t.reset=function(){this._parseLen=U.a,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0,this._result={tags:[]},this._hasAudio=void 0,this._hasVideo=void 0},t.append=function(e){for(this._result={tags:[]},this._cache.put(e);this._cache.unreadLen>=this._parseLen;)this._parseFunc();return this._result},t._parseFlvHead=function(){var e=this._cache.get(U.a);if(e){if(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3]){var t={type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Flv: wrong head"};this._evt.emit(r.a.ERROR,t)}this._hasAudio=!!((4&e[4])>>>2),this._hasVideo=!!(1&e[4]),a.b.i("flv-tag-dump","head audio: "+this._hasAudio+" video: "+this._hasVideo),this._result.head=e,this._parseLen=U.b,this._parseFunc=this._parseFlvTagHead}},t._parseFlvTagHead=function(){this._tag=new U.e;var e=this._cache.get(U.b);e&&(this._tag.tagType=e[0],this._tag.dataSize=Object(b.f)(e,1),this._tag.timestamp=((255&e[7])<<24)+Object(b.f)(e,4),this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+U.c)},t._parseFlvTag=function(){var e=this._tag;e&&(e.tagType!==U.f.SCRIPT&&e.tagType!==U.f.AUDIO&&e.tagType!==U.f.VIDEO||(e.body=this._cache.get(e.dataSize),this._cache.skip(4),this._result.tags.push(e),this._tag=void 0),this._parseFunc=this._parseFlvTagHead,this._parseLen=U.b)},m()(e,[{key:"trackInfo",get:function(){return"boolean"==typeof this._hasVideo&&"boolean"==typeof this._hasAudio?{hasVideo:this._hasVideo,hasAudio:this._hasAudio}:void 0}}]),e}();!function(e){e[e.H264_NAL_UNSPECIFIED=0]="H264_NAL_UNSPECIFIED",e[e.H264_NAL_SLICE=1]="H264_NAL_SLICE",e[e.H264_NAL_DPA=2]="H264_NAL_DPA",e[e.H264_NAL_DPB=3]="H264_NAL_DPB",e[e.H264_NAL_DPC=4]="H264_NAL_DPC",e[e.H264_NAL_IDR_SLICE=5]="H264_NAL_IDR_SLICE",e[e.H264_NAL_SEI=6]="H264_NAL_SEI",e[e.H264_NAL_SPS=7]="H264_NAL_SPS",e[e.H264_NAL_PPS=8]="H264_NAL_PPS",e[e.H264_NAL_AUD=9]="H264_NAL_AUD",e[e.H264_NAL_END_SEQUENCE=10]="H264_NAL_END_SEQUENCE",e[e.H264_NAL_END_STREAM=11]="H264_NAL_END_STREAM",e[e.H264_NAL_FILLER_DATA=12]="H264_NAL_FILLER_DATA",e[e.H264_NAL_SPS_EXT=13]="H264_NAL_SPS_EXT",e[e.H264_NAL_PREFIX=14]="H264_NAL_PREFIX",e[e.H264_NAL_SUB_SPS=15]="H264_NAL_SUB_SPS",e[e.H264_NAL_DPS=16]="H264_NAL_DPS",e[e.H264_NAL_RESERVED17=17]="H264_NAL_RESERVED17",e[e.H264_NAL_RESERVED18=18]="H264_NAL_RESERVED18",e[e.H264_NAL_AUXILIARY_SLICE=19]="H264_NAL_AUXILIARY_SLICE",e[e.H264_NAL_EXTEN_SLICE=20]="H264_NAL_EXTEN_SLICE",e[e.H264_NAL_DEPTH_EXTEN_SLICE=21]="H264_NAL_DEPTH_EXTEN_SLICE",e[e.H264_NAL_RESERVED22=22]="H264_NAL_RESERVED22",e[e.H264_NAL_RESERVED23=23]="H264_NAL_RESERVED23",e[e.H264_NAL_UNSPECIFIED24=24]="H264_NAL_UNSPECIFIED24",e[e.H264_NAL_UNSPECIFIED25=25]="H264_NAL_UNSPECIFIED25",e[e.H264_NAL_UNSPECIFIED26=26]="H264_NAL_UNSPECIFIED26",e[e.H264_NAL_UNSPECIFIED27=27]="H264_NAL_UNSPECIFIED27",e[e.H264_NAL_UNSPECIFIED28=28]="H264_NAL_UNSPECIFIED28",e[e.H264_NAL_UNSPECIFIED29=29]="H264_NAL_UNSPECIFIED29",e[e.H264_NAL_UNSPECIFIED30=30]="H264_NAL_UNSPECIFIED30",e[e.NAL_FF_IGNORE=267448321]="NAL_FF_IGNORE",e[e.PRIV_NAL_MAGIC_H264=31]="PRIV_NAL_MAGIC_H264"}(k||(k={}));var j,z,G=i(7),W=i(32),K=i.n(W);function Q(e){return{data:e,byteIndex:0,bitIndex:0}}function Y(e,t){if($(e)>t){var i=t%8;e.byteIndex=e.byteIndex+Math.floor(t/8)+Math.floor((e.bitIndex+i)/8),e.bitIndex=(e.bitIndex+i)%8}else e.byteIndex=e.data.byteLength-1,e.bitIndex=7}function X(e,t){if(t>32)throw new Error("len must be less 32");var i=e.data[e.byteIndex],n=Math.min(8-e.bitIndex,t),r=t-n;e.bitIndex+=n;var a=i>>8-e.bitIndex&Math.pow(2,n)-1;return 8===e.bitIndex&&(e.bitIndex=0,e.byteIndex++),r?a<<r|X(e,r):a}function q(e){return X(e,ee(e)+1)-1}function Z(e){var t=q(e);return Math.pow(-1,t+1)*Math.ceil(t/2)}function J(e){for(var t=0,i=0;i<8;i++){var n=X(e,8);if(t|=(127&n)<<7*i,!(128&n))break}return t}function $(e){return 8*(e.data.byteLength-e.byteIndex)-e.bitIndex}function ee(e){for(var t=$(e),i=0;i<t;i++)if(1===X(e,1))return 0===e.bitIndex?(e.byteIndex--,e.bitIndex=7):e.bitIndex--,i;return 0}!function(e){e[e.KEY_FRAME=0]="KEY_FRAME",e[e.INTER_FRAME=1]="INTER_FRAME",e[e.INTRA_ONLY_FRAME=2]="INTRA_ONLY_FRAME",e[e.SWITCH_FRAME=3]="SWITCH_FRAME"}(j||(j={})),function(e){e[e.AV1_OBU_SEQUENCE_HEADER=1]="AV1_OBU_SEQUENCE_HEADER",e[e.AV1_OBU_TEMPORAL_DELIMITER=2]="AV1_OBU_TEMPORAL_DELIMITER",e[e.AV1_OBU_FRAME_HEADER=3]="AV1_OBU_FRAME_HEADER",e[e.AV1_OBU_TILE_GROUP=4]="AV1_OBU_TILE_GROUP",e[e.AV1_OBU_METADATA=5]="AV1_OBU_METADATA",e[e.AV1_OBU_FRAME=6]="AV1_OBU_FRAME",e[e.AV1_OBU_REDUNDANT_FRAME_HEADER=7]="AV1_OBU_REDUNDANT_FRAME_HEADER",e[e.AV1_OBU_TILE_LIST=8]="AV1_OBU_TILE_LIST",e[e.AV1_OBU_PADDING=15]="AV1_OBU_PADDING"}(z||(z={}));var te=i(15),ie=function(){function e(){}return e.parse=function(e){var t=Q(e),i={seq_profile:X(t,3),seq_level_idx_0:0,seq_tier_0:0,high_bitdepth:0,twelve_bit:0,monochrome:0,chroma_subsampling_x:0,chroma_subsampling_y:0,chroma_sample_position:0,initial_presentation_delay_present:0,profile_string:"",level_string:"",chroma_format_string:"",bit_depth_luma:8,width:0,height:0,codec:"",color_info:{colorRange:te.b.AVCOL_RANGE_MPEG,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},buffer_delay_length_minus_1:0,frame_presentation_time_length_minus_1:0,frame_id_numbers_present_flag:0,reduced_still_picture_header:0,decoder_model_info_present_flag:0,equal_picture_interval:0,delta_frame_id_length_minus_2:0,additional_frame_id_length_minus_1:0,data:e};i.profile_string=function(e){switch(e){case 0:return"Main";case 1:return"High";case 2:return"Professional";default:return"Unknown"}}(i.seq_profile),X(t,1),i.reduced_still_picture_header=X(t,1);var n,r=0,a=0,s=[0],o=[],c=[0],u=[0],d=[0],_=[];if(i.reduced_still_picture_header)o[0]=X(t,5);else{X(t,1)&&(this.timingInfo(t,i),i.decoder_model_info_present_flag=X(t,1),i.decoder_model_info_present_flag&&this.decoderModelInfo(t,i)),r=X(t,1),a=X(t,5);for(var h=0;h<=a;h++)s[h]=X(t,12),o[h]=X(t,5),o[h]>7?c[h]=X(t,1):c[h]=0,i.decoder_model_info_present_flag?(u[h]=X(t,1),u[h]&&this.operatingParametersInfo(t,i,h)):u[h]=0,r&&(d[h]=X(t,1),d[h]&&(_[h]=X(t,4)))}i.seq_level_idx_0=o[0],i.seq_tier_0=c[0],i.level_string=2+((n=o[0])>>2)+"."+(3&n);var l=X(t,4),f=X(t,4),p=X(t,l+1),v=X(t,f+1);i.width=p+1,i.height=v+1,i.frame_id_numbers_present_flag=i.reduced_still_picture_header?0:X(t,1),i.frame_id_numbers_present_flag&&(i.delta_frame_id_length_minus_2=X(t,4),i.additional_frame_id_length_minus_1=X(t,3)),X(t,1),X(t,1),X(t,1);var m=0;return i.reduced_still_picture_header||(X(t,1),X(t,1),X(t,1),X(t,1),(m=X(t,1))&&(X(t,1),X(t,1)),(X(t,1)||X(t,1))&&X(t,1)||X(t,1),m&&X(t,3)),X(t,1),X(t,1),X(t,1),this.colorConfig(t,i),X(t,1),i.codec="av01."+i.seq_profile+"."+("0"+i.seq_level_idx_0).slice(-2)+(i.seq_tier_0?"H":"M")+"."+("0"+i.bit_depth_luma).slice(-2),i.chroma_format_string=function(e){return 0===e.chroma_subsampling_x&&0===e.chroma_subsampling_y?"4:4:4":1===e.chroma_subsampling_x&&0===e.chroma_subsampling_y?"4:2:2":1===e.chroma_subsampling_x&&1===e.chroma_subsampling_y?"4:2:0":"Unknown"}(i),i},e.timingInfo=function(e,t){X(e,32),X(e,32),t.equal_picture_interval=X(e,1),t.equal_picture_interval&&function(e){var t=ee(e);t>=32||X(e,t)}(e)},e.decoderModelInfo=function(e,t){t.buffer_delay_length_minus_1=X(e,5),t.num_units_in_decoding_tick=X(e,32),t.buffer_removal_time_length_minus_1=X(e,5),t.frame_presentation_time_length_minus_1=X(e,5)},e.operatingParametersInfo=function(e,t,i){var n=t.buffer_delay_length_minus_1+1;t.decoder_buffer_delay||(t.decoder_buffer_delay=[]),t.decoder_buffer_delay[i]=X(e,n),t.encoder_buffer_delay||(t.encoder_buffer_delay=[]),t.encoder_buffer_delay[i]=X(e,n),t.low_delay_mode_flag||(t.low_delay_mode_flag=[]),t.low_delay_mode_flag[i]=X(e,n)},e.colorConfig=function(e,t){t.high_bitdepth=X(e,1),2===t.seq_profile&&t.high_bitdepth?(t.twelve_bit=X(e,1),t.bit_depth_luma=t.twelve_bit?12:10):t.seq_profile<2&&(t.bit_depth_luma=t.high_bitdepth?10:8),1===t.seq_profile?t.monochrome=0:t.monochrome=X(e,1),X(e,1)?(t.color_info.colourPrimaries=X(e,8),t.color_info.transferCharacteristics=X(e,8),t.color_info.matrixCoefficients=X(e,8)):(t.color_info.colourPrimaries=te.a.AVCOL_PRI_UNSPECIFIED,t.color_info.transferCharacteristics=te.d.AVCOL_TRC_UNSPECIFIED,t.color_info.matrixCoefficients=te.c.AVCOL_SPC_UNSPECIFIED),t.chroma_subsampling_x=1,t.chroma_subsampling_y=1,t.monochrome?t.color_info.colorRange=X(e,1)+1:(t.color_info.colourPrimaries===te.a.AVCOL_PRI_BT709&&t.color_info.transferCharacteristics===te.d.AVCOL_TRC_IEC61966_2_1&&t.color_info.matrixCoefficients===te.c.AVCOL_SPC_RGB?(t.color_info.colorRange=1,t.chroma_subsampling_x=0,t.chroma_subsampling_y=0):(t.color_info.colorRange=X(e,1)+1,0===t.seq_profile?(t.chroma_subsampling_x=1,t.chroma_subsampling_y=1):1===t.seq_profile?(t.chroma_subsampling_x=0,t.chroma_subsampling_y=0):12===t.bit_depth_luma?(t.chroma_subsampling_x=X(e,1),t.chroma_subsampling_x?t.chroma_subsampling_y=X(e,1):t.chroma_subsampling_y=0):(t.chroma_subsampling_x=1,t.chroma_subsampling_y=0),t.chroma_subsampling_x&&t.chroma_subsampling_y&&X(e,2)),X(e,1))},e}();function ne(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function re(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(i),!0).forEach((function(t){K()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ne(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var ae=function(){function e(){}return e.createCtx=function(){return{seenFrameHeader:0,ref:[]}},e.parseOBU=function(e,t){for(var i=[],n=0;n<e.byteLength;){var r=e.subarray(n),a=this.parseOBUHeader(r),s=0,o=a.obu_extension_flag+1,c=Q(r);Y(c,8*o),s=a.obu_has_size_field?J(c):r.length-o;var u=c.byteIndex,d=re(re({},a),{},{data:r.subarray(0,u+s)});a.obu_type===z.AV1_OBU_SEQUENCE_HEADER?(d.content=ie.parse(d.data.subarray(u)),t.sh=d.content=ie.parse(d.data.subarray(u))):a.obu_type===z.AV1_OBU_FRAME_HEADER?(t.seenFrameHeader=0,this.frameHeaderOBU(d.data.subarray(u),t)):a.obu_type===z.AV1_OBU_REDUNDANT_FRAME_HEADER?t.seenFrameHeader=1:a.obu_type===z.AV1_OBU_TEMPORAL_DELIMITER?t.seenFrameHeader=0:a.obu_type===z.AV1_OBU_FRAME&&(t.seenFrameHeader=0,d.content=this.frameOBU(d.data.subarray(u),t)),i.push(d),n+=u+s}return i},e.parseOBUHeader=function(e){var t={obu_forbidden_bit:e[0]>>7,obu_type:e[0]>>3&15,obu_extension_flag:e[0]>>2&1,obu_has_size_field:e[0]>>1&1};return t.obu_extension_flag&&(t.temporal_id=e[1]>>5,t.spatial_id=e[1]>>3&3),t},e.frameHeaderOBU=function(e,t){var i=Q(e);t.seenFrameHeader?t.frame={keyframe:!1,show_existing_frame:0}:(t.seenFrameHeader=1,t.frame={keyframe:!1,show_existing_frame:0},this.uncompressedHeader(i,t),t.frame.show_existing_frame?t.seenFrameHeader=0:t.seenFrameHeader=1)},e.frameOBU=function(e,t){return this.frameHeaderOBU(e,t),t.frame},e.uncompressedHeader=function(e,t){var i=t.sh;if(i){var n=j.INTER_FRAME;if(i.reduced_still_picture_header)n=j.KEY_FRAME;else{if(1==X(e,1))return void X(e,3);n=X(e,2)}t.frame&&(t.frame.keyframe=n===j.KEY_FRAME)}},e.temporalPointInfo=function(e,t){X(e,t.frame_presentation_time_length_minus_1+1)},e}();function se(e){for(var t,i=e.byteLength,n=[],r=1,a=null;r<i-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;t=i-n.length,a=new Uint8Array(t);var s=0;for(r=0;r<t;s++,r++)s===n[0]&&(s++,n.shift()),a[r]=e[s];return a}var oe=function(){function e(){}return e.parse=function(e,t){for(var i=se(e),n=0,r=[];n<i.length-1;){var a=0,s=0,o=0;do{a=i[n],n++,s+=a}while(255===a);do{a=i[n],n++,o+=a}while(255===a);var c=i.subarray(n,n+o);r.push({type:s,data:c}),n+=o}return r},e}();function ce(e){switch(e){case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}}var ue=function(){function e(){}return e.parse=function(e){var t=Q(se(e));X(t,8);var i={pps_id:0,sps_id:0,cabac:0,pic_order_present:0,slice_group_count:0,mb_slice_group_map_type:0,ref_count:[],weighted_pred:0,weighted_bipred_idc:0,chroma_qp_index_offset:[],deblocking_filter_parameters_present:0,constrained_intra_pred:0,redundant_pic_cnt_present:0,transform_8x8_mode:0,data:new Uint8Array(e)};return i.pps_id=q(t),i.sps_id=q(t),i.cabac=X(t,1),i.pic_order_present=X(t,1),i.slice_group_count=q(t)+1,i.slice_group_count>1&&q(t),i.ref_count[0]=q(t)+1,i.ref_count[1]=q(t)+1,i.weighted_pred=X(t,1),i.weighted_bipred_idc=X(t,2),Z(t),Z(t),i.chroma_qp_index_offset[0]=Z(t),i.deblocking_filter_parameters_present=X(t,1),i.constrained_intra_pred=X(t,1),i.redundant_pic_cnt_present=X(t,1),i.transform_8x8_mode=0,i},e}(),de=function(){function e(){}return e.parse=function(t){var i=Q(se(t));Y(i,8);var n=X(i,8);Y(i,8);var r=X(i,8),a=q(i),s=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}(n),o=function(e){return(e/10).toFixed(1)}(r),c=1,u=8,d=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(c=q(i))&&X(i,1),u=q(i)+8,d=q(i)+8,X(i,1),X(i,1)))for(var _=3!==c?8:12,h=0;h<_;h++)X(i,1)&&(h<6?e._skipScalingList(i,16):e._skipScalingList(i,64));var l=q(i)+4,f=q(i),p=0,v=0,m=0,A=0,g=0,y=[];if(0===f)p=q(i)+4;else if(1===f){v=X(i,1),A=Z(i),g=Z(i),m=q(i);for(var E=0;E<m;E++)y[E]=Z(i)}var b=Math.max(2,q(i));X(i,1);var T=q(i)+1,S=q(i)+1,x=X(i,1);0===x&&X(i,1),X(i,1);var C=0,L=0,R=0,D=0;X(i,1)&&(C=q(i),L=q(i),R=q(i),D=q(i));var w=1,I=1,O=0,P=!0,k=0,N=0,M=te.b.AVCOL_RANGE_MPEG,B=2,V=0,F=0;if(X(i,1)){if(X(i,1)){var U=X(i,8);U>0&&U<16?(w=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][U-1],I=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][U-1]):255===U&&(w=X(i,8)<<8|X(i,8),I=X(i,8)<<8|X(i,8))}if(X(i,1)&&X(i,1),X(i,1)&&(X(i,3),M=X(i,1)?te.b.AVCOL_RANGE_JPEG:te.b.AVCOL_RANGE_MPEG,X(i,1)&&(B=X(i,8),V=X(i,8),F=X(i,8))),X(i,1)&&(q(i),q(i)),X(i,1)){var H=X(i,32),j=X(i,32);P=!!X(i,1),O=(k=j)/(N=2*H)}}var z=1;1===w&&1===I||(z=w/I);var G=0,W=0;0===c?(G=1,W=2-x):(G=3===c?1:2,W=(1===c?2:1)*(2-x));var K=16*T,J=16*S*(2-x);K-=(C+L)*G,J-=(R+D)*W;for(var $=Math.ceil(K*z),ee=t.subarray(1,4),ie="avc1.",ne=0;ne<3;ne++){var re=ee[ne].toString(16);re.length<2&&(re="0"+re),ie+=re}return{sps_id:a,profile_string:s,level_string:o,bit_depth_luma:u,bit_depth_chroma:d,chroma_format_idc:c,chroma_format_string:ce(c),frame_rate:{fixed:P,fps:O,fps_den:N,fps_num:k},sar_ratio:{width:w,height:I},codec_size:{width:K,height:J},present_size:{width:$,height:J},color_info:{colorRange:M,colourPrimaries:B,transferCharacteristics:V,matrixCoefficients:F},codec:ie,pic_order_cnt_type:f,log2_max_frame_num:l,log2_max_poc_lsb:p,frame_mbs_only_flag:x,delta_pic_order_always_zero_flag:v,num_ref_frames_in_pic_order_cnt_cycle:m,offset_for_ref_frame:y,offset_for_non_ref_pic:A,offset_for_top_to_bottom_field:g,ref_frame_count:b,data:new Uint8Array(t)}},e._skipScalingList=function(e,t){for(var i=8,n=8,r=0;r<t;r++)0!==n&&(n=(i+Z(e)+256)%256),i=0===n?i:n},e}(),_e={1:"Main",2:"Main 10",3:"Main Still Picture",4:"Rext"},he={30:"1",60:"2",63:"2.1",90:"3",93:"3.1",120:"4",123:"4.1",150:"5",153:"5.1",156:"5.2",180:"6",183:"6.1",186:"6.2",255:"8.5"},le=function(){function e(){}return e.parse=function(e){var t=Q(se(e));Y(t,16);var i={pps_id:q(t),sps_id:q(t),dependent_slice_segments_enabled_flag:X(t,1),output_flag_present_flag:X(t,1),num_extra_slice_header_bits:X(t,3),sign_data_hiding_enabled_flag:X(t,1),cabac_init_present_flag:X(t,1),num_ref_idx_l0_default_active:q(t)+1,num_ref_idx_l1_default_active:q(t)+1,init_qp_minus26:q(t),constrained_intra_pred_flag:X(t,1),transform_skip_enabled_flag:X(t,1),tiles_enabled_flag:0,entropy_coding_sync_enabled_flag:0,data:new Uint8Array(e)};return X(t,1)&&q(t),Z(t),Z(t),Y(t,4),i.tiles_enabled_flag=X(t,1),i.entropy_coding_sync_enabled_flag=X(t,1),i},e}(),fe=function(){function e(){}return e.parsePTL=function(e,t,i){if(!this._decodeProfileTierLevel(e,t.general_ptl)||$(e)<8+16*(i-1>0?1:0))return!1;var n;t.general_ptl.level_idc=X(e,8),t.general_ptl.level_string=(n=t.general_ptl.level_idc,he[n]),t.sub_layer_profile_present_flag=[],t.sub_layer_level_present_flag=[];for(var r=0;r<i-1;r++)t.sub_layer_profile_present_flag[r]=X(e,1),t.sub_layer_level_present_flag[r]=X(e,1);if(i-1>0)for(var a=i-1;a<8;a++)X(e,2);for(var s=0;s<i-1;s++){if(t.sub_layer_ptl[s]=this.getPTLCommon(),t.sub_layer_profile_present_flag[s]&&this._decodeProfileTierLevel(e,t.sub_layer_ptl[s]))return!1;if(t.sub_layer_level_present_flag[s]){if($(e)<8)return!1;t.sub_layer_ptl[s].level_idc=X(e,8)}}return!0},e.getPTL=function(){return{general_ptl:e.getPTLCommon(),sub_layer_ptl:[],sub_layer_profile_present_flag:[],sub_layer_level_present_flag:[]}},e.getPTLCommon=function(){return{profile_space:0,tier_flag:0,profile_idc:0,profile_compatibility:0,profile_compatibility_flag:[],constraint_indicator:[],level_idc:0,profile_string:"",level_string:""}},e._decodeProfileTierLevel=function(e,t){if($(e)<88)return!1;t.profile_space=X(e,2),t.tier_flag=X(e,1),t.profile_idc=X(e,5),t.profile_compatibility_flag=[];for(var i=0;i<32;i++)t.profile_compatibility_flag[i]=X(e,1),t.profile_compatibility=(t.profile_compatibility_flag[i]<<31-i)+t.profile_compatibility,0==t.profile_idc&&i>0&&t.profile_compatibility_flag[i]&&(t.profile_idc=i);for(var n=0;n<6;n++)t.constraint_indicator.push(X(e,8));var r;return t.profile_string=(r=t.profile_idc,_e[r]),!0},e}(),pe=[1,2,2,1],ve=[1,2,1,1],me=function(){function e(){}return e.parse=function(e,t){void 0===t&&(t=y.b.hevc);var i=Q(se(e)),n=fe.getPTL();Y(i,16);var r=X(i,4),a=X(i,3),s=a+1;Y(i,1);var o={vps_id:r,sps_id:0,chroma_format_idc:0,chroma_format_string:"",profile_string:"",level_string:"",bit_depth_luma:0,bit_depth_chroma:0,fps:0,width:0,height:0,conformance_window_flag:0,codec:"",color_info:{colorRange:te.b.AVCOL_RANGE_MPEG,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},min_spatial_segmentation_idc:0,log2_max_poc_lsb:0,separate_colour_plane_flag:0,log2_min_cb_size:0,log2_diff_max_min_coding_block_size:0,log2_min_tb_size:0,log2_max_trafo_size:0,log2_ctb_size:0,ctb_width:0,ctb_height:0,temporal_layer:[],ptl:n,data:new Uint8Array(e)};if(!fe.parsePTL(i,n,s))return o;if(o.sps_id=q(i),o.sps_id>=16)return o;var c=q(i);if(3==c&&X(i,1)&&(c=0),o.width=q(i),o.height=q(i),o.conformance_window_flag=X(i,1),o.conformance_window_flag){var u=ve[c],d=pe[c];o.conf_win_left_offset=q(i),o.conf_win_right_offset=q(i),o.conf_win_top_offset=q(i),o.conf_win_bottom_offset=q(i),o.width=o.width-(o.conf_win_left_offset+o.conf_win_right_offset)*d,o.height=o.height-(o.conf_win_top_offset+o.conf_win_bottom_offset)*u}o.bit_depth_luma=q(i)+8,o.bit_depth_chroma=q(i)+8,o.log2_max_poc_lsb=q(i)+4;for(var _=X(i,1)?0:a;_<=a;_++)o.temporal_layer.push({max_dec_pic_buffering:q(i)+1}),q(i),q(i);o.log2_min_cb_size=q(i)+3,o.log2_diff_max_min_coding_block_size=q(i),t!==y.b.kvc4&&t!==y.b.kvc5&&t!==y.b.kvc6||q(i),t!==y.b.kvc3&&t!==y.b.kvc4&&t!==y.b.kvc5&&t!==y.b.kvc6||q(i)&&(q(i),q(i)),o.log2_min_tb_size=q(i)+2;var h=q(i);o.log2_max_trafo_size=h+o.log2_min_tb_size,q(i),q(i),X(i,1)&&X(i,1)&&this.skipScalingListData(i),X(i,1),X(i,1),X(i,1)&&(X(i,4),X(i,4),q(i),q(i),X(i,1));var l=q(i);if(l>64)return o;for(var f=[],p=0;p<l;p++)if(this.parseRps(i,p,l,f)<0)return o;if(X(i,1)){var v=q(i);if(v>31)return o;for(_=0;_<v;_++)X(i,Math.min(o.log2_max_poc_lsb,16)),X(i,1)}return X(i,1),X(i,1),X(i,1)&&this.hvccParseVui(i,o,a),o.log2_ctb_size=o.log2_min_cb_size+o.log2_diff_max_min_coding_block_size,o.ctb_width=o.width+(1<<o.log2_ctb_size)-1>>o.log2_ctb_size,o.ctb_height=o.height+(1<<o.log2_ctb_size)-1>>o.log2_ctb_size,o.chroma_format_idc=c,o.chroma_format_string=3===c?"4:4:4":"4:2:0",o.profile_string=n.general_ptl.profile_string,o.level_string=n.general_ptl.level_string,o.codec=this.getCodec(n.general_ptl,t),o},e.getCodec=function(e,t){void 0===t&&(t=y.b.hevc);for(var i=e.profile_compatibility.toString(16);i.length>1;){var n=i.length-1;if("0"!==i.charAt(n))break;i=i.slice(0,n)}for(var r="",a=!1,s=5;s>=0;s--)(e.constraint_indicator[s]||a)&&(r="."+e.constraint_indicator[s].toString(16)+r,a=!0);return(t===y.b.hevc?"hev1":t)+"."+["","A","B","C"][e.profile_space]+e.profile_idc+"."+i+"."+(0===e.tier_flag?"L":"H")+e.level_idc+r},e.getGeneralPTL=function(){return{profile_space:0,tier_flag:0,profile_idc:0,profile_compatibility:0,profile_compatibility_flag:[],constraint_indicator:[],level_idc:0,profile_string:"",level_string:""}},e.skipScalingListData=function(e){var t,i,n,r;for(t=0;t<4;t++)for(i=0;i<(3==t?2:6);i++)if(X(e,1))for(r=Math.min(64,1<<4+(t<<1)),t>1&&Z(e),n=0;n<r;n++)Z(e);else q(e)},e.parseRps=function(e,t,i,n){var r;if(t&&X(e,1)){if(t>=i)return-1;for(X(e,1),q(e),n[t]=0,r=0;r<=n[t-1];r++){var a=0,s=X(e,1);s||(a=X(e,1)),(s||a)&&n[t]++}}else{var o=q(e),c=q(e);if(2*(c+o)>$(e))return-1;for(n[t]=o+c,r=0;r<o;r++)q(e),X(e,1);for(r=0;r<c;r++)q(e),X(e,1)}return 0},e.hvccParseVui=function(e,t,i){var n;X(e,1)&&255===X(e,8)&&X(e,32),X(e,1)&&X(e,1),X(e,1)&&(X(e,3),X(e,1),X(e,1)&&(t.color_info.colourPrimaries=X(e,8),t.color_info.transferCharacteristics=X(e,8),t.color_info.matrixCoefficients=X(e,8))),X(e,1)&&(q(e),q(e)),X(e,3),X(e,1)&&(q(e),q(e),q(e),q(e)),X(e,1)&&(this.parseTimingInfo(e,t),X(e,1)&&this.skipHrdParameters(e,1,i)),X(e,1)&&(X(e,3),n=q(e),t.min_spatial_segmentation_idc=Math.min(t.min_spatial_segmentation_idc,n),q(e),q(e),q(e),q(e))},e.parseTimingInfo=function(e,t){var i=X(e,32),n=X(e,32);t.fps=n/i||0,X(e,1)&&q(e)},e.skipHrdParameters=function(e,t,i){var n,r=0,a=0,s=0;for(t&&(a=X(e,1),s=X(e,1),(a||s)&&((r=X(e,1))&&X(e,19),X(e,8),r&&X(e,4),X(e,15))),n=0;n<=i;n++){var o=0,c=0,u=0;if(X(e,1)||(u=X(e,1)),u?q(e):c=X(e,1),!c&&(o=q(e))>31)return-1;a&&this._skipSubLayerHrdParameters(e,o,r),s&&this._skipSubLayerHrdParameters(e,o,r)}return 0},e._skipSubLayerHrdParameters=function(e,t,i){var n;for(n=0;n<=t;n++)q(e),q(e),i&&(q(e),q(e)),X(e,1)},e}(),Ae=function(){function e(){}return e.parse=function(e){var t=Q(se(e));Y(t,16);var i={vps_id:X(t,4),fps:0,ptl:fe.getPTL(),data:new Uint8Array(e)};if(i.vps_id>=16)return a.b.i("vps-parser","VPS id out of range:",i.vps_id),i;if(3!==X(t,2))return a.b.i("vps-parser","vps_reserved_three_2bits is not three"),i;Y(t,6);var n=X(t,3);if(Y(t,1),65535!=X(t,16))return a.b.i("vps-parser","vps_reserved_ffff_16bits is not 0xffff\n"),i;if(n>7)return a.b.i("vps-parser","vps_max_sub_layers out of range: ",n),i;if(!fe.parsePTL(t,i.ptl,n))return i;for(var r=X(t,1)?0:n-1;r<n;r++)q(t),q(t),q(t);var s=X(t,6),o=q(t)+1;if(o<1||o>1024||(o-1)*(s+1)>$(t))return a.b.i("vps-parser","too many layer_id_included_flags"),i;for(r=1;r<o;r++)for(var c=0;c<=s;c++)X(t,1);if(X(t,1)){var u=X(t,32),d=X(t,32);i.fps=d/u||0}return i},e}(),ge=[y.b.hevc,y.b.kvc3,y.b.kvc4,y.b.kvc5,y.b.kvc6],ye=[y.b.vvc,y.b.bvc2,y.b.kvc30];function Ee(e){return!!e&&ge.indexOf(e)>=0}var be,Te=i(17),Se=function(){function e(){}return e.parse=function(e){var t=Q(se(e));Y(t,16);var i={data:new Uint8Array(e),pps_id:X(t,6),sps_id:X(t,4),width:0,height:0};X(t,1),i.width=q(t),i.height=q(t),X(t,1)&&(i.pps_conf_win_left_offset=q(t),i.pps_conf_win_right_offset=q(t),i.pps_conf_win_top_offset=q(t),i.pps_conf_win_bottom_offset=q(t)),X(t,1)&&(Z(t),Z(t),Z(t),Z(t)),X(t,1);var n=X(t,1);if(X(t,1)){var r=0;n||(r=q(t));for(var a=q(t),s=0;s<=r;s++)Y(t,a+1)}return i},e}(),xe={0:"NONE",8:"INTRA",64:"STILL_PICTURE",1:"MAIN_10",65:"MAIN_10_STILL_PICTURE",17:"MULTILAYER_MAIN_10",81:"MULTILAYER_MAIN_10_STILL_PICTURE",33:"MAIN_10_444",97:"MAIN_10_444_STILL_PICTURE",49:"MULTILAYER_MAIN_10_444",113:"MULTILAYER_MAIN_10_444_STILL_PICTURE",2:"MAIN_12",34:"MAIN_12_444",35:"MAIN_16_444",10:"MAIN_12_INTRA",42:"MAIN_12_444_INTRA",43:"MAIN_16_444_INTRA",66:"MAIN_12_STILL_PICTURE",98:"MAIN_12_444_STILL_PICTURE",99:"MAIN_16_444_STILL_PICTURE"},Ce={16:"1.0",32:"2.0",35:"2.1",48:"3.0",51:"3.1",64:"4.0",67:"4.1",80:"5.0",83:"5.1",86:"5.2",96:"6.0",99:"6.1",102:"6.2",105:"6.3"},Le=function(){function e(){}return e.parse=function(e){var t=Q(se(e));Y(t,16);var i={data:new Uint8Array(e),sps_id:X(t,4),vps_id:X(t,4),max_sublayers_minus1:X(t,3),chroma_format_idc:X(t,2),chroma_format_string:"",level_idc:0,level_string:"",profile_idc:0,profile_string:"",width:0,height:0,bitdepth:8,fps:0,general_nal_hrd_params_present_flag:0,general_vcl_hrd_params_present_flag:0,general_du_hrd_params_present_flag:0,hrd_cpb_cnt_minus1:0,sps_num_ref_pic_lists:[],sps_long_term_ref_pics_flag:0,sps_inter_layer_prediction_enabled_flag:0,sps_log2_max_pic_order_cnt_lsb_minus4:0,sps_weighted_pred_flag:0,sps_weighted_bipred_flag:0,codec:"vvc",color_info:{colorRange:te.b.AVCOL_RANGE_MPEG,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0}};i.chroma_format_string=function(e){switch(e){case 0:return"Monochrome";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}}(i.chroma_format_idc);var n=1<<X(t,2)+5,r=X(t,1);if(r&&this._profileTierLevel(t,i,1,i.max_sublayers_minus1),X(t,1),X(t,1)&&Y(t,1),i.width=q(t),i.height=q(t),X(t,1)&&(i.conf_win_left_offset=q(t),i.conf_win_right_offset=q(t),i.conf_win_top_offset=q(t),i.conf_win_bottom_offset=q(t)),X(t,1)){var a=Math.floor(i.width/n)+1,s=Math.floor(i.height/n)+1,o=q(t),c=0,u=0;o>0&&(u=X(t,1),c=X(t,1));for(var d=0;o>0&&d<=o;d++)c&&0!==d||(d>0&&i.width>n&&Y(t,a),d>0&&i.height>n&&Y(t,s),d<o&&i.width>n&&Y(t,a),d<o&&i.height>n&&Y(t,s)),u||(Y(t,1),Y(t,1));var _=q(t);if(X(t,1)&&X(t,1))for(var h=0;h<=o;h++)Y(t,_+1)}if(i.bitdepth=q(t)+8,X(t,1),X(t,1),i.sps_log2_max_pic_order_cnt_lsb_minus4=X(t,4),X(t,1)&&q(t),Y(t,8*X(t,2)),Y(t,8*X(t,2)),r){var l=0;i.max_sublayers_minus1>0&&(l=X(t,1)),this._dpbParameters(t,i.max_sublayers_minus1,l)}q(t),X(t,1),q(t),0!=q(t)&&(q(t),q(t));var f=0;0!=i.chroma_format_idc&&(f=X(t,1)),f&&(q(t),0!=q(t)&&(q(t),q(t))),q(t),0!=q(t)&&(q(t),q(t));var p=0;n>32&&(p=X(t,1));var v=X(t,1);v&&(q(t),Y(t,1)),X(t,1)&&Y(t,2);var m=X(t,1);if(0!=i.chroma_format_idc)for(var A=X(t,1),g=X(t,1)?1:A?3:2,y=[],E=0;E<g;E++){Z(t),y[E]=q(t);for(var b=0;b<=y[E];b++)q(t),q(t)}X(t,1),X(t,1)&&0!=i.chroma_format_idc&&Y(t,1),X(t,1),i.sps_weighted_pred_flag=X(t,1),i.sps_weighted_bipred_flag=X(t,1),i.sps_long_term_ref_pics_flag=X(t,1),i.vps_id>0&&(i.sps_inter_layer_prediction_enabled_flag=X(t,1)),X(t,1);for(var T=X(t,1),S=0;S<(T?1:2);S++){i.sps_num_ref_pic_lists[S]=q(t);for(var x=0;x<i.sps_num_ref_pic_lists[S];x++)this._refPicListStruct(t,i,S,x)}X(t,1),X(t,1)&&Y(t,1);var C=X(t,1);X(t,1)&&Y(t,1),X(t,1),X(t,1)&&Y(t,1),X(t,1)&&Y(t,1);var L=6-q(t);X(t,1),X(t,1)&&(q(t),Y(t,1),C&&Y(t,1),X(t,1)&&Y(t,1)),X(t,1),X(t,1),L>=2&&X(t,1)&&L>=3&&q(t),q(t),X(t,1),X(t,1),X(t,1),0!=i.chroma_format_idc&&Y(t,1),1===i.chroma_format_idc&&Y(t,2);var R=X(t,1),D=0;if(3!==i.chroma_format_idc||p||(D=X(t,1)),(v||R)&&q(t),X(t,1)&&q(t),X(t,1)){var w=X(t,2);Z(t);for(var I=0;I<w+1;I++)Z(t),q(t)}var O=X(t,1);m&&O&&Y(t,1);var P=0;if(D&&O&&(P=X(t,1)),P&&Y(t,1),X(t,1),X(t,1),X(t,1)&&X(t,1)){for(var k=q(t),N=0;N<k;N++)q(t);for(var M=q(t),B=0;B<M;B++)q(t)}if(r&&X(t,1)){this._generalTimingHrdParameters(t,i);var V=0;i.max_sublayers_minus1>0&&(V=X(t,1));var F=V?0:i.max_sublayers_minus1;this._olsTimingHrdParameters(t,i,F)}if(X(t,1),X(t,1)){var U=q(t);t.bitIndex&&Y(t,8-t.bitIndex),this._vuiPayload(t,i,U+1)}return i},e._profileTierLevel=function(e,t,i,n){var r,a;i&&(t.profile_idc=X(e,7),t.profile_string=(r=t.profile_idc,xe[r]),Y(e,1)),t.level_idc=X(e,8),t.level_string=(a=t.level_idc,Ce[a]),Y(e,2),i&&this._generalConstraintsInfo(e);for(var s=[],o=n-1;o>=0;o--)s[o]=X(e,1);e.bitIndex&&Y(e,8-e.bitIndex);for(var c=n-1;c>=0;c--)s[c]&&Y(e,1);if(i)for(var u=X(e,8),d=0;d<u;d++)Y(e,32)},e._generalConstraintsInfo=function(e){if(X(e,1)){Y(e,71);var t=X(e,8),i=0;t>5&&(Y(e,6),i=6),t>i&&Y(e,t-i)}e.bitIndex&&Y(e,8-e.bitIndex)},e._dpbParameters=function(e,t,i){for(var n=i?0:t;n<=t;n++)q(e),q(e),q(e)},e._refPicListStruct=function(e,t,i,n){var r=q(e),a=0;t.sps_long_term_ref_pics_flag&&n<t.sps_num_ref_pic_lists[i]&&r>0&&(a=X(e,1));for(var s=0;s<r;s++){var o=0;if(t.sps_inter_layer_prediction_enabled_flag&&(o=X(e,1)),o)q(e);else{var c=0;if(t.sps_long_term_ref_pics_flag&&(c=X(e,1)),c){var u=q(e);((t.sps_weighted_pred_flag||t.sps_weighted_bipred_flag)&&0!=s?u:u+1)&&Y(e,1)}else a&&Y(e,t.sps_log2_max_pic_order_cnt_lsb_minus4+4)}}},e._generalTimingHrdParameters=function(e,t){var i=X(e,32),n=X(e,32);t.fps=n/i||0,t.general_nal_hrd_params_present_flag=X(e,1),t.general_vcl_hrd_params_present_flag=X(e,1),(t.general_nal_hrd_params_present_flag||t.general_vcl_hrd_params_present_flag)&&(X(e,1),t.general_du_hrd_params_present_flag=X(e,1),t.general_du_hrd_params_present_flag&&Y(e,8),Y(e,8),t.general_du_hrd_params_present_flag&&Y(e,4),t.hrd_cpb_cnt_minus1=q(e))},e._olsTimingHrdParameters=function(e,t,i){for(var n=i;n<=t.max_sublayers_minus1;n++){var r=0;X(e,1)||(r=X(e,1)),r?q(e):(t.general_nal_hrd_params_present_flag||t.general_vcl_hrd_params_present_flag)&&0===t.hrd_cpb_cnt_minus1&&Y(e,1),t.general_nal_hrd_params_present_flag&&this._sublayerHrdParameters(e,t,n),t.general_vcl_hrd_params_present_flag&&this._sublayerHrdParameters(e,t,n)}},e._sublayerHrdParameters=function(e,t,i){for(var n=0;n<=t.hrd_cpb_cnt_minus1;n++)q(e),q(e),t.general_du_hrd_params_present_flag&&(q(e),q(e)),Y(e,1)},e._vuiPayload=function(e,t,i){var n=X(e,1),r=X(e,1);X(e,1),X(e,1),X(e,1)&&255===X(e,8)&&X(e,32),X(e,1)&&X(e,1),X(e,1)&&(t.color_info.colourPrimaries=X(e,8),t.color_info.transferCharacteristics=X(e,8),t.color_info.matrixCoefficients=X(e,8),t.color_info.colorRange=X(e,1)?te.b.AVCOL_RANGE_JPEG:te.b.AVCOL_RANGE_MPEG),X(e,1)&&(n&&!r||q(e),q(e))},e}(),Re=function(){function e(){}return e.parse=function(e){var t=Q(se(e));return Y(t,16),{vps_id:X(t,4),data:new Uint8Array(e)}},e}(),De=function(){function e(){}return e.parseAV1C=function(e,t){var i,n=null==(i=ae.parseOBU(e.subarray(4),t)[0])?void 0:i.content;if(n)return{marker:e[0]>>7&1,version:127&e[0],seq_profile:e[1]>>5&7,seq_level_idx_0:31&e[1],seq_tier_0:e[2]>>7&1,high_bitdepth:e[2]>>6&1,twelve_bit:e[2]>>5&1,monochrome:e[2]>>4&1,chroma_subsampling_x:e[2]>>3&1,chroma_subsampling_y:e[2]>>2&1,chroma_sample_position:3&e[2],initial_presentation_delay_present:e[3]>>4&1,sh:n}},e.parseAVCC=function(e){var t=e[0],i=e[1],n=e[2],r=e[3];if(1===t&&0!==i){var s=1+(3&e[4]);if(3===s||4===s){var o=31&e[5];if(0!==o){o>1&&a.b.w("video-config","H264 SPS count: "+o);for(var c,u,d=6,_=[],h=[],l=0;l<o;l++){var f=Object(b.e)(e,d);if(d+=2,0!==f){var p=e.subarray(d,d+f);d+=f,_[(c=de.parse(p)).sps_id]=c}}var v=e[d];if(0!==v){v>1&&a.b.w("video-config","H264 PPS count: "+v),d++;for(var m=0;m<v;m++){var A=Object(b.e)(e,d);d+=2;var g=e.subarray(d,d+A);h[(u=ue.parse(g)).pps_id]=u,0!==A&&(d+=A)}return{version:t,avcProfile:i,profileCompatibility:n,avcLevel:r,naluLengthSize:s,paramSets:{spsList:_,ppsList:h,sps:c,pps:u}}}a.b.e("video-config","Invalid H264 PPS count: "+v)}else a.b.e("video-config","Invalid H264 SPS count: "+o)}else a.b.e("video-config","MP4: Strange NaluLengthSizeMinusOne: "+(s-1))}else a.b.e("video-config","Invalid AVCDecoderConfigurationRecord")},e.parseHVCC=function(e,t){void 0===t&&(t=y.b.hevc);var i=22;i++;for(var n,r,s,o,c=[],u=[],d=[];i<e.byteLength;){var _=63&e[i];if(i+=1,e.byteLength-i<=2)break;var h=Object(b.e)(e,i);i+=2;for(var l=0;l<h&&!(e.byteLength-i<=2);l++){var f=Object(b.e)(e,i);if(i+=2,0!==f){var p=e.subarray(i,i+f);if(p.byteLength!==f)break;_===G.a.HEVC_NAL_VPS?(a.b.v("video-config","VPS lengh "+f),d[(s=Ae.parse(p)).vps_id]=s):_===G.a.HEVC_NAL_SPS?(a.b.v("video-config","SPS lengh "+f),c[(n=me.parse(p,t)).sps_id]=n):_===G.a.HEVC_NAL_PPS?(a.b.v("video-config","PPS lengh "+f),u[(r=le.parse(p)).pps_id]=r):_===G.a.HEVC_NAL_SEI_PREFIX||_===G.a.HEVC_NAL_SEI_SUFFIX?(a.b.i("video-config","sei "+_+" in hvcc"),o||(o=[]),o.push({type:_,data:p})):a.b.i("video-config","found "+_+" nalu in hvcc."),i+=f}}}return{paramSets:{vpsList:d,spsList:c,ppsList:u,seiList:o,sps:n,pps:r}}},e._vvcPTLRecord=function(e,t,i){t+=3+(63&e[t]);var n=Q(e);n.byteIndex=t;for(var r=[],a=i-2;a>=0;a--)r[a]=X(n,1);for(var s=i;s<=8&&i>1;s++)Y(n,1);for(var o=i-2;o>=0;o--)r[o]&&Y(n,8);return t=n.byteIndex,t+(1+4*e[n.byteIndex])},e.parseVvcC=function(e,t){void 0===t&&(t=y.b.vvc);var i=4,n=(e[i],1&e[i]);if(i++,n){var r=e[++i]>>4&7;i+=2,i=this._vvcPTLRecord(e,i,r),i+=6}e[i],i++;for(var s,o,c,u=[],d=[],_=[];i<e.byteLength;){var h=31&e[i];i+=1;var l=1;h!==Te.a.VVC_NAL_UNIT_DCI&&h!==Te.a.VVC_NAL_UNIT_OPI&&(l=Object(b.e)(e,i),i+=2);for(var f=0;f<l;f++){var p=Object(b.e)(e,i);i+=2;var v=e.subarray(i,i+p);if(v.byteLength!==p)break;i+=p,h===Te.a.VVC_NAL_UNIT_VPS?(a.b.v("video-config","VPS lengh "+p),c=Re.parse(v),_.push(c)):h===Te.a.VVC_NAL_UNIT_SPS?(a.b.v("video-config","SPS lengh "+p),s=Le.parse(v),u.push(s)):h===Te.a.VVC_NAL_UNIT_PPS&&(a.b.v("video-config","PPS lengh "+p),o=Se.parse(v),d.push(o))}}return{paramSets:{vpsList:_,spsList:u,ppsList:d,sps:s,pps:o}}},e.parseBV2C=function(e,t){void 0===t&&(t=y.b.bvc2);var i=18;e[i],i++;for(var n,r,s,o=[],c=[],u=[];i<e.byteLength;){var d=31&e[i];i+=1;var _=1;d!==Te.a.VVC_NAL_UNIT_DCI&&d!==Te.a.VVC_NAL_UNIT_OPI&&(_=Object(b.e)(e,i),i+=2);for(var h=0;h<_;h++){var l=Object(b.e)(e,i);i+=2;var f=e.subarray(i,i+l);if(f.byteLength!==l)break;i+=l,d===Te.a.VVC_NAL_UNIT_VPS?(a.b.v("video-config","VPS lengh "+l),s=Re.parse(f),u.push(s)):d===Te.a.VVC_NAL_UNIT_SPS?(a.b.v("video-config","SPS lengh "+l),n=Le.parse(f),o.push(n)):d===Te.a.VVC_NAL_UNIT_PPS&&(a.b.v("video-config","PPS lengh "+l),r=Se.parse(f),c.push(r))}}return{paramSets:{vpsList:u,spsList:o,ppsList:c,sps:n,pps:r}}},e.parseKvLC=function(e,t){void 0===t&&(t=y.b.bvc2);var i=4;e[i],e[i],e[++i],i++;for(var n,r,s,o=[],c=[],u=[];i<e.byteLength;){var d=31&e[i];i+=1;var _=1;d!==Te.a.VVC_NAL_UNIT_DCI&&d!==Te.a.VVC_NAL_UNIT_OPI&&(_=Object(b.e)(e,i),i+=2);for(var h=0;h<_;h++){var l=Object(b.e)(e,i);i+=2;var f=e.subarray(i,i+l);if(f.byteLength!==l)break;i+=l,d===Te.a.VVC_NAL_UNIT_VPS?(a.b.v("video-config","VPS lengh "+l),s=Re.parse(f),u.push(s)):d===Te.a.VVC_NAL_UNIT_SPS?(a.b.v("video-config","SPS lengh "+l),n=Le.parse(f),o.push(n)):d===Te.a.VVC_NAL_UNIT_PPS&&(a.b.v("video-config","PPS lengh "+l),r=Se.parse(f),c.push(r))}}return{paramSets:{vpsList:u,spsList:o,ppsList:c,sps:n,pps:r}}},e.generateAV1C=function(e){var t=new Uint8Array(5+e.data.length);return t[0]=129,t[1]=(e.seq_profile<<5)+(31&e.seq_level_idx_0),t[2]=(e.seq_tier_0<<7)+(e.high_bitdepth<<6)+(e.twelve_bit<<5)+(e.monochrome<<4)+(e.chroma_subsampling_x<<3)+(e.chroma_subsampling_y<<2)+(3&e.chroma_sample_position),t[3]=0,t[4]=8,t.set(e.data,5),t},e.generateAVCC=function(e){if(e.sps&&e.pps&&e.spsList.length&&e.ppsList.length){var t=e.spsList.filter((function(e){return!!e})),i=e.ppsList.filter((function(e){return!!e})),n=t.reduce((function(e,t){return e+t.data.byteLength}),0),r=i.reduce((function(e,t){return e+t.data.byteLength}),0),a=new Uint8Array(7+n+r+2*t.length+2*i.length);a.set([1,e.sps.data[1],e.sps.data[2],e.sps.data[3],255,224|t.length],0);var s=6;return t.forEach((function(e){a[s]=e.data.byteLength>>8&255,a[s+1]=255&e.data.byteLength,a.set(e.data,s+2),s+=2+e.data.byteLength})),a[s]=i.length,s++,i.forEach((function(e){a[s]=e.data.byteLength>>8&255,a[s+1]=255&e.data.byteLength,a.set(e.data,s+2),s+=2+e.data.byteLength})),a}},e.generateHVCC=function(e){if(e.sps&&e.pps&&e.spsList.length&&e.ppsList.length&&e.vpsList.length){var t=e.spsList.filter((function(e){return!!e})),i=e.ppsList.filter((function(e){return!!e})),n=e.vpsList.filter((function(e){return!!e})),r=t.reduce((function(e,t){return e+t.data.byteLength}),0)+i.reduce((function(e,t){return e+t.data.byteLength}),0)+n.reduce((function(e,t){return e+t.data.byteLength}),0)+2*(t.length+i.length+n.length),a=e.sps.ptl,s=new Uint8Array(32+r),o=new DataView(s.buffer,0);s[0]=1,s[1]=(192&a.general_ptl.profile_space)+((1&a.general_ptl.tier_flag)<<5)+a.general_ptl.profile_idc&31,o.setUint32(2,a.general_ptl.profile_compatibility);for(var c=0;c<6;c++)o.setUint8(c+6,a.general_ptl.constraint_indicator[c]||0);o.setUint8(12,a.general_ptl.level_idc);var u=1;e.pps.entropy_coding_sync_enabled_flag&&e.pps.tiles_enabled_flag?u=0:e.pps.entropy_coding_sync_enabled_flag?u=3:e.pps.tiles_enabled_flag&&(u=2),s[13]=240+(3840&e.sps.min_spatial_segmentation_idc),s[14]=255&e.sps.min_spatial_segmentation_idc,s[15]=252+(3&u),s[16]=252+(3&e.sps.chroma_format_idc),s[17]=248+(e.sps.bit_depth_luma-8&7),s[18]=248+(e.sps.bit_depth_chroma-8&7),s[21]=3,s[22]=3;var d=23;return[{nalus:n,type:G.a.HEVC_NAL_VPS},{nalus:t,type:G.a.HEVC_NAL_SPS},{nalus:i,type:G.a.HEVC_NAL_PPS}].forEach((function(e){s[d]=e.type,d++,o.setUint16(d,e.nalus.length),d+=2,e.nalus.forEach((function(e){o.setUint16(d,e.data.byteLength),d+=2,s.set(e.data,d),d+=e.data.byteLength}))})),s}},e.hevDecoderConfigToSample=function(t,i){return{units:e.hevDecoderConfigToNalu(t),dts:0,cts:0,pts:0,originDTS:i,key:!1}},e.hevDecoderConfigToNalu=function(e){var t=[];return e.seiList&&e.seiList.forEach((function(e){e&&t.push(e)})),e.vpsList.forEach((function(e){e&&t.push({type:G.a.HEVC_NAL_VPS,data:e.data})})),e.spsList.forEach((function(e){e&&t.push({type:G.a.HEVC_NAL_SPS,data:e.data})})),e.ppsList.forEach((function(e){e&&t.push({type:G.a.HEVC_NAL_PPS,data:e.data})})),t},e.vvcDecoderConfigToNalu=function(e){var t=[];return e.vpsList.forEach((function(e){e&&t.push({type:Te.a.VVC_NAL_UNIT_VPS,data:e.data})})),e.spsList.forEach((function(e){e&&t.push({type:Te.a.VVC_NAL_UNIT_SPS,data:e.data})})),e.ppsList.forEach((function(e){e&&t.push({type:Te.a.VVC_NAL_UNIT_PPS,data:e.data})})),t},e.avcDecoderConfigToNalu=function(e){var t=[];return e.spsList.forEach((function(e){e&&t.push({type:k.H264_NAL_SPS,data:e.data})})),e.ppsList.forEach((function(e){e&&t.push({type:k.H264_NAL_PPS,data:e.data})})),t},e.vvcDecoderConfigToSample=function(t,i){return{units:e.vvcDecoderConfigToNalu(t),dts:0,cts:0,pts:0,originDTS:i,key:!1}},e.getDPB264=function(e){return e.sps?Math.min(Math.max(e.sps.ref_frame_count,2),16):16},e.getDPBHEVC=function(e){if(!e.sps)return 16;var t=e.sps.temporal_layer.reduce((function(e,t){return Math.max(t.max_dec_pic_buffering,e)}),2);return Math.min(t,16)},e.getDPBLenAV1=function(e){return 8},e}(),we=function(){function e(){}return e.updateAV1Track=function(e,t,i){t&&(e.width=t.width,e.height=t.height,e.codec=t.codec,e.profile=t.profile_string,e.level=t.level_string,e.chromaFormat=t.chroma_format_string,e.bitDepth=t.bit_depth_luma,e.colorInfo=t.color_info,e.dpb=De.getDPBLenAV1(t),e.decConf=i||De.generateAV1C(t))},e.onAV1Detected=function(e,t,i){return a.b.i("video-track-helper","detected av1: "+i.av1),i.av1?(e.outputRaw=!i.av1,e.active=!0):(a.b.i("video-track-helper","AV1 found, disabled."),e.active=!1),e.active},e.updateAVCTrack=function(e,t,i){if(t.sps){var n=t.sps;e.width=n.codec_size.width,e.height=n.codec_size.height,e.pixelRatio=[n.sar_ratio.width,n.sar_ratio.height],n.frame_rate.fixed&&0!==n.frame_rate.fps&&(e.fps=n.frame_rate.fps,e.sampleDuration=e.inputTimescale/e.fps),e.codec=n.codec,e.profile=n.profile_string,e.level=n.level_string,e.chromaFormat=n.chroma_format_string,e.bitDepth=n.bit_depth_luma,e.colorInfo=n.color_info,e.dpb=De.getDPB264(t),e.fps&&(e.sampleDuration=Math.floor(e.timescale/e.fps)),e.decConf=i||De.generateAVCC(t)}},e.updateHEVCTrack=function(e,t,i){if(t.sps){var n=t.sps,r=t.vps;e.width=n.width,e.height=n.height,e.codec=n.codec,e.profile=n.profile_string||(null==r?void 0:r.ptl.general_ptl.profile_string)||"",e.level=n.level_string||(null==r?void 0:r.ptl.general_ptl.level_string)||"",e.chromaFormat=n.chroma_format_string,e.bitDepth=n.bit_depth_luma,e.fps=n.fps||(null==r?void 0:r.fps)||0,e.colorInfo=n.color_info,e.dpb=De.getDPBHEVC(t),e.decConf=i||De.generateHVCC(t)}},e.updateVVCTrack=function(e,t,i){if(t.sps){var n=t.sps;t.vps,e.width=n.width,e.height=n.height,e.codec=n.codec,e.profile=n.profile_string||"",e.level=n.level_string||"",e.chromaFormat=n.chroma_format_string,e.bitDepth=n.bitdepth,e.fps=n.fps||0,e.colorInfo=n.color_info,e.decConf=i}},e.onHEVCDetected=function(e,t,i){return a.b.i("video-track-helper","detected hevc: "+i.hevc+" wasm: "+t.wasmDecoderEnabled),t.wasmDecoderEnabled||i.hevc?(e.outputRaw=!i.hevc||t.preferDecoder===y.c.wasm,e.active=!0):(a.b.i("video-track-helper","HEVC found, disabled. wasmDec:"+t.wasmDecoderEnabled),e.active=!1),e.active},e.onKVCDetected=function(e,t,i){return a.b.i("video-track-helper","detected kvc wasm: "+t.wasmDecoderEnabled),e.active=t.wasmDecoderEnabled,e.outputRaw=e.active,e.active||a.b.i("video-track-helper","KVC found, disabled. wasmDec:"+t.wasmDecoderEnabled),e.active},e.onVVCDetected=function(e,t,i){return a.b.i("video-track-helper","detected vvc wasm: "+t.wasmDecoderEnabled),e.active=t.wasmDecoderEnabled,e.outputRaw=e.active,e.active||a.b.i("video-track-helper","VVC found, disabled. wasmDec:"+t.wasmDecoderEnabled),e.active},e}(),Ie=function(){function e(e,t,i,n){var a=this;this._evt=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._naluLengthSize=4,this._videoTrack=void 0,this._audioTrack=void 0,this._slientAudio=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._aLastDTS=void 0,this._vLastDTS=void 0,this._typeSupported=void 0,this._transmuxData=void 0,this._tagDump=void 0,this._gopRemux=!1,this._timeException=[],this._firstVideoTag=!1,this._av1Ctx=void 0,this._onError=function(e){a._evt.emit(r.a.ERROR,e)},this._evt=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._gopRemux=!!this._config.gopRemux,this._videoTrack=Object(M.b)(1/0,A.f),this._audioTrack=Object(M.a)(1/0,A.f),this._tagDump=new H(this._evt)}e.probe=function(e){return e.byteLength>=3&&70===e[0]&&76===e[1]&&86===e[2]};var t=e.prototype;return t.append=function(e,t,i,n,a){var s=this;if(void 0===a&&(a=!1),!e.byteLength&&a)return this._gopRemux?this._onKeyFrame():this._remux(a),this._tagDump.reset(),void this._evt.emit(r.a.PARSED_DATA,{extra:this._transmuxData});var o=this._tagDump.append(e),c=this._tagDump.trackInfo;void 0===this._videoTrack.active&&c&&(this._videoTrack.active=c.hasVideo,this._audioTrack.active=c.hasAudio,this._videoTrack.active||(this._gopRemux=!1));var u=o.tags;this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:n}),u.length&&(u.forEach((function(e){e.tagType===U.f.VIDEO&&s._videoTrack.active&&(s._firstVideoTag||(s._audioTrack.samples.length&&s._discontinuity(),s._firstVideoTag=!0),s._parseVideoData(e)),e.tagType===U.f.AUDIO&&s._audioTrack.active&&s._parseAudioData(e),e.tagType===U.f.SCRIPT&&s._parseScriptTag(e)})),this._gopRemux||this._remux(!(!a||!this._videoTrack.samples.length&&!this._audioTrack.samples.length)),a&&((this._videoTrack.samples.length||this._audioTrack.samples.length)&&this._remux(!0),this._tagDump.reset(),this._evt.emit(r.a.PARSED_DATA,{extra:this._transmuxData})))},t.destroy=function(){a.b.i("flv-demuxer","destroy")},t.flush=function(){a.b.i("flv-demuxer","flush"),this._remux(!0),this._remuxStat=void 0},t.resetInitSegment=function(e){a.b.i("flv-demuxer","reset init",e),this._transmuxData=e,this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=void 0,this._remuxStat=void 0,this._duration=e.duration,this._timeException=[],"boolean"==typeof e.hasAudio&&"boolean"==typeof e.hasVideo&&(a.b.i("flv-demuxer","reset init audio: "+e.hasAudio+" video: "+e.hasVideo),this._audioTrack.active=e.hasAudio,this._videoTrack.active=e.hasVideo,this._videoTrack.active||(this._gopRemux=!1)),this._tagDump.reset(),this._slientAudio&&this._slientAudio.reset()},t.resetTimeStamp=function(){},t.updateConfig=function(e){p()(this._config,e)},t._discontinuity=function(){a.b.i("flv-demuxer","discontinuity"),this._remux(!0),this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),this._slientAudio&&this._slientAudio.reset()},t._getTimeException=function(e,t,i){var n=i<t||i-t>=A.k;return n&&a.b.i("flv-demuxer","time exception. "+e+" last: "+t+" current:"+i+" offset: "+(i-t)/A.f+"s"),n?i-t:0},t._checkTimestamp=function(e,t,i){var n=this._getTimeException(e,t,i);if(n){if(this._gopRemux=!0,!this._timeException.length&&this._videoTrack.active&&"number"==typeof this._vLastDTS||this._audioTrack.active&&"number"==typeof this._aLastDTS){if(this._timeException.length&&(this._timeException[0].diff<0||this._timeException[0].diff/A.f>30))return this._fixTime(),void a.b.i("flv-demuxer","time exception. fix. "+e);this._audioOnlyStart()?a.b.i("flv-demuxer","time exception. audio only"):(a.b.i("flv-demuxer","time exception. remux. "+e),this._remux(!0))}this._timeException.push({type:e,diff:n})}},t._onKeyFrame=function(){this._gopRemux&&(a.b.v("flv-demuxer","key frame"),this._timeException&&(this._videoTrack.active&&this._videoTrack.samples.length||this._audioOnlyStart())?this._fixTime():this._remux(!0))},t._fixTime=function(){(this._timeException.length>1||this._audioOnlyStart())&&(this._resetTrackSamples(this._videoTrack),this._resetTrackSamples(this._audioTrack));var e=this._remuxer.getLastDTS(),t=Math.max(e.video||0,e.audio||0);a.b.i("flv-demuxer","fix offset",t,e),this._remuxStat={accurateTimeOffset:!0,contiguous:!this._firstRemux,timeOffset:t},this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),this._remuxer.resetTimeStamp(),this._audioTrack.samples.length&&(this._aLastDTS=this._audioTrack.samples[this._audioTrack.samples.length-1].dts),this._videoTrack.samples.length&&(this._vLastDTS=this._videoTrack.samples[this._videoTrack.samples.length-1].dts),this._remux(!0),this._timeException=[],this._gopRemux=!!this._config.gopRemux},t._resetTrackSamples=function(e){var t=e.samples;if(t.length>1){var i=e.sampleDuration||1,n=t[t.length-1];a.b.i("flv-demuxer","reset "+e.type+" track samples time. sampleDuration:"+i+" dts:"+n.dts);for(var r=t.length-2;r>=0;r--){var s=t[r].pts-t[r].dts;t[r].dts=n.dts-i,t[r].pts=t[r].dts+s,n=t[r]}}},t._parseScriptTag=function(e){if(e.body){var t=F.parseMetadata(e.body.buffer);if(t.hasOwnProperty("onMetaData")){var i=t.onMetaData;if("number"==typeof i.duration&&(this._duration=this._duration||i.duration),"number"==typeof i.framerate&&i.framerate>0&&(this._videoTrack.fps=this._videoTrack.fps||i.framerate,this._videoTrack.sampleDuration=Math.floor(A.f/this._videoTrack.fps)),"number"==typeof i.videodatarate&&(this._videoTrack.bitrate=i.videodatarate),"number"==typeof i.audiodatarate&&(this._audioTrack.bitrate=i.audiodatarate),i.keyframes&&i.keyframes.filepositions&&Array.isArray(i.keyframes.filepositions)&&i.keyframes.times&&Array.isArray(i.keyframes.times)&&i.keyframes.filepositions.length===i.keyframes.times.length){var n=[];i.keyframes.times.forEach((function(e,t){n.push({time:e,position:i.keyframes.filepositions[t]})})),i.keyframes=n}a.b.i("flv-demuxer","Parsed onMetaData"),this._evt.emit(r.a.METADATA,i)}}},t._parseVideoData=function(e){if(e.body){var t=e.body[0];e.frameType=(240&t)>>>4;var i=15&t;if(7===i||12===i||13===i){e.codecId=i;var a=e.body[1];if(e.cts=Object(b.c)(e.body,2),0===a)7===i?(this._videoTrack.outputRaw&&(this._discontinuity(),this._videoTrack.outputRaw=!1),this._parseAVCDecoderConfigurationRecord(e)):12===i?(we.onHEVCDetected(this._videoTrack,this._config,this._typeSupported),this._parseHEVCDecoderConfigurationRecord(e)):13===i&&(we.onAV1Detected(this._videoTrack,this._config,this._typeSupported),this._parseAV1DecoderConfigurationRecord(e)),this._videoTrack.duration=this._duration*A.f;else if(1===a){if(!this._videoTrack.codec)return;var s=this._parseAVCVideoData(e)||{};null!=s&&s.abst&&this._evt.emit(r.a.PRIV_NAL,{info:s,abst:s.abst/A.f,originDTS:e.timestamp/A.f})}else if(2!==a)return void this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid video packet type "+a})}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Flv: Unsupported codec in video frame: "+i})}},t._parseHEVCDecoderConfigurationRecord=function(e){if(e.body){var t,i=this._videoTrack,a=e.body.subarray(U.d,e.body.byteLength),s=De.parseHVCC(a);if(s&&s.paramSets.spsList.length){if(i.decConf&&!Object(b.b)(i.decConf,a)&&this._discontinuity(),i.codecType!==y.b.hevc&&(i.codecType=y.b.hevc,this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{codecType:y.b.hevc,enabled:!!i.active,decoder:this._videoTrack.outputRaw?y.c.wasm:y.c.buildin,bitDepth:i.bitDepth,timeOffset:(null==(t=this._remuxStat)?void 0:t.timeOffset)||0})),we.updateHEVCTrack(i,s.paramSets),this._videoTrack.outputRaw){var o=De.hevDecoderConfigToSample(s.paramSets,e.timestamp);this._evt.emit(r.a.RAW_DATA,{type:l.c.decoderConfig,samples:g([o],i.inputTimescale),extra:this._transmuxData})}}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid HEVCDecoderConfigurationRecord"})}},t._parseAV1DecoderConfigurationRecord=function(e){if(e.body){var t=this._videoTrack,i=e.body.subarray(U.d,e.body.byteLength);this._av1Ctx=ae.createCtx();var a,s=De.parseAV1C(i,this._av1Ctx);if(s)t.decConf&&!Object(b.b)(t.decConf,i)&&this._discontinuity(),t.codecType!==y.b.av1&&(t.codecType=y.b.av1,this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:y.c.buildin,codecType:y.b.av1,timeOffset:(null==(a=this._remuxStat)?void 0:a.timeOffset)||0})),we.updateAV1Track(t,s.sh,i);else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AV1DecoderConfigurationRecord"})}},t._parseAVCDecoderConfigurationRecord=function(e){if(e.body){var t,i=e.body.subarray(U.d,e.body.byteLength),a=this._videoTrack,s=De.parseAVCC(e.body.subarray(U.d,e.body.byteLength));if(s&&s.paramSets.spsList.length)a.decConf&&!Object(b.b)(a.decConf,i)&&this._discontinuity(),a.codecType!==y.b.h264&&(a.codecType=y.b.h264,this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:y.c.buildin,codecType:y.b.h264,timeOffset:(null==(t=this._remuxStat)?void 0:t.timeOffset)||0})),we.updateAVCTrack(a,s.paramSets,i);else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AVCDecoderConfigurationRecord"})}},t._parseAVCVideoData=function(e){if(e.body){var t,i=this._videoTrack,n=e.body.buffer,s=e.body.byteLength-U.d,o=new DataView(n,U.d,s),c=[],u=0,d=this._naluLengthSize,_=e.timestamp,h=e.cts;_===this._vLastDTS&&(h+=1);var l=_+h,f=1===e.frameType;if(f&&this._onKeyFrame(),"number"==typeof this._vLastDTS&&this._checkTimestamp(y.l.VIDEO,this._vLastDTS,_),13===e.codecId)this._av1Ctx||(this._av1Ctx=ae.createCtx()),ae.parseOBU(e.body.subarray(U.d),this._av1Ctx).forEach((function(e){c.push({type:0,data:e.data})}));else for(;u<s;){if(u+4>=s){a.b.v("flv-demuxer","Malformed Nalu near timestamp "+_+", offset = "+u+", dataSize = "+s);break}var p=o.getUint32(u);if(3===d&&(p>>>=8),p>s-d)return void a.b.v("flv-demuxer","Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var v=new Uint8Array(n,U.d+u+4,d+p-4),m=0,g=void 0;if(7===e.codecId)if((m=31&o.getUint8(u+d))===k.H264_NAL_IDR_SLICE)f=!0;else if(m===k.PRIV_NAL_MAGIC_H264){try{t=E.parse(v,!0)}catch(e){a.b.w("flv-demuxer","PrivNal parse error "+e)}a.b.i("flv-demuxer","priv nal",t)}else m===k.H264_NAL_SEI&&(g=oe.parse(v.subarray(1),y.b.h264));else if(12===e.codecId)if((m=(126&o.getUint8(u+d))>>1)===G.a.HEVC_NAL_IDR_W_RADL||m===G.a.HEVC_NAL_IDR_N_LP||m===G.a.HEVC_NAL_CRA_NUT)f=!0;else if(m===G.a.PRIV_NAL_MAGIC_HEVC)try{t=E.parse(v,!1)}catch(e){a.b.w("flv-demuxer","PrivNal parse error "+e)}else m!==G.a.HEVC_NAL_SEI_PREFIX&&m!==G.a.HEVC_NAL_SEI_SUFFIX||(g=oe.parse(v.subarray(2),y.b.hevc));var b={type:m,data:v};c.push(b),v.byteLength,u+=d+p,g&&g.length&&this._evt.emit(r.a.SEI,{sei:g})}if(c.length){var T={units:c,dts:_,cts:h,pts:l,originDTS:e.timestamp,key:f,parseTime:performance?performance.now()/1e3:0};T.key&&this._evt.emit(r.a.KEY_FRAME,{pts:l/A.f,cts:h/A.f}),i.samples.push(T)}return this._vLastDTS=_,t}},t._parseAudioData=function(e){if(e.body)if(e.body.byteLength<=1)a.b.v("flv-demuxer","Flv: Invalid audio packet, missing SoundData payload!");else{var t=this._audioTrack,i=e.body[0]>>4;if(10===i)t.codecType=y.b.aac;else{if(2!==i&&14!==i)return a.b.w("flv-demuxer","audio unsupported codec "+i),void(t.active=!1);t.codecType=y.b.mp3}if(t.codecType===y.b.aac){var n=e.body[1];if(0===n){if(e.body.byteLength<4)return;var r=e.body.subarray(2,4);return void this._parseASC(r)}if(1!==n)return void a.b.v("flv-demuxer","Flv: Unsupported AAC data type "+n);if(!t.configParsed){var s,o,c=[5500,11025,22050,44100][e.body[0]>>2&3];if(c<11025)return;var u=1+(1&e.body[0]);a.b.i("flv-demuxer","missing AACPacketType 0. generate samplerate:"+c+" channel:"+u+" codec:"+(null==(s=this._transmuxData)?void 0:s.audioCodec));var d=T.b(c,u,null==(o=this._transmuxData)?void 0:o.audioCodec);if(!d)return void a.b.v("flv-demuxer","generate ASC fail.");this._parseASC(d)}}t.duration=this._duration*A.f;var _,h=t.codecType===y.b.aac?2:1,l=e.timestamp;if(t.sampleDuration&&this._videoTrack.active&&"number"==typeof this._aLastDTS&&this._checkTimestamp(y.l.AUDIO,this._aLastDTS,e.timestamp),t.codecType===y.b.aac)_={unit:e.body.subarray(2),dts:l,pts:l,originDTS:l,parseTime:self.performance?performance.now()/1e3:0},t.samples.push(_);else if(t.codecType===y.b.mp3){var f;_=null==(f=w(t,e.body,h,l,0))?void 0:f.sample}this._aLastDTS=l}},t._parseASC=function(e){var t,i=this._audioTrack;(T.g(i,e)||!i.configParsed)&&i.codec&&i.samples.length&&this._discontinuity(),T.d(i,this._evt,e,l.a.ASC,null==(t=this._transmuxData)?void 0:t.audioCodec)},t._remux=function(e){void 0===e&&(e=!1);var t,i=this._audioTrack,s=this._videoTrack;s.outputRaw&&!i.active&&(this._slientAudio||(S.a.initAudioForFillSilent(i,null==(t=this._transmuxData)?void 0:t.audioCodec),this._slientAudio=new N.a),this._slientAudio.update(i,s));if(0!==i.samples.length||0!==s.samples.length)if(e||!(i.active&&0===i.samples.length||s.active&&s.samples.length<3)){var o=!0,c=0,u=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,u=this._remuxStat.accurateTimeOffset),this._firstRemux&&(this._firstRemux=!1,this._evt.emit(r.a.MEDIA_DEMUX,{type:l.b.FLV}));try{this._remuxer.remux(i,s,c,o,u,e),this._remuxStat=void 0}catch(e){a.b.e("flv-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}else{var d=i.active&&i.configParsed&&this._getAudioTrackDuration(i)||0,_=s.active&&s.decConf&&this._getVideoTrackDuration(s)||0,h=s.samples.reduce((function(e,t){return e+(t.key?1:0)}),0);d>30?(a.b.i("flv-demuxer","audio remux sec > 30, remux now."),this._remux(!0)):(_>30||this._config.isLive&&h>1)&&(a.b.i("flv-demuxer","video remux sec: "+_+" key: "+h+", remux now."),this._remux(!0))}else e&&this._remuxer.flush()},t._getAudioTrackDuration=function(e){return e.samples.length?e.samples.length&&T.c(e.samplerate,1)*e.samples.length:0},t._getVideoTrackDuration=function(e){return e.samples.length?this._timeException.reduce((function(e,t){return e||t.type===y.l.VIDEO}),!1)?e.samples.length*(e.sampleDuration||A.f/A.c)/e.inputTimescale:(e.samples[e.samples.length-1].dts-e.samples[0].dts)/e.inputTimescale:0},t._audioOnlyStart=function(){var e;return!(!this._config.isLive&&void 0!==this._config.isLive||!this._firstRemux||null!=(e=this._remuxStat)&&e.contiguous||!this._videoTrack.active||this._videoTrack.samples.length||!(this._audioTrack.samples.length>0))},m()(e,null,[{key:"probeSize",get:function(){return 188}}]),e}(),Oe=i(33),Pe=function(){function e(e,t,i,n){var a=this;this._evt=void 0,this._remuxer=void 0,this._config=void 0,this._typeSupported=void 0,this._cache=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._parseLen=0,this._parseFunc=void 0,this._pts=0,this._firstRemux=!0,this._remuxStat=void 0,this._vFrameIdx=0,this._av1Ctx=void 0,this._onError=function(e){a._evt.emit(r.a.ERROR,e)},this._evt=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._cache=new _.a,this._parseFunc=this._parseStart,this._parseLen=8}e.probe=function(e){return e.length>4&&68===e[0]&&75===e[1]&&73===e[2]&&70===e[3]};var t=e.prototype;return t.resetInitSegment=function(e,t){this._initTrack(e.duration),this._pts=0,this._firstRemux=!0,this._remuxStat=void 0,this._parseFunc=this._parseStart,this._parseLen=8,this._cache.clear()},t.resetTimeStamp=function(e){},t.append=function(e,t,i,n,r){for(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:n}),this._cache.put(e);this._cache.unreadLen>=this._parseLen;)this._parseFunc();this._remux(r)},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.destroy=function(){this._cache.clear()},t.updateConfig=function(e){p()(this._config,e)},t._initTrack=function(e){this._videoTrack=Object(M.b)(e),this._videoTrack.active=!0,this._audioTrack=Object(M.a)(e),this._audioTrack.active=!1},t._parseStart=function(){if(!(this._cache.unreadLen<8)){var t=this._cache.get(8);if(t)if(e.probe(t)){var i=Object(b.e)(t,6,!0);this._parseLen=i-8,this._parseFunc=this._parseHead}else this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"ivf start code error"})}},t._parseHead=function(){if(!(this._cache.unreadLen<this._parseLen)){var e=this._cache.get(this._parseLen),t=this._videoTrack;if(e&&t){var i=Object(b.a)(e,0,4);if("AV01"===i){t.codecType=y.b.av1,t.width=Object(b.e)(e,4,!0),t.height=Object(b.e)(e,6,!0);var s=Object(b.g)(e,8,!0),o=Object(b.g)(e,12,!0),c=Object(b.g)(e,16,!0);t.inputTimescale=s/o,t.duration=c,a.b.i("ivf-demuxer","head. w: "+t.width+", h:"+t.height+", den:"+s+", num:"+o+", duration:"+t.duration),s&&o||this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"ivf head den: "+s+", num: "+o});var u={duration:t.duration/t.inputTimescale,keyframes:[{time:0,position:this._parseLen}]};this._evt.emit(r.a.METADATA,u),this._parseFunc=this._parseFrameHead,this._parseLen=12}else this._onError({type:n.b.MUX_ERROR,details:n.a.UNSUPPORTED,fatal:!0,reason:"ivf "+i+" unsupported"})}}},t._parseFrameHead=function(){if(!(this._cache.unreadLen<this._parseLen)){var e=this._cache.get(this._parseLen);if(e){var t=Object(b.g)(e,0,!0);this._pts=Object(b.h)(e,4,!0),this._parseFunc=this._parseFrame,this._parseLen=t}}},t._parseFrame=function(){var e=this;if(!(this._cache.unreadLen<this._parseLen)){var t=this._cache.get(this._parseLen),i=this._videoTrack;if(t&&i){var n=[],a=!1;if(this._av1Ctx||(this._av1Ctx=ae.createCtx()),ae.parseOBU(t,this._av1Ctx).forEach((function(t){var r;t.obu_type===z.AV1_OBU_SEQUENCE_HEADER&&e._av1Ctx&&e._av1Ctx.sh&&(we.onAV1Detected(i,e._config,e._typeSupported),we.updateAV1Track(i,e._av1Ctx.sh)),a=a||!(null==(r=t.content)||!r.keyframe),n.push({type:0,data:t.data})})),n.length){var s={units:n,dts:this._pts,cts:0,pts:this._pts,originDTS:this._pts,key:a};s.key&&this._evt.emit(r.a.KEY_FRAME),i.samples.push(s)}this._parseFunc=this._parseFrameHead,this._parseLen=12}}},t._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack;if(i&&t)if(0!==t.samples.length||0!==i.samples.length){if(e||!(t.active&&0===t.samples.length||i.active&&i.samples.length<3)){this._firstRemux&&(this._evt.emit(r.a.KEY_FRAME_INDEXS,{keyframes:[{time:0,position:0}]}),this._firstRemux=!1,this._evt.emit(r.a.MEDIA_DEMUX,{type:l.b.IVF}));var s=Object(Oe.a)(i,this._vFrameIdx);this._vFrameIdx+=s.length,this._evt.emit(r.a.VIDEO_FRAME_INFO,{videoFramesInfo:s});var o=!0,c=0,u=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,u=this._remuxStat.accurateTimeOffset);try{this._remuxer.remux(t,i,c,o,u,e),this._remuxStat=void 0}catch(e){a.b.e("ivf-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},m()(e,null,[{key:"probeSize",get:function(){return 8}}]),e}(),ke=i(9),Ne=i(40),Me=i(26),Be=function(){function e(){}return e.parseOneDescriptor=function(t){var i,n,r=0;for(i=t.data[t.pos],n=t.data[t.pos+1],t.pos+=2;128&n;)r=(127&n)<<7,n=t.data[t.pos],t.pos++;r+=127&n;var a=t.data.subarray(t.pos,t.pos+r);return 3===i?e._parseESDesc(t):4===i?e._parseDecoderConfigDescriptor(t):(t.pos+=r,{tag:i,data:a})},e.getAudioConfig=function(t){if(5===t.tag)return t.data;if(t.descs&&t.descs.length)for(var i=0;i<t.descs.length;i++){var n=e.getAudioConfig(t.descs[i]);if(n)return n}},e.getObjectTypeIndication=function(e){if(e.descs&&e.descs.length)for(var t=0;t<e.descs.length;t++)if(4===e.descs[t].tag)return e.descs[t].oti;return-1},e._parseESDesc=function(t){var i=Object(b.e)(t.data,t.pos);t.pos+=2;var n=t.data[t.pos];t.pos++;var r=0;128&n&&(r=Object(b.e)(t.data,t.pos),t.pos+=2);var a="";if(64&n){var s=t.data[t.pos];a=Object(b.a)(t.data,t.pos+1,s),t.pos+=s+1}var o=0;32&n&&(o=Object(b.e)(t.data,t.pos),t.pos+=2);var c={tag:3,data:t.data,id:i,dependsOnESID:r,url:a,ocrESID:o};return t.pos<t.data.byteLength&&(c.descs=e._parseRemainingDescriptors(t)),c},e._parseDecoderConfigDescriptor=function(t){var i={tag:4,data:t.data,oti:t.data[t.pos],streamType:t.data[t.pos+1],bufferSize:Object(b.f)(t.data,t.pos+2),maxBitrate:Object(b.g)(t.data,t.pos+5),avgBitrate:Object(b.g)(t.data,t.pos+9)};return t.pos+=13,t.data.byteLength>13&&(i.descs=e._parseRemainingDescriptors(t)),i},e._parseRemainingDescriptors=function(t){for(var i=[];t.pos<t.data.byteLength;){var n=e.parseOneDescriptor(t);i.push(n)}return i},e}();function Ve(e){var t=-function(e){var t=[];return t[0]=Ue(Fe(e[0]),Fe(e[3])),t[1]=Ue(Fe(e[1]),Fe(e[4])),0==t[0]||0==t[1]?NaN:-180*Math.atan2(Fe(e[1])/t[1],Fe(e[0])/t[0])/Math.PI}(e);return t-=360*Math.floor(t/360+.0025),(t%=360)<0&&(t+=360),t}function Fe(e){return e/65536}function Ue(){for(var e=0,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var r=i.length,a=0;a<r;a++){if(i[a]===1/0||i[a]===-1/0)return 1/0;e+=i[a]*i[a]}return Math.sqrt(e)}!function(e){e[e.SIZE=0]="SIZE",e[e.NAME=1]="NAME",e[e.BIG_SIZE=2]="BIG_SIZE",e[e.DATA=3]="DATA"}(be||(be={}));var He,je,ze,Ge,We=function(){function e(){}return e.findBox=function(t,i){var n,r,a,s,o=[];if(!i.length)return o;for(var c=0;0<t.byteLength;)n=Object(b.g)(t,0),r=Object(b.a)(t.subarray(4,8),4),c=8,1===n&&(n=Object(b.h)(t,8),c=16),s=0+n,r===i[0]&&(1===i.length?o.push(t.subarray(0+c,s)):(a=e.findBox(t.subarray(0+c,s),i.slice(1))).length&&(o=o.concat(a)));return o},e.readBoxes=function(e){for(var t=0,i=be.SIZE,n={size:0,headSize:8,name:""},r=[];t<e.byteLength;)switch(i){case be.SIZE:n.size=Object(b.g)(e,t),t+=4,i=be.NAME;break;case be.NAME:n.name=Object(b.a)(e,t,4),t+=4,i=1===n.size?be.BIG_SIZE:be.DATA;break;case be.BIG_SIZE:n.size=Object(b.h)(e,t),n.headSize=16,t+=8,i=be.DATA;break;case be.DATA:n.data=e.subarray(t,t+n.size-n.headSize),t+=n.data.byteLength,i=be.SIZE,r.push(n),n={size:0,headSize:8,name:""}}return r},e.readBox=function(e,t){void 0===t&&(t=0);for(var i=t,n=be.SIZE,r={size:0,headSize:8,name:""};i<e.byteLength&&!r.data;)switch(n){case be.SIZE:r.size=Object(b.g)(e,i),i+=4,n=be.NAME;break;case be.NAME:r.name=Object(b.a)(e,i,4),i+=4,n=1===r.size?be.BIG_SIZE:be.DATA;break;case be.BIG_SIZE:r.size=Object(b.h)(e,i),r.headSize=16,i+=8,n=be.DATA;break;case be.DATA:if(!(e.byteLength-i>=r.size-r.headSize)){i=e.byteLength;break}r.data=e.subarray(i,i+r.size-r.headSize),i+=r.data.byteLength,n=be.SIZE}if(r.size)return r},e.ftyp=function(e){var t=e.data;if(t)return{major_brand:Object(b.a)(t,0,4),minor_version:Object(b.g)(t,4),compatible_brands:Object(b.a)(t,8,t.byteLength-8)}},e.moov=function(t){var i={trak:[],mvex:[],pssh:[]};return t.data&&e.readBoxes(t.data).forEach((function(t){t.data&&("mvhd"===t.name?i.mvhd=e._mvhd(t.data):"trak"===t.name?i.trak.push(e._trak(t.data)):"mvex"===t.name?i.mvex.push(e._mvex(t.data)):"pssh"===t.name&&i.pssh.push(t))})),i},e.moof=function(t){var i={};return t.data&&e.readBoxes(t.data).forEach((function(t){if(t.data&&"traf"===t.name){var n=e._traf(t.data);i.traf?i.traf.push(n):i.traf=[n]}})),i},e.esds=function(e){if(e.data)return Be.parseOneDescriptor({data:e.data,pos:4})},e.sidx=function(e){var t=e.data;if(t){var i={referenceID:0,timescale:0,earliestPresentationTime:0,firstOffset:0,referenceCount:0,references:[]},n=t[0],r=4;i.referenceID=Object(b.d)(t,r),i.timescale=Object(b.g)(t,r+4),r+=8,0===n?(i.earliestPresentationTime=Object(b.g)(t,r),i.firstOffset=Object(b.g)(t,r+4),r+=8):(i.earliestPresentationTime=Object(b.h)(t,r),i.firstOffset=Object(b.h)(t,r+8),r+=16),i.referenceCount=Object(b.e)(t,r+2),r+=4;for(var a=0;a<i.referenceCount;a++){t[r];var s=2147483647&Object(b.g)(t,r);r+=4;var o=Object(b.g)(t,r);r+=4,i.references.push({size:s,duration:o/i.timescale}),r+=4}return i}},e.btrt=function(e){var t=e.data;if(t)return{bufferSizeDB:Object(b.g)(t,0),maxBitrate:Object(b.g)(t,4),avgBitrate:Object(b.g)(t,8)}},e._traf=function(t){var i={};return e.readBoxes(t).forEach((function(t){if(t.data)if("tfhd"===t.name)i.tfhd=e._tfhd(t.data);else if("tfdt"===t.name)i.tfdt=e._tfdt(t.data);else if("trun"===t.name){var n=e._trun(t.data);i.trun?i.trun.push(n):i.trun=[n]}else"saiz"===t.name?i.saiz=e._saiz(t.data):"saio"===t.name?i.saio=e._saio(t.data):"senc"===t.name&&(i.senc=e._senc(t.data))})),i},e._tfhd=function(e){var t={trackID:Object(b.g)(e,4),baseDataOffset:0,sampleDescriptionIndex:0,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0},i=Object(b.f)(e,1),n=8;return n<e.byteLength-8&&1&i?(t.baseDataOffset=Object(b.h)(e,n),n+=8):t.baseDataOffset=0,n<e.byteLength-4&&2&i?(t.sampleDescriptionIndex=Object(b.g)(e,n),n+=4):t.sampleDescriptionIndex=0,n<e.byteLength-4&&8&i?(t.defaultSampleDuration=Object(b.g)(e,n),n+=4):t.defaultSampleDuration=0,n<e.byteLength-4&&16&i?(t.defaultSampleSize=Object(b.g)(e,n),n+=4):t.defaultSampleSize=0,n<e.byteLength-4&&32&i?(t.defaultSampleFlags=Object(b.g)(e,n),n+=4):t.defaultSampleFlags=0,t},e._tfdt=function(e){return{baseMediaDecodeTime:1===e[0]?Object(b.h)(e,4):Object(b.g)(e,4)}},e._trun=function(e){var t=e[0],i=Object(b.f)(e,1),n={sampleCount:0,dataOffset:0,firstSampleFlags:0,sampleDuration:[],sampleSize:[],sampleFlags:[],sampleCompositionTimeOffset:[]},r=4;if(n.sampleCount=Object(b.g)(e,r),(r+=4)<e.byteLength-4&&1&i?(n.dataOffset=Object(b.d)(e,r),r+=4):n.dataOffset=0,r<e.byteLength-4&&4&i?(n.firstSampleFlags=Object(b.g)(e,r),r+=4):n.firstSampleFlags=0,r<=e.byteLength-4)for(var a=0;a<n.sampleCount;a++)256&i&&(n.sampleDuration[a]=Object(b.g)(e,r),r+=4),512&i&&(n.sampleSize[a]=Object(b.g)(e,r),r+=4),1024&i&&(n.sampleFlags[a]=Object(b.g)(e,r),r+=4),2048&i&&(n.sampleCompositionTimeOffset[a]=0===t?Object(b.g)(e,r):Object(b.d)(e,r),r+=4);return n},e._saiz=function(e){var t=e[0],i=Object(b.f)(e,1),n={defaultSampleInfoSize:0,sampleCount:0,sampleInfoSize:[]};if(0===t){var r=4;if(1&i&&(r+=8),n.defaultSampleInfoSize=e[r],n.sampleCount=Object(b.g)(e,r+1),r+=5,0===n.defaultSampleInfoSize)for(var a=0;a<n.sampleCount;a++)n.sampleInfoSize[a]=e[r],r++}return n},e._saio=function(e){var t=e[0],i={entryCount:0,offset:[]},n=4;1&Object(b.f)(e,1)&&(n+=8),i.entryCount=Object(b.g)(e,n),n+=4;for(var r=0;r<i.entryCount;r++)0===t?(i.offset[r]=Object(b.g)(e,n),n+=4):(i.offset[r]=Object(b.h)(e,n),n+=8);return i},e._senc=function(e,t){void 0===t&&(t=0),e[0];var i={sampleCount:0,useSubSampleEnc:!!(2&Object(b.f)(e,1)),encItemData:[]},n=4;return i.sampleCount=Object(b.g)(e,n),n+=4,t&&(i.iv=e.subarray(n,8*t),n+=t),i.encData=e.subarray(n),i},e._mvhd=function(e){var t=e[0],i=0,n=0;return 1===t?(i=Object(b.g)(e,20),n=Object(b.h)(e,24)):0===t&&(i=Object(b.g)(e,12),n=Object(b.g)(e,16)),{timescale:i,duration:n}},e._mvex=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("mehd"===t.name?i.mehd=e._mehd(t.data):"trex"===t.name&&(i.trex=e._trex(t.data)))})),i},e._mehd=function(e){return{fragmentDuration:1===e[0]?Object(b.h)(e,4):Object(b.g)(e,4)}},e._trex=function(e){return{trackID:Object(b.g)(e,4),sampleDescriptionIndex:Object(b.g)(e,8),defaultSampleDuration:Object(b.g)(e,12),defaultSampleSize:Object(b.g)(e,16),defaultSampleFlags:Object(b.g)(e,20)}},e._trak=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("tkhd"===t.name?i.tkhd=e._tkhd(t.data):"tref"===t.name?i.tref=e._tref(t.data):"mdia"===t.name&&(i.mdia=e._mdia(t.data)))})),i},e._tkhd=function(e){var t=0,i=0,n=4;1===e[0]?(t=Object(b.g)(e,n+16),i=Object(b.h)(e,n+24),n+=32):(t=Object(b.g)(e,n+8),i=Object(b.g)(e,n+16),n+=20),n+=16;for(var r=[],a=0;a<9;a++)r.push(Object(b.d)(e,n)),n+=4;return{width:Object(b.g)(e,n)>>16,height:Object(b.g)(e,n+4)>>16,trackId:t,duration:i,matrix:r}},e._tref=function(e){return{referenceType:Object(b.a)(e,4,4),trackId:Object(b.g)(e,8)}},e._mdia=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("minf"===t.name?i.minf=e._minf(t.data):"hdlr"===t.name?i.hdlr=e._hdlr(t.data):"mdhd"===t.name&&(i.mdhd=e._mdhd(t.data)))})),i},e._hdlr=function(e){var t={};return 0===e[0]&&(t.type=Object(b.a)(e,8,4)),t},e._minf=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("dinf"===t.name?e._dinf(t.data):"stbl"===t.name&&(i.stbl=e._stbl(t.data)))})),i},e._dinf=function(t){e.readBoxes(t).forEach((function(t){t.data&&"dref"===t.name&&e._dref(t.data)}))},e._dref=function(e){e[0];for(var t=Object(b.g)(e,4),i=0;i<t&&8<e.byteLength;i++);},e._stbl=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("stsd"===t.name?i.stsd=e._stsd(t.data):"stts"===t.name?i.stts=e._stts(t.data):"stsc"===t.name?i.stsc=e._stsc(t.data):"stco"===t.name?i.stco=e._stco(t.data):"co64"===t.name?i.stco=e._co64(t.data):"stsz"===t.name?i.stsz=e._stsz(t.data):"stz2"===t.name?i.stsz=e._stz2(t.data):"stss"===t.name?i.stss=e._stss(t.data):"ctts"===t.name?i.ctts=e._ctts(t.data):"sgpd"===t.name?i.sgpd=e._sgpd(t.data):"stdp"===t.name?i.stdp=e._stdp(t.data):"sdtp"===t.name?i.sdtp=e._sdtp(t.data):"sbgp"===t.name?i.sbgp=e._sbgp(t.data):"subs"===t.name?i.subs=e._subs(t.data):"saiz"===t.name?i.saiz=e._saiz(t.data):"saio"===t.name?i.saio=e._saio(t.data):"senc"===t.name&&(i.senc=e._senc(t.data)))})),i},e._subs=function(e){var t=e[0],i={entries:[]},n=4,r=Object(b.g)(e,n);n+=4;for(var a=0;a<r;a++){var s={sampleDelta:Object(b.g)(e,n),subSamples:[]};i.entries.push(s);var o=Object(b.e)(e,n+4);n+=6;for(var c=0;c<o;c++){1===t?(Object(b.g)(e,n),n+=4):(Object(b.e)(e,n),n+=2);var u={priority:e[n],discardable:e[n+1],codecSpecificParameters:Object(b.g)(e,n+2)};s.subSamples.push(u),n+=6}}return i},e._sbgp=function(e){var t=e[0],i=4,n={groupingType:Object(b.a)(e,i,4),entries:[]};i+=4,1===t&&(Object(b.g)(e,i),i+=4);var r=Object(b.g)(e,i);i+=4;for(var a=0;a<r;a++)n.entries.push({sampleCount:Object(b.d)(e,i),groupDescriptionIndex:Object(b.d)(e,i+4)}),i+=8;return n},e._sdtp=function(e){for(var t={entries:[]},i=4;i<e.byteLength;)t.entries.push({sampleDependsOn:e[i]>>4&3,sampleIsDependedOn:e[i]>>2&3,sampleHasRedundancy:3&e[i]}),i++;return t},e._stdp=function(e){for(var t={priority:[]},i=4;i<e.length;)t.priority.push(Object(b.e)(e,i)),i+=2;return t},e._sgpd=function(e){var t=e[0],i={type:Object(b.a)(e,4,4),entries:[]},n=0,r=8;1===t&&(n=Object(b.g)(e,r),r+=4),2===t&&(Object(b.g)(e,r),r+=4);var a=Object(b.g)(e,r);r+=4;for(var s=0;s<a;s++){var o=0;1===t&&0===n?(o=Object(b.g)(e,r),r+=4):o=n;var c={descriptionLength:o,data:e.subarray(r,r+o)};r+=o,i.entries.push(c)}return i},e._stsd=function(t){return t[0],Object(b.g)(t,4),{sampleEntrys:e.readBoxes(t.subarray(8,t.byteLength)),boxData:t}},e._stts=function(e){for(var t=Object(b.g)(e,4),i=8,n=[],r=0;r<t;r++)n.push({sampleCount:Object(b.g)(e,i),sampleDelta:Object(b.g)(e,i+4)}),i+=8;return{timeToSample:n}},e._stsc=function(e){e[0];for(var t=Object(b.g)(e,4),i=8,n=[],r=0;r<t;r++)n.push({firstChunk:Object(b.g)(e,i),samplesPerChunk:Object(b.g)(e,i+4),sampleDescriptionIndex:Object(b.g)(e,i+8)}),i+=12;return{sampleToChunkBox:n}},e._stco=function(e){for(var t=Object(b.g)(e,4),i=8,n=[],r=0;r<t;r++)n.push(Object(b.g)(e,i)),i+=4;return{chunkOffset:n}},e._co64=function(e){for(var t=Object(b.g)(e,4),i=8,n=[],r=0;r<t;r++)n.push(Object(b.h)(e,i)),i+=8;return{chunkOffset:n}},e._stsz=function(e){var t=Object(b.g)(e,4),i=Object(b.g)(e,8),n=12;if(0===t){t=[];for(var r=0;r<i;r++)t.push(Object(b.g)(e,n)),n+=4}return{sampleCount:i,SampleSize:t}},e._stz2=function(e){for(var t=e[7],i=[],n=Object(b.g)(e,8),r=12,a=0;a<n;a++)4===t?(i.push(e[r]>>4),++a<n&&i.push(15&e[r]),r+=1):8===t?(i.push(e[r]),r+=1):16===t&&(i.push(Object(b.e)(e,r)),r+=2);return{sampleCount:n,SampleSize:i}},e._stss=function(e){for(var t=Object(b.g)(e,4),i=8,n=[],r=0;r<t;r++)n.push(Object(b.g)(e,i)),i+=4;return{sampleNumber:n}},e._ctts=function(e){e[0];for(var t=Object(b.g)(e,4),i=8,n=[],r=0;r<t;r++)n.push({sampleCount:Object(b.g)(e,i),sampleOffset:Object(b.d)(e,i+4)}),i+=8;return{compositionOffset:n}},e._mdhd=function(e){var t=0,i=0;return 1===e[0]?(t=Object(b.g)(e,20),i=Object(b.h)(e,24)):(t=Object(b.g)(e,12),i=Object(b.g)(e,16)),{timescale:t,duration:i}},e}(),Ke=[64,102,103,104,105,107],Qe=[64,102,103,104],Ye={avc1:y.b.h264,avcC:y.b.h264,hev1:y.b.hevc,hvc1:y.b.hevc,hvcC:y.b.hevc,kvc3:y.b.kvc3,kvc4:y.b.kvc4,kvc5:y.b.kvc5,kvc6:y.b.kvc6,kvc7:y.b.kvc30,kvLC:y.b.kvc30,av01:y.b.av1,av1C:y.b.av1,bvc2:y.b.bvc2,bv2C:y.b.bvc2,vvc1:y.b.vvc,vvcC:y.b.vvc},Xe=function(){function e(e,t,i,n){var a=this;this._evt=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._naluLengthSize=4,this._videoTrack=void 0,this._audioTrack=void 0,this._slientAudio=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._typeSupported=void 0,this._transmuxData=void 0,this._gopRemux=!1,this._cache=void 0,this._ftyp=void 0,this._moov=void 0,this._vSampleIndex=0,this._aSampleIndex=0,this._offset=0,this._vSampleInfoList=void 0,this._aSampleInfoList=void 0,this._nextSampleInfo=void 0,this._readingBox=void 0,this._isFMP4=!1,this._readingBoxWaiting=8,this._fragmentEndOffset=0,this._readSamples=!0,this._remuxOnMoof=!1,this._pssh=void 0,this._vLastDTS=0,this._aLastDTS=0,this._av1Ctx=void 0,this._onError=function(e){a._evt.emit(r.a.ERROR,e)},this._evt=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._gopRemux=!!this._config.gopRemux,this._videoTrack=Object(M.b)(1/0),this._audioTrack=Object(M.a)(1/0),this._cache=new _.a}e.probe=function(e){var t=Object(b.a)(e,4,4);return!("styp"!==t&&"ftyp"!==t)};var t=e.prototype;return t.append=function(e,t,i,s,o){if(void 0===o&&(o=!1),this._readSamples){this._cache.put(e),this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:s}),this._isFMP4&&this._isCurretFragmentEnd()&&this._nextFragment();do{if(this._readBox(),!this._moov||!this._readSamples)return;for(i||(this._isFMP4||this._seek(t),i=!0);this._cache.unreadLen&&this._hasMoreSamples();){if(!this._nextSampleInfo){var c=this._getNextSampleInfo();if("notReady"===c)return void a.b.i("mp4-demuxer","sample not ready");this._nextSampleInfo=c}if(!this._nextSampleInfo)return void this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"can not find next sample"});if(this._offset){var u=this._nextSampleInfo.start-this._offset;if(this._cache.unreadLen<u)return;this._cache.skip(this._nextSampleInfo.start-this._offset)}if(this._offset=this._nextSampleInfo.start,!(this._nextSampleInfo&&this._nextSampleInfo.end-this._nextSampleInfo.start<=this._cache.unreadLen))break;var d=this._cache.get(this._nextSampleInfo.end-this._nextSampleInfo.start);if(!d)return;this._offset+=d.byteLength,this._nextSampleInfo.type===y.l.VIDEO?(this._videoTrack.active&&this._parseVideoSample(this._nextSampleInfo,d),this._vSampleIndex++):(this._audioTrack.active&&this._parseAudioSample(this._nextSampleInfo,d),this._aSampleIndex++),this._nextSampleInfo=void 0}this._isCurretFragmentEnd()&&this._nextFragment()}while(this._isFMP4&&this._readNextBox());this._remuxOnMoof&&!o||(this._remux(o&&!this._hasMoreSamples()),o&&this._evt.emit(r.a.PARSED_DATA,{extra:this._transmuxData}))}},t._readBox=function(){for(;this._readNextBox();){if(!this._readingBox){var e=this._cache.get(8);if(!e)return;var t=Object(b.g)(e);this._readingBox={size:t,name:Object(b.a)(e,4,4),headSize:t>1?8:16},this._offset+=8}if(1===this._readingBox.size){if(!(this._cache.unreadLen>=8))return void(this._readingBoxWaiting=8);var i=this._cache.get(8);if(!i)return;var n=Object(b.h)(i);this._readingBox.size=n,this._offset+=8}var a=this._readingBox.size-this._readingBox.headSize;if("mdat"===this._readingBox.name){if(!this._moov)return this._readingBox=void 0,this._readSamples=!1,void this._evt.emit(r.a.MP4_NOT_FASTSTART,{pos:this._offset+a});if(this._isFMP4){this._updateSampleListDataOffset(this._offset),this._readingBoxWaiting=0,this._fragmentEndOffset=this._offset+a;break}if(!this._isFMP4){this._readingBox=void 0,this._readingBoxWaiting=0;break}}if(this._cache.unreadLen>=a){var s=this._cache.get(a);if(this._readingBox.data=s,this._offset+=a,"moov"===this._readingBox.name){if(this._parseMOOV(this._readingBox),this._vSampleInfoList&&this._vSampleInfoList.samples.length||this._aSampleInfoList&&this._aSampleInfoList.samples.length){this._readingBoxWaiting=0,this._readingBox=void 0;break}this._readingBox=void 0}else"moof"===this._readingBox.name?(this._remuxOnMoof&&this._remux(),this._isFMP4=!0,this._parseMOOF(this._readingBox,this._offset),this._readingBox=void 0):"sidx"===this._readingBox.name?(this._parseSIDX(this._readingBox,this._offset),this._readingBox=void 0):"ftyp"===this._readingBox.name?(this._ftyp=We.ftyp(this._readingBox),this._readingBox=void 0):this._readingBox=void 0}else this._readingBoxWaiting=a}},t._updateSampleListDataOffset=function(e){var t,i,n=this._aSampleIndex,r=this._vSampleIndex,a=null==(t=this._aSampleInfoList)?void 0:t.samples,s=null==(i=this._vSampleInfoList)?void 0:i.samples,o=a&&a[n],c=s&&s[r];if(o&&c)for(var u=e,d=a[n],_=s[r];d||_;){var h=d?d.noOffset?d.start+u:d.start:Number.MAX_SAFE_INTEGER,l=_?_.noOffset?_.start+u:_.start:Number.MAX_SAFE_INTEGER,f=void 0;if(h===l?d&&d.noOffset?(f=_,r++):(f=d,n++):h<l?(f=d,n++):(f=_,r++),f){if(f.noOffset){f.noOffset=void 0;var p=f.end-f.start;f.start=Math.min(h,l),f.end=f.start+p}u=f.end}d=a[n],_=s[r]}else if(o||c){var v=o?a:s;if(!v)return;for(var m=v.length-1;m>=0;m--)if(v[m]&&v[m].noOffset){v[m].noOffset=void 0,v[m].start+=e,v[m].end+=e;break}}},t._readNextBox=function(){return!!(this._readingBoxWaiting&&this._cache.unreadLen>=this._readingBoxWaiting)},t._isCurretFragmentEnd=function(){return!!(this._isFMP4&&this._fragmentEndOffset&&!this._hasMoreSamples()&&this._fragmentEndOffset<=this._offset+this._cache.unreadLen)},t._nextFragment=function(){this._isCurretFragmentEnd()&&(this._cache.skip(this._fragmentEndOffset-this._offset),this._offset=this._fragmentEndOffset,this._readingBox=void 0,this._readingBoxWaiting=8,this._fragmentEndOffset=0)},t.destroy=function(){},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.resetInitSegment=function(e,t){this._transmuxData=e,this._readSamples=!0,this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat=void 0,"boolean"==typeof e.hasAudio&&"boolean"==typeof e.hasVideo&&(this._audioTrack.active=e.hasAudio,this._videoTrack.active=e.hasVideo,this._videoTrack.active||(this._gopRemux=!1)),this._cache.clear(),t&&this._cache.put(t),this._vSampleIndex=0,this._aSampleIndex=0,this._offset=0,this._nextSampleInfo=void 0,this._slientAudio&&this._slientAudio.reset(),this._isFMP4&&(this._vSampleInfoList&&(this._vSampleInfoList.samples=[],this._vSampleInfoList.endPTS=0),this._aSampleInfoList&&(this._aSampleInfoList.samples=[],this._aSampleInfoList.endPTS=0),this._readingBoxWaiting=8,this._readingBox=void 0),a.b.i("mp4-demuxer","reset init")},t.resetTimeStamp=function(){},t.updateConfig=function(e){p()(this._config,e)},t._parseVideoSample=function(e,t){var i,n=0,a=[],s=!1,o=this._videoTrack;if(o.codecType===y.b.av1)this._av1Ctx||(this._av1Ctx=ae.createCtx()),ae.parseOBU(t,this._av1Ctx).forEach((function(e){var t;s=s||!(null==(t=e.content)||!t.keyframe),a.push({type:0,data:e.data})}));else for(;n<t.byteLength;){var c=Object(b.g)(t,n);n+=4;var u=t.subarray(n,n+c);3===this._naluLengthSize&&(c>>>=8);var d=0,_=void 0;o.codecType===y.b.h264?(d=31&u[0])===k.H264_NAL_IDR_SLICE?s=s||!0:k.PRIV_NAL_MAGIC_H264:Ee(o.codecType)?(d=(126&u[0])>>1)===G.a.HEVC_NAL_IDR_W_RADL||d===G.a.HEVC_NAL_IDR_N_LP?s=s||!0:G.a.PRIV_NAL_MAGIC_HEVC:(i=o.codecType)&&ye.indexOf(i)>=0&&(d=(248&u[1])>>3,_=(7&u[1])-1,d!==Te.a.VVC_NAL_UNIT_CODED_SLICE_IDR_W_RADL&&d!==Te.a.VVC_NAL_UNIT_CODED_SLICE_IDR_N_LP||(s=s||!0)),a.push({type:d,data:u,temporalId:_}),n+=c}if(a.length){var h={units:a,dts:e.dts,cts:e.cts,pts:e.pts,originDTS:e.dts,key:s,duration:e.duration};h.key&&this._evt.emit(r.a.KEY_FRAME,{cts:e.cts/o.inputTimescale,pts:e.pts/o.inputTimescale}),e.auxiliaryInfo&&(h.auxiliaryInfo=e.auxiliaryInfo),0!==e.index||this._remuxStat&&0!==this._remuxStat.timeOffset||(h.dts=h.pts=h.cts=h.originDTS=0),o.samples.push(h)}},t._parseAudioSample=function(e,t){var i,n,r=this._audioTrack;r.codecType===y.b.aac&&(t.length<=2||r.asc&&r.asc===Object(b.e)(t))||(r.codecType===y.b.mp3?i=null==(n=w(r,t,0,e.dts,0))?void 0:n.sample:(i={unit:t,dts:e.dts,pts:e.dts,duration:e.duration||e.duration||r.sampleDuration,originDTS:e.dts},e.auxiliaryInfo&&(i.auxiliaryInfo=e.auxiliaryInfo),r.samples.push(i)))},t._hasMoreSamples=function(){return!!(this._aSampleInfoList&&this._aSampleIndex<this._aSampleInfoList.samples.length||this._vSampleInfoList&&this._vSampleIndex<this._vSampleInfoList.samples.length)},t._getNextSampleInfo=function(){var e=this._aSampleInfoList?this._aSampleInfoList.samples[this._aSampleIndex]:void 0,t=this._vSampleInfoList?this._vSampleInfoList.samples[this._vSampleIndex]:void 0,i=e?e.start-this._offset:-1,n=t?t.start-this._offset:-1;return n>=0&&(n<i||n>i&&i<0)?t:i>=0&&(i<n||i>n&&n<0)?e:this._isFMP4&&(i<n&&null!=e&&e.noOffset||i>n&&null!=t&&t.noOffset)?"notReady":void 0},t._remux=function(e){void 0===e&&(e=!1);var t,i=this._audioTrack,s=this._videoTrack;s.outputRaw&&!i.active&&(this._slientAudio||(S.a.initAudioForFillSilent(i,null==(t=this._transmuxData)?void 0:t.audioCodec),this._slientAudio=new N.a),this._slientAudio.update(i,s));if(0!==i.samples.length||0!==s.samples.length){if(e||!(i.active&&0===i.samples.length||s.active&&s.samples.length<3)){var o=!0,c=0,u=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,u=this._remuxStat.accurateTimeOffset),this._firstRemux&&(this._firstRemux=!1,this._evt.emit(r.a.MEDIA_DEMUX,{type:this._isFMP4?l.b.FMP4:l.b.MP4}));try{this._remuxer.remux(i,s,c,o,u,e,this._pssh),this._remuxStat=void 0}catch(e){a.b.e("mp4-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},t._getTrexByID=function(e){if(this._moov)for(var t=0;t<this._moov.mvex.length;t++){var i;if((null==(i=this._moov.mvex[t].trex)?void 0:i.trackID)===e)return this._moov.mvex[t].trex}},t._getTrakByID=function(e){if(this._moov)for(var t=0;t<this._moov.trak.length;t++){var i;if((null==(i=this._moov.trak[t].tkhd)?void 0:i.trackId)===e)return this._moov.trak[t]}},t._parseMOOF=function(e,t){var i,n=this,r=We.moof(e);r.traf&&r.traf.length>1&&(this._remuxOnMoof=!0),null==(i=r.traf)||i.forEach((function(i){var r=i.tfdt,a=i.tfhd,s=i.trun;if(a&&s){var o,c=n._getTrexByID(a.trackID),u=(null==r?void 0:r.baseMediaDecodeTime)||0,d=0,_=a.defaultSampleSize||(null==c?void 0:c.defaultSampleSize)||0,h=_,l=a.defaultSampleDuration||(null==c?void 0:c.defaultSampleDuration)||0,f=a.trackID||0;f===n._videoTrack.id&&(o=n._videoTrack),f===n._audioTrack.id&&(o=n._audioTrack);var p=n._getTrakByID(f);if(p&&o){var v,m,A;if(null!=(v=p.mdia)&&null!=(m=v.mdhd)&&m.timescale&&(o.inputTimescale=p.mdia.mdhd.timescale),o.sampleDescIndex=a.sampleDescriptionIndex,o.type===y.l.VIDEO&&n._vSampleInfoList?A=n._vSampleInfoList:o.type===y.l.AUDIO&&n._aSampleInfoList&&(A=n._aSampleInfoList),!A)return;var g=A.samples.length;"video"===o.type&&n._vLastDTS>u?u=n._vLastDTS:"audio"===o.type&&n._aLastDTS>u&&(u=n._aLastDTS);var E=0;s.forEach((function(n){if(o&&A){var r=!n.dataOffset,s=0;r||(s=a.baseDataOffset?a.baseDataOffset+n.dataOffset:n.dataOffset+t-e.size);a.defaultSampleFlags||(null==c?void 0:c.defaultSampleFlags)||(null==n||n.firstSampleFlags);for(var f=0;f<(n.sampleCount||0);f++){l=n.sampleDuration[f]||l,d=n.sampleCompositionTimeOffset[f]||0,h=n.sampleSize[f]||_,l||o.type!==y.l.AUDIO||(l=T.c(o.samplerate,o.inputTimescale));var p={type:o.type,index:g,gopID:0,dts:u,cts:d,pts:u+d,duration:l,start:s,end:s+h,noOffset:r};if(i.senc)if(o.useSubSampleEnc=i.senc.useSubSampleEnc,i.senc.encItemData[f])p.auxiliaryInfo={enc:i.senc.encItemData[f]};else if(i.saiz&&i.senc.encData){var v=i.saiz.sampleInfoSize[f]||i.saiz.defaultSampleInfoSize;p.auxiliaryInfo={enc:i.senc.encData.subarray(E,E+v)},E+=v}s+=h,u+=l,n.sampleFlags[f]||a.defaultSampleFlags||0,g++,A.samples.push(p),A.endPTS=u+d}}})),"video"===o.type?n._vLastDTS=u:"audio"===o.type&&(n._aLastDTS=u)}}}))},t._parseSIDX=function(e,t){var i=We.sidx(e),n=this._vSampleInfoList;if(i&&n){n.keyframes=[];var a=0,s=t;i.references.forEach((function(e){n.keyframes.push({time:a,position:s}),a+=e.duration,s+=e.size})),this._evt.emit(r.a.KEY_FRAME_INDEXS,{keyframes:n.keyframes})}},t._parseMOOV=function(e){var t=this;a.b.i("mp4-demuxer","parse moov size: "+e.size),this._moov=We.moov(e);var i={mp4MoovSize:e.size};if(this._ftyp&&p()(i,this._ftyp),this._moov.mvhd){var n=this._moov.mvhd.timescale;this._duration=this._moov.mvhd.duration/n,this._duration||this._moov.mvex.forEach((function(e){e.mehd&&(i.duration=t._duration=e.mehd.fragmentDuration/n)})),i.duration=this._duration}if(this._pssh=[],this._moov.pssh.forEach((function(e){e.data&&t._pssh&&t._pssh.push(e.data)})),this._moov.trak.forEach((function(e){var i,n,r;if(e.mdia&&e.mdia.minf&&e.mdia.minf.stbl&&e.mdia.hdlr&&e.mdia.mdhd&&e.tkhd)if("vide"===e.mdia.hdlr.type)void 0===t._videoTrack.active&&(t._videoTrack.active=!0),t._vSampleInfoList=t._parseSTBL(t._videoTrack,e.mdia.minf.stbl,e.mdia.mdhd),t._videoTrack.rotation=Ve(e.tkhd.matrix),t._videoTrack.id=e.tkhd.trackId,null!=(i=t._pssh)&&i.length&&(t._videoTrack.stsd=null==(n=e.mdia.minf.stbl.stsd)?void 0:n.boxData),t._videoTrack.bitrate||(t._videoTrack.bitrate=8*((null==(r=t._vSampleInfoList)?void 0:r.size)||0)/1e3/(e.mdia.mdhd.duration/e.mdia.mdhd.timescale));else if("soun"===e.mdia.hdlr.type){var a,s,o;void 0===t._audioTrack.active&&(t._audioTrack.active=!0),t._audioTrack.id=e.tkhd.trackId,t._aSampleInfoList=t._parseSTBL(t._audioTrack,e.mdia.minf.stbl,e.mdia.mdhd),null!=(a=t._pssh)&&a.length&&(t._audioTrack.stsd=null==(s=e.mdia.minf.stbl.stsd)?void 0:s.boxData),t._audioTrack.bitrate||(t._audioTrack.bitrate=8*((null==(o=t._aSampleInfoList)?void 0:o.size)||0)/1e3/(e.mdia.mdhd.duration/e.mdia.mdhd.timescale))}})),this._vSampleInfoList&&this._vSampleInfoList.description.length&&this._parseVideoDescription(this._vSampleInfoList.description),this._aSampleInfoList&&this._aSampleInfoList.description.length&&this._parseAudioDescription(this._aSampleInfoList.description),this._vSampleInfoList){this._vSampleInfoList.keyframes&&(i.keyframes=this._vSampleInfoList.keyframes,this._aSampleInfoList&&this._aSampleInfoList.samples.length&&this._vSampleInfoList.keyframes.length&&this._aSampleInfoList.samples[0].start<this._vSampleInfoList.keyframes[0].position&&(i.keyframes[0]=p()({},i.keyframes[0]),i.keyframes[0].position=this._aSampleInfoList.samples[0].start));var s=[],o=this._videoTrack.inputTimescale;this._vSampleInfoList.samples.forEach((function(e){s.push({index:0,dts:e.dts/o,pts:e.pts/o,duration:e.duration/o})})),s.sort((function(e,t){return e.pts-t.pts})),s.forEach((function(e,t){e.index=t})),i.videoFramesInfo=s}else if(this._aSampleInfoList){var c,u=0,d=this._audioTrack.inputTimescale,_=[{time:0,position:null==(c=this._aSampleInfoList.samples[0])?void 0:c.start}];this._aSampleInfoList.samples.forEach((function(e){e.dts-u>10*d&&(_.push({time:e.dts/d,position:e.start}),u=e.dts)})),i.keyframes=_}a.b.i("mp4-demuxer","Parsed onMetaData"),this._evt.emit(r.a.METADATA,i)},t._seek=function(e){var t,i;if(a.b.i("mp4-demuxer","seek:"+e),0===e||this._isFMP4)return this._vSampleIndex=0,void(this._aSampleIndex=0);var n=null==(t=this._vSampleInfoList)?void 0:t.samples,r=null==(i=this._aSampleInfoList)?void 0:i.samples;if(n&&this._vSampleInfoList){var s=Ne.a.getPosByTime(this._vSampleInfoList.keyframes,e);s&&(this._vSampleIndex=this._findSampleIndexByPos(n,s.position))}r&&(this._vSampleInfoList?n&&(this._aSampleIndex=this._findSampleIndexByPos(r,n[this._vSampleIndex].end),a.b.i("mp4-demuxer","seek audio by video pos: "+e+" a: "+this._aSampleIndex+" v: "+this._vSampleIndex)):(this._aSampleIndex=this._findSampleIndexByTime(r,e*this._videoTrack.inputTimescale),a.b.i("mp4-demuxer","seek audio by time: "+e+" a: "+this._aSampleIndex+" v: "+this._vSampleIndex)))},t._findSampleIndexByPos=function(e,t){if(e[0]&&t<e[0].start)return 0;if(e[e.length-1]&&t>=e[e.length-1].end)return e.length-1;for(var i,n=0,r=e.length-1,a=0,s=0;n<=r;){if(t>=((i=(s=(a=(n+r)/2|0)-1)>=0?e[s]:void 0)?i.end:e[a].start)&&t<e[a].end)return a;if(t===e[a].end)return a+1;t>e[a].end?n=a+1:r=a-1}return 0},t._findSampleIndexByTime=function(e,t){if(e[0]&&t<e[0].dts)return 0;if(e[e.length-1]&&t>=e[e.length-1].dts)return e.length-1;for(var i=0,n=e.length-1,r=0,a=0,s=0;i<=n;)if(t>(s=e[a=1+(r=(i+n)/2|0)]?e[a].dts:Number.MAX_SAFE_INTEGER))i=a;else{if(!(t<e[r].dts))return t===s?a:r;n=r-1}return 0},t._parseVideoDescription=function(e){var t=this;a.b.i("mp4-demuxer","parse video desc: "+e[0].name);var i=!1;e.forEach((function(n){"avc1"!==n.name&&"hev1"!==n.name&&"hvc1"!==n.name&&"kvc3"!==n.name&&"kvc4"!==n.name&&"kvc5"!==n.name&&"kvc6"!==n.name&&"av01"!==n.name&&"encv"!==n.name&&"bvc2"!==n.name&&"kvc7"!==n.name&&"vvc1"!==n.name||(t._parseVideoSampleEntry(e[0]),i=!0)})),i||(a.b.i("mp4-demuxer","video codec unsupported"),this._videoTrack.active=!1)},t._parseAudioDescription=function(e){var t=this;a.b.i("mp4-demuxer","parse audio desc: "+e[0].name);var i=!1;e.forEach((function(e){("mp4a"===e.name||"enca"===e.name||"Opus"===e.name&&t._typeSupported.opus)&&(t._parseAudioSampleEntry(e),i=!0)})),i||(a.b.i("mp4-demuxer","audio codec unsupported"),this._audioTrack.active=!1)},t._parseAudioSampleEntry=function(e){var t=this;if(e.data&&e.data){var i=8,n=Object(b.e)(e.data,i);i+=n>=2?56:1===n?36:20,We.readBoxes(e.data.subarray(i,e.data.byteLength)).forEach((function(e){if("esds"===e.name)t._readEsds(e);else if("wave"===e.name&&e.data)We.readBoxes(e.data).forEach((function(e){"esds"===e.name&&t._readEsds(e)}));else if("btrt"===e.name){var i=We.btrt(e);i&&(t._audioTrack.maxBitrate=i.maxBitrate/1e3,t._audioTrack.bitrate=i.avgBitrate/1e3)}else"dOps"===e.name&&e.data&&(t._audioTrack.codecType=y.b.opus,t._audioTrack.codec="opus",t._audioTrack.channelCount=e.data[1],t._audioTrack.samplerate=Object(b.g)(e.data,4))}))}},t._readEsds=function(e){if("esds"===e.name){var t=this._audioTrack,i=We.esds(e);if(i){var n=Be.getObjectTypeIndication(i);if(-1===Ke.indexOf(n))return void(t.active=!1);if(-1!==Qe.indexOf(n)){var r=Be.getAudioConfig(i);r&&T.d(t,this._evt,r,l.a.ASC),t.codecType=y.b.aac}else t.codecType=y.b.mp3}}},t._parseVideoSampleEntry=function(e){var t=this;if(e.data){var i=this._videoTrack;We.readBoxes(e.data.subarray(78,e.data.byteLength)).forEach((function(n){var a;if("avcC"===n.name)i.codecType=Ye[n.name],t._parseAvcC(i,n),t._checkFps(i),t._evt.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:y.c.buildin,codecType:y.b.h264,timeOffset:(null==(a=t._remuxStat)?void 0:a.timeOffset)||0});else if("hvcC"===n.name)Ee(i.codecType)||(i.codecType=Ye[e.name]||y.b.hevc,i.codecType===y.b.hevc?we.onHEVCDetected(i,t._config,t._typeSupported):we.onKVCDetected(i,t._config,t._typeSupported)),t._parseHvcC(i,n),t._checkFps(i);else if("av1C"===n.name)i.codecType=Ye[n.name],we.onAV1Detected(i,t._config,t._typeSupported),t._parseAv1C(i,n),t._checkFps(i);else if("vvcC"===n.name||"bv2C"===n.name||"kvLC"===n.name)i.codecType=Ye[n.name],we.onVVCDetected(i,t._config,t._typeSupported),t._parseVvcC(i,n),t._checkFps(i);else if("btrt"===n.name){var s=We.btrt(n);s&&(i.maxBitrate=s.maxBitrate/1e3,i.bitrate=s.avgBitrate/1e3)}}))}},t._parseAv1C=function(e,t){if(t.data){this._av1Ctx=ae.createCtx();var i=De.parseAV1C(t.data,this._av1Ctx);i?we.updateAV1Track(e,i.sh,t.data):this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AV1DecoderConfigurationRecord"})}},t._parseAvcC=function(e,t){if(t.data){var i=De.parseAVCC(t.data);i?we.updateAVCTrack(e,i.paramSets,t.data):this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AVCDecoderConfigurationRecord"})}},t._parseHvcC=function(e,t){var i;if(a.b.i("mp4-demuxer","parse hvcc"),t.data){var s=De.parseHVCC(t.data,e.codecType);if(s&&s.paramSets.spsList.length){if(we.updateHEVCTrack(e,s.paramSets),this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{codecType:e.codecType||y.b.unknown,enabled:!!e.active,decoder:this._videoTrack.outputRaw?y.c.wasm:y.c.buildin,bitDepth:e.bitDepth,timeOffset:(null==(i=this._remuxStat)?void 0:i.timeOffset)||0}),this._videoTrack.outputRaw){var o=De.hevDecoderConfigToSample(s.paramSets,0);this._evt.emit(r.a.RAW_DATA,{type:l.c.decoderConfig,samples:g([o],e.inputTimescale),extra:this._transmuxData})}}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid HEVCDecoderConfigurationRecord"})}},t._parseVvcC=function(e,t){var i,s;if(a.b.i("mp4-demuxer","parse vvcC"),t.data)if((s=e.codecType===y.b.kvc30?De.parseKvLC(t.data,e.codecType):e.codecType===y.b.bvc2?De.parseBV2C(t.data,e.codecType):De.parseVvcC(t.data,e.codecType))&&s.paramSets.spsList.length){if(we.updateVVCTrack(e,s.paramSets),e.sampleDuration=this._vSampleInfoList&&this._vSampleInfoList.samples.length?Math.round(this._duration*e.inputTimescale/this._vSampleInfoList.samples.length):3003,e.duration=this._duration,this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{codecType:e.codecType||y.b.unknown,enabled:!!e.active,decoder:this._videoTrack.outputRaw?y.c.wasm:y.c.buildin,bitDepth:e.bitDepth,timeOffset:(null==(i=this._remuxStat)?void 0:i.timeOffset)||0}),this._videoTrack.outputRaw){var o=De.vvcDecoderConfigToSample(s.paramSets,0);this._evt.emit(r.a.RAW_DATA,{type:l.c.decoderConfig,samples:[o],extra:this._transmuxData})}}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid VVCDecoderConfigurationRecord"})},t._parseSTBL=function(e,t,i){a.b.i("mp4-demuxer","parse stbl");var n={description:t.stsd?t.stsd.sampleEntrys:[],samples:[],keyframes:[],endPTS:0,size:0};if(e.inputTimescale=i.timescale,e.duration=i.duration,t.stco&&t.stsc&&t.stsz&&t.stsz.sampleCount){var r,s=0,o=0,c=t.stco.chunkOffset[s],u=t.stsc.sampleToChunkBox[o],d=u.samplesPerChunk,_=t.stsc.sampleToChunkBox[o].firstChunk,h=0,l=Math.ceil(Object(Me.c)(1,e.inputTimescale)),f=0,p=void 0,v=0,m=0;t.stts&&(p=t.stts.timeToSample[f],v=t.stts.timeToSample[f].sampleCount);var A=0,g=void 0,E=0,b=0;t.ctts&&(g=t.ctts.compositionOffset[A],E=t.ctts.compositionOffset[A].sampleCount);var T=0,S=0;t.stss&&(S=t.stss.sampleNumber[T]);for(var x=0;x<t.stsz.sampleCount;x++)if(x>=d&&s<t.stco.chunkOffset.length&&(h=0,_++,s++,c=t.stco.chunkOffset[s],t.stsc.sampleToChunkBox[o+1]&&_>=t.stsc.sampleToChunkBox[o+1].firstChunk&&(o++,u=t.stsc.sampleToChunkBox[o]),d+=u.samplesPerChunk),t.stts&&x>=v&&f<t.stts.timeToSample.length-1&&(f++,v+=(p=t.stts.timeToSample[f]).sampleCount),t.ctts&&x>=E&&A<t.ctts.compositionOffset.length&&(A++,E+=(g=t.ctts.compositionOffset[A]).sampleCount),t.stss&&x>=S-1&&S&&(T++,S=t.stss.sampleNumber[T],r={time:0,position:0}),u&&c){var C,L;b=(null==(C=g)?void 0:C.sampleOffset)||0;var R="number"==typeof t.stsz.SampleSize?t.stsz.SampleSize:t.stsz.SampleSize[x],D=Math.max(l,(null==(L=p)?void 0:L.sampleDelta)||0),w=m+b,I={type:e.type,index:x,gopID:n.keyframes.length||1,dts:m,cts:b,pts:w,duration:D,start:c+h,end:c+h+R};w>n.endPTS&&(n.endPTS=w),n.samples.push(I),n.size+=R,r&&(r.time=n.keyframes.length?Math.round((m+b)/e.inputTimescale*1e3)/1e3:0,r.position=I.start,n.keyframes.push(r),r=void 0),m+=D,h+=R,!t.stss&&0===n.keyframes.length&&n.samples.length&&n.keyframes.push({time:0,position:n.samples[0].start})}return e.type===y.l.VIDEO&&n.samples.length&&i.timescale&&(n.fps=n.samples.length/(i.duration/i.timescale)),n.samples.length&&(e.sampleDuration=this._duration*e.inputTimescale/n.samples.length),n}return n},t._checkFps=function(e){var t,i;null!=(t=this._vSampleInfoList)&&t.fps&&Object(ke.a)(null==(i=this._vSampleInfoList)?void 0:i.fps)&&this._vSampleInfoList.fps>0&&(e.fps=this._vSampleInfoList.fps)},m()(e,null,[{key:"probeSize",get:function(){return 8}}]),e}();!function(e){e[e.AV_PICTURE_STRUCTURE_UNKNOWN=0]="AV_PICTURE_STRUCTURE_UNKNOWN",e[e.AV_PICTURE_STRUCTURE_TOP_FIELD=1]="AV_PICTURE_STRUCTURE_TOP_FIELD",e[e.AV_PICTURE_STRUCTURE_BOTTOM_FIELD=2]="AV_PICTURE_STRUCTURE_BOTTOM_FIELD",e[e.AV_PICTURE_STRUCTURE_FRAME=3]="AV_PICTURE_STRUCTURE_FRAME"}(He||(He={})),function(e){e[e.MMCO_END=0]="MMCO_END",e[e.MMCO_SHORT2UNUSED=1]="MMCO_SHORT2UNUSED",e[e.MMCO_LONG2UNUSED=2]="MMCO_LONG2UNUSED",e[e.MMCO_SHORT2LONG=3]="MMCO_SHORT2LONG",e[e.MMCO_SET_MAX_LONG=4]="MMCO_SET_MAX_LONG",e[e.MMCO_RESET=5]="MMCO_RESET",e[e.MMCO_LONG=6]="MMCO_LONG"}(je||(je={})),function(e){e[e.AV_PICTURE_TYPE_NONE=0]="AV_PICTURE_TYPE_NONE",e[e.AV_PICTURE_TYPE_I=1]="AV_PICTURE_TYPE_I",e[e.AV_PICTURE_TYPE_P=2]="AV_PICTURE_TYPE_P",e[e.AV_PICTURE_TYPE_B=3]="AV_PICTURE_TYPE_B",e[e.AV_PICTURE_TYPE_S=4]="AV_PICTURE_TYPE_S",e[e.AV_PICTURE_TYPE_SI=5]="AV_PICTURE_TYPE_SI",e[e.AV_PICTURE_TYPE_SP=6]="AV_PICTURE_TYPE_SP",e[e.AV_PICTURE_TYPE_BI=7]="AV_PICTURE_TYPE_BI"}(ze||(ze={})),function(e){e[e.HEVC_SLICE_B=0]="HEVC_SLICE_B",e[e.HEVC_SLICE_P=1]="HEVC_SLICE_P",e[e.HEVC_SLICE_I=2]="HEVC_SLICE_I"}(Ge||(Ge={}));var qe,Ze=[ze.AV_PICTURE_TYPE_P,ze.AV_PICTURE_TYPE_B,ze.AV_PICTURE_TYPE_I,ze.AV_PICTURE_TYPE_SP,ze.AV_PICTURE_TYPE_SI],Je=function(){function e(e,t,i,n){var a=this;this._evt=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._typeSupported=void 0,this._cache=void 0,this._slientAudio=void 0,this._transmuxData=void 0,this._firstRemux=!0,this._remuxStat=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._psUpdated=!1,this._vSample=void 0,this._vSampleIndex=0,this._vSampleIndexOnGOPStart=0,this._lastPTS=0,this._frameDuration=A.e/A.c,this._codecParserContext=void 0,this._onError=function(e){a._evt.emit(r.a.ERROR,e)},this._evt=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._cache=new _.a,this._initTrack(1/0),this._newSample(),this._slientAudio=new N.a}e.probe=function(e){return e.length>4&&0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]};var t=e.prototype;return t.resetInitSegment=function(e){this._initTrack(e.duration),this._transmuxData=e,this._firstRemux=!0,this._remuxStat=void 0,this._psUpdated=!1,this._vSample=void 0,this._vSampleIndex=0,this._vSampleIndexOnGOPStart=0,this._newSample(),this._cache.clear(),this._slientAudio&&this._slientAudio.reset(),a.b.i("raw-demuxer","reset init")},t.resetTimeStamp=function(e){},t.append=function(e,t,i,n,a){var s=this._findStartCode(e);if(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:n}),s&&s.length){var o=-this._cache.unreadLen;this._cache.put(e);for(var c=0,u=0;u<s.length;u++){if(c=s[u].pos-o-s[u].state){var d=this._cache.get(c);this._cache.skip(s[u].state),d&&(d=3===s[u].state&&0===d[d.length-1]?d.subarray(0,d.length-1):d,this._parseNalu(d))}else this._cache.skip(s[u].state);o=s[u].pos}}else this._cache.put(e);if(a){var _,h=this._cache.get(this._cache.unreadLen);h&&(this._parseNalu(h),this._vSample&&this._videoTrack&&this._nextSample(),this.flush());var l={duration:(this._lastPTS+this._frameDuration)/((null==(_=this._videoTrack)?void 0:_.inputTimescale)||A.e)};this._evt.emit(r.a.METADATA,l)}},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.destroy=function(){},t.updateConfig=function(e){p()(this._config,e)},t._initTrack=function(e){var t;this._videoTrack=Object(M.b)(e),this._videoTrack.naluState=0,this._videoTrack.active=!0,this._audioTrack=Object(M.a)(e),S.a.initAudioForFillSilent(this._audioTrack,null==(t=this._transmuxData)?void 0:t.audioCodec)},t._findStartCode=function(e){var t=this._videoTrack;if(t){for(var i=e.byteLength,n=[],r=0,s=t.naluState;r<i;)i-r>3&&0===s?(1===e[r+2]?0===e[r+1]&&0===e[r]&&n.push({pos:r+3,state:3}):0===e[r+2]&&(s=1,0===e[r+1]&&(s=2,0===e[r]&&(s=3))),r+=3):(s<2?0===e[r]?s++:s=0:3===s||2===s?1===e[r]?(n.push({pos:r+1,state:s+1}),s=0):e[r]>1&&(s=0):a.b.w("raw-demuxer","error state",s),r++);return t.naluState=s,n}},t._remux=function(e){void 0===e&&(e=!1),this._nextSample();var t=this._audioTrack,i=this._videoTrack;if(i&&t)if(this._slientAudio.update(t,i),0!==t.samples.length||0!==i.samples.length){if(e||!(t.active&&0===t.samples.length||i.active&&i.samples.length<3)){this._firstRemux&&(this._evt.emit(r.a.KEY_FRAME_INDEXS,{keyframes:[{time:0,position:0}]}),this._firstRemux=!1,this._evt.emit(r.a.MEDIA_DEMUX,{type:l.b.RAW}));var s=Object(Oe.a)(i,this._vSampleIndexOnGOPStart);this._evt.emit(r.a.VIDEO_FRAME_INFO,{videoFramesInfo:s});var o=!0,c=0,u=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,u=this._remuxStat.accurateTimeOffset);try{this._remuxer.remux(t,i,c,o,u,e),this._remuxStat=void 0}catch(e){a.b.e("raw-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},t._parseNalu=function(e){var t=this._videoTrack;if(t){if(!t.codecType||t.codecType===y.b.unknown){var i=31&e[0],a=(126&e[0])>>1;if(i>=k.H264_NAL_SPS&&i<=k.H264_NAL_AUD)t.codecType=y.b.h264,this._codecParserContext={pict_type:ze.AV_PICTURE_TYPE_NONE,picture_structure:He.AV_PICTURE_STRUCTURE_UNKNOWN,key_frame:0,priv_data:{picture_structure:He.AV_PICTURE_STRUCTURE_UNKNOWN,poc:{poc_lsb:0,poc_msb:0,delta_poc_bottom:0,delta_poc:[],frame_num:0,prev_poc_msb:0,prev_poc_lsb:0,frame_num_offset:0,prev_frame_num_offset:0,prev_frame_num:0},ps:{spsList:[],ppsList:[]}}},this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:y.c.buildin,codecType:y.b.h264,timeOffset:0});else{if(!(a>=G.a.HEVC_NAL_VPS&&a<=G.a.HEVC_NAL_AUD||a===G.a.HEVC_NAL_SEI_PREFIX||a===G.a.HEVC_NAL_SEI_SUFFIX))return void this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"unsupport codec"});var s,o,c,u;this._codecParserContext={pict_type:ze.AV_PICTURE_TYPE_NONE,picture_structure:He.AV_PICTURE_STRUCTURE_UNKNOWN,key_frame:0,priv_data:{ps:{spsList:[],ppsList:[],vpsList:[]},poc:0,pocTid0:0,max_dec_pic_buffering:0}},".kvc3"===(null==(s=this._transmuxData)?void 0:s.suffix)?t.codecType=y.b.kvc3:".kvc4"===(null==(o=this._transmuxData)?void 0:o.suffix)?t.codecType=y.b.kvc4:".kvc5"===(null==(c=this._transmuxData)?void 0:c.suffix)?t.codecType=y.b.kvc5:".kvc6"===(null==(u=this._transmuxData)?void 0:u.suffix)?t.codecType=y.b.kvc6:t.codecType=y.b.hevc}}t.codecType===y.b.h264?this._parseH264Nalu(e):Ee(t.codecType)&&this._parseHEVCNalu(e)}},t._parseH264Nalu=function(e){var t=this._codecParserContext,i=this._videoTrack;if(t&&i){var n=t.priv_data,a=[0,0],s=0;t.pict_type=ze.AV_PICTURE_TYPE_I,t.key_frame=0,t.picture_structure=He.AV_PICTURE_STRUCTURE_UNKNOWN;var o={ref_idc:e[0]>>5&3,type:31&e[0],nuh_layer_id:0,temporal_id:0,data:e};switch(o.type){case k.H264_NAL_IDR_SLICE:i.decConf&&this._remux(),this._vSampleIndexOnGOPStart=this._vSampleIndex,t.key_frame=1,n.poc.prev_frame_num=0,n.poc.prev_frame_num_offset=0,n.poc.prev_poc_msb=n.poc.prev_poc_lsb=0;case k.H264_NAL_SLICE:var c=Q(se(e.subarray(1,e.byteLength)));o.gbCtx=c,q(c);var u=q(c);t.pict_type=Ze[u%5];var d=q(c),_=n.ps.ppsList[d],h=n.ps.spsList[_.sps_id];n.ps.sps=h,n.ps.pps=_,n.ps.sps.ref_frame_count<=1&&n.ps.pps.ref_count[0]<=1&&t.pict_type===ze.AV_PICTURE_TYPE_I&&(t.key_frame=1),n.poc.frame_num=X(c,h.log2_max_frame_num),h.frame_mbs_only_flag?n.picture_structure=He.AV_PICTURE_STRUCTURE_FRAME:X(c,1)?n.picture_structure=He.AV_PICTURE_STRUCTURE_TOP_FIELD+X(c,1):n.picture_structure=He.AV_PICTURE_STRUCTURE_FRAME,o.type===k.H264_NAL_IDR_SLICE&&q(c),0===h.pic_order_cnt_type&&(n.poc.poc_lsb=X(c,h.log2_max_poc_lsb),1==_.pic_order_present&&n.picture_structure==He.AV_PICTURE_STRUCTURE_FRAME&&(n.poc.delta_poc_bottom=Z(c))),1!=h.pic_order_cnt_type||h.delta_pic_order_always_zero_flag||(n.poc.delta_poc[0]=Z(c),1==_.pic_order_present&&n.picture_structure===He.AV_PICTURE_STRUCTURE_FRAME&&(n.poc.delta_poc[1]=Z(c))),a[0]=a[1]=Number.MAX_SAFE_INTEGER;var l=this.ff_h264_init_poc(a,h,n.poc,n.picture_structure,o.ref_idc);if(o.ref_idc&&o.type!==k.H264_NAL_IDR_SLICE&&(s=this.scan_mmco_reset(t,c))<0)return;if(n.poc.prev_frame_num=s?0:n.poc.frame_num,n.poc.prev_frame_num_offset=s?0:n.poc.frame_num_offset,0!==o.ref_idc&&(s?(n.poc.prev_poc_msb=0,n.poc.prev_poc_lsb=n.picture_structure===He.AV_PICTURE_STRUCTURE_BOTTOM_FIELD?0:a[0]):(n.poc.prev_poc_msb=n.poc.poc_msb,n.poc.prev_poc_lsb=n.poc.poc_lsb)),!i.decConf){var f;this._psUpdated&&this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),we.updateAVCTrack(i,n.ps),this._checkFps(i);var p=De.avcDecoderConfigToNalu(n.ps);this._vSample&&(f=this._vSample.units).push.apply(f,p),i.fps&&(this._frameDuration=i.inputTimescale/i.fps)}this._vSample&&(-1!==this._vSample.poc&&Math.floor(l/2)!==Math.floor(this._vSample.poc/2)&&this._nextSample(),this._vSample.units.push({type:o.type,data:o.data}),-1===this._vSample.poc&&(this._vSample.pts=this._vSampleIndex?(l/2+this._vSampleIndexOnGOPStart+h.ref_frame_count)*this._frameDuration:0,this._vSample.cts=this._vSample.pts-this._vSample.dts,this._vSample.pts>this._lastPTS&&(this._lastPTS=this._vSample.pts),this._vSample.key=!!t.key_frame,this._vSample.poc=l,this._vSample.key&&this._evt.emit(r.a.KEY_FRAME)));break;case k.H264_NAL_AUD:break;case k.H264_NAL_SPS:var v=de.parse(e);v&&(n.ps.sps&&!Object(b.b)(n.ps.sps.data,v.data)&&(this._psUpdated=!0),n.ps.spsList[v.sps_id]=v),i.decConf&&this._remux(),i.decConf=void 0;break;case k.H264_NAL_PPS:var m=ue.parse(e);m&&(n.ps.pps&&!Object(b.b)(n.ps.pps.data,m.data)&&(this._psUpdated=!0),n.ps.ppsList[m.pps_id]=m),i.decConf&&this._remux(),i.decConf=void 0}}},t._parseHEVCNalu=function(e){var t=this._codecParserContext,i=this._videoTrack;if(t&&i){var a,s=t.priv_data;t.pict_type=ze.AV_PICTURE_TYPE_I,t.key_frame=0,t.picture_structure=He.AV_PICTURE_STRUCTURE_UNKNOWN;var o={type:(126&e[0])>>1,nuh_layer_id:(1&e[0])<<5&e[1]>>3&31,temporal_id:(7&e[1])-1,ref_idc:0,data:e};if(!(o.nuh_layer_id>0))switch(o.type){case G.a.HEVC_NAL_TRAIL_N:case G.a.HEVC_NAL_TRAIL_R:case G.a.HEVC_NAL_TSA_N:case G.a.HEVC_NAL_TSA_R:case G.a.HEVC_NAL_STSA_N:case G.a.HEVC_NAL_STSA_R:case G.a.HEVC_NAL_BLA_W_LP:case G.a.HEVC_NAL_BLA_W_RADL:case G.a.HEVC_NAL_BLA_N_LP:case G.a.HEVC_NAL_IDR_W_RADL:case G.a.HEVC_NAL_IDR_N_LP:case G.a.HEVC_NAL_CRA_NUT:case G.a.HEVC_NAL_RADL_N:case G.a.HEVC_NAL_RADL_R:case G.a.HEVC_NAL_RASL_N:case G.a.HEVC_NAL_RASL_R:if(!i.decConf&&(this._psUpdated&&this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),we.updateHEVCTrack(i,s.ps),i.decConf&&(this._checkFps(i),this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{codecType:i.codecType||y.b.unknown,enabled:!!i.active,decoder:i.outputRaw?y.c.wasm:y.c.buildin,bitDepth:i.bitDepth,timeOffset:0}),i.fps&&(this._frameDuration=i.inputTimescale/i.fps),i.outputRaw))){var c=De.hevDecoderConfigToSample(s.ps,this._vSample?this._vSample.dts:0);this._evt.emit(r.a.RAW_DATA,{type:l.c.decoderConfig,samples:g([c],i.inputTimescale),extra:this._transmuxData})}if(o.gbCtx=Q(se(o.data.subarray(2,o.data.byteLength))),a=this.hevc_parse_slice_header(t,o))return a;break;case G.a.HEVC_NAL_AUD:break;case G.a.HEVC_NAL_SEI_PREFIX:case G.a.HEVC_NAL_SEI_SUFFIX:i.decConf?(this._nextSample(),this._vSample&&this._vSample.units.push({type:G.a.HEVC_NAL_SEI_PREFIX,data:e})):(s.ps.seiList||(s.ps.seiList=[]),s.ps.seiList.push({type:o.type,data:e}));break;case G.a.HEVC_NAL_SPS:var u=me.parse(e,i.codecType);if(u&&(s.ps.sps&&!Object(b.b)(s.ps.sps.data,u.data)&&(this._psUpdated=!0),s.ps.spsList[u.sps_id]=u,s.max_dec_pic_buffering=u.temporal_layer.reduce((function(e,t){return Math.max(e,t.max_dec_pic_buffering)}),0)),!(i.codecType===y.b.hevc?we.onHEVCDetected(i,this._config,this._typeSupported):we.onKVCDetected(i,this._config,this._typeSupported)))return void this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"unsupport codec hevc"});i.decConf&&this._remux(),i.decConf=void 0;break;case G.a.HEVC_NAL_PPS:var d=le.parse(e);d&&(s.ps.pps&&!Object(b.b)(s.ps.pps.data,d.data)&&(this._psUpdated=!0),s.ps.ppsList[d.pps_id]=d),i.decConf&&this._remux(),i.decConf=void 0;break;case G.a.HEVC_NAL_VPS:var _=Ae.parse(e);_&&(s.ps.vps&&!Object(b.b)(s.ps.vps.data,_.data)&&(this._psUpdated=!0),s.ps.vpsList[_.vps_id]=_),i.decConf&&this._remux(),i.decConf=void 0}}},t._nextSample=function(){this._videoTrack&&this._vSample&&this._vSample.units.length&&-1!==this._vSample.pts&&(this._videoTrack.samples.push(this._vSample),this._vSampleIndex++,this._vSample=void 0),this._vSample||this._newSample()},t._newSample=function(){var e=this._vSampleIndex*this._frameDuration;this._vSample={poc:-1,key:!1,pts:-1,dts:e,cts:0,units:[],originDTS:e,duration:this._frameDuration}},t.hevc_parse_slice_header=function(e,t){var i,n,s,o=e.priv_data,c=o.ps,u=t.gbCtx;if(!u)return-1;n=X(u,1),function(e){return e.type>=16&&e.type<=23}(t)&&(e.key_frame=1,Y(u,1));var d=q(u);if(c.pps=c.ppsList[d],c.sps=c.spsList[c.pps.sps_id],c.vps=c.vpsList[c.sps.vps_id],n)s=0;else{s=c.pps.dependent_slice_segments_enabled_flag?X(u,1):0;var _=X(u,Math.ceil(Math.log2(c.sps.ctb_width*c.sps.ctb_height)));if(_>=c.sps.ctb_width*c.sps.ctb_height)return a.b.i("raw-demuxer","Invalid slice segment address: "+_+"."),-1}if(s)return 0;for(i=0;i<c.pps.num_extra_slice_header_bits;i++)Y(u,1);var h=q(u);if(h!==Ge.HEVC_SLICE_I&&h!==Ge.HEVC_SLICE_P&&h!==Ge.HEVC_SLICE_B)return a.b.i("raw-demuxer","Unknown slice type: %d.\n",h),-1;e.pict_type=h===Ge.HEVC_SLICE_B?ze.AV_PICTURE_TYPE_B:h===Ge.HEVC_SLICE_P?ze.AV_PICTURE_TYPE_P:ze.AV_PICTURE_TYPE_I,c.pps.output_flag_present_flag&&Y(u,1),c.sps.separate_colour_plane_flag&&Y(u,2);var l=function(e){return e.type===G.a.HEVC_NAL_IDR_W_RADL||e.type===G.a.HEVC_NAL_IDR_N_LP}(t);if(l)o.poc=0,this._remux(),this._vSampleIndexOnGOPStart=this._vSampleIndex;else{var f=X(u,c.sps.log2_max_poc_lsb);o.poc=this.ff_hevc_compute_poc(c.sps,o.pocTid0,f,t.type)}return 0===t.temporal_id&&t.type!==G.a.HEVC_NAL_TRAIL_N&&t.type!==G.a.HEVC_NAL_TSA_N&&t.type!==G.a.HEVC_NAL_STSA_N&&t.type!==G.a.HEVC_NAL_RADL_N&&t.type!==G.a.HEVC_NAL_RASL_N&&t.type!==G.a.HEVC_NAL_RADL_R&&t.type!==G.a.HEVC_NAL_RASL_R&&(o.pocTid0=o.poc),this._vSample&&(-1!==this._vSample.poc&&o.poc!==this._vSample.poc&&this._nextSample(),this._vSample.units.push({type:t.type,data:t.data}),-1===this._vSample.pts&&(this._vSample.pts=this._vSampleIndex?(o.poc+this._vSampleIndexOnGOPStart+o.max_dec_pic_buffering)*this._frameDuration:0,this._vSample.cts=this._vSample.pts-this._vSample.dts,this._vSample.pts>this._lastPTS&&(this._lastPTS=this._vSample.pts),this._vSample.key=l,this._vSample.poc=o.poc,this._vSample.key&&this._evt.emit(r.a.KEY_FRAME))),1},t.ff_hevc_compute_poc=function(e,t,i,n){var r,a=1<<e.log2_max_poc_lsb,s=t%a,o=t-s;return r=i<s&&s-i>=a/2?o+a:i>s&&i-s>a/2?o-a:o,n!==G.a.HEVC_NAL_BLA_W_LP&&n!==G.a.HEVC_NAL_BLA_W_RADL&&n!==G.a.HEVC_NAL_BLA_N_LP||(r=0),r+i},t.ff_h264_init_poc=function(e,t,i,n,r){var a=1<<t.log2_max_frame_num,s=[];if(i.frame_num_offset=i.prev_frame_num_offset,i.frame_num<i.prev_frame_num&&(i.frame_num_offset+=a),0===t.pic_order_cnt_type){var o=1<<t.log2_max_poc_lsb;i.prev_poc_lsb<0&&(i.prev_poc_lsb=i.poc_lsb),i.poc_lsb<i.prev_poc_lsb&&i.prev_poc_lsb-i.poc_lsb>=o/2?i.poc_msb=i.prev_poc_msb+o:i.poc_lsb>i.prev_poc_lsb&&i.prev_poc_lsb-i.poc_lsb<-o/2?i.poc_msb=i.prev_poc_msb-o:i.poc_msb=i.prev_poc_msb,s[0]=s[1]=i.poc_msb+i.poc_lsb,n===He.AV_PICTURE_STRUCTURE_FRAME&&(s[1]+=i.delta_poc_bottom)}else if(1===t.pic_order_cnt_type){var c,u,d,_;for(c=0!==t.num_ref_frames_in_pic_order_cnt_cycle?i.frame_num_offset+i.frame_num:0,0===r&&c>0&&c--,u=0,_=0;_<t.num_ref_frames_in_pic_order_cnt_cycle;_++)u+=t.offset_for_ref_frame[_];if(c>0){var h=(c-1)/t.num_ref_frames_in_pic_order_cnt_cycle,l=(c-1)%t.num_ref_frames_in_pic_order_cnt_cycle;for(d=h*u,_=0;_<=l;_++)d+=t.offset_for_ref_frame[_]}else d=0;0==r&&(d+=t.offset_for_non_ref_pic),s[0]=d+i.delta_poc[0],s[1]=s[0]+t.offset_for_top_to_bottom_field,n===He.AV_PICTURE_STRUCTURE_FRAME&&(s[1]+=i.delta_poc[1])}else{var f=2*(i.frame_num_offset+i.frame_num);r||f--,s[0]=f,s[1]=f}return n!==He.AV_PICTURE_STRUCTURE_BOTTOM_FIELD&&(e[0]=s[0]),n!==He.AV_PICTURE_STRUCTURE_TOP_FIELD&&(e[1]=s[1]),Math.min(e[0],e[1])},t.scan_mmco_reset=function(e,t){var i=e.priv_data;if(!i.ps.pps)return-1;var n=3&e.pict_type,r=0,s=[];i.ps.pps.redundant_pic_cnt_present&&q(t),n===ze.AV_PICTURE_TYPE_B&&X(t,1);var o={list_count:r};if(this.ff_h264_parse_ref_count(o,s,t,i.ps.pps,n,i.picture_structure)<0)return-2;if(r=o.list_count,n!==ze.AV_PICTURE_TYPE_I)for(var c=0;c<r;c++)if(X(t,1))for(var u=0;;u++){var d=q(t);if(!(d<3)){if(d>3)return a.b.i("raw-demuxer","illegal reordering_of_pic_nums_idc %d\n",d),-3;break}if(q(t),u>=s[c])return a.b.i("raw-demuxer","reference count %d overflow\n",u),-4}if((i.ps.pps.weighted_pred&&n===ze.AV_PICTURE_TYPE_P||1===i.ps.pps.weighted_bipred_idc&&n==ze.AV_PICTURE_TYPE_B)&&i.ps.sps&&this.ff_h264_pred_weight_table(t,i.ps.sps,s,n,{use_weight:0,use_weight_chroma:0,luma_log2_weight_denom:0,chroma_log2_weight_denom:0,luma_weight_flag:[],chroma_weight_flag:[]},i.picture_structure),X(t,1))for(var _=0;_<66;_++){var h=q(t);if(h>je.MMCO_LONG)return a.b.i("raw-demuxer","illegal memory management control operation "+h),-5;if(h===je.MMCO_END)return 0;if(h===je.MMCO_RESET)return 1;h!==je.MMCO_SHORT2UNUSED&&h!==je.MMCO_SHORT2LONG||q(t),h!==je.MMCO_SHORT2LONG&&h!==je.MMCO_LONG2UNUSED&&h!==je.MMCO_LONG&&h!==je.MMCO_SET_MAX_LONG||q(t)}return 0},t.ff_h264_parse_ref_count=function(e,t,i,n,r,s){var o;if(t[0]=n.ref_count[0],t[1]=n.ref_count[1],r!==ze.AV_PICTURE_TYPE_I){var c=[];if(c[0]=c[1]=s===He.AV_PICTURE_STRUCTURE_FRAME?15:31,X(i,1)&&(t[0]=q(i)+1,r===ze.AV_PICTURE_TYPE_B?t[1]=q(i)+1:t[1]=1),o=r===ze.AV_PICTURE_TYPE_B?2:1,t[0]-1>c[0]||2==o&&t[1]-1>c[1])return a.b.i("raw-demuxer","reference overflow %u > %u or %u > %u\n",t[0]-1,c[0],t[1]-1,c[1]),t[0]=t[1]=0,e.list_count=0,t[0]=0,t[1]=0,-1;t[1]-1>c[1]&&(a.b.i("raw-demuxer","reference overflow %u > %u \n",t[1]-1,c[1]),t[1]=0)}else o=0,t[0]=t[1]=0;return e.list_count=o,0},t.ff_h264_pred_weight_table=function(e,t,i,n,r,s){var o,c;for(r.use_weight=0,r.use_weight_chroma=0,r.luma_log2_weight_denom=q(e),r.luma_log2_weight_denom>7&&(a.b.i("raw-demuxer","luma_log2_weight_denom %d is out of range\n",r.luma_log2_weight_denom),r.luma_log2_weight_denom=0),r.luma_log2_weight_denom,t.chroma_format_idc&&(r.chroma_log2_weight_denom=q(e),r.chroma_log2_weight_denom>7&&(a.b.i("raw-demuxer","chroma_log2_weight_denom %d is out of range\n",r.chroma_log2_weight_denom),r.chroma_log2_weight_denom=0),r.chroma_log2_weight_denom),o=0;o<2;o++){for(r.luma_weight_flag[o]=0,r.chroma_weight_flag[o]=0,c=0;c<i[o];c++)if(X(e,1)&&(Z(e),Z(e)),t.chroma_format_idc&&X(e,1))for(var u=0;u<2;u++)Z(e),Z(e);if(n!==ze.AV_PICTURE_TYPE_B)break}return r.use_weight=r.use_weight||r.use_weight_chroma,0},t._checkFps=function(e){(!e.fps||e.fps>A.j)&&(e.fps=A.c)},m()(e,null,[{key:"probeSize",get:function(){return 4}}]),e}(),$e=function(){function e(e,t){this._decrypter=void 0,this._decryptdata=void 0,this._decryptdata=t,this._decrypter=new d(e,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var n=this._decrypter.isSync();if(this._decryptAacSample(e,t,i,n),!n)return}}},t.decryptAvcSamples=function(e,t,i,n){for(;;t++,i=0){if(t>=e.length)return void n();for(var r=e[t].units;!(i>=r.length);i++){var a=r[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this._decrypter.isSync();if(this._decryptAvcSample(e,t,i,n,a,s),!s)return}}}},t._decryptBuffer=function(e,t){this._decryptdata.key&&this._decrypter.decrypt(e,this._decryptdata.key.buffer,this._decryptdata.iv.buffer,t)},t._decryptAacSample=function(e,t,i,n){var r=e[t].unit,a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this._decryptBuffer(s,(function(a){a=new Uint8Array(a),r.set(a,16),n||o.decryptAacSamples(e,t+1,i)}))},t._getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Uint8Array(t),n=0,r=32;r<=e.length-16;r+=160,n+=16)i.set(e.subarray(r,r+16),n);return i},t._getAvcDecryptedUnit=function(e,t){for(var i=new Uint8Array(t),n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(i.subarray(n,n+16),r);return e},t._decryptAvcSample=function(e,t,i,n,r,a){var s=se(r.data),o=this._getAvcEncryptedData(s),c=this;this._decryptBuffer(o.buffer,(function(o){r.data=c._getAvcDecryptedUnit(s,o),a||c.decryptAvcSamples(e,t,i+1,n)}))},e}();!function(e){e[e.registration=5]="registration",e[e.av1=95]="av1",e[e.opus=127]="opus"}(qe||(qe={}));var et={5:function(e,t){p()(e,{descriptor_name:"registration",format_identifier:Object(b.a)(t,0,4)})}};function tt(e,t){var i={descriptor_tag:e[t],descriptor_length:e[t+1]},n=et[i.descriptor_tag];return n&&n(i,e.subarray(t+2,t+2+i.descriptor_length)),i}var it=function(){function e(e,t,i,s){var o=this;this._evt=void 0,this._config=void 0,this._typeSupported=void 0,this._remuxer=void 0,this._sampleAes=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._pmtParsed=!1,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._duration=0,this._vLastDts=0,this._aLastDts=0,this._aacOverFlow=null,this._aacLastPTS=null,this._videoSample=null,this._contiguous=!1,this._timeOffset=0,this._accurateTimeOffset=!1,this._transmuxData=void 0,this._audioNonMonotonous=0,this._tsException={aacOverhead:0,unknownTSPacketCount:0},this._hevcParamSets={spsList:[],ppsList:[],vpsList:[]},this._avcParamSets={spsList:[],ppsList:[]},this._av1sh=void 0,this._psUpdated=!1,this._remuxOnFlush=!1,this._av1Ctx=void 0,this._parsePMT=function(e,t,i,n){var r,s,c={audio:-1,video:-1,id3:-1,aCodecType:y.b.unknown,codecType:y.b.h264};for(r=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<r;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){a.b.v("unkown stream type:"+e[t]);break}case 15:-1===c.audio&&(c.audio=s),c.aCodecType=y.b.aac;break;case 21:-1===c.id3&&(c.id3=s);break;case 219:if(!n){a.b.v("unkown stream type:"+e[t]);break}case 27:-1===c.video&&(c.video=s);break;case 3:case 4:i.mpeg||i.mp3?-1===c.audio&&(c.audio=s):a.b.i("ts-demuxer","MPEG audio found, not supported in this browser for now"),c.aCodecType=y.b.mp3;break;case 6:case 196:var u=4095&Object(b.e)(e,t+3);if(u){var d=!1,_=!1,h=!1,l=!1,f=!1;o._readDescriptors(e,t+5,u).forEach((function(e){if(e.descriptor_tag===qe.av1)d=!0;else if(e.descriptor_tag===qe.opus);else if(e.descriptor_tag===qe.registration){var t=e.format_identifier;"AV01"===t&&(d=!0),"KVC3"===t&&(_=!0),"KVC4"===t&&(h=!0),"KVC5"===t&&(l=!0),"KVC6"===t&&(f=!0)}})),d&&(i.av1?-1===c.video&&-1===c.video&&(c.video=s):a.b.i("ts-demuxer","AV1 video found, not supported in this browser for now"),c.codecType=y.b.av1),_&&(c.codecType=y.b.kvc3,-1===c.video&&(c.video=s)),h&&(c.codecType=y.b.kvc4,-1===c.video&&(c.video=s)),l&&(c.codecType=y.b.kvc5,-1===c.video&&(c.video=s)),f&&(c.codecType=y.b.kvc6,-1===c.video&&(c.video=s))}break;case 36:c.codecType=y.b.hevc,-1===c.video&&(c.video=s);break;default:a.b.v("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return c},this._pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,n=i.length;(!o._config.forceKeyFrameOnDiscontinuity||!0===e.key||t.decConf&&(n||o._contiguous))&&(o._config.gopRemux&&e.key&&i&&i.length>1&&o._remuxStat&&(o._remuxStat,o._remux()),e.id=o._videoTrack.samples.length,o._videoTrack.samples.push(e),e.key&&o._evt.emit(r.a.KEY_FRAME,{cts:e.cts/t.inputTimescale,pts:e.pts/t.inputTimescale}))}},this._createVSample=function(e,t,i){if(o._vLastDts&&i-o._vLastDts<90){var n=t-i;t=(i=o._vLastDts+90)+n}return o._vLastDts=i,{key:e,pts:t,dts:i,cts:t-i,units:[],originDTS:i}},this._parseVideoPES=function(e,t){if(e.data){var i,n=o._videoTrack,r=o._videoSample;n.codecType===y.b.av1?(o._av1Ctx||(o._av1Ctx=ae.createCtx()),i=ae.parseOBU(e.data,o._av1Ctx)):i=o._readVideoNALu(e.data),e.data=null,r&&r.frame&&i.length&&!n.audFound&&(o._pushAccesUnit(r,n),r=o._videoSample=o._createVSample(!1,e.pts,e.dts)),Ee(n.codecType)?r=o._parseHEVCNalu(i,e.pts,e.dts):n.codecType===y.b.h264?r=o._parseAVCNalu(i,e.pts,e.dts):n.codecType===y.b.av1&&(r||(r=o._videoSample=o._createVSample(!1,e.pts,e.dts)),i.forEach((function(e){var t;if(e.obu_type===z.AV1_OBU_SEQUENCE_HEADER){var i=e.content;i&&o._av1sh&&!Object(b.b)(o._av1sh.data,i.data)&&n.decConf&&(o._remuxByStat(!0),o._remuxer.ISGenerated&&o._transmuxData&&o._remuxer.resetInitSegment(o._transmuxData)),o._av1sh=i,we.updateAV1Track(n,i)}r.frame=r.frame||e.obu_type===z.AV1_OBU_FRAME||e.obu_type===z.AV1_OBU_FRAME_HEADER,r.key=r.key||!(null==(t=e.content)||!t.keyframe),r.units.push({type:0,data:e.data})}))),t&&r&&(o._pushAccesUnit(r,n),o._videoSample=null)}},this._parseMPEGPES=function(e){if(e.data){var t=e.data,i=o._audioTrack,n=t.length,r=0,s=0,c=e.pts;if(void 0!==c)for(;s<n;)if(P(t,s)){var u=w(i,t,s,c,r);if(!u)break;s+=u.length,r++}else s++;else a.b.w("[tsdemuxer]: MPEG PES unknown PTS")}},this._parseAACPES=function(e){var t;if(e.data){var i,r,s,c,u,d,_=o._audioTrack,h=o._aacLastPTS,f=e.data,p=e.pts,v=o._aacOverFlow,m=null;if(o._aLastDts=e.dts,v){var A=new Uint8Array(v.byteLength+f.byteLength);A.set(v,0),A.set(f,v.byteLength),f=A}for(s=0,c=f.length;s<c-1&&!T.f(f,s);s++);if(s&&(s<c-1?(u="AAC PES did not start with ADTS header,offset:"+s,d=!1):(u="no ADTS header found in AAC PES",d=!0),a.b.w("parsing error:"+u),o._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:d,reason:u}),d))return;var g=f.subarray(s+2,s+4);if((T.g(_,g)||!_.configParsed)&&o._remuxer.ISGenerated&&o._transmuxData&&o._remuxer.resetInitSegment(o._transmuxData),T.d(_,o._evt,g,l.a.ADTS,null==(t=o._transmuxData)?void 0:t.audioCodec),r=0,i=T.c(_.samplerate,_.inputTimescale),h&&(o._audioNonMonotonous||(o._audioNonMonotonous=p<h?1:0),o._audioNonMonotonous||v)){var y=h+i;Math.abs(y-p)>1&&(a.b.v("AAC: align PTS for overlapping frames by "+Math.round((y-p)/90)),p=y)}for(;s<c;)if(T.f(f,s)&&s+5<c){var E=T.a(_,f,s,p,r);if(!E){s++;break}s+=E.length,m=E.sample.pts,E.sample.originDTS=e.pts,r++}else s++;r>1&&(o._tsException.aacOverhead=1),v=s<c?f.subarray(s,c):null,o._aacOverFlow=v,o._aacLastPTS=m}},this._onError=function(e){o._evt.emit(r.a.ERROR,e)},this._evt=e,this._config=i,this._typeSupported=s,this._remuxer=t,this._sampleAes=null,this._remuxStat=null}var t=e.prototype;return t.setDecryptData=function(e){e&&e.key&&"SAMPLE-AES"===e.method?this._sampleAes=new $e(this._config,e):this._sampleAes=null},e.probe=function(t){var i=e.syncOffset(t);return!(i<0)&&(i&&a.b.w("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),!0)},e.syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){if(e===y.l.AUDIO)return Object(M.a)(t,A.l);var i=Object(M.b)(t,A.l);return i.audFound=!1,i.naluState=0,i},t.resetInitSegment=function(t){this._pmtParsed=!1,this._pmtId=-1,this._videoTrack=e.createTrack(y.l.VIDEO,t.duration),this._audioTrack=e.createTrack(y.l.AUDIO,t.duration),this._aacOverFlow=null,this._aacLastPTS=null,this._videoSample=null,this._duration=t.duration,this._vLastDts=0,this._aLastDts=0,this._audioNonMonotonous=0,this._tsException.aacOverhead=0,this._remuxStat=null,this._transmuxData=t,this._transmuxData.stat=this._tsException,this._firstRemux=!0},t.resetTimeStamp=function(){},t.append=function(e,t,i,a,s){void 0===s&&(s=!1),this._contiguous=i,this._timeOffset=t,this._accurateTimeOffset=a,null===this._remuxStat&&(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:a}),this._remuxStat;var o,c,u,d,_,h=this._videoTrack,l=this._audioTrack,f=this._parsePAT,p=this._parsePMT,v=this._parsePES,m=this._parseVideoPES,A=this._parseAACPES,g=this._parseMPEGPES,E=e.length,b=!1,T=this._pmtParsed,S=h.pid,x=l.pid,C=this._pmtId,L=h.pesData,R=l.pesData;if(!e.byteLength&&s)return this._remux(!0),void this._onParsed();for(E-=(E+0)%188,o=0;o<E;o+=188)if(71===e[o]){if(c=!!(64&e[o+1]),u=((31&e[o+1])<<8)+e[o+2],(48&e[o+3])>>4>1){if((d=o+5+e[o+4])===o+188)continue}else d=o+4;switch(u){case S:c&&(L&&(_=v(L,!0))&&void 0!==_.pts&&m(_,!1),L={data:[],size:0}),L&&(L.data.push(e.subarray(d,o+188)),L.size+=o+188-d);break;case x:c&&(R&&(_=v(R))&&void 0!==_.pts&&(l.codecType===y.b.aac?A(_):g(_)),R={data:[],size:0}),R&&(R.data.push(e.subarray(d,o+188)),R.size+=o+188-d);break;case 0:c&&(d+=e[d]+1),C=this._pmtId=f(e,d);break;case C:c&&(d+=e[d]+1);var D=p(e,d,this._typeSupported,null!==this._sampleAes);if(D.video<0&&D.audio<0)return void this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"no track found"});if(!this._pmtParsed){var w={};this._duration&&(w.duration=this._duration),this._evt.emit(r.a.METADATA,w)}if(D.video>0){var I="boolean"!=typeof h.active||h.active;!Ee(h.codecType)&&Ee(D.codecType)?I=D.codecType===y.b.hevc?we.onHEVCDetected(h,this._config,this._typeSupported):we.onKVCDetected(h,this._config,this._typeSupported):(h.codecType!==y.b.h264&&D.codecType===y.b.h264||h.codecType!==y.b.av1&&D.codecType===y.b.av1)&&this._videoTrack.outputRaw&&(this._remux(!0),this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),this._videoTrack.outputRaw=!1),h.pid=S=I?D.video:-1,h.active=I,h.codecType=D.codecType}(x=D.audio)>0&&(l.pid=x,l.active=!0,l.codecType=D.aCodecType),b&&!T&&(b=!1),T=this._pmtParsed=!0;break;case 17:case 8191:break;default:this._tsException.unknownTSPacketCount?this._tsException.unknownTSPacketCount++:this._tsException.unknownTSPacketCount=1,b=!0}}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});L&&(_=v(L,s))&&void 0!==_.pts?(m(_,s),h.pesData=void 0):(this._videoSample&&s&&(this._pushAccesUnit(this._videoSample,h),this._videoSample=null),h.pesData=L),R&&(_=v(R))&&void 0!==_.pts?(l.codecType===y.b.aac?A(_):g(_),l.pesData=void 0):(R&&R.size,l.pesData=R),(x>0&&0===l.samples.length||S>0&&0===h.samples.length||S<=0&&x<=0)&&!s||(!s&&this._config.gopRemux||this._remux(s),s&&this._onParsed())},t._onParsed=function(){this._evt.emit(r.a.PARSED_DATA,{extra:this._transmuxData})},t.flush=function(){var e,t=this._videoTrack,i=this._audioTrack,n=t.pesData,r=i.pesData,a=this._parsePES,s=this._parseVideoPES,o=this._parseAACPES,c=this._parseMPEGPES;if(n&&(e=a(n,!0))&&void 0!==e.pts&&s(e,!0),t.pesData=void 0,r&&(e=a(r))&&void 0!==e.pts&&(i.codecType===y.b.aac?o(e):c(e)),i.pesData=void 0,i.pid&&0===i.samples.length&&t.pid&&0===t.samples.length)this._remuxer.flush();else{var u=this._remuxStat;u&&(u={timeOffset:this._timeOffset,contiguous:!0,accurateTimeOffset:this._accurateTimeOffset}),this._remux(!0),this._videoSample=null,this._remuxStat=null}},t.updateConfig=function(e){p()(this._config,e)},t._remuxByStat=function(e){void 0===e&&(e=!1),this._remuxStat&&this._remux(e)},t._remux=function(e){var t;void 0===e&&(e=!1);var i=this._audioTrack,n=this._videoTrack;if(e){if(0==n.samples.length&&0===i.samples.length)return void this._remuxer.flush()}else if(n.active&&n.samples.length<3||i.active&&0===i.samples.length)return;if(!this._remuxOnFlush||e){null!=(t=this._transmuxData)&&t.stat&&(this._transmuxData.stat.audioNonMonotonous=this._audioNonMonotonous);var a=!0,s=0,o=!1;this._remuxStat&&(a=this._remuxStat.contiguous,s=this._remuxStat.timeOffset,o=this._remuxStat.accurateTimeOffset),this._firstRemux&&(this._firstRemux=!1,this._evt.emit(r.a.MEDIA_DEMUX,{type:l.b.TS})),this._sampleAes?this._decryptAndRemux(i,n,s,a,o,e):this._remuxer.remux(i,n,s,a,o,e),this._remuxStat=null}},t._decryptAndRemux=function(e,t,i,n,r,a){if(void 0===a&&(a=!1),e.samples&&this._sampleAes){var s=this;this._sampleAes.decryptAacSamples(e.samples,0,(function(){s._decryptAndRemuxAvc(e,t,i,n,r,a)}))}else this._decryptAndRemuxAvc(e,t,i,n,r,a)},t._decryptAndRemuxAvc=function(e,t,i,n,r,a){if(void 0===a&&(a=!1),t.samples&&this._sampleAes){var s=this;this._sampleAes.decryptAvcSamples(t.samples,0,0,(function(){s._remuxer.remux(e,t,i,n,r,a)}))}else this._remuxer.remux(e,t,i,n,r,a)},t.destroy=function(){this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._readDescriptors=function(e,t,i){for(var n=i?t+i:e.byteLength,r=[];n-t>2;){var a=tt(e,t);r.push(a),t+=2+a.descriptor_length}return r},t._checkRegistrationDescriptors=function(e,t,i){var n=e[t];return t+=2,5===n&&e.length>=t+4?Object(b.a)(e,t,4):""},t._parsePES=function(e,t){void 0===t&&(t=!1);var i,n,r,s,o,c,u=e.data,d=0,_=0,h=0;if(!e||0===e.size)return null;for(;u[0].length<19&&u.length>1;){var l=new Uint8Array(u[0].length+u[1].length);l.set(u[0]),l.set(u[1],u[0].length),u[0]=l,u.splice(1,1)}if(1===((i=u[0])[0]<<16)+(i[1]<<8)+i[2]){if((r=(i[4]<<8)+i[5])&&r>e.size-6)return null;if(0===r&&!t)return null;192&(n=i[7])&&((_=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(_-=8589934592),64&n?((h=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(h-=8589934592),_-h>60*A.l&&(a.b.w(Math.round((_-h)/A.l)+"s delta between PTS and DTS, align them"),_=h)):h=_),c=(s=i[8])+9,e.size-=c,o=new Uint8Array(e.size);for(var f=0,p=u.length;f<p;f++){var v=(i=u[f]).byteLength;if(c){if(c>v){c-=v;continue}i=i.subarray(c),v-=c,c=0}o.set(i,d),d+=v}return r&&(r-=s+3),{data:o,pts:_,dts:h,len:r}}return null},t._parseHEVCNalu=function(e,t,i){var n,r=this,a=this._videoTrack,s=this._hevcParamSets,o=this._videoSample;return e.forEach((function(e){var c;switch(e.type){case G.a.HEVC_NAL_IDR_W_RADL:case G.a.HEVC_NAL_IDR_N_LP:case G.a.HEVC_NAL_CRA_NUT:r._checkParamSets(),n=!0,o||(o=r._videoSample=r._createVSample(!1,t,i)),o.key=!0,o.frame=!0;break;case G.a.HEVC_NAL_AUD:n=!1,a.audFound=!0,o&&r._pushAccesUnit(o,a),o=r._videoSample=r._createVSample(!1,t,i);break;case G.a.HEVC_NAL_SPS:n=!0;var u=me.parse(e.data,a.codecType);s.sps&&!Object(b.b)(s.sps.data,u.data)&&(r._psUpdated=!0),s.spsList[u.sps_id]=u,s.sps=u;break;case G.a.HEVC_NAL_PPS:n=!0;var d=le.parse(e.data);s.pps&&!Object(b.b)(s.pps.data,d.data)&&(r._psUpdated=!0),s.ppsList[d.pps_id]=d,s.pps=d;break;case G.a.HEVC_NAL_VPS:n=!0;var _=Ae.parse(e.data);s.vps&&!Object(b.b)(s.vps.data,_.data)&&(r._psUpdated=!0),s.vpsList[_.vps_id]=_,s.vps=_;break;default:if(r._checkParamSets(),n=!0,void 0===e.type){n=!1;break}o||(o=r._videoSample=r._createVSample(!0,t,i)),o.frame=!0}o&&n&&(null==(c=o.units)||c.push(e))})),o},t._parseAVCNalu=function(e,t,i){var n,r=this,a=this._videoTrack,s=this._avcParamSets,o=this._videoSample,c=!1;e.forEach((function(e){var u;switch(e.type){case k.H264_NAL_SLICE:r._checkParamSets(),n=!0,o||(o=r._videoSample=r._createVSample(!0,t,i)),o.frame=!0;var d=e.data;if(c&&d.length>4){var _=Q(d);Y(_,8),q(_);var h=q(_);2!==h&&4!==h&&7!==h&&9!==h||(o.key=!0)}break;case k.H264_NAL_IDR_SLICE:r._checkParamSets(),n=!0,o||(o=r._videoSample=r._createVSample(!0,t,i)),o.key=!0,o.frame=!0;break;case k.H264_NAL_SEI:n=!0;break;case k.H264_NAL_SPS:n=!0,c=!0;var l=de.parse(e.data);s.sps&&!Object(b.b)(s.sps.data,l.data)&&(r._psUpdated=!0),s.spsList[l.sps_id]=l,s.sps=l;break;case k.H264_NAL_PPS:n=!0;var f=ue.parse(e.data);s.pps&&!Object(b.b)(s.pps.data,f.data)&&(r._psUpdated=!0),s.ppsList[f.pps_id]=f,s.pps=f;break;case k.H264_NAL_AUD:n=!1,a.audFound=!0,o&&r._pushAccesUnit(o,a),o=r._videoSample=r._createVSample(!1,t,i);break;case k.H264_NAL_FILLER_DATA:default:n=!1}o&&n&&(null==(u=o.units)||u.push(e))}))},t._checkParamSets=function(){var e,t=this._videoTrack;t.decConf&&this._psUpdated&&(this._remuxByStat(!0),this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData));var i=!1;t.decConf&&!this._psUpdated||(t.codecType===y.b.h264?this._avcParamSets.spsList.length&&this._avcParamSets.ppsList.length&&(we.updateAVCTrack(t,this._avcParamSets),i=!0):this._hevcParamSets.spsList.length&&this._hevcParamSets.ppsList.length&&this._hevcParamSets.vpsList.length&&(we.updateHEVCTrack(t,this._hevcParamSets),i=!0)),i&&this._evt.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!!t.active,decoder:t.outputRaw?y.c.wasm:y.c.buildin,codecType:t.codecType||y.b.unknown,bitDepth:t.bitDepth,timeOffset:(null==(e=this._remuxStat)?void 0:e.timeOffset)||0}),this._psUpdated=!1},t._getLastNalUnit=function(){var e,t=this._videoSample;if(!t||0===t.units.length){var i=this._videoTrack.samples;t=i[i.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},t._readVideoNALu=function(e){var t,i,n,r,a=this._videoTrack,s=e.byteLength,o=s,c=[],u=0,d=0,_=a.naluState||0,h=-1,l=_;if(-1===_)h=0,r=Ee(a.codecType)?(126&e[0])>>1:31&e[0],_=0,u=1;else if(_>0)for(;d<4;d++){var f=e[d];if(0!==f){if(1===f&&_>=2){h=d+1,r=Ee(a.codecType)?(126&e[h])>>1:31&e[h],_=0;var p=this._getLastNalUnit();p&&l&&d<=4-l&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-l));break}d<s&&(_=0);break}_++,u=d+1}for(;u<o;)if(1===(t=e[u+2]))if(0===e[u]&&0===e[u+1]){if(_=u>0&&0===e[u-1]?3:2,u+=3,h>=0)n={data:e.subarray(h,u-_-1),type:r},c.push(n);else{var v=this._getLastNalUnit();if(v&&(i=u-_-1)>0){var m=new Uint8Array(v.data.byteLength+i);m.set(v.data,0),m.set(e.subarray(0,i),v.data.byteLength),v.data=m}}u<s?(h=u,r=Ee(a.codecType)?(126&e[u])>>1:31&e[u],_=0):_=-1}else u+=3;else 0===t?u++:u+=3;for(var A=s-1;A>s-4&&A>=d&&0===e[A];A--)_++;if(h>=0&&_>=0&&h<s&&(n={data:e.subarray(h,s),type:r,state:_},c.push(n)),0===c.length){var g=this._getLastNalUnit();if(g){var y=new Uint8Array(g.data.byteLength+e.byteLength);y.set(g.data,0),y.set(e,g.data.byteLength),g.data=y}}return a.naluState=_,c},m()(e,[{key:"minChunkSize",get:function(){return 188}},{key:"encryptedChunkSize",get:function(){return 752}}],[{key:"probeSize",get:function(){return 752}}]),e}(),nt=function(){function e(e,t,i,n){this._evt=void 0,this._config=void 0,this._vendor=void 0,this._typeSupported=void 0,this._decrypter=void 0,this._nextIV=null,this._cache=new _.a,this._probe=void 0,this._muxConfig=[],this._demuxer=void 0,this._remuxer=void 0,this._stat=void 0,this._minChunkSize=0,this._evt=e,this._typeSupported=t,this._config=i,this._vendor=n,Ie&&this._muxConfig.push({Demux:Ie,Remux:h.b,type:l.b.FLV}),it&&this._muxConfig.push({Demux:it,Remux:h.b,type:l.b.TS}),Xe&&this._muxConfig.push({Demux:Xe,Remux:h.b,type:l.b.MP4}),Je&&this._muxConfig.push({Demux:Je,Remux:h.b,type:l.b.RAW}),Pe&&this._muxConfig.push({Demux:Pe,Remux:h.b,type:l.b.IVF}),this._minChunkSize=this._muxConfig.reduce((function(e,t){return Math.max(t.Demux.probeSize,e)}),0)}var t=e.prototype;return t.push=function(e,t,i,n,r,a,s,o,c,u){var _=this,h=e;if((s||a)&&this._cache.clear(),u.progress&&this._minChunkSize)if(this._cache.put(e),c)h=this._cache.get(this._cache.unreadLen);else{var l=Math.floor(this._cache.unreadLen/this._minChunkSize)*this._minChunkSize;if(!(l>=this._minChunkSize))return void(this._stat||(this._stat={contiguous:r,trackSwitch:a,discontinuity:s,accurateTimeOffset:o}));h=this._cache.get(l)}else this._cache.unreadLen&&(this._cache.put(e),h=this._cache.get(this._cache.unreadLen));if(h)if(e=h,this._stat&&(r=this._stat.contiguous,a=this._stat.trackSwitch,s=this._stat.discontinuity,o=this._stat.accurateTimeOffset,this._stat=void 0),e.byteLength>0&&t&&t.key&&"AES-128"===t.method){var f=this._decrypter;!f&&it&&d&&(f=this._decrypter=new d(this._config,{removePKCS7Padding:c})),s&&(this._nextIV=null);var p=this._nextIV?this._nextIV:t.iv;if(!f)return;f.decrypt(e,t.key.buffer,p.buffer,(function(d){c?_._nextIV=null:(_._nextIV=new Uint8Array(16),_._nextIV.set(e.subarray(e.byteLength-16),0)),_._pushDecrypted(new Uint8Array(d),t,i,n,r,a,s,o,c,u)}))}else t&&c&&(this._nextIV=null),this._pushDecrypted(e,t,i,n,r,a,s,o,c,u)},t.flush=function(){this._demuxer&&this._demuxer.flush(),this._cache.clear()},t.end=function(){this._evt.emit(r.a.LOAD_END)},t.updateConfig=function(e){var t;a.b.i("demuxer-inline","update config",e),null==(t=this._demuxer)||t.updateConfig(e)},t._probeData=function(e,t,i,a){if(!this._demuxer||t&&this._probe&&!this._probe(e)){for(var s=this._evt,o=this._typeSupported,c=this._config,u=0,d=this._muxConfig.length;u<d;u++){var _=this._muxConfig[u],h=_.Demux.probe;if(h(e)){this._remuxer=new _.Remux(s,c,o,this._vendor),this._demuxer=new _.Demux(s,this._remuxer,c,o),this._evt.emit(r.a.DEMUXER_DETECTED,{type:_.type}),this._probe=h;break}}if(!this._demuxer)return void this._evt.emit(r.a.ERROR,{type:n.b.MUX_ERROR,details:n.a.DEMUX_NOT_FOUND,fatal:!0,reason:"no demux matching with content found"})}},t._pushDecrypted=function(e,t,i,n,r,a,s,o,c,u){this._demuxer||this._probeData(e,!0,i,u);var d=this._demuxer,_=this._remuxer;_&&d&&(this._minChunkSize=t?d.encryptedChunkSize||16:d.minChunkSize||0,(a||s)&&(d.resetInitSegment(u,i),_.resetInitSegment(u)),s&&(d.resetTimeStamp(),_.resetTimeStamp()),t&&d.hasOwnProperty("setDecryptData")&&d.setDecryptData(t),d.append(e,n,r,o,c))},e}();t.a=nt},function(e,t,i){var n,r=i(6),a=i(3),s=i(1),o=i(7),c=i(17),u=i(0),d=i(11),_=i(2),h=function(){function e(e){this._module=void 0,this._libde265=void 0,this._waitingData=!1,this._evt=void 0,this._ctx=void 0,this._more=void 0,this._stridePtr=void 0,this._chromaStridePtr=void 0,this._threads=0,this._evt=e}var t=e.prototype;return t.init=function(e,t,i){var n=this;this._threads=i;var r=e.js.data,a=e.jsw?e.jsw.data:"",s=new Function(r+" return KwaiDec265;")(),o=a?new Blob([r],{type:"text/javascript"}):"",c=new Blob([a],{type:"text/javascript"});return s({wasmBinary:e.wasm.data,mainScriptUrlOrBlob:o,locateFile:function(e){return-1!==e.indexOf(".worker.js")?URL.createObjectURL(c):""}}).then((function(e){n._module=e,n._stridePtr=n._module._malloc(4),n._chromaStridePtr=n._module._malloc(4),n._cwrapLibde265Fun(),n._initDecoder()}))},t.flush=function(){return this._libde265.de265_flush_data(this._ctx)},t.free=function(){this._libde265.de265_free_decoder(this._ctx),this._ctx=void 0,this._module._free(this._more),this._more=void 0},t.rebuild=function(){this._waitingData=!1,this._libde265.de265_free_decoder(this._ctx),this._module.setValue(this._more,0,"i16"),this._newDecoder()},t.reset=function(){this._libde265.de265_reset(this._ctx),this._waitingData=!1},t.pushData=function(e,t){var i=this._libde265.de265_push_data(this._ctx,e,e.length,t||0,0);this._libde265.de265_isOK(i)&&this._waitingData&&this._decode()},t.pushNalus=function(e,t){var i=this;e.forEach((function(e){i._libde265.de265_push_NAL(i._ctx,e.data,e.data.length,t||0,0),i._libde265.de265_push_end_of_NAL(i._ctx)})),this._waitingData&&this._decode()},t.getPendingNALNumber=function(){return this._libde265.de265_get_number_of_NAL_units_pending(this._ctx)},t.endOfFrame=function(){this._libde265.de265_push_end_of_frame(this._ctx)},t.nextFrame=function(){this._waitingData||this._decode()},t.isWaitingData=function(){return this._waitingData},t._decode=function(){if(this._module){this._module.setValue(this._more,1,"i16");for(var e=0;0!==this._module.getValue(this._more,"i16");){var t=performance.now();if(e=this._libde265.de265_decode(this._ctx,this._more),!this._libde265.de265_isOK(e)){this._module.setValue(this._module,0,"i16");break}this._waitingData=!1;var i=this._libde265.de265_get_next_picture(this._ctx);if(i){this._evt.emit(s.a.DECODER_FRAME,{frame:this._getImage(i),startTime:t});break}}switch(e){case this._libde265.DE265_ERROR_WAITING_FOR_INPUT_DATA:this._waitingData=!0}}},t._initDecoder=function(){this._more=this._module._malloc(2),this._newDecoder(),this._decode()},t._newDecoder=function(){this._ctx=this._libde265.de265_new_decoder(),this._threads>1&&this._libde265.de265_start_worker_threads(this._ctx,this._threads),this._disableFilters(!0)},t._disableFilters=function(e){this._libde265.de265_set_parameter_bool(this._ctx,this._libde265.DE265_DECODER_PARAM_DISABLE_DEBLOCKING,e),this._libde265.de265_set_parameter_bool(this._ctx,this._libde265.DE265_DECODER_PARAM_DISABLE_SAO,e)},t._getImage=function(e){var t=this._libde265.de265_get_image_width(e,0),i=this._libde265.de265_get_image_height(e,0),n=this._libde265.de265_get_image_width(e,1),r=this._libde265.de265_get_image_height(e,1),a=this._libde265.de265_get_chroma_format(e),s=this._libde265.de265_get_bits_per_pixel(e,0),o=this._libde265.de265_get_bits_per_pixel(e,1),c=this._libde265.de265_get_image_plane(e,0,this._stridePtr),u=this._libde265.de265_get_image_plane(e,1,this._chromaStridePtr),d=this._libde265.de265_get_image_plane(e,2),_=this._module.getValue(this._stridePtr,"i32"),h=this._module.getValue(this._chromaStridePtr,"i32"),l=this._module.HEAPU8.subarray(c,c+_*i),f=this._module.HEAPU8.subarray(u,u+h*r),p=this._module.HEAPU8.subarray(d,d+h*r);return{format:{width:t,height:i,chroma:a,chromaWidth:n,chromaHeight:r,cropLeft:0,cropTop:0,cropWidth:t,cropHeight:i,displayWidth:0,displayHeight:0,pts:this._libde265.de265_get_image_PTS(e,0)},y:{bytes:l,stride:_,bits:s},u:{bytes:f,stride:h,bits:o},v:{bytes:p,stride:h,bits:o}}},t._cwrapLibde265Fun=function(){this._libde265={DE265_OK:0,DE265_ERROR_NO_SUCH_FILE:1,DE265_ERROR_EOF:3,DE265_ERROR_COEFFICIENT_OUT_OF_IMAGE_BOUNDS:4,DE265_ERROR_CHECKSUM_MISMATCH:5,DE265_ERROR_CTB_OUTSIDE_IMAGE_AREA:6,DE265_ERROR_OUT_OF_MEMORY:7,DE265_ERROR_CODED_PARAMETER_OUT_OF_RANGE:8,DE265_ERROR_IMAGE_BUFFER_FULL:9,DE265_ERROR_CANNOT_START_THREADPOOL:10,DE265_ERROR_LIBRARY_INITIALIZATION_FAILED:11,DE265_ERROR_LIBRARY_NOT_INITIALIZED:12,DE265_ERROR_WAITING_FOR_INPUT_DATA:13,DE265_ERROR_CANNOT_PROCESS_SEI:14,DE265_ERROR_PARAMETER_PARSING:15,DE265_ERROR_NO_INITIAL_SLICE_HEADER:16,DE265_ERROR_PREMATURE_END_OF_SLICE:17,DE265_ERROR_UNSPECIFIED_DECODING_ERROR:18,DE265_ERROR_MAX_THREAD_CONTEXTS_EXCEEDED:500,DE265_ERROR_MAX_NUMBER_OF_SLICES_EXCEEDED:501,DE265_ERROR_NOT_IMPLEMENTED_YET:502,DE265_WARNING_NO_WPP_CANNOT_USE_MULTITHREADING:1e3,DE265_WARNING_WARNING_BUFFER_FULL:1001,DE265_WARNING_PREMATURE_END_OF_SLICE_SEGMENT:1002,DE265_WARNING_INCORRECT_ENTRY_POINT_OFFSET:1003,DE265_WARNING_CTB_OUTSIDE_IMAGE_AREA:1004,DE265_WARNING_SPS_HEADER_INVALID:1005,DE265_WARNING_PPS_HEADER_INVALID:1006,DE265_WARNING_SLICEHEADER_INVALID:1007,DE265_WARNING_INCORRECT_MOTION_VECTOR_SCALING:1008,DE265_WARNING_NONEXISTING_PPS_REFERENCED:1009,DE265_WARNING_NONEXISTING_SPS_REFERENCED:1010,DE265_WARNING_BOTH_PREDFLAGS_ZERO:1011,DE265_WARNING_NONEXISTING_REFERENCE_PICTURE_ACCESSED:1012,DE265_WARNING_NUMMVP_NOT_EQUAL_TO_NUMMVQ:1013,DE265_WARNING_NUMBER_OF_SHORT_TERM_REF_PIC_SETS_OUT_OF_RANGE:1014,DE265_WARNING_SHORT_TERM_REF_PIC_SET_OUT_OF_RANGE:1015,DE265_WARNING_FAULTY_REFERENCE_PICTURE_LIST:1016,DE265_WARNING_EOSS_BIT_NOT_SET:1017,DE265_WARNING_MAX_NUM_REF_PICS_EXCEEDED:1018,DE265_WARNING_INVALID_CHROMA_FORMAT:1019,DE265_WARNING_SLICE_SEGMENT_ADDRESS_INVALID:1020,DE265_WARNING_DEPENDENT_SLICE_WITH_ADDRESS_ZERO:1021,DE265_WARNING_NUMBER_OF_THREADS_LIMITED_TO_MAXIMUM:1022,DE265_NON_EXISTING_LT_REFERENCE_CANDIDATE_IN_SLICE_HEADER:1023,DE265_WARNING_CANNOT_APPLY_SAO_OUT_OF_MEMORY:1024,DE265_WARNING_SPS_MISSING_CANNOT_DECODE_SEI:1025,DE265_WARNING_COLLOCATED_MOTION_VECTOR_OUTSIDE_IMAGE_AREA:1026,de265_start_worker_threads:this._module.cwrap("de265_start_worker_threads","number",["number","number"]),de265_get_version:this._module.cwrap("de265_get_version","string"),de265_get_version_number:this._module.cwrap("de265_get_version_number","number"),de265_get_error_text:this._module.cwrap("de265_get_error_text","string",["number"]),de265_isOK:this._module.cwrap("de265_isOK","number",["number"]),de265_set_verbosity:this._module.cwrap("de265_set_verbosity","number",["number"]),de265_chroma_mono:0,de265_chroma_420:1,de265_chroma_422:2,de265_chroma_444:3,de265_get_image_width:this._module.cwrap("de265_get_image_width","number",["number","number"]),de265_get_image_height:this._module.cwrap("de265_get_image_height","number",["number","number"]),de265_get_chroma_format:this._module.cwrap("de265_get_chroma_format","number",["number"]),de265_get_bits_per_pixel:this._module.cwrap("de265_get_bits_per_pixel","number",["number","number"]),de265_get_image_plane:this._module.cwrap("de265_get_image_plane","number",["number","number","number"]),de265_get_image_plane_user_data:this._module.cwrap("de265_get_image_plane_user_data","number",["number","number"]),de265_get_image_PTS:this._module.cwrap("de265_get_image_PTS","number",["number"]),de265_get_image_user_data:this._module.cwrap("de265_get_image_user_data","number",["number"]),de265_set_image_user_data:this._module.cwrap("de265_set_image_user_data","number",["number","number"]),de265_new_decoder:this._module.cwrap("de265_new_decoder","number"),de265_free_decoder:this._module.cwrap("de265_free_decoder","number",["number"]),de265_push_data:this._module.cwrap("de265_push_data","number",["number","array","number","number","number"]),de265_push_end_of_NAL:this._module.cwrap("de265_push_end_of_NAL","number",["number"]),de265_push_end_of_frame:this._module.cwrap("de265_push_end_of_frame","number",["number"]),de265_push_NAL:this._module.cwrap("de265_push_NAL","number",["number","array","number","number","number"]),de265_flush_data:this._module.cwrap("de265_flush_data","number",["number"]),de265_get_number_of_input_bytes_pending:this._module.cwrap("de265_get_number_of_input_bytes_pending","number",["number"]),de265_get_number_of_NAL_units_pending:this._module.cwrap("de265_get_number_of_NAL_units_pending","number",["number"]),de265_decode:this._module.cwrap("de265_decode","number",["number","number"]),de265_reset:this._module.cwrap("de265_reset","number",["number"]),de265_peek_next_picture:this._module.cwrap("de265_peek_next_picture","number",["number"]),de265_get_next_picture:this._module.cwrap("de265_get_next_picture","number",["number"]),de265_release_next_picture:this._module.cwrap("de265_release_next_picture","number",["number"]),de265_get_warning:this._module.cwrap("de265_get_warning","number",["number"]),de265_get_highest_TID:this._module.cwrap("de265_get_highest_TID","number",["number"]),de265_get_current_TID:this._module.cwrap("de265_get_current_TID","number",["number"]),de265_set_limit_TID:this._module.cwrap("de265_set_limit_TID","number",["number","number"]),de265_set_framerate_ratio:this._module.cwrap("de265_set_framerate_ratio","number",["number","number"]),de265_change_framerate:this._module.cwrap("de265_change_framerate","number",["number","number"]),DE265_DECODER_PARAM_BOOL_SEI_CHECK_HASH:0,DE265_DECODER_PARAM_DUMP_SPS_HEADERS:1,DE265_DECODER_PARAM_DUMP_VPS_HEADERS:2,DE265_DECODER_PARAM_DUMP_PPS_HEADERS:3,DE265_DECODER_PARAM_DUMP_SLICE_HEADERS:4,DE265_DECODER_PARAM_ACCELERATION_CODE:5,DE265_DECODER_PARAM_SUPPRESS_FAULTY_PICTURES:6,DE265_DECODER_PARAM_DISABLE_DEBLOCKING:7,DE265_DECODER_PARAM_DISABLE_SAO:8,de265_acceleration_SCALAR:0,de265_acceleration_MMX:10,de265_acceleration_SSE:20,de265_acceleration_SSE2:30,de265_acceleration_SSE4:40,de265_acceleration_AVX:50,de265_acceleration_AVX2:60,de265_acceleration_ARM:70,de265_acceleration_NEON:80,de265_acceleration_AUTO:1e4,de265_set_parameter_bool:this._module.cwrap("de265_set_parameter_bool","number",["number","number","number"]),de265_set_parameter_int:this._module.cwrap("de265_set_parameter_int","number",["number","number","number"]),module:this._module}},e}();!function(e){e[e.KS265_PIXFMT_YUV_420P=0]="KS265_PIXFMT_YUV_420P",e[e.KS265_PIXFMT_YUV_420SP=1]="KS265_PIXFMT_YUV_420SP",e[e.KS265_PIXFMT_YUV_420SP_VU=2]="KS265_PIXFMT_YUV_420SP_VU"}(n||(n={}));var l,f={nWidth:720,nHeight:1280,nCodedWidth:720,nCodedHeight:1280,nLumaBitDepth:10,nChromaBitDepth:10,nChromaFormatIdc:0,profile:1,level:150,has_b_frames:1,pts:0,bIllegalStream:0,poc:0},p=[0,0,0,1],v=function(){function e(e){this._evt=void 0,this._module=void 0,this._libks265=void 0,this._ctx=0,this._needNextFrame=!1,this._pendingNum=0,this._isDataEnded=!1,this._config={pAuth:0,threads:1,nal_mode:0,pic_out_pos:0,bEnableOutputRecToFile:0,strRecYuvFileName:0,logLevel:0,outputPixfmt:n.KS265_PIXFMT_YUV_420P,b_use_pthread:0},this._configPtr=0,this._framePtr=0,this._evt=e}var t=e.prototype;return t.init=function(e,t,i){var n=this,r=e.js.data,a=e.jsw?e.jsw.data:"",s=new Function(r+" return KW265;")(),o=a?new Blob([r],{type:"text/javascript"}):"",c=new Blob([a],{type:"text/javascript"});return s({wasmBinary:e.wasm.data,mainScriptUrlOrBlob:o,locateFile:function(e){return-1!==e.indexOf(".worker.js")?URL.createObjectURL(c):""}}).then((function(e){n._module=e,n._cwrapLibKS265Fun(),i>1?(n._config.b_use_pthread=1,n._config.threads=i,n._config.nal_mode=0):n._config.nal_mode=0,n._newDecoder()}))},t.pushNalus=function(e,t,i){void 0===i&&(i=!1),this._updateKS265FrameInfo(this._module,this._framePtr+24,f),this._module.setValue(this._framePtr,0,"i32"),this._pendingNum++;var n=e.reduce((function(e,t){return e+t.data.byteLength}),0)+p.length*e.length,r=new Uint8Array(n),a=0;e.forEach((function(e){r.set(p,a),r.set(e.data,a+p.length),a+=p.length+e.data.byteLength}));var s=performance.now();this._libks265.KS265DecodeFrame(this._ctx,r,n,Math.round(t)||0),this._tryGetFrame(s),this._isDataEnded=i},t.getPendingNALNumber=function(){return this._pendingNum},t.endOfFrame=function(){},t.nextFrame=function(){this._pendingNum&&this._tryGetFrame(),this._needNextFrame=!0},t.free=function(){this._libks265.KS265DecoderDestroy(this._ctx),this._configPtr&&this._module._free(this._configPtr),this._framePtr&&this._module._free(this._framePtr),this._configPtr=this._framePtr=0},t.rebuild=function(){_.b.i("ks265-wrapper","rebuild"),this.free(),this._pendingNum=0,this._needNextFrame=!1,this._isDataEnded=!1,this._newDecoder()},t.flush=function(){},t.reset=function(){},t.isWaitingData=function(){return this._needNextFrame},t._tryGetFrame=function(e){if(e=e||performance.now(),this._isDataEnded&&this._libks265.KS265DecodeFlush(this._ctx,0),!(this._libks265.KS265DecoderGetDecodedFrame(this._ctx,this._framePtr)<0)){var t=this._readKS265Frame(this._module,this._framePtr);t.bValid&&(this._evt.emit(s.a.DECODER_FRAME,{frame:this._getImage(t),startTime:e}),this._isDataEnded||this._libks265.KS265DecoderReturnDecodedFrame(this._ctx,this._framePtr),this._needNextFrame=!1,this._pendingNum--)}},t._newDecoder=function(){this._configPtr=this._mallocKS265DecConfig(this._module,this._config),this._framePtr=this._mallocKS265Frame(this._module,f),this._ctx=this._libks265.KS265DecoderCreate(this._configPtr),this._libks265.KS265DecodeFlush(this._ctx,1)},t._getImage=function(e){return{format:{width:e.frameinfo.nWidth,height:e.frameinfo.nHeight,chroma:1,chromaWidth:e.frameinfo.nWidth/2,chromaHeight:e.frameinfo.nHeight/2,cropLeft:0,cropTop:0,cropWidth:e.frameinfo.nWidth,cropHeight:e.frameinfo.nHeight,displayWidth:0,displayHeight:0,pts:e.frameinfo.pts},y:{bytes:this._module.HEAPU8.subarray(e.pData[0],e.pData[0]+e.iStride[0]*e.frameinfo.nHeight),stride:e.iStride[0],bits:8},u:{bytes:this._module.HEAPU8.subarray(e.pData[1],e.pData[1]+e.iStride[1]*e.frameinfo.nHeight/2),stride:e.iStride[1],bits:8},v:{bytes:this._module.HEAPU8.subarray(e.pData[2],e.pData[2]+e.iStride[2]*e.frameinfo.nHeight/2),stride:e.iStride[2],bits:8}}},t._mallocKS265DecConfig=function(e,t){var i=e._malloc(36);return e.setValue(i,t.pAuth,"i32"),e.setValue(i+4,t.threads,"i32"),e.setValue(i+8,t.nal_mode,"i32"),e.setValue(i+12,t.pic_out_pos,"i32"),e.setValue(i+16,t.bEnableOutputRecToFile,"i32"),e.setValue(i+20,t.strRecYuvFileName,"i32"),e.setValue(i+24,t.logLevel,"i32"),e.setValue(i+28,t.outputPixfmt,"i32"),e.setValue(i+32,t.b_use_pthread,"i32"),i},t._readKS265FrameInfo=function(e,t){return{nWidth:e.getValue(t,"i32"),nHeight:e.getValue(t+4,"i32"),nCodedWidth:e.getValue(t+8,"i32"),nCodedHeight:e.getValue(t+12,"i32"),nLumaBitDepth:e.getValue(t+16,"i32"),nChromaBitDepth:e.getValue(t+20,"i32"),nChromaFormatIdc:e.getValue(t+24,"i32"),profile:e.getValue(t+28,"i32"),level:e.getValue(t+32,"i32"),has_b_frames:e.getValue(t+36,"i32"),pts:e.getValue(t+40,"i32"),bIllegalStream:e.getValue(t+48,"i32"),poc:e.getValue(t+52,"i32")}},t._updateKS265FrameInfo=function(e,t,i){e.setValue(t,i.nWidth,"i32"),e.setValue(t+4,i.nHeight,"i32"),e.setValue(t+8,i.nCodedWidth,"i32"),e.setValue(t+12,i.nCodedHeight,"i32"),e.setValue(t+16,i.nChromaFormatIdc,"i32"),e.setValue(t+20,i.profile,"i32"),e.setValue(t+24,i.level,"i32"),e.setValue(t+28,i.has_b_frames,"i32"),e.setValue(t+32,i.pts,"i64")},t._mallocKS265Frame=function(e,t){return e._malloc(80)},t._readKS265Frame=function(e,t){return{bValid:e.getValue(t,"i32"),pData:[e.getValue(t+4,"i32"),e.getValue(t+8,"i32"),e.getValue(t+12,"i32")],iStride:[e.getValue(t+16,"i16"),e.getValue(t+18,"i16"),e.getValue(t+20,"i16")],frameinfo:this._readKS265FrameInfo(e,t+24)}},t._cwrapLibKS265Fun=function(){this._libks265={KS265DecoderCreate:this._module.cwrap("KS265DecoderCreate","number",["number"]),KS265DecoderDestroy:this._module.cwrap("KS265DecoderDestroy","number",["number"]),KS265DecoderSetDecConfig:this._module.cwrap("KS265DecoderSetDecConfig","number",["number","number"]),KS265DecodeFrameHeader:this._module.cwrap("KS265DecodeFrameHeader","number",["number","array","number"]),KS265DecodeFrame:this._module.cwrap("KS265DecodeFrame","number",["number","array","number","number"]),KS265DecodeFlush:this._module.cwrap("KS265DecodeFlush","number",["number","number"]),KS265DecoderGetDecodedFrame:this._module.cwrap("KS265DecoderGetDecodedFrame","number",["number","number"]),KS265DecoderReturnDecodedFrame:this._module.cwrap("KS265DecoderReturnDecodedFrame","number",["number","number"]),KS265DumpVUIParameters:this._module.cwrap("KS265DumpVUIParameters","number",["number","number","number"]),module:this._module}},e}();!function(e){e[e.KVC_PIXFMT_YUV_420P=0]="KVC_PIXFMT_YUV_420P",e[e.KVC_PIXFMT_YUV_420SP=1]="KVC_PIXFMT_YUV_420SP",e[e.KVC_PIXFMT_YUV_420SP_VU=2]="KVC_PIXFMT_YUV_420SP_VU"}(l||(l={}));var m={width:720,height:1280,codedWidth:720,codedHeight:1280,chromaFormat:0,profile:1,level:150,hasBFrames:1,pts:0},A=[0,0,0,1],g=function(){function e(e,t){void 0===t&&(t=u.b.kvc4),this._evt=void 0,this._module=void 0,this._libkvc=void 0,this._ctx=0,this._needNextFrame=!1,this._pendingNum=0,this._isDataEnded=!1,this._codecType=u.b.unknown,this._leastKVC5=!1,this._postProcessYuv={ysize:0,usize:0,vsize:0,y:0,u:0,v:0},this._config={threads:1,queueDecode:0,picOutPos:0,outputPixfmt:l.KVC_PIXFMT_YUV_420P,b_use_pthread:0},this._configPtr=0,this._framePtr=0,this._evt=e,this._codecType=t}var t=e.prototype;return t.init=function(e,t,i){var n=this,r=e.js.data,a=e.jsw?e.jsw.data:"",s=new Function(r+" return KVCDecoder;")(),o=a?new Blob([r],{type:"text/javascript"}):"",c=new Blob([a],{type:"text/javascript"});return s({wasmBinary:e.wasm.data,mainScriptUrlOrBlob:o,locateFile:function(e){return-1!==e.indexOf(".worker.js")?URL.createObjectURL(c):""}}).then((function(e){n._module=e,n._cwrapLibKVCFun(),n._leastKVC5=n._codecType===u.b.kvc5||n._codecType===u.b.kvc6,n._codecType===u.b.kvc6&&n._libkvc.KVCDecoderPostProcess&&_.b.i("kvc-wrapper","kvc6 post process on."),i>1?(n._config.b_use_pthread=1,n._config.threads=i,n._config.queueDecode=0):n._config.queueDecode=0,n._newDecoder()}))},t.pushNalus=function(e,t,i){void 0===i&&(i=!1),this._updateKVCFrameInfo(this._module,this._framePtr+24,m),this._module.setValue(this._framePtr,0,"i32"),this._pendingNum++;var n=e.reduce((function(e,t){return e+t.data.byteLength}),0)+A.length*e.length,r=new Uint8Array(n),a=0;e.forEach((function(e){r.set(A,a),r.set(e.data,a+A.length),a+=A.length+e.data.byteLength}));var s=performance.now();this._libkvc.KVCDecodeFrame(this._ctx,r,n,Math.round(t)||0),this._tryGetFrame(s),this._isDataEnded=i},t.getPendingNALNumber=function(){return this._pendingNum},t.endOfFrame=function(){},t.nextFrame=function(){this._pendingNum&&this._tryGetFrame(),this._needNextFrame=!0},t.free=function(){this._libkvc.KVCDecoderDestroy(this._ctx),this._ctx=0,this._configPtr&&this._module._free(this._configPtr),this._framePtr&&this._module._free(this._framePtr),this._freePostProcess(),this._configPtr=this._framePtr=0},t.rebuild=function(){_.b.i("kvc-wrapper","rebuild"),this._pendingNum=0,this._needNextFrame=!1,this._isDataEnded=!1,this._postProcessYuv.ysize=0,this._postProcessYuv.usize=0,this._postProcessYuv.vsize=0,this.free(),this._newDecoder()},t.flush=function(){},t.reset=function(){},t.isWaitingData=function(){return this._needNextFrame},t._tryGetFrame=function(e){if(e=e||performance.now(),this._isDataEnded&&this._libkvc.KVCDecodeFlush(this._ctx,0),!(this._libkvc.KVCDecoderGetDecodedFrame(this._ctx,this._framePtr)<0)){var t=this._readKVCFrame(this._module,this._framePtr);t.valid&&(this._codecType===u.b.kvc6&&this._libkvc.KVCDecoderPostProcess&&this._postProcess(this._module,t),this._evt.emit(s.a.DECODER_FRAME,{frame:this._getImage(t),startTime:e}),this._isDataEnded||this._libkvc.KVCDecoderReturnDecodedFrame(this._ctx,this._framePtr),this._needNextFrame=!1,this._pendingNum--)}},t._postProcess=function(e,t){t.ysize===this._postProcessYuv.ysize&&t.usize===this._postProcessYuv.usize&&t.vsize===this._postProcessYuv.vsize||this._mallocPostProcessYUV(e,t),e.HEAPU8.set(e.HEAPU8.subarray(t.data[0],t.data[0]+t.ysize),this._postProcessYuv.y),e.HEAPU8.set(e.HEAPU8.subarray(t.data[1],t.data[1]+t.usize),this._postProcessYuv.u),e.HEAPU8.set(e.HEAPU8.subarray(t.data[2],t.data[2]+t.vsize),this._postProcessYuv.v),t.data=[this._postProcessYuv.y,this._postProcessYuv.u,this._postProcessYuv.v],e.setValue(this._framePtr+8,t.data[0],"i32"),e.setValue(this._framePtr+12,t.data[1],"i32"),e.setValue(this._framePtr+16,t.data[2],"i32"),this._libkvc.KVCDecoderPostProcess(this._ctx,this._framePtr)},t._freePostProcess=function(){_.b.i("kvc-wrapper","free post process yuv."),this._postProcessYuv.y&&this._module._free(this._postProcessYuv.y),this._postProcessYuv.u&&this._module._free(this._postProcessYuv.u),this._postProcessYuv.v&&this._module._free(this._postProcessYuv.v),this._postProcessYuv.y=this._postProcessYuv.u=this._postProcessYuv.v=0},t._mallocPostProcessYUV=function(e,t){_.b.i("kvc-wrapper","malloc post process yuv."),this._freePostProcess(),this._postProcessYuv.y=e._malloc(t.ysize),this._postProcessYuv.u=e._malloc(t.usize),this._postProcessYuv.v=e._malloc(t.vsize),this._postProcessYuv.ysize=t.ysize,this._postProcessYuv.usize=t.usize,this._postProcessYuv.vsize=t.vsize},t._newDecoder=function(){this._configPtr=this._mallocKVCDecConfig(this._module,this._config),this._framePtr=this._mallocKVCFrame(this._module,m),this._ctx=this._libkvc.KVCDecoderCreate(this._configPtr),this._libkvc.KVCDecodeFlush(this._ctx,1)},t._getImage=function(e){return{format:{width:e.info.width,height:e.info.height,chroma:1,chromaWidth:e.info.width/2,chromaHeight:e.info.height/2,cropLeft:0,cropTop:0,cropWidth:e.info.width,cropHeight:e.info.height,displayWidth:0,displayHeight:0,pts:e.info.pts},y:{bytes:this._module.HEAPU8.subarray(e.data[0],e.data[0]+e.ysize),stride:e.stride[0],bits:8},u:{bytes:this._module.HEAPU8.subarray(e.data[1],e.data[1]+e.usize),stride:e.stride[1],bits:8},v:{bytes:this._module.HEAPU8.subarray(e.data[2],e.data[2]+e.vsize),stride:e.stride[2],bits:8}}},t._mallocKVCDecConfig=function(e,t){var i=e._malloc(20);return e.setValue(i,t.threads,"i32"),e.setValue(i+4,t.queueDecode,"i32"),e.setValue(i+8,t.picOutPos,"i32"),e.setValue(i+12,t.outputPixfmt,"i32"),e.setValue(i+16,t.b_use_pthread,"i32"),i},t._mallocKVCFrameInfo=function(e){return e._malloc(40)},t._readKVCFrameInfo=function(e,t){return{width:e.getValue(t,"i32"),height:e.getValue(t+4,"i32"),codedWidth:e.getValue(t+8,"i32"),codedHeight:e.getValue(t+12,"i32"),chromaFormat:e.getValue(t+16,"i32"),profile:e.getValue(t+20,"i32"),level:e.getValue(t+24,"i32"),hasBFrames:e.getValue(t+28,"i32"),pts:e.getValue(t+32,"i64")}},t._updateKVCFrameInfo=function(e,t,i){e.setValue(t,i.width,"i32"),e.setValue(t+4,i.height,"i32"),e.setValue(t+8,i.codedWidth,"i32"),e.setValue(t+12,i.codedHeight,"i32"),e.setValue(t+16,i.chromaFormat,"i32"),e.setValue(t+20,i.profile,"i32"),e.setValue(t+24,i.level,"i32"),e.setValue(t+28,i.hasBFrames,"i32"),e.setValue(t+32,i.pts,"i64")},t._mallocKVCFrame=function(e,t){return e._malloc(this._leastKVC5?65536:64)},t._readKVCFrame=function(e,t){var i,n=e.getValue(t,"i32"),r=4,a=0;this._leastKVC5?(a=e.getValue(t+r,"i32"),r+=4,i=this._readKVCFrameInfo(e,t+32)):i=this._readKVCFrameInfo(e,t+24);var s=[e.getValue(t+r,"i32"),e.getValue(t+r+4,"i32"),e.getValue(t+r+8,"i32")];r+=12;var o=[e.getValue(t+r,"i16"),e.getValue(t+r+2,"i16"),e.getValue(t+r+4,"i16")];return r+=6,{valid:n,poc:a,data:s,stride:o,info:i,ysize:o[0]*i.height,usize:o[1]*i.height/2,vsize:o[2]*i.height/2}},t._cwrapLibKVCFun=function(){this._libkvc={KVCDecoderCreate:this._module.cwrap("KVCDecoderCreate","number",["number"]),KVCDecoderDestroy:this._module.cwrap("KVCDecoderDestroy","number",["number"]),KVCDecoderSetDecConfig:this._module.cwrap("KVCDecoderSetDecConfig","number",["number","number"]),KVCDecodeFrameHeader:this._module.cwrap("KVCDecodeFrameHeader","number",["number","array","number"]),KVCDecodeFrame:this._module.cwrap("KVCDecodeFrame","number",["number","array","number","number"]),KVCDecodeFlush:this._module.cwrap("KVCDecodeFlush","number",["number","number"]),KVCDecoderGetDecodedFrame:this._module.cwrap("KVCDecoderGetDecodedFrame","number",["number","number"]),KVCDecoderReturnDecodedFrame:this._module.cwrap("KVCDecoderReturnDecodedFrame","number",["number","number"]),KVCDecoderGetVersion:this._module.cwrap("KVCDecoderGetVersion","number"),KVC19DumpVUIParameters:this._module.cwrap("KVCDumpVUIParameters","number",["number","number","number"]),module:this._module},this._module._KVCDecoderPostProcess&&(_.b.i("kvc-wrapper","post process func detected."),this._libkvc.KVCDecoderPostProcess=this._module.cwrap("KVCDecoderPostProcess","number",["number","number"]))},e}(),y=i(15),E=[0,0,0,1],b=function(){function e(e){this._evt=void 0,this._module=void 0,this._libkvc=void 0,this._ctx=0,this._needNextFrame=!1,this._pendingNum=0,this._isDataEnded=!1,this._config={threads:1,needOutput:1},this._configPtr=0,this._inputPtr=0,this._framePtr=0,this._videoInfoPtr=0,this._streamPtrs=[],this._videoInfo=void 0,this._evt=e}var t=e.prototype;return t.init=function(e,t,i){var n=this,r=e.js.data,a=e.jsw?e.jsw.data:"",s=new Function(r+" return KVC30;")(),o=a?new Blob([r],{type:"text/javascript"}):"",c=new Blob([a],{type:"text/javascript"});return s({wasmBinary:e.wasm.data,mainScriptUrlOrBlob:o,locateFile:function(e){return-1!==e.indexOf(".worker.js")?URL.createObjectURL(c):""}}).then((function(e){n._module=e,n._cwrapLibKVCFun(),i>1?(n._config.threads=1,n._config.threads=i):n._config.threads=0,n._newDecoder()}))},t.pushNalus=function(e,t,i){void 0===i&&(i=!1),this._module.setValue(this._framePtr,0,"i32"),this._pendingNum++;var n=e.reduce((function(e,t){return e+t.data.byteLength}),0)+E.length*e.length,r=new Uint8Array(n),a=0;e.forEach((function(e){r.set(E,a),r.set(e.data,a+E.length),a+=E.length+e.data.byteLength})),this._writeKVCInput(this._module,r,t),this._dec(),this._isDataEnded=i},t.getPendingNALNumber=function(){return this._pendingNum},t.endOfFrame=function(){},t.nextFrame=function(){this._needNextFrame=!0},t.free=function(){this._libkvc.KVCDecoderDestroy(this._ctx),this._ctx&&this._module._free(this._ctx),this._ctx=0,this._configPtr&&this._module._free(this._configPtr),this._inputPtr&&this._module._free(this._inputPtr),this._framePtr&&this._module._free(this._framePtr),this._videoInfoPtr&&this._module._free(this._videoInfoPtr),this._configPtr=this._framePtr=0,this._freeStreamPtr()},t.rebuild=function(){_.b.i("kvc30-wrapper","rebuild"),this._pendingNum=0,this._needNextFrame=!1,this._isDataEnded=!1,_.b.i("kvc30-wrapper","rebuild"),this.free(),this._newDecoder()},t.flush=function(){_.b.i("kvc30-wrapper","flush"),this._module.setValue(this._inputPtr,0,"i64"),this._module.setValue(this._inputPtr+8,0,"i32"),this._module.setValue(this._inputPtr+12,0,"i32");var e=!1;do{e=this._dec()}while(e);this._pendingNum=0,this._needNextFrame=!1},t.reset=function(){},t.isWaitingData=function(){return this._needNextFrame},t._newDecoder=function(){_.b.i("kvc30-wrapper","new decoder."),this._configPtr=this._mallocKVCDecConfig(this._module,this._config),this._inputPtr=this._module._malloc(16),this._framePtr=this._module._malloc(96),this._videoInfoPtr=this._module._malloc(68),this._ctx=this._libkvc.KVCDecoderCreate(this._configPtr)},t._getImage=function(e){return{format:{width:e.width[0],height:e.height[0],chroma:1,chromaWidth:e.width[1],chromaHeight:e.height[1],cropLeft:0,cropTop:0,cropWidth:e.width[0],cropHeight:e.height[0],displayWidth:0,displayHeight:0,pts:e.pts,colorInfo:this._getColorInfo()},y:{bytes:this._module.HEAPU8.subarray(e.bufs[0],e.bufs[0]+e.stride[0]*e.height[0]*e.bytesPerPixel),stride:e.stride[0],bits:e.bitDepth},u:{bytes:this._module.HEAPU8.subarray(e.bufs[1],e.bufs[1]+e.stride[1]*e.height[1]*e.bytesPerPixel),stride:e.stride[1],bits:e.bitDepth},v:{bytes:this._module.HEAPU8.subarray(e.bufs[2],e.bufs[2]+e.stride[2]*e.height[2]*e.bytesPerPixel),stride:e.stride[2],bits:e.bitDepth}}},t._mallocKVCDecConfig=function(e,t){var i=e._malloc(8);return e.setValue(i,t.threads,"i32"),e.setValue(i+4,t.needOutput,"i32"),i},t._writeKVCInput=function(e,t,i){var n=e._malloc(t.byteLength);e.HEAPU8.set(t,n),e.setValue(this._inputPtr,Math.round(i),"i64"),e.setValue(this._inputPtr+8,n,"i32"),e.setValue(this._inputPtr+12,t.byteLength,"i32"),this._streamPtrs.push(n),this._freeStreamPtr(16)},t._freeStreamPtr=function(e){if(void 0===e&&(e=0),this._module)for(;this._streamPtrs.length>e;){var t=this._streamPtrs.shift();t&&this._module._free(t)}},t._readKVCFrame=function(e,t){return{pts:e.getValue(t,"i64"),bufs:[e.getValue(t+8,"i32"),e.getValue(t+12,"i32"),e.getValue(t+16,"i32"),e.getValue(t+20,"i32")],outputFrame:e.getValue(t+24,"i32"),width:[e.getValue(t+28,"i32"),e.getValue(t+32,"i32"),e.getValue(t+36,"i32"),e.getValue(t+40,"i32")],height:[e.getValue(t+44,"i32"),e.getValue(t+48,"i32"),e.getValue(t+52,"i32"),e.getValue(t+56,"i32")],stride:[e.getValue(t+60,"i32"),e.getValue(t+64,"i32"),e.getValue(t+68,"i32"),e.getValue(t+72,"i32")],bytesPerPixel:e.getValue(t+76,"i32"),colorFormat:e.getValue(t+80,"i32"),bitDepth:e.getValue(t+84,"i32"),planes:e.getValue(t+88,"i32"),hasOutput:e.getValue(t+92,"i32")}},t._readVideoInfo=function(e,t){return{chromaFormat:e.getValue(t,"i32"),codedWidth:e.getValue(t+4,"i32"),codedHeight:e.getValue(t+8,"i32"),width:e.getValue(t+12,"i32"),height:e.getValue(t+16,"i32"),hasBFrames:e.getValue(t+20,"i32"),profile:e.getValue(t+24,"i32"),level:e.getValue(t+28,"i32"),b_vui_valid:e.getValue(t+32,"i32"),aspect_ratio_info_present_flag:e.getValue(t+36,"i32"),video_full_range_flag:e.getValue(t+40,"i32"),sar_width:e.getValue(t+44,"i32"),sar_height:e.getValue(t+48,"i32"),colour_description_present_flag:e.getValue(t+52,"i32"),colour_primaries:e.getValue(t+56,"i32"),transfer_characteristics:e.getValue(t+60,"i32"),matrix_coeffs:e.getValue(t+64,"i32")}},t._dec=function(){if(this._libkvc.KVCDecodeFrame(this._ctx,this._inputPtr,this._framePtr));else{var e=this._readKVCFrame(this._module,this._framePtr);if(e.hasOutput)return this._videoInfo||this._updateVideoInfo(),this._evt.emit(s.a.DECODER_FRAME,{frame:this._getImage(e),startTime:performance.now()}),this._libkvc.KVCDecodeUnrefFrame(this._ctx,this._framePtr),this._needNextFrame=!1,this._pendingNum--,!0}return!1},t._updateVideoInfo=function(){this._libkvc.KVCExportParams(this._ctx,this._videoInfoPtr),this._videoInfo=this._readVideoInfo(this._module,this._videoInfoPtr),_.b.i("kvc30-wrapper","video info",this._videoInfo)},t._getColorInfo=function(){var e=this._videoInfo;if(e&&e.colour_description_present_flag)return{colorRange:e.video_full_range_flag?y.b.AVCOL_RANGE_JPEG:y.b.AVCOL_RANGE_MPEG,colourPrimaries:e.colour_primaries,transferCharacteristics:e.transfer_characteristics,matrixCoefficients:e.matrix_coeffs}},t._cwrapLibKVCFun=function(){this._libkvc={KVCDecoderCreate:this._module.cwrap("kvc30dec_create","number",["number"]),KVCDecoderDestroy:this._module.cwrap("kvc30dec_destroy","number",["number"]),KVCDecodeFrame:this._module.cwrap("kvc30dec_decode","number",["number","number","number"]),KVCDecodeUnrefFrame:this._module.cwrap("kvc30dec_unref_frame","number",["number","number"]),KVCExportParams:this._module.cwrap("kvc30dec_export_params","number",["number","number"]),KVCGetVersion:this._module.cwrap("kvc30dec_get_version","number"),module:this._module}},e}(),T=r.a/r.j,S=r.a/r.c,x=[o.a.HEVC_NAL_TRAIL_N,o.a.HEVC_NAL_TSA_N,o.a.HEVC_NAL_STSA_N,o.a.HEVC_NAL_RADL_N,o.a.HEVC_NAL_RASL_N],C=[o.a.HEVC_NAL_IDR_W_RADL,o.a.HEVC_NAL_IDR_N_LP,o.a.HEVC_NAL_CRA_NUT],L=[c.a.VVC_NAL_UNIT_CODED_SLICE_IDR_W_RADL,c.a.VVC_NAL_UNIT_CODED_SLICE_IDR_N_LP,c.a.VVC_NAL_UNIT_CODED_SLICE_CRA,c.a.VVC_NAL_UNIT_CODED_SLICE_GDR],R=function(){function e(e){var t=this;this._decoder=void 0,this._evt=void 0,this._clock=-1,this._frameBufLen=0,this._maxFrameBufLen=16,this._vLastPTS=0,this._vLastDTS=0,this._dataCache=[],this._gopId=0,this._frameDuration=33,this._droppedFrames=0,this._decodedFrames=0,this._loop=void 0,this._decodeTimes=[],this._avgDecodeDuration=0,this._mediaInfo=void 0,this._hasOverriddenFPS=!1,this._output=u.o.canvas,this._decConfigData=void 0,this._seeking=!1,this._seekingTime=0,this._decId=1,this._defaultDropPolicy=u.n.AUTO,this._dropPolicy=u.n.AUTO,this._lastDataCachePTS=-1,this._endOfData=!1,this._expiredDataSync=!1,this._lastPushPTS=0,this._appendDecActive=!1,this._lowBufThreshold=16,this._decBufInfo=[],this._idrFrame=C,this._checkSkip=void 0,this._onSeeked=function(e){t._evt.emit(s.a.DECODER_SEEK,{hitCache:e}),e?t._seeking=!1:t._expiredDataSync=!0},this._onSeekAbort=function(){t._seeking=!1,t._evt.emit(s.a.DECODER_SEEK_ABORT)},this._onFrame=function(e){for(t._vLastPTS=e.frame.format.pts;t._decBufInfo.length&&e.frame.format.pts+1>=t._decBufInfo[0].pts;)t._decBufInfo.shift();if(t._decodeTimes.length>10&&t._decodeTimes.shift(),e.startTime){var i=performance.now()-e.startTime;t._decodeTimes.push(i),t._avgDecodeDuration=t._decodeTimes.reduce((function(e,t){return e+t}),0)/t._decodeTimes.length,t._vLastPTS+=i,t._decodedFrames++;var n=e.frame;t._preprocessYUV(n),t._evt.emit(s.a.DECODER_IMG,{droped:t._droppedFrames,decoded:t._decodedFrames,decId:t._decId,frame:n});var r=t._seekingTime;t._endOfData&&(r=t._lastDataCachePTS>=0?Math.min(t._lastDataCachePTS,r):r),t._seeking&&e.frame.format.pts+1>=r&&t._onSeeked(!0)}},this._checkHevcSkip=function(e){return e.units.reduce((function(e,t){return-1!==x.indexOf(t.type)&&e}),!0)},this._isIDR=function(e){return e.units.reduce((function(e,i){return-1!==t._idrFrame.indexOf(i.type)||e}),!1)},this._checkVvcSkip=function(e){return e.units.reduce((function(e,i){return t._checkVvcNaluSkip(i.type,i.temporalId)&&e}),!0)},this._checkVvcNaluSkip=function(e,t){return 255!=e&&!!t},this._evt=e,this._evt.on(s.a.DECODER_FRAME,this._onFrame),this._checkSkip=this._checkHevcSkip}var t=e.prototype;return t.init=function(e,t,i,n,r,o,c){var d=this;_.b.i("v-decoder-inline","init. "+c),this._decId=e,this._dropPolicy=i.videoDropFramePolicy,this._defaultDropPolicy=i.videoDropFramePolicy,c===u.p.kw265?this._decoder=new v(this._evt):o===u.b.kvc3||o===u.b.kvc4||o===u.b.kvc5||o===u.b.kvc6?this._decoder=new g(this._evt,o):o===u.b.bvc2||o===u.b.vvc||o===u.b.kvc30?(this._idrFrame=L,this._checkSkip=this._checkVvcSkip,this._decoder=new b(this._evt)):this._decoder=new h(this._evt);try{this._decoder.init(t,n,r).then((function(){d._decoder&&(d._appendDecActive=!0,d._decoder.nextFrame(),d._startLoop(),d._evt.emit(s.a.DEC_INIT_COMPLETE,{simd:n,threads:r,decoderType:c}))})).catch((function(e){d._evt.emit(s.a.ERROR,{type:a.b.DECODER_ERROR,details:a.a.DECODER_INIT_ERROR,fatal:!0,reason:e})}))}catch(e){this._evt.emit(s.a.ERROR,{type:a.b.DECODER_ERROR,details:a.a.DECODER_INIT_ERROR,fatal:!0,reason:e.message})}},t.expiredDataSync=function(){this._expiredDataSync=!1},t.appendData=function(e){var t=this;this._expiredDataSync||(this._endOfData&&_.b.i("v-decoder-inline","end of data false on append"),this._endOfData=!1,e.type!==d.c.decoderConfig?(e.samples.forEach((function(i){var n=t._isIDR(i);if(n||-1!==t._lastDataCachePTS){var a;if(n)t._decConfigData&&(a=i.units).unshift.apply(a,t._decConfigData.units),t._gopId++;var s={key:n,gopId:t._gopId,type:e.type||d.c.videoFrame,data:i,dts:i.dts*r.a,pts:i.pts*r.a};s.pts>t._lastDataCachePTS&&(t._lastDataCachePTS=s.pts);var o=t._dataCache.length?t._dataCache[t._dataCache.length-1].dts:t._vLastDTS;s.discontinuity=!!(s.type===d.c.videoFrame&&o&&Math.abs(s.dts-o)>r.k),t._dataCache.push(s)}})),!this._hasOverriddenFPS&&this._dataCache.length>10&&(this._frameDuration=Math.max(T,(this._dataCache[this._dataCache.length-1].dts-this._dataCache[0].dts)/(this._dataCache.length-1)))):this._decConfigData=e.samples[0])},t.endOfData=function(){_.b.i("v-decoder-inline","end of data"),this._endOfData=!0},t.updateState=function(e,t,i,n,r,a){this._output=t,this._appendDecActive=i,this._frameBufLen=n,this._maxFrameBufLen=a,this._dropPolicy=r>=1.5?u.n.ALL_NON_REF:this._defaultDropPolicy,this._seeking&&Math.abs(e-this._seekingTime)>100&&this._onSeekAbort(),t!==u.o.video&&(this._clock=e)},t.updateMediaInfo=function(e){_.b.i("v-decoder-inline","update media info",e),this._mediaInfo=e,this._updateFPS()},t.destroy=function(){this._evt.off(s.a.DECODER_FRAME,this._onFrame),this._appendDecActive=!1,this._stopLoop()},t.clean=function(e){if(_.b.i("v-decoder-inline","clean",e),this._dataCache.length&&e>this._dataCache[0].pts){for(var t=0;t<this._dataCache.length&&!(this._dataCache[t].key&&this._dataCache[t].pts>e);t++);this._dataCache=this._dataCache.slice(0,t)}else e>this._lastPushPTS&&this._decoder&&this._decoder.rebuild()},t.reset=function(e,t){void 0===t&&(t=!1),_.b.i("v-decoder-inline","reset",e),this._decoder&&this._decoder.rebuild(),this._decId=e,this._dataCache=[],this._lastDataCachePTS=-1,this._vLastPTS=0,this._vLastDTS=0,this._clock=-1,this._frameBufLen=0,this._endOfData=!1,this._expiredDataSync=!1,this._lastPushPTS=0,this._appendDecActive=!0,this._decBufInfo=[],this._updateFPS(),t||(this._seeking=!1,this._seekingTime=0)},t.seek=function(e){var t,i;_.b.i("v-decoder-inline","decoder seek: "+e),this._clock=this._seekingTime=e,this._seeking=!0;var n=this._vLastPTS||(null==(t=this._decBufInfo[0])?void 0:t.pts)||0,r=this._decBufInfo.length?this._decBufInfo[this._decBufInfo.length-1].pts+this._frameDuration:this._vLastPTS||(null==(i=this._dataCache[0])?void 0:i.pts)||0;if(this._decBufInfo.length&&e>=n&&e<=r)_.b.i("v-decoder-inline","decoder seek hit dec cache");else if(this._dataCache.length&&r<=e&&this._lastDataCachePTS>=e){for(var a=this._dataCache[0].gopId,o=a,c=0,u=0,d=0;d<this._dataCache.length&&(this._dataCache[d].gopId===a&&u++,this._dataCache[d].gopId!==o&&(o=this._dataCache[d].gopId,c=d),!(this._dataCache[d].pts>=e));d++);o===a||u<=3&&o-a==1?_.b.i("v-decoder-inline","decoder seek hit data cache. continue decode"):(_.b.i("v-decoder-inline","decoder seek hit data cache. switch gop"),this._evt.emit(s.a.RENDERER_BUF_EXPIRED),this._dataCache.splice(0,c),this._decoder&&this._decoder.rebuild(),this._vLastPTS=0,this._vLastDTS=0,this._lastPushPTS=0)}else _.b.i("v-decoder-inline","decoder seek miss cache."),this._dataCache=[],this._onSeeked(!1)},t._dataEnded=function(){return!(!this._endOfData||this._dataCache.length||!this._decoder||this._decoder.isWaitingData()||this._decoder.getPendingNALNumber())},t._preprocessYUV=function(e){this._preprocessYUVPlane(e.y,e.format.width,e.format.height),this._preprocessYUVPlane(e.u,e.format.chromaWidth,e.format.chromaHeight),this._preprocessYUVPlane(e.v,e.format.chromaWidth,e.format.chromaHeight)},t._preprocessYUVPlane=function(e,t,i){var n=e.bits>8?2:1;if(e.stride/n>t){for(var r=new Uint8Array(t*i*n),a=0;a<i;a++)r.set(e.bytes.subarray(e.stride*a,e.stride*a+t*n),a*t*n);e.stride=t*n,e.bytes=r}else e.bytes=new Uint8Array(e.bytes)},t._pushDataToDecoder=function(e){this._decoder&&e&&(this._decBufInfo.push({pts:e.pts,dts:e.dts,gopId:e.gopId}),this._decBufInfo.sort((function(e,t){return e.pts-t.pts})),this._decoder.pushNalus(e.data.units,e.pts,this._endOfData&&!this._dataCache.length),e.pts>this._lastPushPTS&&(this._lastPushPTS=e.pts),e.type===d.c.videoFrame&&(this._vLastDTS=e.dts,this._dataCache.length||this._decoder.endOfFrame()))},t._resetTime=function(){_.b.i("v-decoder-inline","reset time"),this._decoder&&this._vLastDTS&&this._decoder.reset(),this._vLastPTS=0,this._vLastDTS=0,this._lastPushPTS=0},t._update=function(){if(this._decoder&&-1!==this._clock&&this._output!==u.o.video){var e=this._clock;if(this._vLastPTS&&this._dataCache.length&&this._appendDecActive&&!this._seeking){var t=this._syncIndex(e);t>5&&this._dropFrame(e,this._dataCache[t].gopId)}e+=(this._maxFrameBufLen+16)*this._frameDuration;var i=this._frameBufLen<this._maxFrameBufLen;if(this._appendDecActive&&this._dataCache.length&&(this._vLastPTS<=e||i)){for(var n=this._dataCache[0],r=0;n&&(n.pts<=e||n.dts<=e||!this._vLastDTS||i)&&!(++r>3);)if(this._dropPolicy===u.n.ALL_NON_REF&&this._checkSkip(n.data))this._dataCache.shift(),n=this._dataCache[0],this._droppedFrames++;else{var a=this._dataCache.shift();this._pushDataToDecoder(a),n=this._dataCache[0],i=!1}this._endOfData&&!this._dataCache.length?(this._decoder.flush(),this._evt.emit(s.a.DECODER_DATA_END)):this._dataCache.length<this._lowBufThreshold&&this._evt.emit(s.a.DECODER_BUF_LOW)}this._decoder.isWaitingData()&&!this._decoder.getPendingNALNumber()||this._decoder.nextFrame()}},t._syncIndex=function(e){for(var t=0;t<this._dataCache.length;t++)if(this._dataCache[t].type===d.c.videoFrame&&this._dataCache[t].dts>=e)return t;return this._dataCache.length?this._dataCache.length-1:-1},t._dropFrame=function(e,t){for(var i,n=0,r=!1,a=0,o=!1,c=0;a<this._dataCache.length;){var h=this._dataCache[a],l=void 0;if(h.type===d.c.videoFrame)if(h.gopId<t)o=!0,l=this._dataCache.splice(a,1)[0];else{if(h.gopId>t)break;if(!(e>h.dts&&this._dropPolicy!==u.n.MIN))break;this._checkSkip(h.data)&&(l=this._dataCache.splice(a,1)[0]),a++}else h.gopId<t&&(l=this._dataCache.splice(a,1)[0]);l&&(void 0===i&&(i=l.pts),c=l.pts,n++,l.discontinuity&&(r=!0))}if(this._droppedFrames+=n,o&&this._decoder&&this._decoder.rebuild(),r&&this._resetTime(),n&&void 0!==i){_.b.i("v-decoder-inline","drop frame",n,e,o);var f={pts:i,endPTS:c,count:n};this._evt.emit(s.a.DECODER_DROP_FRAME,f)}},t._updateFPS=function(){var e=this._mediaInfo;e&&e.fps&&"number"==typeof e.fps&&e.fps>0&&e.fps<r.j?(this._hasOverriddenFPS=!0,this._frameDuration=r.a/e.fps,this._lowBufThreshold=Math.max(2*e.fps,16)):this._frameDuration=S},t._startLoop=function(){var e=this;this._loop||(this._loop=setInterval((function(){e._update()}),0))},t._stopLoop=function(){this._loop&&(clearInterval(this._loop),this._loop=void 0)},e}();t.a=R},function(e,t,i){var n,r=i(39),a=i(34),s=i(3),o=i(1),c=i(0),u=i(2),d=i(24),_=i(5),h=i.n(_),l=i(15),f=i(22),p="\n    precision lowp float;\n\n    attribute vec2 aPosition;\n    attribute vec2 aLumaPosition;\n    attribute vec2 aChromaPosition;\n    varying vec2 vLumaPosition;\n    varying vec2 vChromaPosition;\n    uniform mat3 uMatrix;\n    void main() {\n        gl_Position = vec4((uMatrix * vec3(aPosition, 1)).xy, 0, 1);\n        vLumaPosition = aLumaPosition;\n        vChromaPosition = aChromaPosition;\n    }\n    ",v="\n    #define EOTF_C1 .8359375\n    #define EOTF_C2 18.8515625\n    #define EOTF_C3 18.6875\n    #define EOTF_HLG_GAMMA 0.2\n    #define _EOTF_HLG_A 0.17883277\n    #define _EOTF_HLG_B 0.28466892\n    #define _EOTF_HLG_C 0.55991073\n    #define MAIN_A 2.51\n    #define MAIN_B 0.03\n    #define MAIN_C 1.23\n    #define MAIN_D 0.59\n    #define MAIN_E 0.14\n    #define MAIN_ADAPTED_LUM 0.001\n\n    precision lowp float;\n\n    const vec3 eotf_m1 = vec3(1.0 / .1593017578125);\n    const vec3 eotf_m2 = vec3(1.0 / 78.84375);\n    const vec3 tonemapping_hlg_m1 = vec3(1.0 / 1.3);\n    const vec3 main_m1 = vec3(0.555555555556);\n    const vec3 main_m2 = vec3(2.0);\n    \n    // bt2020 to bt709\n    const mat3 mat_xyz_to_rgbp3 = mat3(\n        1.66049100210843, -0.124550474521591, -0.0181507633549054, \n        -0.587641138788548, 1.13289989712596, -0.100578898008008, \n        -0.0728498633198855, -0.00834942260436943, 1.11872966136291\n    );\n\n    float _eotf_hlg(float x) {\n        if (x < 0.5) {\n            return pow(x / 0.5, 2.0) / 12.0;\n        } else {\n            return (exp((x - _EOTF_HLG_C) / _EOTF_HLG_A) + _EOTF_HLG_B) / 12.0;\n        }\n    }\n\n    vec3 eotf_hlg(vec3 i) {\n        vec3 res;\n        float Y = 0.2627 * res.x + 0.6780 * res.y + 0.0593 * res.z;\n        res = pow(Y, EOTF_HLG_GAMMA) * res;\n        res.x = _eotf_hlg(i.x);\n        res.y = _eotf_hlg(i.y);\n        res.z = _eotf_hlg(i.z);\n        return res;\n    }\n\n    vec3 eotf(vec3 i) {\n        i = max(i, 1e-10);\n        vec3 input_m2 = pow(i, eotf_m2);\n        return pow((input_m2 - EOTF_C1) / (EOTF_C2 - EOTF_C3 * input_m2), eotf_m1) * 10000.0;\n    }\n\n    vec3 tonemapping_hlg(vec3 i) {\n        vec3 res = pow(i, tonemapping_hlg_m1);\n        return res;\n    }\n\n    float _trc_gamma(float i) {\n        if (i < 0.018) {\n            return 4.5 * i;\n        } else {\n            return 1.099 * pow(i, 0.45);\n        }\n    }\n\n    vec3 trc_gamma(vec3 i) {\n        vec3 res;\n        res.x = _trc_gamma(i.x);\n        res.y = _trc_gamma(i.y);\n        res.z = _trc_gamma(i.z);\n        return res;\n    }\n\n    // vec3 rgb_gamma(vec3 i) {\n    //     vec3 l = 4.5 * i;\n    //     vec3 g = 1.099 * pow(i, vec3(0.45)) - 0.099;\n    //     if(i.x > 0.018 && i.y > 0.018 && i.z > 0.018) {\n    //         return l;\n    //     } else {\n    //         return g;\n    //     }\n    // }\n\n    // vec3 rgb_inverse_gamma(vec3 i) {\n    //     vec3 l = i / 4.5;\n    //     vec3 g = pow((i + 0.099) / 1.099, vec3(1.0 / 0.45, 1.0 / 0.45, 1.0 / 0.45));\n    //     if(i.x > 0.018 * 4.5 && i.y > 0.018 * 4.5 && i.z > 0.018 * 4.5) {\n    //         return l;\n    //     } else {\n    //         return g;\n    //     }\n    // }\n\n    // vec3 inverse_eotf(vec3 i) {\n    //     float c1 = .8359375;\n    //     float c2 = 18.8515625;\n    //     float c3 = 18.6875;\n    //     vec3 m1 = vec3(.1593017578125);\n    //     vec3 m2 = vec3(78.84375);\n\n    //     i = max(i / 10000.0, 1e-10);\n    //     return pow(max(pow(i, m1) * c2 + c1, vec3(0.0)) / (1.0 + c3 * pow(i, m1)), m2);\n    // }\n\n    // float _inverse_trc(float x) {\n    //     return pow(x, 1.5);\n    // }\n\n    // vec3 inverse_trc(vec3 i) {\n    //     vec3 res;\n    //     res.x = _inverse_trc(i.x);\n    //     res.y = _inverse_trc(i.y);\n    //     res.z = _inverse_trc(i.z);\n    //     return res;\n    // }\n\n    uniform sampler2D uTextureY;\n    uniform sampler2D uTextureCb;\n    uniform sampler2D uTextureCr;\n    uniform float uColorCovYOffset;\n    uniform mat3 uColorConversion;\n    uniform int uColorTrc;\n    uniform int uBitsPerPixel;\n    varying vec2 vLumaPosition;\n    varying vec2 vChromaPosition;\n\n    void main() {\n        vec3 yuv;\n        if (uBitsPerPixel > 8) {\n            float normalized = pow(2.0, float(uBitsPerPixel - 8));\n            yuv.x = (texture2D(uTextureY, vLumaPosition).r + texture2D(uTextureY, vLumaPosition).a * 256.0) / normalized + uColorCovYOffset;\n            yuv.y = (texture2D(uTextureCb, vChromaPosition).r + texture2D(uTextureCb, vChromaPosition).a * 256.0) / normalized - 0.5;\n            yuv.z = (texture2D(uTextureCr, vChromaPosition).r + texture2D(uTextureCr, vChromaPosition).a * 256.0) / normalized - 0.5;\n            vec3 rgb = uColorConversion * yuv;\n\n            vec3 rgb_lum;\n            if (uColorTrc == 16) { // HDR10 or HDR10+\n                // 电光转换（EOTF）\n                rgb_lum = eotf(rgb);\n\n                //tone mapping\n                vec3 tmp = rgb_lum * MAIN_ADAPTED_LUM;\n                rgb_lum = tmp * (tmp * MAIN_A + MAIN_B) / (tmp * (tmp * MAIN_C + MAIN_D) + MAIN_E) / 1.3;\n                rgb_lum = pow(rgb_lum, main_m1) * pow(main_m2, rgb_lum) / 2.0; //g=1.8\n\n                //调节饱和度\n                float gray = (rgb_lum.x + rgb_lum.y + rgb_lum.z) / 2.0;\n                rgb_lum = rgb_lum + (rgb_lum * 1.5 - gray) * 0.12;\n            } else { // HLG\n                rgb_lum = eotf_hlg(rgb);\n                rgb_lum = tonemapping_hlg(rgb_lum);\n            }\n            vec3 rgbp3 = trc_gamma(mat_xyz_to_rgbp3 * rgb_lum);\n            gl_FragColor = vec4(rgbp3, 1.0);\n        } else {\n            yuv.x = texture2D(uTextureY, vLumaPosition).x + uColorCovYOffset;\n            yuv.y = texture2D(uTextureCb, vChromaPosition).x - 0.5;\n            yuv.z = texture2D(uTextureCr, vChromaPosition).x - 0.5;\n            gl_FragColor = vec4(clamp(uColorConversion * yuv, 0.0, 1.0), 1.0);\n        }\n    }",m=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),A=new Float32Array([1.164,1.164,1.164,0,-.392,2.017,1.596,-.813,0]),g=new Float32Array([1,1,1,0,-.343,1.765,1.4,-.711,0]),y=new Float32Array([1,1,1,-.011864761000000005,-.302259224,1.801888929,1.197778023,-.6617980229999999,.008744828]),E=new Float32Array([1.164,1.164,1.164,-.013561232000000003,-.345441461,2.059156233,1.365248481,-.756825597,.010008336]),b=new Float32Array([1.164,1.164,1.164,0,-.213,2.112,1.793,-.533,0]),T=new Float32Array([1,1,1,0,-.187,1.856,1.575,-.468,0]),S=new Float32Array([1.164,1.164,1.164,0,-.187,2.141,1.678,-.6504,0]),x=new Float32Array([1,-0,0,0,1,0,0,0,1]),C=new Float32Array([0,-1,0,1,0,0,0,0,1]),L=new Float32Array([-1,0,0,0,-1,0,0,0,1]),R=new Float32Array([0,1,0,-1,0,0,0,0,1]),D="webgl-frame",w=function(){function e(e){this._gl=void 0,this._textures={},this._framebuffers={},this._program=null,this._buf=null,this._positionLocation=0,this._lumaPositionBuffer=null,this._lumaPositionLocation=0,this._chromaPositionBuffer=null,this._chromaPositionLocation=0,this._colorCovYoffset=null,this._texsizeLocation=null,this._colorCovLocation=null,this._colorTrcLocation=null,this._bitsPerPixelLocation=null,this._matrixLocation=null,this._vertexShader=null,this._fragmentShader=null,this._frameInfo={rotation:0},this._outputFBO=null,this._output=null,this._pictMode=f.b.normal,this._afterDrawCB=void 0,u.b.i(D,"constructor"),this._gl=e}e.getRotMatrix=function(e){switch(e){case 90:return C;case 180:return L;case 270:return R}return x},e._texParam=function(e,t){e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)};var t=e.prototype;return t.destroy=function(){u.b.i(D,"destroy");var e=this._gl;if(e){this._clearWebGL(),u.b.i(D,"destroy. lose ctx");var t=e.getExtension("WEBGL_lose_context");t&&t.loseContext()}this._frameInfo.buffer=void 0,this._frameInfo.colorInfo=void 0,this._afterDrawCB=void 0},t.setWebGLCtx=function(e,t){void 0===t&&(t=f.b.normal),u.b.i(D,"set webgl",e,e!==this._gl),this._pictMode=t,e!==this._gl&&(this._clearWebGL(),this._gl=e)},t.drawToFBO=function(){var t=this._gl;if(u.b.i(D,"draw to fbo",!!t),t)return this._output||(this._output=t.createTexture(),e._texParam(t,this._output),this._outputFBO=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._outputFBO),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,t.canvas.width,t.canvas.height,0,t.LUMINANCE,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._output,0)),{texture:this._output,framebuffer:this._outputFBO}},t.drawToCanvas=function(){u.b.i(D,"draw to canvas");var e=this._gl;e&&(this._outputFBO&&e.deleteFramebuffer(this._outputFBO),this._output&&e.deleteTexture(this._output),this._outputFBO=null,this._output=null)},t.afterDraw=function(e){this._afterDrawCB=e},t._createOrReuseTexture=function(e){if(this._textures[e])return this._textures[e];var t=this._gl;if(!t)return null;var i=t.createTexture();return i?(this._textures[e]=i,i):null},t._uploadTexture=function(t,i,n,r,a){var s=this._gl;if(s){var o=this._createOrReuseTexture(t);s.activeTexture(s.TEXTURE0),e._texParam(s,o),s.texImage2D(s.TEXTURE_2D,0,r>8?s.LUMINANCE_ALPHA:s.LUMINANCE,i,n,0,r>8?s.LUMINANCE_ALPHA:s.LUMINANCE,s.UNSIGNED_BYTE,a)}},t._init=function(){u.b.i(D,"init");var e=this._gl;e&&(this._program=this._initProgram(p,v),this._program&&(this._buf=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._buf),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW),this._positionLocation=e.getAttribLocation(this._program,"aPosition"),this._lumaPositionBuffer=e.createBuffer(),this._lumaPositionLocation=e.getAttribLocation(this._program,"aLumaPosition"),this._chromaPositionBuffer=e.createBuffer(),this._chromaPositionLocation=e.getAttribLocation(this._program,"aChromaPosition"),this._colorCovYoffset=e.getUniformLocation(this._program,"uColorCovYOffset"),this._colorCovLocation=e.getUniformLocation(this._program,"uColorConversion"),this._colorTrcLocation=e.getUniformLocation(this._program,"uColorTrc"),this._bitsPerPixelLocation=e.getUniformLocation(this._program,"uBitsPerPixel"),this._texsizeLocation=e.getUniformLocation(this._program,"textureSize"),this._matrixLocation=e.getUniformLocation(this._program,"uMatrix"),e.pixelStorei(e.UNPACK_ALIGNMENT,1)))},t._attachTexture=function(e,t,i){var n=this._gl;n&&this._program&&(n.activeTexture(t),n.bindTexture(n.TEXTURE_2D,this._textures[e]),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.uniform1i(n.getUniformLocation(this._program,e),i))},t._initProgram=function(e,t){var i=this._gl;if(i){u.b.i(D,"init program",i);var n=this._compileShader(i.VERTEX_SHADER,e),r=this._compileShader(i.FRAGMENT_SHADER,t);this._vertexShader=n,this._fragmentShader=r;var a=i.createProgram();if(a&&n&&r){if(i.attachShader(a,n),i.attachShader(a,r),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS)){var s=i.getProgramInfoLog(a);throw i.deleteProgram(a),new Error("GL program linking failed: "+s)}return a}}return null},t._compileShader=function(e,t){var i=this._gl;if(i){var n=i.createShader(e);if(n){if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){var r=i.getShaderInfoLog(n);throw i.deleteShader(n),new Error("GL shader compilation for "+e+" failed: "+r)}return n}}return null},t.drawFrame=function(t,i,n){void 0===n&&(n=0);var r=this._gl;if(r){var a=t.format,s=t.y.bits>8?2:1,o=!this._program||this._checkFormatUpdated(t.format);this._frameInfo.buffer=t,this._frameInfo.colorInfo=t.format.colorInfo||i,i=t.format.colorInfo||i,this._frameInfo.rotation=n,o&&this.clear(),this._program||this._init(),o&&(this._setupTexturePosition(this._lumaPositionBuffer,this._lumaPositionLocation,t.y.stride/s,t.format),this._setupTexturePosition(this._chromaPositionBuffer,this._chromaPositionLocation,t.u.stride*a.width/a.chromaWidth/s,t.format)),this._uploadTexture("uTextureY",t.y.stride/s,t.format.height,t.y.bits,t.y.bytes),this._uploadTexture("uTextureCb",t.u.stride/s,t.format.chromaHeight,t.u.bits,t.u.bytes),this._uploadTexture("uTextureCr",t.v.stride/s,t.format.chromaHeight,t.v.bits,t.v.bytes),r.useProgram(this._program),this._pictMode===f.b.normal?r.viewport((r.canvas.width-a.displayWidth)/2,(r.canvas.height-a.displayHeight)/2,a.displayWidth,a.displayHeight):r.viewport(0,0,r.canvas.width,r.canvas.height),this._attachTexture("uTextureY",r.TEXTURE0,0),this._attachTexture("uTextureCb",r.TEXTURE1,1),this._attachTexture("uTextureCr",r.TEXTURE2,2),this._output&&(r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,this._output),r.bindFramebuffer(r.FRAMEBUFFER,this._outputFBO),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.canvas.width,r.canvas.height,0,r.RGBA,r.UNSIGNED_BYTE,null));var c,u=-16/255;i?(c=i.matrixCoefficients===l.c.AVCOL_SPC_BT2020_CL||i.matrixCoefficients===l.c.AVCOL_SPC_BT2020_NCL?S:i.matrixCoefficients===l.c.AVCOL_SPC_BT709?i.colorRange===l.b.AVCOL_RANGE_MPEG?b:T:i.colourPrimaries===l.a.AVCOL_PRI_BT470BG?i.colorRange===l.b.AVCOL_RANGE_MPEG?E:y:i.colorRange===l.b.AVCOL_RANGE_MPEG?A:g,i.colorRange===l.b.AVCOL_RANGE_JPEG&&(u=0),r.uniform1i(this._colorTrcLocation,i.transferCharacteristics)):c=t.y.bits>8?S:A,r.uniform1i(this._bitsPerPixelLocation,t.y.bits),r.uniformMatrix3fv(this._matrixLocation,!1,e.getRotMatrix(n)),r.uniform1f(this._colorCovYoffset,u),r.uniformMatrix3fv(this._colorCovLocation,!1,c);var d=new Float32Array([a.width,a.height]);r.uniform2fv(this._texsizeLocation,d),r.bindBuffer(r.ARRAY_BUFFER,this._buf),r.enableVertexAttribArray(this._positionLocation),r.vertexAttribPointer(this._positionLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this._lumaPositionBuffer),r.enableVertexAttribArray(this._lumaPositionLocation),r.vertexAttribPointer(this._lumaPositionLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this._chromaPositionBuffer),r.enableVertexAttribArray(this._chromaPositionLocation),r.vertexAttribPointer(this._chromaPositionLocation,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,m.length/2),this._output&&(r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.activeTexture(r.TEXTURE0)),r.finish(),this._afterDrawCB&&this._afterDrawCB()}},t.reDraw=function(){this._frameInfo.buffer&&this.drawFrame(this._frameInfo.buffer,this._frameInfo.colorInfo,this._frameInfo.rotation)},t._setupTexturePosition=function(e,t,i,n){var r=this._gl;if(r){var a=n.cropLeft/i,s=(n.cropLeft+n.cropWidth)/i,o=(n.cropTop+n.cropHeight)/n.height,c=n.cropTop/n.height,u=new Float32Array([a,o,s,o,a,c,a,c,s,o,s,c]);r.bindBuffer(r.ARRAY_BUFFER,e),r.bufferData(r.ARRAY_BUFFER,u,r.STATIC_DRAW)}},t.clear=function(){var e=this._gl;e&&(e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT))},t._checkFormatUpdated=function(e){var t,i=null==(t=this._frameInfo.buffer)?void 0:t.format;return!(i&&e.width===i.width&&e.height===i.height&&e.chromaWidth===i.chromaWidth&&e.chromaHeight===i.chromaHeight)},t._clearWebGL=function(){var e=this;u.b.i(D,"clear WebGL");var t=this._gl;t&&(t.disableVertexAttribArray(this._positionLocation),t.disableVertexAttribArray(this._lumaPositionLocation),t.disableVertexAttribArray(this._chromaPositionLocation),this._buf&&t.deleteBuffer(this._buf),this._lumaPositionBuffer&&t.deleteBuffer(this._lumaPositionBuffer),this._chromaPositionBuffer&&t.deleteBuffer(this._chromaPositionBuffer),Object.keys(this._textures).forEach((function(t){e._gl&&e._textures[t]&&e._gl.deleteTexture(e._textures[t]),delete e._textures[t]})),Object.keys(this._framebuffers).forEach((function(t){e._gl&&e._framebuffers[t]&&e._gl.deleteFramebuffer(e._framebuffers[t]),delete e._framebuffers[t]})),this._program&&t.deleteProgram(this._program),this._vertexShader&&t.deleteShader(this._vertexShader),this._fragmentShader&&t.deleteShader(this._fragmentShader),this._program=null)},h()(e,[{key:"outputTexture",get:function(){return this._output?{texture:this._output,framebuffer:this._outputFBO}:void 0}}]),e}(),I=i(35);!function(e){e[e.OK=0]="OK",e[e.REORDER=1]="REORDER"}(n||(n={}));var O=function(){function e(){this._cache=[],this._totalSize=0,this._index=-1,this._lastDuration=1e3/24,this._maxCacheSize=52428800}var t=e.prototype;return t.init=function(e){e&&e>52428800&&(this._maxCacheSize=e)},t.reset=function(){u.b.i("yuv-cache","reset"),this._cache=[],this._totalSize=0,this._index=-1},t.next=function(){return this.getFrameByIndex(this._index+1)},t.prev=function(){return this.getFrameByIndex(this._index-1)},t.push=function(e,t){void 0===t&&(t=!1);var i=n.OK,r=e.y.bytes.byteLength+e.u.bytes.byteLength+e.v.bytes.byteLength,a=this._cache[this._cache.length-1],s=a?e.format.pts-a.pts:this._lastDuration;if(this._cache.push({pts:e.format.pts,endPTS:e.format.pts+s,size:r,yuv:e}),t&&(e.y.bytes=new Uint8Array(e.y.bytes),e.u.bytes=new Uint8Array(e.u.bytes),e.v.bytes=new Uint8Array(e.v.bytes)),a)if((s<=0||s>=1e3)&&u.b.i("yuv-cache","yuv cache pts diff: "+s+", "+a.pts+"/"+e.format.pts),s<0){this._cache.sort((function(e,t){return e.pts-t.pts}));for(var o=0;o<this._cache.length-1;o++)this._cache[o].endPTS=this._cache[o+1].pts;var c=this._cache[this._cache.length-1];this._lastDuration=c.pts-a.pts,c.endPTS=c.pts+this._lastDuration,i=n.REORDER}else a.endPTS=e.format.pts,this._lastDuration=s;return this._totalSize+=r,this._checkTotalSize(),i},t.decDropFrameInfo=function(e){u.b.i("yuv-cache","dec drop: "+e.count+" "+e.pts+" ~ "+e.endPTS);var t=this._cache[this._cache.length-1];t&&(t.endPTS=e.pts,this._lastDuration=e.pts-t.pts,(this._lastDuration<=0||this._lastDuration>=1e3)&&u.b.i("yuv-cache","yuv drop frame pts diff: "+this._lastDuration)),this._cache.push({pts:e.pts,endPTS:e.endPTS,size:0})},t.ptsToIndex=function(e){return this._cache.length&&e<=this._cache[this._cache.length-1].endPTS?I.a.searchIndex(this._cache,(function(t){return e<t.pts?-1:e>t.endPTS?1:0})):-1},t.getFrameByIndex=function(e){if(e>=0&&e<this._cache.length)return this._index=e,this._cache[e]},t.getLessPtsIdxThen=function(e){var t=this._cache[e];if(t&&e>0&&e<this._cache.length)for(var i=e-1;i>=0;i--)if(this._cache[i].pts<t.pts)return i;return-1},t.clean=function(e){if(u.b.i("yuv-cache","clean"),e>=0&&this.reset(),this._cache.length&&e<=this._cache[this._cache.length-1].endPTS){var t=Math.max(0,I.a.searchIndex(this._cache,(function(t){return e<t.pts?-1:e>t.pts?1:0})));this._cache=this._cache.slice(0,t),t<this._index&&(this._index=t)}},t.hasDropedAfterIdx=function(e){if(e>=this._cache.length)return!1;for(var t=Math.max(0,e);t<this._cache.length;t++)if(!this._cache[t].yuv)return!0;return!1},t._checkTotalSize=function(){for(;this._totalSize>=this._maxCacheSize&&this._index>0;){var e=this._cache.shift();e&&e.yuv&&(this._totalSize-=e.size),this._index--}},h()(e,[{key:"current",get:function(){return this.getFrameByIndex(this._index)}},{key:"index",get:function(){return this._index},set:function(e){e>=0&&e<this._cache.length&&(this._index=e)}},{key:"cache",get:function(){return this._cache}},{key:"remaining",get:function(){return this._cache.length-1-this._index}}]),e}(),P=function(){function e(e){this._config=void 0,this._evt=void 0,this._yuvCache=new O,this._yuv=void 0,this._decBlockPolicy=c.m.NONE,this._waitingVideoSync=!0,this._nextDraw=void 0,this._mediaInfo=void 0,this._clock=0,this._yuvBufferLenOnWaiting=3,this._output=c.o.canvas,this._endOfData=!1,this._loop=void 0,this._maxFrameBufLen=10,this._cOutput=void 0,this._evt=e}var t=e.prototype;return t.init=function(e,t,i){this._config=t,i instanceof a.a?this._cOutput=i:this._cOutput=new r.a(i),this._decBlockPolicy=this._config.videoDecBlockPolicy,this._yuvCache.init(t.videoFrameBufferSize);try{var n=Object(d.a)();this._cOutput.webgl&&n.webGL&&(this._yuv=new w(this._cOutput.webgl),this._cOutput instanceof a.a&&this._cOutput.setWebGLFrameSink(this._yuv))}catch(e){console.error(e)}this._yuv?this._startLoop():this._evt.emit(o.a.ERROR,{type:s.b.DECODER_ERROR,details:s.a.DECODER_WEBGL_ERROR,fatal:!0,reason:"render initialization error"})},t.append=function(e){var t,i=this._yuvCache.remaining;this._yuvCache.push(e)===n.REORDER&&(u.b.i("canvas-renderer","yuv cache reorder."),this._yuvCache.ptsToIndex(this._clock),this._nextDraw=this._yuvCache.current,null!=(t=this._nextDraw)&&t.yuv&&!this._waitingVideoSync&&this._draw(this._nextDraw.yuv)),this._checkWaitingReady(),i!==this._yuvCache.remaining&&this._evt.emit(o.a.RENDERER_BUF_UPDATE,{needMore:this._yuvCache.remaining<this._yuvBufferLenOnWaiting,yuvBufLen:this._yuvCache.remaining})},t._checkWaitingReady=function(){this._waitingVideoSync&&(this._yuvCache.remaining>=this._yuvBufferLenOnWaiting||this._dataEnded())&&this._onWaitingReady()},t.updateState=function(e,t,i,n,r,a){if(this._clock=e,this._output!==r&&this._yuv&&this._yuv.clear(),this._output=r,this._maxFrameBufLen=a,r!==c.o.video&&this._cOutput&&this._cOutput.updateCanvasSize(t,i)){var s=this._yuvCache.current;s&&s.yuv&&this._draw(s.yuv)}},t.updateMediaInfo=function(e){u.b.i("canvas-renderer","update media info",e),this._mediaInfo=e},t.step=function(e){if(!this._waitingVideoSync)if(e===c.j.NEXT){var t,i=this._nextDraw?this._nextDraw.pts:-1;i>=0&&null!=(t=this._nextDraw)&&t.yuv&&(this._clock=i,this._evt.emit(o.a.STEP,{type:e,time:i}))}else if(e===c.j.PREV){var n=this._nextDraw?this._yuvCache.index-1:this._yuvCache.index;if(n>0){var r=this._yuvCache.getLessPtsIdxThen(n);if(r>=0){if(n-r>1&&u.b.i("canvas-renderer","step prev skip "+(n-r-1)),this._nextDraw=this._yuvCache.getFrameByIndex(r),this._nextDraw&&this._nextDraw.yuv)return this._clock=this._nextDraw.yuv.format.pts,void this._evt.emit(o.a.STEP,{type:e,time:this._nextDraw.yuv.format.pts})}else this._yuvCache.reset()}this._evt.emit(o.a.STEP,{type:e,time:-1})}},t.seek=function(e){u.b.i("canvas-renderer","seek: "+e);var t=this._yuvCache.ptsToIndex(e);if(-1!==t){if(!this._yuvCache.hasDropedAfterIdx(t))return this._yuvCache.index=t,this._nextDraw=this._yuvCache.current,u.b.i("canvas-renderer","seek hit yuv cache"),this._clock=e,this._updateRenderer(),void this._evt.emit(o.a.RENDERER_SEEK,{hitCache:!0,time:e});u.b.i("canvas-renderer","yuv cache has dropped."),this._yuvCache.reset()}u.b.i("canvas-renderer","seek miss yuv cache"),this._evt.emit(o.a.RENDERER_SEEK,{hitCache:!1,time:e})},t.endOfData=function(){u.b.i("canvas-renderer","end of data"),this._endOfData=!0,this._checkWaitingReady()},t.decDropFrameInfo=function(e){u.b.i("canvas-renderer","dec drop frame info"),this._yuvCache.decDropFrameInfo(e)},t.reset=function(e,t){void 0===t&&(t=!1),u.b.i("canvas-renderer","reset",e),this._yuvCache.reset(),t||(this._clock=-1),this._waitingVideoSync=!0,this._nextDraw=void 0,this._endOfData=!1,this._evt.emit(o.a.RENDERER_BUF_UPDATE,{needMore:!0,yuvBufLen:0})},t.clean=function(e){void 0===e&&(e=0),this._yuvCache.clean(e),this._nextDraw=void 0,this._evt.emit(o.a.RENDERER_BUF_UPDATE,{needMore:!0,yuvBufLen:0})},t.destroy=function(){this._yuv&&this._yuv.destroy(),this._yuvCache.reset(),this._stopLoop(),!this._cOutput||this._cOutput instanceof a.a||this._cOutput.destroy(),this._cOutput=void 0},t._dataEnded=function(){return this._endOfData},t._updateRenderer=function(){var e,t;if(this._cOutput&&-1!==this._clock){var i=this._yuvCache.remaining;for(!this._nextDraw||null!=(e=this._nextDraw)&&e.yuv||u.b.i("canvas-renderer","skip empty frame"),this._nextDraw&&null!=(t=this._nextDraw)&&t.yuv||(this._nextDraw=this._yuvCache.next());this._nextDraw&&this._clock>=0;){var n=this._clock-this._nextDraw.pts,r=this._clock-this._nextDraw.endPTS;if(this._waitingVideoSync&&r>200)u.b.v("canvas-renderer","skip draw",this._clock,this._nextDraw.endPTS,r),this._nextDraw=this._yuvCache.next();else{if(this._checkWaitingReady(),this._waitingVideoSync||!(n>=-1))break;if(r<=200){u.b.v("canvas-renderer","draw",this._nextDraw.pts,n,r),this._nextDraw.yuv&&this._draw(this._nextDraw.yuv),this._nextDraw=this._yuvCache.next();break}this._decBlockPolicy===c.m.NONE?(this._nextDraw.yuv&&this._draw(this._nextDraw.yuv),this._nextDraw=this._yuvCache.next()):(u.b.v("canvas-renderer","skip b",this._nextDraw.pts,n,r),this._nextDraw=this._yuvCache.next(),this._nextDraw||this._dataEnded()||this._onWaiting())}}i!=this._yuvCache.remaining&&this._evt.emit(o.a.RENDERER_BUF_UPDATE,{needMore:this._yuvCache.remaining<this._yuvBufferLenOnWaiting,yuvBufLen:this._yuvCache.remaining})}},t._draw=function(e){var t;if(this._cOutput){var i,n=e.format,r=(null==(t=this._mediaInfo)?void 0:t.rotation)||0;this._cOutput.updateFormatSize(n.width,n.height,r),n.displayWidth=this._cOutput.displaySize.w,n.displayHeight=this._cOutput.displaySize.h,this._yuv&&this._yuv.drawFrame(e,null==(i=this._mediaInfo)?void 0:i.colorInfo,r),this._evt.emit(o.a.RENDERER_DRAW,{yuvBufLen:this._yuvCache.remaining})}},t._startLoop=function(){var e=this;this._loop||(this._loop=setInterval((function(){e._updateRenderer()}),0))},t._stopLoop=function(){this._loop&&(clearInterval(this._loop),this._loop=void 0)},t._onWaiting=function(){var e=this._maxFrameBufLen||10;u.b.i("canvas-renderer","waiting. frame buf: "+e),this._yuvBufferLenOnWaiting!==e&&(this._yuvBufferLenOnWaiting=e),this._waitingVideoSync=!0,this._evt.emit(o.a.DECODER_WAITING)},t._onWaitingReady=function(){u.b.i("canvas-renderer","waiting ready. frame buf: "+this._yuvCache.remaining+", data ended: "+this._dataEnded()),this._waitingVideoSync=!1,this._evt.emit(o.a.DEC_VIDEO_READY)},e}();t.a=P},function(e,t,i){"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global&&global,e.exports=function(){var e,t="function"==typeof atob,i="function"==typeof btoa,n="function"==typeof Buffer,r="function"==typeof TextDecoder?new TextDecoder:void 0,a="function"==typeof TextEncoder?new TextEncoder:void 0,s=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),o=(e={},s.forEach((function(t,i){return e[t]=i})),e),c=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,u=String.fromCharCode.bind(String),d="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e,t){return void 0===t&&(t=function(e){return e}),new Uint8Array(Array.prototype.slice.call(e,0).map(t))},_=function(e){return e.replace(/=/g,"").replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"}))},h=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},l=function(e){for(var t,i,n,r,a="",o=e.length%3,c=0;c<e.length;){if((i=e.charCodeAt(c++))>255||(n=e.charCodeAt(c++))>255||(r=e.charCodeAt(c++))>255)throw new TypeError("invalid character found");a+=s[(t=i<<16|n<<8|r)>>18&63]+s[t>>12&63]+s[t>>6&63]+s[63&t]}return o?a.slice(0,o-3)+"===".substring(o):a},f=i?function(e){return btoa(e)}:n?function(e){return Buffer.from(e,"binary").toString("base64")}:l,p=n?function(e){return Buffer.from(e).toString("base64")}:function(e){for(var t=[],i=0,n=e.length;i<n;i+=4096)t.push(u.apply(null,e.subarray(i,i+4096)));return f(t.join(""))},v=function(e,t){return void 0===t&&(t=!1),t?_(p(e)):p(e)},m=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?u(192|t>>>6)+u(128|63&t):u(224|t>>>12&15)+u(128|t>>>6&63)+u(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return u(240|t>>>18&7)+u(128|t>>>12&63)+u(128|t>>>6&63)+u(128|63&t)},A=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,g=function(e){return e.replace(A,m)},y=n?function(e){return Buffer.from(e,"utf8").toString("base64")}:a?function(e){return p(a.encode(e))}:function(e){return f(g(e))},E=function(e,t){return void 0===t&&(t=!1),t?_(y(e)):y(e)},b=function(e){return E(e,!0)},T=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,S=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return u(55296+(t>>>10))+u(56320+(1023&t));case 3:return u((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return u((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},x=function(e){return e.replace(T,S)},C=function(e){if(e=e.replace(/\s+/g,""),!c.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,i,n,r="",a=0;a<e.length;)t=o[e.charAt(a++)]<<18|o[e.charAt(a++)]<<12|(i=o[e.charAt(a++)])<<6|(n=o[e.charAt(a++)]),r+=64===i?u(t>>16&255):64===n?u(t>>16&255,t>>8&255):u(t>>16&255,t>>8&255,255&t);return r},L=t?function(e){return atob(h(e))}:n?function(e){return Buffer.from(e,"base64").toString("binary")}:C,R=n?function(e){return d(Buffer.from(e,"base64"))}:function(e){return d(L(e),(function(e){return e.charCodeAt(0)}))},D=function(e){return R(I(e))},w=n?function(e){return Buffer.from(e,"base64").toString("utf8")}:r?function(e){return r.decode(R(e))}:function(e){return x(L(e))},I=function(e){return h(e.replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})))},O=function(e){return w(I(e))},P=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}},k=function(){var e=function(e,t){return Object.defineProperty(String.prototype,e,P(t))};e("fromBase64",(function(){return O(this)})),e("toBase64",(function(e){return E(this,e)})),e("toBase64URI",(function(){return E(this,!0)})),e("toBase64URL",(function(){return E(this,!0)})),e("toUint8Array",(function(){return D(this)}))},N=function(){var e=function(e,t){return Object.defineProperty(Uint8Array.prototype,e,P(t))};e("toBase64",(function(e){return v(this,e)})),e("toBase64URI",(function(){return v(this,!0)})),e("toBase64URL",(function(){return v(this,!0)}))},M={version:"3.7.4",VERSION:"3.7.4",atob:L,atobPolyfill:C,btoa:f,btoaPolyfill:l,fromBase64:O,toBase64:E,encode:E,encodeURI:b,encodeURL:b,utob:g,btou:x,decode:O,isValid:function(e){if("string"!=typeof e)return!1;var t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},fromUint8Array:v,toUint8Array:D,extendString:k,extendUint8Array:N,extendBuiltins:function(){k(),N()},Base64:{}};return Object.keys(M).forEach((function(e){return M.Base64[e]=M[e]})),M}()},function(e,t,i){i.r(t);var n=i(14),r=i(1),a=i(27),s=i(11),o=i(2),c=i(41);t.default=function(e){var t,i=new n.a;[r.a.PRIV_NAL,r.a.SEI,r.a.VIDEO_CODEC_DETECTED,r.a.INIT_PTS_FOUND,r.a.PARSING_INIT_SEGMENT,r.a.PARSED_DATA,r.a.LOAD_END,r.a.ERROR,r.a.DEMUXER_DETECTED,r.a.MEDIA_DEMUX,r.a.METADATA,r.a.KEY_FRAME_INDEXS,r.a.KEY_FRAME,r.a.VIDEO_FRAME_INFO,r.a.MP4_NOT_FASTSTART].forEach((function(t){return i.on(t,(function(i){return e.postMessage({event:t,data:i})}))})),i.on(r.a.PARSING_DATA,(function(t){var i={event:r.a.PARSING_DATA,data:t},n=[];t.segments.forEach((function(e){n.push(e.payload.buffer)})),e.postMessage(i,n)})),i.on(r.a.RAW_DATA,(function(t){var i={event:r.a.RAW_DATA,data:t};if(t.type===s.c.videoFrame){var n=[];t.samples&&t.samples.forEach((function(e){e.units.forEach((function(t){e.units.length&&-1===n.indexOf(t.data.buffer)&&n.push(t.data.buffer)}))}));try{e.postMessage(i,n)}catch(t){e.postMessage(i)}}else e.postMessage(i)})),e.addEventListener("message",(function(e){var n=e.data;switch(n.cmd){case a.a.INIT:o.b.level(n.config.kwaiKernelLog),function(e,i,n,r){t=new c.a(e,i,n,r)}(i,n.typeSupported,n.config,n.vendor);break;case a.a.PUSH:t.push(n.data,n.decryptdata,n.initSegment,n.timeOffset,n.contiguous,n.trackSwitch,n.discontinuity,n.accurateTimeOffset,n.fragEnd,n.transmuxData);break;case a.a.FLUSH:t.flush();break;case a.a.LOAD_END:t.end();break;case a.a.UPDATE_CONFIG:t.updateConfig(n.config)}}))}},function(e,t){function i(t,n){return e.exports=i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,i(t,n)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){i.r(t);var n=i(14),r=i(1),a=i(13),s=i(2),o=i(43);t.default=function(e){var t=new n.a,i=new o.a(t);[r.a.STEP,r.a.RENDERER_BUF_UPDATE,r.a.DEC_VIDEO_READY,r.a.DECODER_WAITING,r.a.RENDERER_SEEK,r.a.RENDERER_DRAW,r.a.ERROR].forEach((function(i){return t.on(i,(function(t){return e.postMessage({event:i,data:t})}))})),t.on(r.a.DECODER_IMG,(function(t){e.postMessage({event:r.a.DECODER_IMG,data:t},[t.frame.y.bytes.buffer,t.frame.u.bytes.buffer,t.frame.v.bytes.buffer])})),e.addEventListener("message",(function(e){var n=e.data;switch(n.cmd){case a.a.UPDATE_STATE:i.updateState(n.streamTime,n.width,n.height,n.stoped,n.output,n.maxFrameBufLen);break;case a.a.APPEND_DATA:i.append(n.frame);break;case a.a.SEEK:i.seek(n.time);break;case a.a.STEP:i.step(n.type);break;case a.a.INIT_RENDERER:s.b.level(n.config.kwaiKernelLog),i.init(n.id,n.config,n.canvas);break;case a.a.RESET:i.reset(n.decId,n.seeking);break;case a.a.CLEAN:i.clean(n.startTime);break;case a.a.MEDIA_INFO:i.updateMediaInfo(n.mediaInfo);break;case a.a.END_OF_DATA:i.endOfData();break;case a.a.DEC_DROP_FRAME:i.decDropFrameInfo(n.data);break;case a.a.DESTROY:i&&i.destroy(),t&&t.removeAllListeners()}}))}},function(e,t,i){e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t,i){var n=Object.prototype.hasOwnProperty;function r(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function a(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var i,r,s=[];for(r in"string"!=typeof t&&(t="?"),e)if(n.call(e,r)){if((i=e[r])||null!=i&&!isNaN(i)||(i=""),r=a(r),i=a(i),null===r||null===i)continue;s.push(r+"="+i)}return s.length?t+s.join("&"):""},t.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,n={};t=i.exec(e);){var a=r(t[1]),s=r(t[2]);null===a||null===s||a in n||(n[a]=s)}return n}},function(e,t,i){i.r(t);var n=i(14),r=i(1),a=i(2),s=i(42),o=i(13);t.default=function(e){var t=new n.a,i=new s.a(t);[r.a.DEC_INIT_COMPLETE,r.a.DECODER_SEEK,r.a.DECODER_SEEK_ABORT,r.a.RENDERER_BUF_EXPIRED,r.a.DECODER_DATA_END,r.a.DECODER_BUF_LOW,r.a.DECODER_DROP_FRAME,r.a.ERROR].forEach((function(i){return t.on(i,(function(t){return e.postMessage({event:i,data:t})}))})),t.on(r.a.DECODER_IMG,(function(t){e.postMessage({event:r.a.DECODER_IMG,data:t},[t.frame.y.bytes.buffer,t.frame.u.bytes.buffer,t.frame.v.bytes.buffer])})),e.addEventListener("message",(function(e){var n=e.data;switch(n.cmd){case o.a.APPEND_DATA:i.appendData(n.data);break;case o.a.UPDATE_STATE:i.updateState(n.streamTime,n.output,n.active,n.frameBufLen,n.playbackRate,n.maxFrameBufLen);break;case o.a.INIT_265:a.b.level(n.config.kwaiKernelLog),i.init(n.id,n.lib,n.config,n.simd,n.threads,n.codecType,n.decoderType);break;case o.a.MEDIA_INFO:i.updateMediaInfo(n.mediaInfo);break;case o.a.DESTROY:i&&i.destroy(),t&&t.removeAllListeners();break;case o.a.RESET:i.reset(n.decId,n.seeking);break;case o.a.CLEAN:i.clean(n.startTime);break;case o.a.SEEK:i.seek(n.time);break;case o.a.END_OF_DATA:i.endOfData();break;case o.a.EXPIRED_DATA_SYNC:i.expiredDataSync()}}))}},function(e,t,i){i.r(t),i.d(t,"default",(function(){return cr})),i.d(t,"createKernel",(function(){return ur})),i.d(t,"DownloadStatus",(function(){return Ge})),i.d(t,"LOG_LEVEL",(function(){return A.a})),i.d(t,"KEvents",(function(){return v.a})),i.d(t,"REPORT_TYPES",(function(){return yn})),i.d(t,"CodecType",(function(){return L.b})),i.d(t,"Decoder",(function(){return L.c})),i.d(t,"DemuxerType",(function(){return ai.b})),i.d(t,"HttpRangeType",(function(){return L.d})),i.d(t,"MediaBox",(function(){return L.g})),i.d(t,"VideoDecBlockPolicy",(function(){return L.m})),i.d(t,"VideoDropFramePolicy",(function(){return L.n})),i.d(t,"VideoRendererType",(function(){return L.o})),i.d(t,"WasmDecoder",(function(){return L.p})),i.d(t,"StereoType",(function(){return L.k}));var n=i(8),r=i.n(n),a=i(5),s=i.n(a),o=i(38),c=i(12),u=i.n(c),d=i(6),_=[16,24,32],h=function(){function e(){this._waitingRec=[],this._frameBufLenIdx=0}return e.prototype.onWaiting=function(){this._waitingRec.push(performance.now()),this._waitingRec.length>3&&this._waitingRec.shift(),this._frameBufLenIdx>=_.length-1||this._waitingRec.length>=3&&this._waitingRec[this._waitingRec.length-1]-this._waitingRec[0]<15e3&&this._frameBufLenIdx++},s()(e,[{key:"maxFrameBufLen",get:function(){return _[this._frameBufLenIdx]||_[_.length-1]}}]),e}(),l=i(30),f=i.n(l),p=i(3),v=i(1),m=i(13),A=i(2),g=i(43),y="canvas-renderer-wrapper",E=function(){function e(e,t){var i=this;this._ctx=void 0,this._evt=void 0,this._renderer=void 0,this._rendererW=void 0,this._id=0,this._frameBufLen=0,this._cOutput=void 0,this._onWorkMessage=function(e){var t=e.data;i._onMessage(e.data.event,t.data)},this._onMessage=function(e,t){switch(e){case v.a.RENDERER_DRAW:case v.a.RENDERER_BUF_UPDATE:i._frameBufLen=t.yuvBufLen}i._rendererW&&i._evt.emit(e,t)},this._evt=e,this._ctx=t,this._cOutput=t.cOutput}var t=e.prototype;return t.init=function(e){if(e&&(this._rendererW=f()(47)),this._rendererW?this._rendererW.addEventListener("message",this._onWorkMessage):this._renderer=new g.a(this._evt),A.b.i(y,"init renderer"),this._cOutput.canvas instanceof HTMLCanvasElement){var t=this._ctx.getDecConfig();if(this._rendererW){var i=this._cOutput.canvas.transferControlToOffscreen();this._rendererW.postMessage({cmd:m.a.INIT_RENDERER,id:this._id,config:t,canvas:i},[i])}else this._renderer&&this._renderer.init(this._id,t,this._cOutput)}else this._evt.emit(v.a.ERROR,{type:p.b.RENDERER_ERROR,details:p.a.DECODER_UNSUPPORTED,fatal:!0,reason:"init error worker:"+!!this._rendererW+" canvas:"+!!this._cOutput.canvas+" decoder:"+!!this._renderer})},t.destroy=function(){A.b.i(y,"destroy"),this._rendererW?(this._rendererW.postMessage({cmd:m.a.DESTROY}),this._rendererW.removeEventListener("message",this._onWorkMessage),this._rendererW.terminate()):this._renderer&&(this._renderer.destroy(),this._renderer=void 0)},t.step=function(e){A.b.i(y,"step: "+e),this._rendererW?this._rendererW.postMessage({cmd:m.a.STEP,type:e}):this._renderer&&this._renderer.step(e)},t.updateMediaInfo=function(e){(this._rendererW||this._renderer)&&(this._rendererW?this._rendererW.postMessage({cmd:m.a.MEDIA_INFO,mediaInfo:e}):this._renderer&&this._renderer.updateMediaInfo(e))},t.seek=function(e){A.b.i(y,"seek: "+e),this._rendererW?this._rendererW.postMessage({cmd:m.a.SEEK,time:e}):this._renderer&&this._renderer.seek(e)},t.reset=function(e){void 0===e&&(e=!1),this._frameBufLen=0,this._rendererW?this._rendererW.postMessage({cmd:m.a.RESET,decId:this._id,seeking:e}):this._renderer&&this._renderer.reset(this._id,e)},t.flush=function(e){this._rendererW?this._rendererW.postMessage({cmd:m.a.CLEAN,startTime:e}):this._renderer&&this._renderer.clean(e)},t.append=function(e){this._rendererW?this._rendererW.postMessage({cmd:m.a.APPEND_DATA,frame:e},[e.y.bytes.buffer,e.u.bytes.buffer,e.v.bytes.buffer]):this._renderer&&this._renderer.append(e)},t.update=function(e,t,i,n,r,a){this._rendererW?this._rendererW.postMessage({cmd:m.a.UPDATE_STATE,streamTime:e,width:t,height:i,stoped:n,output:r,maxFrameBufLen:a}):this._renderer&&this._renderer.updateState(e,t,i,n,r,a)},t.endOfData=function(){this._rendererW?this._rendererW.postMessage({cmd:m.a.END_OF_DATA}):this._renderer&&this._renderer.endOfData()},t.dropFrame=function(e){this._rendererW?this._rendererW.postMessage({cmd:m.a.DEC_DROP_FRAME,data:e}):this._renderer&&this._renderer.decDropFrameInfo(e)},s()(e,[{key:"isUseingWorker",get:function(){return!!this._rendererW}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"frameBufLen",get:function(){return this._frameBufLen}}]),e}(),b=i(14),T=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._evt=void 0,i._mediaInfo=[],i._active=!1,i._waiting=!0,i._seeking=!1,i._ready=!1,i._pausedOnWaiting=void 0,i._size={w:0,h:0},i._r=void 0,i._bufRules=new h,i._loop=function(){i._active&&i._ctx.cOutput.canvas&&(i._updateState(),requestAnimationFrame(i._loop))},i._ctx=t,i._evt=new b.a,i._r=new E(i._evt,t),i}u()(t,e);var i=t.prototype;return i.destroy=function(){this._mediaInfo=[],this.stop(),this._r.destroy(),this._evt.removeAllListeners(),this.removeAllListeners()},i.setMediaInfo=function(e){A.b.i("canvas-provider","setMediaInfo"),this._mediaInfo.push(e)},i.start=function(){this._active||(A.b.i("canvas-provider","start loop"),this._active=!0,requestAnimationFrame(this._loop))},i.stop=function(){A.b.i("canvas-provider","stop loop"),this._active=!1},i.step=function(e){this._r.step(e)},i._updateState=function(){},i._checkResize=function(e){var t=!1,i=("undefined"==typeof window?1:window.devicePixelRatio)||1,n=e.clientWidth*i,r=e.clientHeight*i;return this._size.w===n&&this._size.h===r||(this._size.w=n,this._size.h=r,t=!0),t},s()(t,[{key:"canvas",get:function(){return this._ctx.cOutput.canvas}},{key:"waiting",get:function(){return this._waiting}},{key:"pausedOnWaiting",get:function(){return this._pausedOnWaiting},set:function(e){this._pausedOnWaiting=e}}]),t}(b.a),S=i(44),x=i(25),C=i.n(x),L=i(0),R=i(10);function D(e,t,i){if(void 0===e[t=t.toLocaleLowerCase()])e[t]=i;else{var n=e[t];Array.isArray(n)?n.push(i):"string"==typeof n&&(e[t]=[n,i])}}function w(e){var t={};return"string"==typeof e?e.trim().split(/[\r\n]+/).forEach((function(e){var i=e.split(": "),n=i.shift(),r=i.join(":");n&&D(t,n,r)})):e&&e.forEach((function(e,i){e.split(",").forEach((function(e){D(t,i,e)}))})),t}function I(e){var t=[];if(e)for(var i in t=[],e)if("kwaisign"===i||0===i.indexOf("x-ks-")){var n=e[i];n&&t.push(i+": "+(Array.isArray(n)?n.join(","):n).slice(0,255))}if(t.length)return t.slice(0,10),t}var O,P=function(){function e(){this.tag="fetch",this._context=void 0,this._callbacks=null,this._controller=null,this._reader=null,this._abort=!1}e.isSupported=function(){return"undefined"!=typeof fetch&&"undefined"!=typeof ReadableStream};var t=e.prototype;return t.load=function(e,t){var i=this;this._context=e,this._callbacks=t;var n=new Headers;e.headers&&e.headers.forEach((function(e){n.append(e.header,e.value)})),e.range&&n.append("Range",e.range);var r={method:e.requestMethod?e.requestMethod:"GET",headers:n,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:this._getAbortSignal()};e.requestBody&&(r.body=e.requestBody),e.credentials&&(r.credentials="include"),fetch(e.url,r).then((function(t){if(e.responseUrl=t.url,e.responseHeader=w(t.headers),i._callbacks&&i._callbacks.onConnect&&i._callbacks.onConnect(e,t.status),t.ok)return i._abort?void(t.body&&t.body.getReader().cancel()):"arraybuffer"===e.responseType?e.progress?void(t.body&&(i._reader=t.body.getReader(),i._pump(i._reader))):void t.arrayBuffer().then((function(t){i._onEnd(e,t)})):void t.text().then((function(t){i._onEnd(e,t)}));var n=new Error(t.status+" "+t.statusText);i._onError(n)})).catch((function(e){"AbortError"!==e.name&&i._onError(e)}))},t.abort=function(){this._controller?this._controller.abort():this._reader&&(this._reader.cancel(),this._reader=null),this._abort=!0},t.destroy=function(){this._callbacks=null,this.abort()},t._onProgress=function(e,t){this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t)},t._onEnd=function(e,t){this._callbacks&&this._callbacks.onEnd&&(this._reader=null,this._controller=null,this._callbacks.onEnd(e,t))},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},t._pump=function(e){var t=this;e.read().then((function(i){if(t._abort)return e.cancel(),null;if(i.done)return t._onEnd(t._context,null),null;var n=i.value.buffer;return t._onProgress(t._context,n),t._pump(e)})).catch((function(e){"AbortError"!==e.name&&t._onError(e)}))},t._getAbortSignal=function(){try{if(AbortController)return this._controller=new AbortController,this._controller.signal}catch(e){return null}return null},e}();!function(e){e.MOZ_CHUNK="moz-chunked-arraybuffer",e.UNKNOW="unknow",e.UNSUPPORT=""}(O||(O={}));var k,N=function(){function e(){var e=this;this.tag="xhr",this._xhr=null,this._context=void 0,this._callbacks=null,this._progress=O.UNKNOW,this._onReadyStateChange=function(t){if(e._xhr){var i=e._xhr;2===i.readyState&&(e._context.responseUrl=i.responseURL,e._context.responseHeader=w(i.getAllResponseHeaders()),e._callbacks&&e._callbacks.onConnect&&e._callbacks.onConnect(e._context,i.status),(i.status<200||i.status>299)&&e._onError(new Error("xhr error")))}},this._onProgress=function(t){if(e._xhr){var i=e._xhr.response;e._callbacks&&e._callbacks.onProgress&&i&&e._callbacks.onProgress(e._context,i)}},this._onLoadEnd=function(t){var i=null,n=e._xhr;!e._progress&&n&&(i=n.response),e._callbacks&&e._callbacks.onEnd(e._context,i)},this._onError=function(t){var i;e._callbacks&&e._callbacks.onError&&e._callbacks.onError(t),null==(i=e._xhr)||i.abort()},this._xhr=null}e.isSupportChunk=function(){if(e.supportChunk!==O.UNKNOW)return e.supportChunk;try{var t=new XMLHttpRequest;if(t.open("GET","https://example.com",!0),t.responseType=O.MOZ_CHUNK,t.responseType===O.MOZ_CHUNK)return e.supportChunk=O.MOZ_CHUNK,e.supportChunk}catch(t){e.supportChunk=O.UNSUPPORT}return O.UNSUPPORT};var t=e.prototype;return t.load=function(t,i){this._callbacks=i,this._context=t,this._progress=O.UNSUPPORT,t.progress&&"arraybuffer"===t.responseType&&(this._progress=e.isSupportChunk());var n=this._xhr=new XMLHttpRequest;n.open(t.requestMethod?t.requestMethod:"GET",this._context.url,!0),this._progress===O.MOZ_CHUNK?(n.responseType=O.MOZ_CHUNK,n.onprogress=this._onProgress,n.onload=this._onLoadEnd):(n.responseType=t.responseType||"arraybuffer",n.onload=this._onLoadEnd),n.onreadystatechange=this._onReadyStateChange,n.onerror=this._onError,n.withCredentials=!!t.credentials,t.range&&n.setRequestHeader("Range",t.range),t.headers&&t.headers.forEach((function(e){n.setRequestHeader(e.header,e.value)})),n.send(t.requestBody)},t.abort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.destroy=function(){this._callbacks=null,this.abort()},e}();N.supportChunk=O.UNKNOW;var M=0,B=function(){var e=t.prototype;function t(){var e=this;this._context=void 0,this._loader=void 0,this._callbacks=null,this._config=void 0,this._loaderCallback=void 0,this._stats=void 0,this._retryDelay=0,this._loading=!1,this._aborted=!1,this._requestTimeout=void 0,this._transTimer=void 0,this._retryTimeout=void 0,this._rangeStart=void 0,this._progressTime=0,this._loadInternal=function(){e._loading=!0,e._aborted=!1;var t=e._stats;t.code=0,t.tfirst=0,t.loaded=0,e._retryTimeout&&(clearTimeout(e._retryTimeout),e._retryTimeout=null),e._loader=new(e._getInternalLoader(e._context,e._config)),e._loader&&(t.id=e._loader.tag+"-"+M,e._config.connectionTimeout&&(e._requestTimeout=setTimeout(e._onTimeout,e._config.connectionTimeout)),e._httpRange(e._context),t.tsload=Date.now(),t.tstart=performance.now(),e._loader.load(e._context,e._loaderCallback))},this._onConnect=function(t,i){var n=e._stats;e._getContentLen(t,n),e._requestTimeout&&(clearTimeout(e._requestTimeout),e._requestTimeout=null),e._startTransmissionTimer(),n.code=i,n.tfirst=Math.max(n.trequest,performance.now()),e._callbacks&&e._callbacks.onConnect&&e._callbacks.onConnect(t,n)},this._onProgress=function(t,i){var n=e._stats;if(e._progressTime=performance.now(),!t.breakpointContinuation&&n.output>n.loaded){if(n.loaded+i.byteLength-n.output>0){var r=i.slice(n.output-n.loaded);e._callProgress(e._context,r,n)}n.loaded+=i.byteLength}else n.loaded+=i.byteLength,e._callProgress(e._context,i,n)},this._onError=function(t){A.b.i("loader",null==t?void 0:t.message),e._stopTimer(),e._destroyLoader();var i,n=e._stats,r=e._config;e._loading=!1,e._context.breakpointContinuation&&416===n.code?null!=(i=e._callbacks)&&i.onEnd&&e._callbacks.onEnd(e._context,null,n):(n.fatal=!r.maxRetry||n.retry>=r.maxRetry||!r.maxRetry,n.text=t.message||"load error",e._callbacks&&e._callbacks.onError&&e._callbacks.onError(e._context,n),n.fatal||(r.breakpointContinuation&&(A.b.i("loader","breakpointContinuation"),e._stats.output&&e._stats.loaded>0?(e._rangeStart?e._context.rangeStart=e._rangeStart+e._stats.output:e._context.rangeStart=e._stats.output,e._context.breakpointContinuation=!0):(e._context.rangeStart=e._rangeStart,e._context.breakpointContinuation=!1)),n.retry++,e._callbacks&&(e._retryDelay?(e._retryTimeout=setTimeout(e._loadInternal,e._retryDelay),e._retryDelay=2*e._retryDelay):e._loadInternal())))},this._onTimeout=function(){e._loading=!1,e._abortInternal();var t=new Error("timeout");e._onError(t)},M++,this._loader=null,this._config={useFetch:!1,connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0},this._loaderCallback={onConnect:this._onConnect,onProgress:this._onProgress,onEnd:this._onEnd.bind(this),onError:this._onError}}return e._getInternalLoader=function(e,t){if(!e.progress)return N;if(void 0!==k)return k;if(k=null,R.a.msie||R.a.msedge){if(t.useFetch)return P.isSupported()&&(k=P),k;N.isSupportChunk()?k=N:P.isSupported()&&(k=P)}else P.isSupported()?k=P:N.isSupportChunk()&&(k=N);return k},e.load=function(e,t,i){this._init(e,t,i),this._loadInternal()},e.destroy=function(){this._stopTimer(),this._abortInternal(!1),this._destroyLoader(),this._callbacks=null},e.abort=function(){this._stopTimer(),this._abortInternal()},e._init=function(e,t,i){this._context=e,this._rangeStart=e.rangeStart,this._callbacks=t,this._config=i||this._config,this._stats={id:"",trequest:performance.now(),retry:0,loaded:0,code:0,output:0,tfirst:0,tload:0,total:0,tsload:0,tstart:0,fatal:!1,text:""},this._config.retryDelay&&(this._retryDelay=this._config.retryDelay)},e._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=null)},e._abortInternal=function(e){void 0===e&&(e=!0),e&&this._callbacks&&this._callbacks.onAbort&&!this._aborted&&this._loading&&this._callbacks.onAbort(this._context,this._stats),this._aborted=!0,this._loader&&this._loader.abort()},e._stopTimer=function(){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._stopTransmissionTimer()},e._callProgress=function(e,t,i){this._stats.output+=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t,i)},e._onEnd=function(e,t){this._stopTimer();var i=this._stats;this._getContentLen(e,i),i.total=t?i.loaded="string"==typeof t?t.length||0:t.byteLength||0:i.loaded,i.tload=Math.max(i.tfirst,performance.now()),this._loading=!1,i.output=0,this._callbacks&&this._callbacks.onEnd(e,t,i)},e._startTransmissionTimer=function(){var e=this;this._stopTransmissionTimer(),this._progressTime=performance.now();var t=this._config.transmissionTimeout||0;t&&(this._transTimer=setInterval((function(){performance.now()-e._progressTime>t&&e._onTimeout()}),1e3))},e._stopTransmissionTimer=function(){this._transTimer&&(clearInterval(this._transTimer),this._transTimer=null)},e._httpRange=function(e){if(e.rangeEnd||e.rangeStart)if(e.rangeType&&e.rangeType!==L.d.STANDARD&&"string"==typeof e.url){var t=new C.a(e.url,!0);e.rangeEnd?(t.query.start=(e.rangeStart||0).toString(),t.query.end=(e.rangeEnd-1).toString()):e.rangeStart&&(t.query.start=e.rangeStart.toString()),e.url=t.toString()}else e.rangeEnd?e.range="bytes="+(e.rangeStart||0)+"-"+(e.rangeEnd-1):e.rangeStart&&(e.range="bytes="+e.rangeStart+"-")},e._getContentLen=function(e,t){if(!t.contentTotalLength||!t.contentLength){var i=e.responseHeader;if(i){if(e.range||"number"==typeof e.rangeStart){var n=i["content-range"];n&&(t.contentTotalLength=parseInt((Array.isArray(n)?n[0]:n).split("/")[1])||0)}var r=i["content-length"];r&&(t.contentLength=parseInt(Array.isArray(r)?r[0]:r)||0)}}},s()(t,[{key:"context",get:function(){return this._context}},{key:"config",get:function(){return this._config}}]),t}(),V=function(){function e(){this.timeout=6048e5}var t=e.prototype;return t.write=function(t,i){if(e.available)try{localStorage.setItem(t,JSON.stringify({value:i,time:Date.now()}))}catch(e){}},t.read=function(t,i){if(void 0===i&&(i=!0),e.available)try{var n=localStorage.getItem(t);if(n){var r=JSON.parse(n),a=r.value,s=r.time,o=void 0===s?0:s;if(!i)return a;if(Date.now()-o<("number"==typeof i?i:this.timeout))return a}}catch(e){}},s()(e,null,[{key:"available",get:function(){if(void 0===e._available)try{localStorage.setItem("alg","test"),e._available=!0}catch(t){e._available=!1}return e._available}}]),e}();V._available=void 0;var F=V,U="https://s2-10895.kwimgs.com/kos/nlav10895/",H={key:"kwai-dec265-lib",lib:U+"265/kwai-dec265-10.wasm",libS:U+"265/kwai-dec265-simd-10.wasm",libT:U+"265/kwai-dec265-threads-10.wasm",libST:U+"265/kwai-dec265-simd-threads-10.wasm",js:U+"265/kwai-dec265-10.js",jsT:U+"265/kwai-dec265-threads-10.js",jsST:U+"265/kwai-dec265-simd-threads-10.js",jsW:U+"265/kwai-dec265-threads-10.worker.js"},j={key:"kwai-deckvc-lib",lib:U+"kvc/kvc-decoder-1.wasm",libS:U+"kvc/kvc-decoder-simd-1.wasm",libT:U+"kvc/kvc-decoder-threads-2.wasm",libST:U+"kvc/kvc-decoder-simd-threads-2.wasm",js:U+"kvc/kvc-decoder-1.js",jsT:U+"kvc/kvc-decoder-threads-2.js",jsST:U+"kvc/kvc-decoder-simd-threads-2.js",jsW:U+"kvc/kvc-decoder-threads-2.worker.js"},z={key:"kwai-deckvc30-lib",lib:U+"kvc30/libkvc30dec-1.wasm",libS:U+"kvc30/libkvc30dec-simd-1.wasm",libT:U+"kvc30/libkvc30dec-threads-1.wasm",libST:U+"kvc30/libkvc30dec-simd-threads-1.wasm",js:U+"kvc30/libkvc30dec-1.js",jsT:U+"kvc30/libkvc30dec-threads-1.js",jsST:U+"kvc30/libkvc30dec-simd-threads-1.js",jsW:U+"kvc30/libkvc30dec-threads-1.worker.js"},G={key:"kwai-deckvc4-lib",lib:U+"kvc4/kvc-decoder-1.wasm",libS:U+"kvc4/kvc-decoder-simd-1.wasm",libT:U+"kvc4/kvc-decoder-threads-1.wasm",libST:U+"kvc4/kvc-decoder-simd-threads-1.wasm",js:U+"kvc4/kvc-decoder-1.js",jsT:U+"kvc4/kvc-decoder-threads-1.js",jsST:U+"kvc4/kvc-decoder-simd-threads-1.js",jsW:U+"kvc4/kvc-decoder-threads-1.worker.js"},W={key:"kwai-deckvc6-lib",lib:U+"kvc6/kvc-decoder.wasm",libS:U+"kvc6/kvc-decoder-simd.wasm",libT:U+"kvc6/kvc-decoder-threads.wasm",libST:U+"kvc6/kvc-decoder-simd-threads.wasm",js:U+"kvc6/kvc-decoder.js",jsT:U+"kvc6/kvc-decoder-threads.js",jsST:U+"kvc6/kvc-decoder-simd-threads.js",jsW:U+"kvc6/kvc-decoder-threads.worker.js"},K={key:"kwai-kw265-lib",lib:U+"ks265/libks265dec-3.wasm",libS:U+"ks265/libks265dec-simd-3.wasm",libT:U+"ks265/libks265dec-threads-3.wasm",libST:U+"ks265/libks265dec-simd-threads-3.wasm",js:U+"ks265/libks265dec-3.js",jsT:U+"ks265/libks265dec-threads-3.js",jsST:U+"ks265/libks265dec-simd-threads-3.js",jsW:U+"ks265/libks265dec-threads-3.worker.js"},Q=function(e){function t(t){var i;return(i=e.call(this)||this)._ls=new F,i._decoderType=L.p.kw265,i._config=void 0,i._wasmLoader=void 0,i._jsLoader=void 0,i._jswLoader=void 0,i._loadStartTime=0,i._onLoaderError=function(e,t){i._destroyLoader(),i.emit(v.a.ERROR,{type:p.b.NETWORK_ERROR,details:p.a.DEC_LIB_LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url})},i._config=t,i}u()(t,e);var i=t.prototype;return i.load=function(e,t,i,n){A.b.i("dec-lib-loader","load: "+t),this._loadStartTime=performance.now(),this._decoderType=t;var r=this._decLibURL,a=r.js,s="",o=r.lib;n&&r.jsW&&(i&&r.libST&&r.jsST?(o=r.libST,a=r.jsST,s=r.jsW):r.libT&&r.jsT?(o=r.libT,a=r.jsT,s=r.jsW):n=!1),i&&!n&&r.libS&&(o=r.libS);var c={js:{url:a,data:""},wasm:{url:o}};if(s&&(c.jsw={url:s,data:""}),!e&&F.available){var u=this._ls.read(this._decLibURL.key,!1);u&&(u.js&&u.js.url===c.js.url&&(c.js.data=u.js.data),c.jsw&&u.jsw&&u.jsw.url===c.jsw.url&&(c.jsw.data=u.jsw.data),u.wasm&&u.wasm.url===c.wasm.url&&(c.wasm.data=S.Base64.toUint8Array(u.wasm.data)))}this._checkEnd(c,!0)||(c.js.data||this._loadJs(c),c.wasm.data||this._loadWasm(c),c.jsw&&!c.jsw.data&&this._loadJsw(c))},i.destroy=function(){this.removeAllListeners(),this._destroyLoader()},i._destroyLoader=function(){this._destroyWasmLoader(),this._destroyJsLoader(),this._destroyJswLoader()},i._checkEnd=function(e,t){void 0===t&&(t=!1);var i=!!(e.js.data&&e.wasm.data&&(!e.jsw||e.jsw&&e.jsw.data));if(!t&&i&&e.wasm.data){var n={js:r()({},e.js),wasm:{url:e.wasm.url,data:S.Base64.fromUint8Array(e.wasm.data)}};e.jsw&&(n.jsw=r()({},e.jsw)),this._ls.write(this._decLibURL.key,n)}if(i){A.b.i("dec-lib-loader","dec lib loaded",t);var a={lib:e,hitCache:t,duration:performance.now()-this._loadStartTime};this.emit(v.a.DEC_LIB_LOADED,a)}return i},i._loadWasm=function(e){var t=this;this._destroyWasmLoader();var i=this._wasmLoader=new B,n={onError:this._onLoaderError,onEnd:function(i,n){n instanceof ArrayBuffer&&(e.wasm.data=new Uint8Array(n),t._checkEnd(e))}},r={useFetch:!1,connectionTimeout:this._config.decLibConnectionTimeout,maxRetry:this._config.decLibLoadingMaxRetry},a={url:e.wasm.url,responseType:"arraybuffer",progress:!1};i.load(a,n,r)},i._loadJs=function(e){var t=this;this._destroyJsLoader();var i=this._jsLoader=new B,n={onError:this._onLoaderError,onEnd:function(i,n){"string"==typeof n&&(e.js.data=n,t._checkEnd(e))}},r={useFetch:!1,connectionTimeout:this._config.decLibConnectionTimeout,maxRetry:this._config.decLibLoadingMaxRetry},a={url:e.js.url,responseType:"text",progress:!1};i.load(a,n,r)},i._loadJsw=function(e){var t=this;if(this._destroyJswLoader(),e.jsw){var i=this._jsLoader=new B,n={onError:this._onLoaderError,onEnd:function(i,n){"string"==typeof n&&(e.jsw&&(e.jsw.data=n),t._checkEnd(e))}},r={useFetch:!1,connectionTimeout:this._config.decLibConnectionTimeout,maxRetry:this._config.decLibLoadingMaxRetry},a={url:e.jsw.url,responseType:"text",progress:!1};i.load(a,n,r)}},i._destroyWasmLoader=function(){this._wasmLoader&&this._wasmLoader.destroy()},i._destroyJsLoader=function(){this._jsLoader&&this._jsLoader.destroy()},i._destroyJswLoader=function(){this._jswLoader&&this._jswLoader.destroy()},s()(t,[{key:"_decLibURL",get:function(){return this._decoderType===L.p.kvc3?j:this._decoderType===L.p.kvc4?G:this._decoderType===L.p.kvc5||this._decoderType===L.p.kvc6?W:this._decoderType===L.p.kvc30?z:this._decoderType===L.p.h265?H:K}}]),t}(b.a);function Y(){return"undefined"==typeof navigator?0:navigator.hardwareConcurrency||0}function X(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function q(){var e,t;if("undefined"!=typeof window)return(null==(e=window)?void 0:e.SourceBuffer)||(null==(t=window)?void 0:t.WebKitSourceBuffer)}var Z,J,$=i(24);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready",e.FAIRPLAY="com.apple.fairplay"}(Z||(Z={})),function(e){e.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(J||(J={}));var ee="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):void 0,te=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._drmSystemOptions={audioRobustness:"SW_SECURE_CRYPTO",videoRobustness:"SW_SECURE_DECODE"},i._mediaKeysList=[],i._hasSetMediaKeys=!1,i._loader=void 0,i._loaderConfig=void 0,i._mediaKeysPromise=void 0,i._licenseServerUrl="",i._videoCodecs=[],i._onMediaEncrypted=function(e){if(A.b.i("eme",'Media is encrypted using "'+e.initDataType+'" init data type'),!i._mediaKeysPromise&&i._videoCodecs.length&&"cenc"===e.initDataType&&e.initData&&(i._licenseServerUrl=i._licenseServerUrl||i._ctx.config.widevineLicenseUrl,i._attemptKeySystemAccess(Z.WIDEVINE,i._videoCodecs)),!i._mediaKeysPromise)return A.b.e("eme","Fatal: Media is encrypted but no CDM access or no keys have been requested"),void i._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_NO_KEYS,fatal:!0,reason:"media is encrypted but no CDM access or no keys have been requested"});var t=function(t){i._ctx.video&&(i._attemptSetMediaKeys(t),i._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};i._mediaKeysPromise.then(t).catch(t)},i._onKeySessionMessage=function(e){var t=e.target;i._requestLicense(e.message,t)},i._onLoaderError=function(e,t){t.fatal&&i._onError({type:p.b.NETWORK_ERROR,details:p.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,reason:t.text,statusCode:t.code})},i.isBrowserSupported=function(){return"chrome"===R.a.name&&R.a.version.major>=68||R.a.firefox},i._onError=function(e){i.emit(v.a.ERROR,e)},i._ctx=t,t.video&&t.video.addEventListener("encrypted",i._onMediaEncrypted),i._loaderConfig={useFetch:!1,maxRetry:t.config.keyLoadingMaxRetry,connectionTimeout:t.config.keyConnectionTimeout,transmissionTimeout:t.config.keyTransmissionTimeout,retryDelay:t.config.keyLoadingRetryDelay},i}u()(t,e),t.getSupportedMediaKeySystemConfigurations=function(e,t,i){var n={audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.5"',robustness:i.audioRobustness||""},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:i.audioRobustness||""}],videoCapabilities:[]};return t.forEach((function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:i.videoRobustness||""})})),[n]};var i=t.prototype;return i.onManifestParsed=function(e,t){var i=this;if(void 0===t&&(t=!1),this._videoCodecs=e.map((function(e){return e.videoCodec})),t)if(e.reduce((function(e,t){return e&&(t.drmSchemaId===J.WIDEVINE||!t.drmSchemaId)}),!0)&&ee&&this.isBrowserSupported()){this._licenseServerUrl=e.reduce((function(e,t){return e||t.drmToken||""}),"");var n=Z.WIDEVINE;A.b.i("eme","on manifest parsed",n,this._videoCodecs),this._attemptKeySystemAccess(Z.WIDEVINE,this._videoCodecs)}else setTimeout((function(){return i._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_UNSUPPORTED,fatal:!0,reason:"DRM unsupported."})}),0)},i.reset=function(){var e,t=this;return A.b.i("eme","reset"),this._mediaKeysList.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.removeEventListener("message",t._onKeySessionMessage),e.mediaKeysSession.close().catch((function(){}))})),this._mediaKeysList=[],this._hasSetMediaKeys=!1,null==(e=this._ctx.video)?void 0:e.setMediaKeys(null)},i.destory=function(){var e=this,t=this._ctx.video;t&&t.removeEventListener("encrypted",this._onMediaEncrypted);var i=this._mediaKeysList;i.length&&Promise.all(i.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.removeEventListener("message",e._onKeySessionMessage),t.mediaKeysSession.close().catch((function(){}))}))).then((function(){if(t)return t.setMediaKeys(null)})).catch((function(){})),this.removeAllListeners()},i._attemptSetMediaKeys=function(e){if(!this._ctx.video)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return A.b.e("eme","Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_NO_KEYS,fatal:!0,reason:"media is encrypted but no CDM access or no keys have been obtained yet"});A.b.i("eme","Setting keys for encrypted media"),this._ctx.video.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(e,t){var i=this,n=this._mediaKeysList[0];if(!n)return A.b.e("eme","Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_NO_ACCESS,fatal:!0,reason:"media is encrypted but not any key-system access has been obtained yet"});if(n.mediaKeysSessionInitialized)A.b.i("eme","Key-Session already initialized but requested again");else{var r=n.mediaKeysSession;if(!r)return A.b.e("eme","Fatal: Media is encrypted but no key-session existing"),void this._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_NO_SESSION,fatal:!0,reason:"media is encrypted but no key-session existing"});if(!t)return A.b.i("eme","Fatal: initData required for generating a key session is null"),void this._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0,reason:"initData required for generating a key session is null"});A.b.i("eme",'Generating key-session request for "'+e+'" init data type'),n.mediaKeysSessionInitialized=!0,r.generateRequest(e,t).then((function(){A.b.d("eme","Key-session generation succeeded")})).catch((function(e){A.b.e("eme","Error generating key-session request:",e),i._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_NO_SESSION,fatal:!1,reason:"error generating key-session request:"+e})}))}},i._attemptKeySystemAccess=function(e,i){var n=this,r=t.getSupportedMediaKeySystemConfigurations(e,i,this._drmSystemOptions);if(A.b.i("eme","Requesting encrypted media key-system access"),ee){var a=ee(e,r);this._mediaKeysPromise=a.then((function(t){var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};n._mediaKeysList.push(i);var r=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(e){return i.mediaKeys=e,n._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession()).addEventListener("message",n._onKeySessionMessage,!1)})),e}));return r.catch((function(e){A.b.e("eme","Failed to create media-keys:",e)})),r})),a.catch((function(t){A.b.e("eme",'Failed to obtain key-system "'+e+'" access:',t)}))}else A.b.i("eme","no requestMediaKeySystemAccess")},i._getLicenseServerUrl=function(e){switch(e){case Z.WIDEVINE:if(!this._ctx.config.widevineLicenseUrl)break;return this._ctx.config.widevineLicenseUrl;case Z.PLAYREADY:if(!this._ctx.config.playreadyLicenseUrl)break;return this._ctx.config.playreadyLicenseUrl;case Z.FAIRPLAY:if(!this._ctx.config.fairplayLicenseUrl)break;return this._ctx.config.fairplayLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},i._requestLicense=function(e,t){var i=this,n=this._mediaKeysList[0];if(!n)return A.b.e("eme","Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this._onError({type:p.b.KEY_SYSTEM_ERROR,details:p.a.KEY_SYSTEM_NO_ACCESS,fatal:!0,reason:"media is encrypted but no key-system access has been obtained yet"});this._disposeLoader();var r={onError:this._onLoaderError,onEnd:function(e,n){i._disposeLoader(),n instanceof ArrayBuffer&&t.update(n)}},a=this._loader=new B,s={requestMethod:"POST",requestBody:e,url:this._licenseServerUrl||this._getLicenseServerUrl(n.mediaKeySystemDomain),responseType:"arraybuffer"};a.load(s,r,this._loaderConfig)},i._disposeLoader=function(){this._loader&&this._loader.destroy()},s()(t,[{key:"isActive",get:function(){return!(!this._ctx.video||!this._ctx.video.mediaKeys)}}]),t}(b.a),ie=i(9),ne=function(e){function t(t,i){var n;return(n=e.call(this)||this)._config=void 0,n._avStat=void 0,n._stat=void 0,n.video=void 0,n._sourceBuffer=void 0,n._mediaSource=null,n._mimeCodec=void 0,n._cleanUpTask=void 0,n._appendQueue=void 0,n._hasVideo=void 0,n._hasAudio=void 0,n._endOfData=!1,n._appendEnabled=void 0,n._duration=1/0,n._appendError=0,n._appendBufferError=!1,n._mseDuration=null,n._sbHandler={},n._souceBufferLocked=!1,n._sbAppendStarted=void 0,n._startBufSec=0,n._startBufTimer=void 0,n._lastAppendInfo={},n._changeTypeSupported=tn.isChangeTypeSupported(),n._onSourceOpen=function(){A.b.i("mse","MediaSource onSourceOpen"),n._mediaSource&&(n._mediaSource.removeEventListener("sourceopen",n._onSourceOpen),n._checkSourceBuffer(),n.refresh())},n._onSourceEnded=function(){A.b.i("mse","MediaSource onSourceEnded")},n._onSourceClose=function(){A.b.i("mse","MediaSource onSourceClose"),n._mediaSource&&(n._mediaSource.removeEventListener("sourceopen",n._onSourceOpen),n._mediaSource.removeEventListener("sourceended",n._onSourceEnded),n._mediaSource.removeEventListener("sourceclose",n._onSourceClose))},n._onSourceBufferUpdateEnd=function(e){n._update(e),n._endOfData&&n._endOfStream(),n._updateDuration(),n._stat.mseUpdate++,n.emit(v.a.MSE_UPDATE)},n._onSourceBufferError=function(e){var t=n._getSourceBufferType(e.currentTarget);A.b.i("mse",t+" SourceBuffer Error: ",e),n._onError({type:p.b.MSE_ERROR,details:p.a.SOURCEBUFFER_ERROR,fatal:!0,reason:t+" source buffer error. "+JSON.stringify(n._lastAppendInfo)})},n._startBufEnded=function(){A.b.i("mse","startPlayBufEnd"),n._removeStartBufTimer(),n._startBufSec=0,n.refresh()},n._onError=function(e){n.emit(v.a.ERROR,e)},A.b.i("mse","constructor"),n._config=t,n._avStat=i,n._hasVideo=!1,n._hasAudio=!1,n._appendQueue={video:[],audio:[]},n._sourceBuffer={},n._cleanUpTask={video:[],audio:[]},n._mimeCodec={},n._sbAppendStarted={},n._appendEnabled=!0,n._stat={mseBufferFull:0,mseRemove:0,mseUpdate:0},n}u()(t,e);var i=t.prototype;return i.attach=function(e){var t=this;A.b.i("mse","attach",e),this.video=e;var i=X();if(i){var n=this._mediaSource=new i,r=URL.createObjectURL(n);A.b.i("mse","src: "+r),this.video.src=r,this.video.load(),n.addEventListener("sourceopen",this._onSourceOpen),n.addEventListener("sourceended",this._onSourceEnded),n.addEventListener("sourceclose",this._onSourceClose),this._souceBufferLocked=!1}else setTimeout((function(){t._onError({type:p.b.MSE_ERROR,details:p.a.MEDIASOURCE_ERROR,fatal:!0,reason:"MediaSource is not support"})}),0)},i.trackInfo=function(e){var t=e.tracks.audio,i=e.tracks.video;t&&t.container&&(this._mimeCodec.audio=t.container+'; codecs="'+t.codec+'"'),i&&i.codec&&(this._mimeCodec.video=i.container+'; codecs="'+i.codec+'"'),this._hasAudio=!(!this._hasAudio&&!t),this._hasVideo=!(!this._hasVideo&&!i),A.b.i("mse","track info. video: "+this._hasVideo+" audio: "+this._hasAudio),this._checkSourceBuffer()},i.updateDuration=function(e){A.b.i("mse","update duration: "+e),this._duration=e,this._updateDuration()},i.setStartBufSec=function(e){A.b.i("mse","startPlayBufSec: "+e),this._removeStartBufTimer(),this._startBufSec=e,this._startBufTimer=setTimeout(this._startBufEnded,1e3*e)},i._updateDuration=function(){if("number"==typeof this._duration&&this.video&&this._mediaSource&&this._sourceBuffer&&0!==this.video.readyState&&"open"===this._mediaSource.readyState){for(var e in this._sourceBuffer)if(this._sourceBuffer[e]&&this._sourceBuffer[e].updating)return;var t=this.video.duration;if(null===this._mseDuration&&(this._mseDuration=this._mediaSource.duration),this._avStat.isLive&&!this._avStat.liveShiftEnabled)this._mseDuration=this._mediaSource.duration=1/0;else if(this._duration!==this._mseDuration&&this._duration!==t||!Object(ie.a)(t)){var i=!0;for(var n in this._sourceBuffer)i=i&&!!this._duration&&this.bufferedEndByType(n)<this._duration;i&&this._duration&&(this._mseDuration=this._mediaSource.duration=this._duration),this._duration=null}}},i._checkSourceBuffer=function(){var e=(this._hasAudio?1:0)+(this._hasVideo?1:0),t=(this._mimeCodec.audio?1:0)+(this._mimeCodec.video?1:0);if(A.b.v("mse","checkSourceBuffer",e,t,this._mimeCodec),this._mediaSource&&"open"===this._mediaSource.readyState&&e>0&&t>=e)for(var i in this._mimeCodec)this._mimeCodec[i]&&(A.b.i("mse","add sb: "+i+" "+this._mimeCodec[i]),this._addSourceBuffer(i))},i._addSourceBuffer=function(e){var t=this;if(!this._sourceBuffer[e]&&!this._souceBufferLocked){try{this._mediaSource&&(this._sourceBuffer[e]=this._mediaSource.addSourceBuffer(this._mimeCodec[e]),this._lastAppendInfo[e]={sn:0,subSn:0,codec:this._mimeCodec[e]},this._sbAppendStarted[e]=!1)}catch(t){return A.b.e("mse",t),void this._onError({type:p.b.MSE_ERROR,details:p.a.ADDSOURCEBUFFER_ERROR,fatal:!0,reason:"type:"+e+" codec:"+this._mimeCodec[e]+" code:"+t.code+" msg:"+t.message})}var i=this._sourceBuffer[e];this._sbHandler[e]={updateend:function(){t._onSourceBufferUpdateEnd(e)},error:function(e){t._onSourceBufferError(e)}},i.addEventListener("error",this._sbHandler[e].error),i.addEventListener("updateend",this._sbHandler[e].updateend),this._duration&&this._mediaSource&&this._duration!==this._mediaSource.duration&&(this._mediaSource.duration=this._duration)}},i._hasPendingData=function(){return!(!this._appendQueue||!(this._appendQueue.video&&this._appendQueue.video.length||this._appendQueue.audio&&this._appendQueue.audio.length))},i.refresh=function(){for(var e in this._sourceBuffer)this._update(e)},i._doAppend=function(e){if(this._appendQueue[e]&&this._appendQueue[e].length>0){if(!this._appendEnabled)return void(this._getBufferQueueSize()>209715200&&!this._appendBufferError&&(this._appendBufferError=!0,this._onError({type:p.b.MSE_ERROR,details:p.a.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull"})));if(this._sourceBuffer[e]&&!this._sourceBuffer[e].updating&&!this._appendBufferError){var t=this._appendQueue[e].shift();this._appendBuffer(t)}}},i.mediaSegment=function(e){var t=this;e.forEach((function(e){var i=e.type;e.codec=t._mimeCodec[e.type],t._appendQueue[i].push(e),t._sourceBuffer[i]&&(t._souceBufferLocked=!0,t._update(i))}))},i.bufferedByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?{start:t.buffered.start(0),end:t.buffered.end(t.buffered.length-1)}:{start:0,end:0}},i.bufferedEndByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?t.buffered.end(t.buffered.length-1):0},i.bufferSliceNumByType=function(e){var t=this._sourceBuffer[e];return t?t.buffered.length:0},i.pendingSecByType=function(e){var t=this._appendQueue[e];return t?t.reduce((function(e,t){return e+t.endDTS-t.startDTS}),0):0},i.pendingNum=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].length;return e},i._calculateRemoveRange=function(e){var t=this.video;if(t&&!t.seeking){var i=t.currentTime;if(this._sourceBuffer[e]){var n=this._cleanUpTask[e],r=this._sourceBuffer[e].buffered;if(r.length>=1&&i-r.start(0)>=10){var a=i-5;if(n.length&&0===n[n.length-1].start&&n[n.length-1].end===a)return;n.push({start:0,end:a})}}}},i._cleanUpRange=function(e,t){try{for(var i=0;i<e.buffered.length;i++){var n=e.buffered.start(i),r=e.buffered.end(i),a=Math.max(n,t.start),s=Math.min(r,t.end);if(s>a)return e.remove(a,s),this._stat.mseRemove++,!(t.end>r&&i<e.buffered.length-1)||(t.start=Math.max(t.start,s),!1);if(!(t.end>s))break;t.start=Math.max(t.start,s)}return!0}catch(t){return!(e&&e.updating)}},i._appendBuffer=function(e){if(e&&this._sourceBuffer[e.type]&&this.video&&!this.video.error){var t=this._lastAppendInfo[e.type],i=this._sourceBuffer[e.type];if(e.codec&&t&&e.codec!==t.codec&&(A.b.i("mse",e.type+" codecType change: "+e.codec),i&&this._changeTypeSupported)){A.b.i("mse",e.type+" changeType: "+e.codec);try{i.changeType(e.codec),t.subSn=0}catch(t){return void this._onError({type:p.b.MSE_ERROR,details:p.a.CHANGETYPE_ERROR,fatal:!0,reason:"type:"+e.type+" codec:"+e.codec+" code:"+t.code+" msg:"+t.message})}}t&&(t.codec=e.codec,t.start=e.startDTS,t.end=e.endDTS,t.sn++,t.subSn++);try{e.updateTimestampOffset&&!i.buffered.length&&(i.timestampOffset=e.startPTS),i.appendBuffer(e.payload.buffer),this._sbAppendStarted[e.type]=!0}catch(t){A.b.i("mse",e.type,t.code,t.message),22!==t.code?(this._appendError?this._appendError++:this._appendError=1,this._appendError>this._config.appendErrorMaxRetry?(this._appendBufferError=!0,this._onError({type:p.b.MSE_ERROR,details:p.a.APPENDBUFFER_ERROR,fatal:!0,reason:"code:"+t.code+" type:"+e.type+" msg:"+t.message})):this._appendQueue[e.type].unshift(e)):(this._appendQueue[e.type].unshift(e),this._calculateRemoveRange(e.type),this.hasCleanUpTask(e.type)&&this._cleanUp(e.type),A.b.i("mse","mse bufferfull"),this._stat.mseBufferFull++,this.emit(v.a.MSE_BUFFER_FULL))}}},i._getSourceBufferType=function(e){for(var t in this._sourceBuffer)if(this._sourceBuffer[t]===e)return t;return"unknown"},i.clean=function(e,t,i){var n=0,r=Number.POSITIVE_INFINITY;for(var a in this._sbAppendStarted={},this._endOfData=!1,this._sourceBuffer)if(this._sbAppendStarted[a]=!1,(!i||i===a)&&this._sourceBuffer[a]){if(e){n=Math.max(n,e);for(var s=this._appendQueue[a].length-1;s>=0&&(!this._appendQueue[a][s].startPTS||this._appendQueue[a][s].startPTS>=e);s--)this._appendQueue[a].pop()}else this._appendQueue[a]=[];t&&(r=Math.min(r,t)),this._cleanUpTask[a].push({start:n,end:r}),this._cleanUp(a)}this._appendEnabled=!0},i.setAppendEnabled=function(e){!this._appendEnabled&&e?(this._appendEnabled=e,this.refresh()):this._appendEnabled=e},i.getAppendEnabled=function(){return this._appendEnabled},i.endOfData=function(){A.b.i("mse","data end"),this._endOfData=!0,!this._hasPendingData()&&(this._avStat.isLive||!this._avStat.isLive&&void 0!==this._duration)&&this.video&&this.video.buffered.length&&this._endOfStream()},i.ended=function(){return this._endOfData},i._endOfStream=function(){var e=this._mediaSource;if(e&&"open"===e.readyState){for(var t in this._sourceBuffer){var i=this._sourceBuffer[t];if(i&&i.updating)return}try{A.b.i("mse","end of stream"),e.endOfStream()}catch(e){A.b.e("mse",e),this._onError({type:p.b.MSE_ERROR,details:p.a.ENDOFSTREAM_ERROR,fatal:!0,reason:"code:"+e.code+" msg:"+e.message})}}},i.destroy=function(){if(A.b.i("mse","destroy"),this._mediaSource){var e=this._mediaSource;if(this._endOfStream(),"closed"!==e.readyState)for(var t in this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend),e.removeSourceBuffer(this._sourceBuffer[t]));e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceended",this._onSourceEnded),e.removeEventListener("sourceclose",this._onSourceClose),this._mediaSource=null}this._removeStartBufTimer(),this.removeAllListeners(),this._appendQueue={},this._mimeCodec={},this._sbAppendStarted={},this._cleanUpTask={},this._sourceBuffer={},this._sbHandler={}},i.hasCleanUpTask=function(e){var t=0;if(void 0===e)for(var i in this._cleanUpTask)t+=this._cleanUpTask[i].length;else this._cleanUpTask[e]&&(t=this._cleanUpTask[e].length);return t>0},i.hasSourceBuffer=function(){return!!Object.keys(this._sourceBuffer).length},i.hasTrackInfo=function(){return!!Object.keys(this._mimeCodec).length},i.hasSourceBufferAppendStarted=function(){if(Object.keys(this._sbAppendStarted).length){var e=!0;for(var t in this._sbAppendStarted)e=e&&this._sbAppendStarted[t];return e}return!1},i._getBufferQueueSize=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].reduce((function(e,t){return t.payload&&t.payload.byteLength?e+t.payload.byteLength:e}),0);return e},i.getBufferQueueSec=function(e){var t=this;return this._appendQueue?(e?[e]:Object.keys(this._appendQueue)).reduce((function(e,i){return t._appendQueue[i]&&t._appendQueue[i].length>0&&(0===Object.keys(t._sourceBuffer).length||t._sourceBuffer[i])?Math.max(e,t._appendQueue[i].reduce((function(e,t){var i=t.endDTS-t.startDTS;return i?e+i:e}),0)):e}),0):0},i._update=function(e){if(this.hasCleanUpTask(e)&&this._cleanUp(e),this._startBufSec>0){if(!this.hasTrackInfo())return;for(var t in this._sourceBuffer)if(this.pendingSecByType(t)<this._startBufSec)return;this._startBufEnded()}this._doAppend(e)},i._cleanUp=function(e){for(var t=this._cleanUpTask[e];t&&t.length;){var i=t[0],n=this._sourceBuffer[e];if(n){if(n.updating||!this._cleanUpRange(n,i))return;t.shift()}else t.shift()}this.refresh()},i._removeStartBufTimer=function(){this._startBufTimer&&(clearTimeout(this._startBufTimer),this._startBufTimer=void 0)},s()(t,[{key:"stat",get:function(){return this._stat}},{key:"readyState",get:function(){return this._mediaSource?this._mediaSource.readyState:"closed"}},{key:"trackBufInfo",get:function(){var e={};try{for(var t in this._sourceBuffer){var i=this._sourceBuffer[t].buffered;e[t]=[];for(var n=0;n<i.length;n++)e[t].push({st:i.start(n),ed:i.end(n)})}}catch(e){}return e}}]),t}(b.a),re={400:"01",401:"02",403:"03",404:"04",other4xx:"05",serverError:"06",timeoutOpen:"07",timeoutIO:"08",200:"09",206:"09"};function ae(e,t,i){if(void 0===i&&(i=0),e>=100)return e;var n="00";return"timeout"===t?n=i?re.timeoutIO||n:re.timeoutOpen||n:re.hasOwnProperty(i)?n=re[i]||n:/^4\d{2}$/.test(i.toString())?n=re.other4xx||n:/^5\d{2}$/.test(i.toString())&&(n=re.serverError||n),parseInt(e+n,10)}var se,oe=function(){function e(e){this.url=[],this.urlId=0,this.bitrate=0,this.maxBitrate=0,this.qualityType="",this.qualityLabel="",this.id=0,this.codec="",this.audioCodec="",this.videoCodec="",this.hidden=!1,this.enableAdaptive=!0,this.default=!1,this.width=void 0,this.height=void 0,this.index=0,this.drmSchemaId="",this.drmToken="",this.comment="",this.url=[e],this.urlId=0}return e.prototype.getKLevel=function(){return{width:this.width,height:this.height,qualityLabel:this.qualityLabel,qualityType:this.qualityType,bitrate:this.bitrate,maxBitrate:this.maxBitrate}},s()(e,[{key:"currentUrl",get:function(){return this.url[this.urlId]||""}}]),e}(),ce=function(e){function t(t){var i;return(i=e.call(this,t)||this).startSN=0,i.endSN=0,i.fragments=[],i.initSegment=null,i.live=!0,i.needSidxRanges=!1,i.startTimeOffset=null,i.targetduration=0,i.totalduration=0,i.type=null,i.version=null,i.PTSKnown=!1,i.m3u8Slice=void 0,i.audioGroupIds=void 0,i.attrs=void 0,i.averagetargetduration=void 0,i.name=void 0,i.lang=void 0,i.groupId="",i.instreamId="",i.autoselect=void 0,i.forced=void 0,i.size=0,i.partOfData=!1,i.http416=0,i}return u()(t,e),t.prototype.mergeFrom=function(e,t){if(void 0===t&&(t=!1),e.fragments.length)if(this.endSN=e.endSN,e.partOfData||(e.initSegment&&!this.initSegment&&(this.initSegment=e.initSegment),this.live=e.live,this.needSidxRanges=e.needSidxRanges,this.targetduration=e.targetduration,this.PTSKnown=e.PTSKnown,this.averagetargetduration=e.averagetargetduration,this.hasFrag||(this.m3u8Slice=e.m3u8Slice,this.audioGroupIds=e.audioGroupIds,this.attrs=e.attrs,this.name=e.name,this.lang=e.lang,this.groupId=e.groupId,this.instreamId=e.instreamId,this.autoselect=e.autoselect,this.forced=e.forced)),t){var i,n=e.startSN-this.startSN;if(this.fragments.splice(n),e.partOfData){var r=this.fragments[this.fragments.length-1].endPTS;r&&e.fragments.forEach((function(e){e.start=e.startPTS=r,e.endPTS=e.startPTS+e.duration,r=e.endPTS}))}(i=this.fragments).push.apply(i,e.fragments),this.totalduration=this.fragments.reduce((function(e,t){return e+t.duration}),0),e.partOfData?this.size+=e.size:this.size=e.size}else this.startSN=e.startSN,this.fragments=e.fragments,this.totalduration=e.totalduration,this.size=0},s()(t,[{key:"timeInfo",get:function(){var e=[],t=[];return this.fragments.forEach((function(i){e.push(i.start),"number"==typeof i.programDateTime&&t.push(i.programDateTime)})),{duration:this.totalduration,times:e,utcs:t,targetduration:this.targetduration}}},{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||"number"!=typeof this.fragments[0].programDateTime||!Object(ie.a)(this.fragments[0].programDateTime))}},{key:"hasFrag",get:function(){return this.fragments.length>0}}]),t}(oe),ue=i(28),de=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=void 0,this.baseuri=e,this.reluri=t}return s()(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(ue.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();!function(e){e.AUDIO="audio",e.VIDEO="video"}(se||(se={}));var _e=function(){function e(){var e;this._url="",this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[se.AUDIO]=!1,e[se.VIDEO]=!1,e),this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.sn=0,this.levelkey=void 0,this.level=0,this.start=0,this.cc=0,this.maxStartPTS=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.deltaPTS=void 0,this.dropped=void 0,this.backtracked=void 0,this.type=void 0,this.loader=void 0,this.title=null,this.urlId=void 0,this.data=void 0}var t=e.prototype;return t.setByteRange=function(e,t){var i=e.split("@",2),n=[];1===i.length?n[0]=t?t.byteRangeEndOffset:0:n[0]=parseInt(i[1],10),n[1]=parseInt(i[0],10)+n[0],this._byteRange=n},t.addElementaryStream=function(e){this._elementaryStreams[e]=!0},t.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},t.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},t.setDecryptDataFromLevelKey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new de(e.baseuri,e.reluri)).method=e.method,i.iv=this.createInitializationVector(t)),i},s()(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(ue.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(ie.a)(this.programDateTime))return null;var e=Object(ie.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}]),e}(),he=/^(\d+)x(\d+)$/,le=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,fe=function(){function e(t){for(var i in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&(this[i]=t[i])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=he.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i={};for(le.lastIndex=0;null!==(t=le.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},e}(),pe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function ve(e){var t={};return(e||"").split(/[ ,]+/).forEach((function(e){0!==e.indexOf("avc1")&&0!==e.indexOf("hev1")&&0!==e.indexOf("av01")&&0!==e.indexOf("kvc")||(t.video=e),0===e.indexOf("mp4a")&&(t.audio=e)})),t}function me(e,t){var i=[].concat(e.split(/[ ,]+/));["video","audio"].forEach((function(e){var n=i.filter((function(t){return function(e,t){var i=pe[t];return!!i&&!0===i[e.slice(0,4)]}(t,e)}));if(n.length){var r=n.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("av01",0)||0===e.lastIndexOf("hev1",0)||0===e.lastIndexOf("hvc1",0)||0===e.lastIndexOf("mp4a",0)}));t[e+"Codec"]=r.length>0?r[0]:n[0],i=i.filter((function(e){return-1===n.indexOf(e)}))}})),t.codec=i.join(",")}var Ae=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,ge=/#EXT-X-MEDIA:(.*)/g,ye=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ee=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,be=/\.(mp4|m4s|m4v|m4a)$/i;function Te(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),"number"==typeof e.programDateTime&&Object(ie.a)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var Se,xe=function(){function e(){}return e.findGroup=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}},e.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift(),10).toString(16),t+=("000"+parseInt(i.shift(),10).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return Object(ue.buildAbsoluteURL)(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,i){var n,r=[];for(Ae.lastIndex=0;null!==(n=Ae.exec(t));){var a=new ce(e.resolve(n[2],i)),s=a.attrs=new fe(n[1]),o=s.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.maxBitrate=s.decimalInteger("BANDWIDTH")/1e3;var c=s.decimalInteger("AVERAGE-BANDWIDTH")/1e3;a.bitrate=c||a.maxBitrate,a.name=s.NAME,me(s.CODECS||"",a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),r.push(a)}return r},e.parseMasterPlaylistMedia=function(t,i,n,r){var a;void 0===r&&(r=[]);var s=[],o=0;for(ge.lastIndex=0;null!==(a=ge.exec(t));){var c=new fe(a[1]);if(c.TYPE===n){var u=new ce(c.URI?e.resolve(c.URI,i):"");if(u.attrs=c,u.index=u.id=o++,u.groupId=c["GROUP-ID"]||"",u.instreamId=c["INSTREAM-ID"]||"",u.name=c.NAME||c.LANGUAGE,u.type=n,u.default="YES"===c.DEFAULT,u.autoselect="YES"===c.AUTOSELECT,u.forced="YES"===c.FORCED,u.lang=c.LANGUAGE||"",r.length){var d=e.findGroup(r,u.groupId);u.audioCodec=d?d.codec:r[0].codec}s.push(u)}}return s},e.parseLevelPlaylist=function(e,t,i,n,r,a){void 0===n&&(n=L.e.MAIN),void 0===r&&(r=0),void 0===a&&(a=0);var s,o,c,u=a,d=0,_=0,h=null,l=new _e,f=null,p=new ce(t);for(ye.lastIndex=0;null!==(o=ye.exec(e));){var v=o[1];if(v){l.duration=parseFloat(v);var m=(" "+o[2]).slice(1);l.title=m||null,l.tagList.push(m?["INF",v,m]:["INF",v])}else if(o[3]){if(Object(ie.a)(l.duration)){var g=u++;l.type=n,l.start=d,l.levelkey=s,l.sn=g,l.level=i,l.cc=_,l.urlId=r,l.baseurl=t,l.relurl=(" "+o[3]).slice(1),Te(l,h),p.fragments.push(l),h=l,d+=l.duration,l=new _e}}else if(o[4]){var y=(" "+o[4]).slice(1);h?l.setByteRange(y,h):l.setByteRange(y)}else if(o[5])l.rawProgramDateTime=(" "+o[5]).slice(1),l.tagList.push(["PROGRAM-DATE-TIME",l.rawProgramDateTime]),null===f&&(f=p.fragments.length);else{if(!(o=o[0].match(Ee))||o.length<=0)break;for(c=1;c<o.length&&void 0===o[c];c++);var E=(" "+o[c+1]).slice(1),b=(" "+o[c+2]).slice(1);switch(o[c]){case"#":l.tagList.push(b?[E,b]:[E]);break;case"PLAYLIST-TYPE":p.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":u=p.startSN=parseInt(E,10);break;case"TARGETDURATION":p.targetduration=parseFloat(E);break;case"VERSION":p.version=parseInt(E,10);break;case"EXTM3U":break;case"ENDLIST":p.live=!1;break;case"DIS":_++,l.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":_=parseInt(E,10);break;case"KEY":var T=new fe(E),S=T.enumeratedString("METHOD"),x=T.URI,C=T.hexadecimalInteger("IV");S&&(s=new de(t,x),x&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(S)>=0&&(s.method=S,s.key=null,C&&(s.iv=C)));break;case"START":var R=new fe(E).decimalFloatingPoint("TIME-OFFSET");Object(ie.a)(R)&&(p.startTimeOffset=R);break;case"MAP":var D=new fe(E);l.relurl=D.URI,D.BYTERANGE&&l.setByteRange(D.BYTERANGE),l.baseurl=t,l.level=i,l.type=n,l.sn="initSegment",p.initSegment=l,(l=new _e).rawProgramDateTime=p.initSegment.rawProgramDateTime;break;default:A.b.w("line parsed but not handled: "+o)}}}return(l=h)&&!l.relurl&&(p.fragments.pop(),d-=l.duration),p.totalduration=d,p.averagetargetduration=d/p.fragments.length,p.endSN=u-1,!p.initSegment&&p.fragments.length&&p.fragments.every((function(e){return be.test(e.relurl)}))&&(A.b.w("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(l=new _e).relurl=p.fragments[0].relurl,l.baseurl=t,l.level=i,l.type=n,l.sn="initSegment",p.initSegment=l,p.needSidxRanges=!0),f&&function(e,t){for(var i=e[t],n=t-1;n>=0;n--){var r=e[n];i.programDateTime&&(r.programDateTime=i.programDateTime-1e3*r.duration),i=r}}(p.fragments,f),p},e}();function Ce(e){switch(e){case L.e.MAIN:return Se.LEVEL;case L.e.SUBTITLE:return Se.SUBTITLE_TRACK;case L.e.AUDIO:return Se.AUDIO_TRACK;default:return Se.LEVEL}}!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(Se||(Se={}));var Le=function(e){function t(t){var i;return(i=e.call(this)||this).loaders={},i.tag="PlaylistLoader",i._config=void 0,i._loadsuccess=function(e,t,n){if(i.emit(v.a.DOWNLOAD,qe(Ge.SUCCESS,e,n)),e.isSidxRequest)i._onError({type:p.b.OTHER_ERROR,details:p.a.UNSUPPORTED,fatal:!0,url:e.url.toString(),reason:"unsupport sidx",statusCode:n.code});else if(i._resetInternalLoader(e.type),"string"==typeof t)if(t.startsWith("#EXTINF:")&&e.rangeStart&&e.levelDetails)i._handleTrackOrLevelPlaylist(e,t,n);else{if(0!==t.indexOf("#EXTM3U")){var r=t;return r.length>100&&(r=r.slice(0,100)),void i._handleManifestParsingError(e,"no EXTM3U delimiter."+r,n)}t.indexOf("#EXTINF:")>0||t.indexOf("#EXT-X-TARGETDURATION:")>0?i._handleTrackOrLevelPlaylist(e,t,n):i._handleMasterPlaylist(e,t,n)}else i._onError({type:p.b.NETWORK_ERROR,details:p.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url.toString(),reason:'expected responseType of "text" for PlaylistLoader',statusCode:n.code})},i._loaderror=function(e,t){i._handleNetworkError(e,t)},i._loadAbort=function(e,t){i.emit(v.a.DOWNLOAD,qe(Ge.ABORT,e,t))},i._onError=function(e){i.emit(v.a.ERROR,e)},i._config=t,i.loaders={},i}u()(t,e),t.canHaveQualityLevels=function(e){return e===Se.LEVEL},t.mapContextToLevelType=function(e){switch(e.type){case Se.AUDIO_TRACK:return L.e.AUDIO;case Se.SUBTITLE_TRACK:return L.e.SUBTITLE;default:return L.e.MAIN}},t.getResponseUrl=function(e){var t=e.responseUrl;return t&&0!==t.indexOf("data:")||"string"!=typeof e.url||(t=e.url),t||""};var i=t.prototype;return i._createInternalLoader=function(e){var t=new B;return e.loader=t,this.loaders[e.type]=t,t},i._getInternalLoader=function(e){return this.loaders[e.type]},i._resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},i._destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this._resetInternalLoader(e)}},i.destroy=function(){this.removeAllListeners(),this._destroyInternalLoaders()},i.load=function(e){A.b.d(this.tag,"Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var t,i,n,r,a=this._getInternalLoader(e);if(a){var s=a.context;if(s&&s.url===e.url)return A.b.i(this.tag,"playlist request ongoing"),!1;A.b.w(this.tag,"aborting previous loader for type: "+e.type),a.abort()}switch(e.type){case Se.MANIFEST:t=this._config.manifestLoadingMaxRetry,i=this._config.manifestConnectionTimeout,n=this._config.manifestTransmissionTimeout,r=this._config.manifestLoadingRetryDelay;break;default:t=this._config.levelLoadingMaxRetry,i=this._config.levelConnectionTimeout,n=this._config.levelTransmissionTimeout,r=this._config.levelLoadingRetryDelay}a=this._createInternalLoader(e),e.responseType=e.responseType||"text";var o={connectionTimeout:i,transmissionTimeout:n,maxRetry:t,retryDelay:r},c={onEnd:this._loadsuccess,onError:this._loaderror,onAbort:this._loadAbort};return A.b.d(this.tag,"Calling internal loader delegate for URL: "+e.url),a.load(e,c,o),!0},i._handleMasterPlaylist=function(e,i,n){var r=i,a=t.getResponseUrl(e),s=xe.parseMasterPlaylist(r,a);if(s.length){var o=s.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),c=xe.parseMasterPlaylistMedia(r,a,"AUDIO",o),u=xe.parseMasterPlaylistMedia(r,a,"SUBTITLES",o);if(c.length){var d=!1;if(c.forEach((function(e){e.url||(d=!0)})),!1===d&&s[0].audioCodec&&!s[0].attrs.AUDIO){A.b.v(this.tag,"audio codec signaled in quality level, but no embedded audio track signaled, create one");var _=new ce("");_.type=L.e.MAIN,_.name="main",_.id=-1,c.unshift(_)}}var h=0;s.forEach((function(e,t){e.default&&(h=t)}));var l={levels:s,audioTracks:c,subtitleTracks:u,def:h};this.emit(v.a.HLS_MANIFEST_PARSED,l)}else this._handleManifestParsingError(e,"no level found in manifest",n)},i._handleTrackOrLevelPlaylist=function(e,i,n){var r=e.id,a=e.level,s=e.type,o=t.getResponseUrl(e),c=Object(ie.a)(r)?r:0,u=Object(ie.a)(a)?a:c,d=t.mapContextToLevelType(e),_=e.levelDetails,h=!(!i.startsWith("#EXTINF:")||!e.rangeStart),l=_&&h?_.endSN+1:0;_&&(_.http416=0);var f=xe.parseLevelPlaylist(i,o,u,d,c,l);if(h&&(f.startSN=l,A.b.i("playlist-loader","part of media playlist data")),f.size=i.length,f.partOfData=h,s===Se.MANIFEST){var p={levels:[f],def:0};this.emit(v.a.HLS_MANIFEST_PARSED,p)}if(f.needSidxRanges&&f.initSegment){var m=f.initSegment.url;this.load({url:m,isSidxRequest:!0,type:s,level:a,levelDetails:f,id:r,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",headers:this._config.headers})}else e.levelDetails=f,this._handlePlaylistLoaded(e,n)},i._handleManifestParsingError=function(e,t,i){this._onError({type:p.b.NETWORK_ERROR,details:p.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url.toString(),reason:t,statusCode:i.code})},i._handleNetworkError=function(e,t){var i,n;A.b.i(this.tag,"A network error occured while loading a "+e.type+"-type playlist");var r=this._getInternalLoader(e);switch(e.type){case Se.MANIFEST:i=p.a.MANIFEST_LOAD_ERROR,n=!0;break;case Se.LEVEL:i=p.a.LEVEL_LOAD_ERROR,n=!1;break;case Se.AUDIO_TRACK:i=p.a.AUDIO_TRACK_LOAD_ERROR,n=!1;break;case Se.SUBTITLE_TRACK:i=p.a.SUBTITLE_TRACK_LOAD_ERROR,n=!1;break;default:i=p.a.MANIFEST_LOAD_ERROR,n=!1}if(this.emit(v.a.DOWNLOAD,qe(Ge.FAIL,e,t)),t.fatal){if(r&&(r.abort(),this._resetInternalLoader(e.type)),e.rangeStart&&416===t.code){A.b.i("playlist-loader","level 416"),e.levelDetails&&e.levelDetails.http416++;var a=new ce("");return e.levelDetails?(a.endSN=e.levelDetails.endSN,a.targetduration=e.levelDetails.targetduration):a.targetduration=2,void this.emit(v.a.LEVEL_LOADED,{details:a,level:e.level||0,stats:t})}this._onError({type:p.b.NETWORK_ERROR,details:i,fatal:n,url:e.url.toString(),reason:t.text,statusCode:t.code})}},i._handlePlaylistLoaded=function(e,i){var n,r=e.type,a=e.level,s=(e.id,e.levelDetails);if(s&&(s.targetduration||null!=(n=e.levelDetails)&&n.partOfData))if(t.canHaveQualityLevels(e.type))this.emit(v.a.LEVEL_LOADED,{details:s,level:a||0,stats:i});else switch(r){case Se.AUDIO_TRACK:this.emit(v.a.AUDIO_TRACK_LOADED,{details:s,level:a||0,stats:i});break;case Se.SUBTITLE_TRACK:this.emit(v.a.SUBTITLE_TRACK_LOADED,{details:s,level:a||0,stats:i})}else this._handleManifestParsingError(e,"invalid target duration.",i)},t}(b.a);function Re(e){var t;performance.addEventListener&&(t=e,performance&&("function"==typeof performance.setResourceTimingBufferSize?performance.setResourceTimingBufferSize(t):"function"==typeof performance.webkitSetResourceTimingBufferSize&&performance.webkitSetResourceTimingBufferSize(t)),performance.addEventListener("resourcetimingbufferfull",we))}function De(){performance.removeEventListener&&performance.removeEventListener("resourcetimingbufferfull",we)}var we=function(){performance&&("function"==typeof performance.clearResourceTimings?performance.clearResourceTimings():"function"==typeof performance.webkitClearResourceTimings&&performance.webkitClearResourceTimings())},Ie=/\.(mp4|m4s|mov|m4a)($|\?)/,Oe=/\.flv($|\?)/,Pe=/\.m3u8($|\?)/,ke=/\.sdp($|\?)/,Ne=/\.(webm|mkv|mka)($|\?)/,Me=/\.mp3($|\?)/,Be=/\.aac($|\?)/,Ve=/\.ts($|\?)/,Fe=/\.yuv($|\?)/,Ue=/\.slice($|\?)/;function He(e){return Ie.test(e)?L.g.mp4:Oe.test(e)||je(e)?L.g.flv:Pe.test(e)?L.g.hls:ke.test(e)?L.g.webrtc:Ne.test(e)?L.g.matroska:Me.test(e)?L.g.mp3:Be.test(e)?L.g.aac:Ve.test(e)?L.g.ts:Fe.test(e)?L.g.yuv:L.g.unknown}function je(e){return Ue.test(e)}var ze,Ge,We=/\_([A-Za-z0-9]+)\_/,Ke=/[A-Za-z0-9]+\_([A-Za-z0-9]+)\./;function Qe(e){return"string"!=typeof e?"":He(e)===L.g.flv?Ye(e,Ke)||Ye(e,We):Ye(e,We)||Ye(e,Ke)}function Ye(e,t){var i=e.match(t);return i&&i.length>1?i[1]:""}!function(e){e.FAIL="FAIL",e.ABORT="ABORT",e.SUCCESS="SUCCESS"}(Ge||(Ge={}));var Xe=((ze={})[Se.MANIFEST]=p.a.MANIFEST_LOAD_ERROR,ze[Se.LEVEL]=p.a.LEVEL_LOAD_ERROR,ze[Se.AUDIO_TRACK]=p.a.AUDIO_TRACK_LOAD_ERROR,ze[Se.SUBTITLE_TRACK]=p.a.SUBTITLE_TRACK_LOAD_ERROR,ze);function qe(e,t,i,n,r,a){void 0===r&&(r=!1);var s="string"==typeof t.url?t.url:"",o=new C.a(s).host,c={domain:o,stream_host:o,download_url:s,download_start_time:i.tsload,download_spend_time:i.tload?Math.round(i.tload-i.tstart):Math.round(performance.now()-i.tstart),http_response_time:i.tfirst?Math.round(i.tfirst-i.tstart):0,download_status:e,http_status_code:i.code,retry_index:i.retry,error_code:0,error_message:"",loader_id:i.id,download_size:i.total||i.loaded||0,resource_type:t.type||"",preload:r?1:0};a&&(c.codec=a),n&&(c.quality_type=n);var u=t.frag;if(u&&(c.slice_play_start_time=Math.round(1e3*u.start),u.duration&&(c.slice_play_duration=Math.round(1e3*u.duration)),u.sn&&(c.slice_index=u.sn),u.level&&(c.slice_level_index=u.level)),e===Ge.FAIL){var d=Xe[t.type]||p.a.LOAD_ERROR;c.error_code=ae(d,i.text,i.code)}if(i.text&&(c.error_message=i.text),t.responseHeader){var _=I(t.responseHeader);_&&(c.custom_http_header=_)}"number"==typeof t.rangeStart&&(c.range_start=t.rangeStart),t.rangeEnd&&(c.range_end=t.rangeEnd);var h=Qe(c.download_url);if(h&&(c.transcoding_template=h),"string"==typeof t.url){var l=function(e){if(performance&&"function"==typeof performance.getEntriesByName){var t=performance.getEntriesByName(e,"resource");if(t.length){var i=t[t.length-1],n={};return i.redirectStart&&(n.redirect=Math.round(i.redirectEnd-i.redirectStart)),n.dns=Math.round(i.domainLookupEnd-i.domainLookupStart),n.tcp=Math.round(i.connectEnd-i.connectStart),n.request=Math.round(i.requestStart-i.connectEnd),n.firstResponse=Math.round(i.responseStart-i.requestStart),i.responseStart>0?n.response=Math.round(i.responseEnd-i.responseStart):n.response=Math.round(i.responseEnd-i.fetchStart),n.duration=Math.round(i.duration)||0,n}}return null}(t.url);l&&(l.redirect&&(c.time_redirect=l.redirect),l.dns&&(c.time_dns=l.dns),l.tcp&&(c.time_tcp=l.tcp),l.request&&(c.time_request=l.request),l.firstResponse&&(c.time_first_response=l.firstResponse),l.response&&(c.time_response=l.response),l.duration&&(c.duration=l.duration))}return c}var Ze,Je={beacon:!1,predictStep:5,targetBuffer:10,duration:5,smoothRatioToTarget:0,switchpanelty:2.5*1e-6,slidingWindowSize:3,kalmanR:Math.pow(.2,2),kalmanQ:4e-4,initBitrate:2e6,startBitrateLimit:!0,speedPredictRatio:1.5,speedPredictNum:3,algorithm:1,speedPredictRatioOnStart:3,lowProfileThreshold:4,lowProfileBitrate:25e5,lowProfileStartThreshold:5};!function(e){e[e.Default=0]="Default",e[e.Seek=1]="Seek"}(Ze||(Ze={}));var $e=function(){function e(e){this._ctx=void 0,this._conf=void 0,this._bufferSize=0,this._lastBufferSize=0,this._pastThroughput=void 0,this._bitrates=[],this._qos={},this._storage=void 0,this._index=0,this._nextIndex=0,this._status=Ze.Default,this._speedPredictCnt=0,this._lowProfile=!1,this._lowProfileIndex=0,this._lowProfileHistory=0,this._renderBlockCount=0,this._initBitrate=0,this._storage=new F,this._conf=r()({},Je),this._ctx=e}var t=e.prototype;return t.init=function(e){var t=r()({},Je);this._conf=r()(t,e),this._initBitrate=this._conf.initBitrate},t.onManifestUpdated=function(){var e=this,t=this._ctx.lctx;this._initBitrate=this._conf.initBitrate,this._bitrates=[],t.abrLevels.forEach((function(t){e._bitrates.push(1e3*t.bitrate),t.default&&(e._initBitrate=t.bitrate)})),this._index=Math.min(t.abrDefault,this._bitrates.length-1),A.b.i("algorithm-hls","setInfo "+this._bitrates+", "+this._index),this._nextIndex=0,this._bufferSize=this._conf.duration,this._lastBufferSize=0,this._pastThroughput=new Array(this._conf.slidingWindowSize),this._pastThroughput[this._conf.slidingWindowSize-1]=0,this._status=Ze.Default,this._lowProfileIndex=this._maxBitrateIndex(this._bitrates,this._conf.lowProfileBitrate)},t.destroy=function(){},t.bitrateInit=function(){var e=this,t=this._bitrateToIndex(this._bitrates,this._initBitrate),i=this._storage.read("kwai_hls_adaptive");if(A.b.i("algorithm-hls","storage read:"+i),void 0!==i&&i.bitrate>=0&&i.speed>0&&2===i.version){i.time&&i.lowProfile&&Date.now()-i.time<2592e5&&(this._lowProfileHistory=Math.min(parseInt(i.lowProfile),this._conf.lowProfileStartThreshold+1),this._lowProfileHistory>this._conf.lowProfileStartThreshold&&(this._lowProfile=!0,t=Math.min(t,this._lowProfileIndex)));var n=Math.min(i.bitrate,1024*i.speed/this._conf.speedPredictRatioOnStart),r=this._bitrates.reduce((function(t,i,r){return Math.abs(i-n)<Math.abs(e._bitrates[t]-n)?r:t}),0);t=this._conf.startBitrateLimit?Math.min(t,r):r}return t},t.onLevelLoad=function(e){e<this._bitrates.length&&e>=0&&(this._index=e)},t.onKeyPoint=function(e){if(e.byteLength){var t=e.duration||e.spendTime,i=e.byteLength/t*7.8125;this._qos=r()({cache:!1},e),A.b.v("algorithm-hls","report download time:"+t+" bytes:"+e.byteLength+" buffered:"+e.buffered+" speed:"+i+" cache:"+this._qos.cache);var n=this._nextRateIndex(i,e.buffered/1e3);n!==this._nextIndex&&this._storage.write("kwai_hls_adaptive",{version:2,index:n,bitrate:this._bitrates[n],speed:this._qos&&this._qos.speed?this._qos.speed:0,lowProfile:Math.max(0,this._lowProfile?this._lowProfileHistory+1:this._lowProfileHistory-1),time:Date.now()}),this._nextIndex=n,this._qos.speed=i,this._qos.buffered=e.buffered,this._qos.nextBitrate=this._bitrates[this._nextIndex],this._qos.currentBitrate=this._bitrates[this._index]}},t.onSeek=function(e){A.b.v("algorithm-hls","report seek buffered:"+e.buffered+" inBuffer:"+e.isInBuffer),e.isInBuffer?this._resetAlgorithm():this._qos.seek=1,(!e.isInBuffer||e.buffered/1e3<this._conf.targetBuffer)&&(A.b.i("algorithm-hls","status change to seek."),this._status=Ze.Seek,this._speedPredictCnt=this._conf.speedPredictNum)},t.onDownloadEnabled=function(e){e||this._resetAlgorithm()},t._resetAlgorithm=function(){this._bufferSize=0,this._lastBufferSize=0,this._pastThroughput=new Array(this._conf.slidingWindowSize)},t._nextRateIndex=function(e,t){this._bufferSize=t,this._pastThroughput.shift(),this._pastThroughput.push(e),this._status===Ze.Seek&&(t>=this._conf.targetBuffer||this._speedPredictCnt<=0)&&(this._speedPredictCnt=0,this._status=Ze.Default,A.b.i("algorithm-hls","status change to default. buffered:"+t+" step:"+this._speedPredictCnt));var i=-1;return this._status===Ze.Seek?(this._speedPredictCnt--,this._lastBufferSize=this._bufferSize,i=this._nextRateBySpeed(e)):i=this._nextRateBySpeedAndBuffered(e,t),this._lowProfile&&(i=Math.min(i,this._lowProfileIndex)),i},t._nextRateBySpeed=function(e){var t=1024*e,i=this._bitrates[this._index];if(t<i||t>i*this._conf.speedPredictRatio)for(var n=this._bitrates.length-1;n>=0;n--)if(t>this._bitrates[n]*this._conf.speedPredictRatio)return n;return this._index},t._nextRateBySpeedAndBuffered=function(e,t){var i,n=1024*e,r=this._bitrates,a=r[this._index],s=this._ctx.playbackRate;for(i=r.length-1;i>0&&!(n>r[i]*s);i--);var o=r[i],c=this._index,u=t/s;return o>a?u>o*this._conf.duration/n&&(c=i):o<a&&u<a*this._conf.duration/n+this._conf.duration&&(c=i),A.b.v("algorithm-hls","_nextRateBySpeedAndBuffered bitrateBySpeed:"+o+", nextBitrate:"+c+", bitrate:"+a+", remainingTime:"+u+", speed:"+n+", playbackRate:"+s),c},t._bitrateToIndex=function(e,t){return e.reduce((function(i,n,r){return(e[i]+n)/2>=t?i:r}),0)},t._maxBitrateIndex=function(e,t){return e.reduce((function(e,i,n){return i>t?e:n}),0)},s()(e,[{key:"nextLevel",get:function(){return this._nextIndex}},{key:"lowProfile",get:function(){return this._lowProfile}}]),e}(),et={speedPredictRatioOnStart:6},tt=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._algorithm=void 0,i._downloadEnd=void 0,i._downloadStartTime=0,i._index=0,i._ctx=t,i._downloadEnd=0,i}u()(t,e);var i=t.prototype;return i.init=function(){return this._algorithm=new $e(this._ctx),this._algorithm.init(this._ctx.config.hlsAdaptiveConfig||et),this._algorithm.onManifestUpdated(),this._algorithm.bitrateInit()},i.onAbrLevelsUpdated=function(){var e;null==(e=this._algorithm)||e.onManifestUpdated()},i.destory=function(){this._algorithm&&(this._algorithm=void 0)},i.onDownload=function(e){if(this._algorithm&&this._ctx.isAbrAvailable&&"number"==typeof e.slice_play_start_time&&"number"==typeof e.slice_play_duration&&Object(ie.a)(e.slice_play_start_time)&&Object(ie.a)(e.slice_play_duration)&&e.download_status===Ge.SUCCESS){this._downloadEnd=e.slice_play_start_time+e.slice_play_duration;var t={buffered:this._downloadEnd-1e3*this._ctx.currentTime,duration:e.duration||0,spendTime:e.download_spend_time,byteLength:e.download_size};this._algorithm.onKeyPoint(t)}},i.onNewSource=function(){if(this._algorithm){var e=this._ctx.lctx.currentIdx;this._downloadStartTime=this._downloadStartTime||performance.now(),e>=0&&e<this._ctx.lctx.levels.length&&(this._index=e),this._algorithm.onLevelLoad(this._ctx.lctx.orignIndexToAbr(e))}},i.onSeek=function(e){this._algorithm&&this._ctx.isAbrAvailable&&this._algorithm.onSeek({isInBuffer:e.isInBuffer,buffered:this._downloadEnd-1e3*this._ctx.currentTime})},i.nextBitrateIndex=function(){var e=this._ctx.lctx;if(e.abr&&this._algorithm){var t=e.abrIndexToOrign(this._algorithm.nextLevel);if(t!==this._index&&t>=0&&t<e.levels.length)return t}return this._index},i.setDownloadEnabled=function(e){this._algorithm&&this._algorithm.onDownloadEnabled(e)},s()(t,[{key:"abrInitLevel",get:function(){var e;return(null==(e=this._algorithm)?void 0:e.bitrateInit())||0}}]),t}(b.a);function it(e,t,i){var n=e[t],r=e[i],a=r.startPTS;Object(ie.a)(a)?i>t?(n.duration=a-n.start,n.duration<0&&A.b.w("LevelHelper","negative duration computed for frag "+n.sn+",level "+n.level+", duration "+n.duration+", there should be some duration drift between playlist and fragment!. from")):(r.duration=n.start-a,r.duration<0&&A.b.w("LevelHelper","negative duration computed for frag "+r.sn+",level "+r.level+", duration "+r.duration+", there should be some duration drift between playlist and fragment!. to")):r.start=i>t?n.start+n.duration:Math.max(n.start-r.duration,0)}function nt(e,t,i,n,r,a){var s=i;if(Object(ie.a)(t.startPTS)){var o=Math.abs(t.startPTS-i);Object(ie.a)(t.deltaPTS)?t.deltaPTS=Math.max(o,t.deltaPTS):t.deltaPTS=o,s=Math.max(i,t.startPTS),i=Math.min(i,t.startPTS),n=Math.max(n,t.endPTS),r=Math.min(r,t.startDTS),a=Math.max(a,t.endDTS)}var c=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=s,t.endPTS=n,t.startDTS=r,t.endDTS=a,t.duration=n-i;var u,d=t.sn;if(!e||d<e.startSN||d>e.endSN||"number"!=typeof d)return 0;var _=d-e.startSN,h=e.fragments;for(h[_]=t,u=_;u>0;u--)it(h,u,u-1);for(u=_;u<h.length-1;u++)it(h,u,u+1);return e.PTSKnown=!0,c}function rt(e,t,i){void 0===i&&(i=!1),t.partOfData||function(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var i,n=0;if(at(e,t,(function(e,r){n=e.cc-r.cc,Object(ie.a)(e.startPTS)&&(r.start=r.startPTS=e.startPTS,r.endPTS=e.endPTS,r.duration=e.duration,r.backtracked=e.backtracked,r.dropped=e.dropped,i=r),t.PTSKnown=!0})),t.PTSKnown){if(n){A.b.v("LevelHelper","discontinuity sliding from playlist, take drift into account");for(var r=t.fragments,a=0;a<r.length;a++)r[a].cc+=n}i?nt(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):function(e,t){var i=t.startSN-e.startSN,n=e.fragments,r=t.fragments;if(!(i<0||i>n.length))for(var a=0;a<r.length;a++)r[a].start+=n[i].start}(e,t),t.PTSKnown=e.PTSKnown}}(e,t),e.mergeFrom(t,i)}function at(e,t,i){if(e&&t)for(var n=Math.max(e.startSN,t.startSN)-t.startSN,r=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,s=n;s<=r;s++){var o=e.fragments[a+s],c=t.fragments[s];if(!o||!c)break;i(o,c,s)}}function st(e,t,i){var n=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),r=n/2;return e&&t.endSN===e.endSN&&(n=r),i&&(n=Math.max(r,n-(performance.now()-i))),Math.round(n)}var ot,ct,ut=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._onManifestLoaded=function(){i.emit(v.a.MANIFEST_PARSED)},i._ctx=t,i}u()(t,e);var i=t.prototype;return i.loadManifest=function(){this._onManifestLoaded()},i.loadLevel=function(e,t){void 0===t&&(t=L.e.MAIN)},i.destroy=function(){},t}(b.a),dt=function(){function e(){}return e.verify=function(e){return!!(e&&e.hasOwnProperty("version")&&e.hasOwnProperty("adaptationSet")&&e.adaptationSet.hasOwnProperty("representation")&&Array.isArray(e.adaptationSet.representation)&&e.adaptationSet.representation.length>0)&&e.adaptationSet.representation.reduce((function(e,t){return!!(e&&t.url&&t.bitrate&&t.qualityType)}),!0)},e.parse=function(t){var i,n=[];return e.verify(t)&&t.adaptationSet.representation.forEach((function(e,t){var r=new oe(e.url);r.id=e.id||t,r.maxBitrate=e.bitrate||0,r.bitrate=e.averageBitrate||r.maxBitrate,r.qualityType=e.qualityType||"",r.qualityLabel=e.name||"",r.codec=e.codec||"",r.hidden=e.hidden||!1,r.enableAdaptive=void 0===e.enableAdaptive||!!e.enableAdaptive,r.default=e.defaultSelect||!1,r.index=t,n.push(r),r.default&&void 0===i&&(i=t)})),{levels:n,def:i||0,srcType:L.i.KWAI_FLV_ABR}},e}(),_t=function(){function e(){}return e.verify=function(e){return!!(e&&e.hasOwnProperty("segments")&&Array.isArray(e.segments)&&e.segments.length>0)&&(e.segments.forEach((function(e){if(!e.url||!e.duration||!e.time)return!1})),!0)},e.parse=function(t,i){void 0===i&&(i="");var n=[],r={levels:n,withCredentials:!1,hasVideo:!0,hasAudio:!0};if(e.verify(t)){var a=new ce("");n.push(a);var s=t;r.withCredentials=!!s.withCredentials,void 0!==s.hasAudio&&(r.hasAudio=!!s.hasAudio),void 0!==s.hasVideo&&(r.hasVideo=!!s.hasVideo);var o=0,c=0,u=0;s.segments.forEach((function(e,t){var n=new _e;n.sn=t,"string"==typeof e.startUtcTime?n.programDateTime=parseInt(e.startUtcTime):"number"==typeof e.startUtcTime&&(n.programDateTime=e.startUtcTime),"string"==typeof e.duration?n.duration=(parseFloat(e.duration)||0)/1e3:n.duration=(e.duration||0)/1e3,n.start=o,n.baseurl=i,n.relurl=e.url,o+=n.duration,t>0&&u!==e.periodId&&(n.tagList.push(["DIS"]),c++),n.cc=c,u=e.periodId,a.fragments.push(n)})),a.live=!1,a.type=L.e.MAIN,a.startSN=0,a.endSN=a.fragments.length-1,a.totalduration=o,a.averagetargetduration=o/a.fragments.length}return r},e}(),ht=function(){function e(){}return e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.representation&&e.adaptationSet.representation.length)&&e.adaptationSet.representation.reduce((function(e,t){return!!(t.url&&t.bandwidth&&e)}),!0)},e.parse=function(t){var i=[];return e.verify(t)&&t.adaptationSet.representation.forEach((function(e){if(e&&(e.url||e.m3u8)){var t=new ce(e.baseUrl?Object(ue.buildAbsoluteURL)(e.baseUrl,e.url,{alwaysNormalize:!0}):e.url);t.bitrate=Math.floor(e.bandwidth/1e3),t.maxBitrate=Math.floor(e.bandwidth/1e3),t.qualityType=e.qualityType||"",t.qualityLabel=e.qualityLabel||"",e.width&&e.height&&(t.width=e.width,t.height=e.height),me(e.codecs||"",t),t.audioCodec="",t.m3u8Slice=e.m3u8||e.m3u8Slice,t.totalduration=e.duration,e.backupUrl&&e.backupUrl.length&&(t.url=t.url.concat(e.backupUrl)),t.default=e.defaultSelect||!1,t.urlId=0,i.push(t)}})),{levels:i,def:0}},e}();!function(e){e[e.HLSTS=1]="HLSTS",e[e.MP4=2]="MP4",e[e.FLV=3]="FLV",e[e.HLSFMP4=4]="HLSFMP4"}(ot||(ot={})),function(e){e[e.LongVideo=1]="LongVideo",e[e.ShortVideo=2]="ShortVideo",e[e.LiveGame=3]="LiveGame",e[e.LiveShow=4]="LiveShow",e[e.LivePlayBack=5]="LivePlayBack"}(ct||(ct={}));var lt={1:L.g.hls_ts,2:L.g.mp4,3:L.g.flv,4:L.g.hls_fmp4},ft=function(){function e(){}return e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.length)&&e.adaptationSet.reduce((function(e,t){return!!(e&&t.representation&&t.representation.length)}),!0)},e.parse=function(t){var i,n,r,a,s,o,c,u=[],d=!1,_=0;if(e.verify(t)){var h=t;o=lt[h.mediaType],c=1===h.stereoType?L.k.V360:L.k.Normal,h.adaptationSet.forEach((function(e){var t=e.duration/1e3;!_&&t&&(_=t);var o=e.drmSchemaId,c=e.drmToken;e.drmSchemaId&&(d=!0);var l=L.e.MAIN;if(e.mimeType&&(-1!==e.mimeType.indexOf("video")||(l=-1!==e.mimeType.indexOf("audio")?L.e.AUDIO:"text/vtt"===e.mimeType?L.e.SUBTITLE:void 0)),l){var f=e.representation.map((function(i,n){var u;if(h.mediaType===ot.HLSTS||h.mediaType===ot.HLSFMP4?((u=new ce(i.url)).lang=e.language||"",u.default=!!i.defaultSelect,u.id=i.id||n,u.m3u8Slice=i.m3u8Slice,u.totalduration=t||_,u.maxBitrate=i.maxBitrate||0):(u=new oe(i.url)).maxBitrate=i.maxBitrate||0,u.bitrate=i.avgBitrate||u.maxBitrate,u.qualityType=i.qualityType||"",u.qualityLabel=i.qualityLabel||"",u.codec=i.codecs||"",u.codec){var f=ve(u.codec);u.audioCodec=f.audio||"",u.videoCodec=f.video||""}return 1===h.adaptationSet.length&&(u.audioCodec=""),i.width&&i.height&&(u.width=i.width,u.height=i.height),u.hidden=i.hidden||!1,u.enableAdaptive=void 0===i.disableAdaptive||!i.disableAdaptive,u.default=i.defaultSelect||!1,u.index=n,u.drmSchemaId=i.drmSchemaId||o,u.drmToken=i.drmToken||c,u.drmSchemaId&&(d=!0),i.backupUrl&&i.backupUrl.length&&(u.url=u.url.concat(i.backupUrl)),u.urlId=0,u.default&&void 0===r&&(l===L.e.MAIN?r=n:l===L.e.AUDIO?a=n:l===L.e.SUBTITLE&&(s=n)),u.comment=i.comment,u}));l===L.e.MAIN?u=u.concat(f):l===L.e.AUDIO?(i||(i=[]),i=i.concat(f)):l===L.e.SUBTITLE&&(n||(n=[]),n=n.concat(f))}}))}return n&&e.processingSubtitleType(n,_),{levels:u,def:r||0,audioTracks:i,defAudio:a||0,subtitleTracks:n,defSubtitle:s||0,drm:d,box:o,stereoType:c}},e.processingSubtitleType=function(e,t){e.forEach((function(e,i){if(He(e.currentUrl)===L.g.hls){e.live=!1,e.index=i,e.totalduration=t,e.targetduration=t,e.endSN=1;var n=new _e;n.type=L.e.SUBTITLE,n.start=0,n.sn=1,n.level=i,n.cc=0,n.url=e.currentUrl,n.duration=t,e.fragments=[n]}}))},e.getAdaptationIdxByType=function(e,t){for(var i=0;i<e.adaptationSet.length;i++){var n;if(void 0===e.adaptationSet[i].mimeType)return"video"===t?0:-1;if(0===(null==(n=e.adaptationSet[i].mimeType)?void 0:n.indexOf(t)))return i}return-1},e}();function pt(e,t,i){var n=Math.min(e,t);return n>1080||1080===n&&i>35}var vt=[L.g.hls,L.g.hls_ts,L.g.hls_fmp4];function mt(e){return!!e&&-1!==vt.indexOf(e)}var At=new RegExp('codecs="((/w|.)+)"'),gt=[{k:"video/mp4",v:L.g.mp4},{k:"video/quicktime",v:L.g.mp4},{k:"video/x-flv",v:L.g.flv},{k:"video/webm",v:L.g.matroska},{k:"video/x-matroska",v:L.g.matroska},{k:"video/mp2t",v:L.g.ts},{k:"audio/x-matroska",v:L.g.matroska},{k:"audio/mp4",v:L.g.mp4},{k:"audio/mpeg",v:L.g.mp3},{k:"audio/aac",v:L.g.aac},{k:"application/vnd.apple.mpegurl",v:L.g.hls},{k:"application/x-mpegurl",v:L.g.hls}];function yt(e){for(var t={type:e,box:L.g.unknown,vCodec:L.b.unknown},i=0;i<gt.length;i++)if(0===e.toLocaleLowerCase().indexOf(gt[i].k)){t.box=gt[i].v;var n=e.match(At);n&&n.length>2&&n[1].split(",").forEach((function(e){0===e.indexOf("avc1")?t.vCodec=L.b.h264:0===e.indexOf("av01")?t.vCodec=L.b.av1:0!==e.indexOf("hev1")&&0!==e.indexOf("hvc1")||(t.vCodec=L.b.hevc)}));break}return t}var Et=new RegExp("^((http|https)://)|blob:"),bt=[L.g.matroska,L.g.mp3,L.g.aac],Tt=[L.g.flv,L.g.raw,L.g.webrtc,L.g.ivf],St=[L.g.mp4,L.g.flv,L.g.hls,L.g.raw,L.g.hls_fmp4,L.g.hls_ts,L.g.ts,L.g.ivf],xt=Object.keys(L.b).map((function(e){return L.b[e]})),Ct=function(){function e(){}return e.verifyMix=function(e){var t=0;for(var i in e)-1!==xt.indexOf(i)&&t++;return t>0},e.isSrcEmpty=function(e){try{if("string"==typeof e){if(!(e=e.trim()))return!0;if(!Et.test(e))return 0===Object.keys(JSON.parse(e)).length}else if(!(e instanceof Blob))return 0===Object.keys(e).length}catch(e){}return!1},e.filterLevels=function(e){var t=R.a.chrome||R.a.firefox;e.levels.forEach((function(e){t&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec="")}));var i=tn.isMSEAvailable()?tn.isMSECodecStrSupportedInMp4:tn.isVideoCodecStrSupportedInMp4;e.levels=e.levels.filter((function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||i(t,"audio"))&&(!n||i(n))}));var n=!1;return e.levels.forEach((function(t,i){t.index=i,t.default&&(e.def=i,n=!0)})),n||(A.b.i("media-src","no default main level, select the one with the lowest bit rate."),e.def=e.levels.reduce((function(t,i,n){return i.bitrate<e.levels[t].bitrate?n:t}),0)),e.audioTracks&&(e.audioTracks=e.audioTracks.filter((function(e){return!e.audioCodec||i(e.audioCodec,"audio")})),e.defAudio=void 0,e.audioTracks.forEach((function(t,i){t.index=i,t.default&&(e.defAudio=i)})),void 0===e.defAudio&&(e.defAudio=0)),e.subtitleTracks&&e.subtitleTracks.length&&e.subtitleTracks.forEach((function(t,i){t.index=i,t.default&&(e.defSubtitle=i)})),e},e.preParse=function(t,i,n,r,a){if(void 0===i&&(i=!1),void 0===a&&(a=""),"string"==typeof t){if(!(t=this._formatStrData(t)))return{src:t,box:L.g.unknown,srcType:L.i.OTHERS}}else t instanceof Blob||(t=JSON.parse(JSON.stringify(t)));if(Array.isArray(t)){for(var s,o=[],c=t.map((function(t){if(!t||!t.src)return{info:void 0,priority:0};var s=e._preParseMd(t.src,i,n,r,a);return o.push(s.box),{info:s,mime:t.type?yt(t.type):void 0,priority:0}})),u=0;u<c.length;u++){var d=c[u];if(d.info&&d.info.src)if(d.mime&&(d.mime.box!==L.g.unknown&&(d.info.box=d.mime.box),d.mime.vCodec!==L.b.unknown&&(d.info.codecType=d.mime.vCodec)),void 0!==n&&n!==d.info.nativeFirst||d.priority++,d.info.nativeFirst)d.priority+=d.info.box===L.g.unknown?1:tn.isVideoBoxSupported(d.info.box)?2:-2,d.priority+=d.info.codecType===L.b.unknown?1:r&&r===d.info.codecType||tn.isVideoCodecSupported(d.info.codecType)?2:-2;else{if(!tn.isMSEAvailable())continue;d.priority+=d.info.box===L.g.unknown?1:St.indexOf(d.info.box)>=0?2:-2,d.priority+=d.info.codecType===L.b.unknown?1:r&&r===d.info.codecType||tn.isMSECodecSupported(d.info.codecType)?2:-2}}return c.sort((function(e,t){return t.priority-e.priority})),null!=(s=c[0])&&s.info?(c[0].info.mixContainerInput=o,c[0].info):{src:t,box:L.g.unknown,srcType:L.i.OTHERS}}return e._preParseMd(t,i,n,r,a)},e._preParseMd=function(t,i,n,a,s){if(void 0===i&&(i=!1),void 0===s&&(s=""),"string"==typeof t&&!(t=this._formatStrData(t)))return{src:t,box:L.g.unknown,srcType:L.i.OTHERS};var o,c,u=[],d=tn.isMSEAvailable();if(e.verifyMix(t)){var _={},h=t;for(var l in c={},h){var f=l;if(-1!==xt.indexOf(f)){var p=h[f];if("string"==typeof p&&(p=p.trim()),!p)continue;var v=this._getBoxBySrc(p,s);if(v.nativeFirst=this._getNativeFirstByBox(v.box,d,n),u.push(f),d&&!v.nativeFirst){var m=tn.getVideoCodecCompatibilityByCodec(f);c[f]=m.decoder,f===L.b.h264&&(m={decoder:L.c.buildin,smooth:!0,mix:m.mix}),m.smooth&&m.decoder===L.c.buildin&&p&&(v.compatibility=m,v.codecType=f,_[f]=v)}else{var g=tn.isVideoCodecSupported(f);c[f]=g?L.c.buildin:L.c.unsupported,(!g||R.a.ios&&f===L.b.hevc&&v.box===L.g.hls_ts)&&f!==L.b.h264||(v.compatibility={decoder:L.c.buildin,smooth:!0,mix:!1},v.codecType=f,_[f]=v)}}}var y,E=_[L.b.hevc],b=_[L.b.av1],T=_[L.b.h264];if(a&&_[a])o=_[a];else{var S,x=b||E;!R.a.mobile&&i&&x&&x.compatibility&&x.compatibility.mix&&T&&(ft.verify(x.src)&&ft.verify(T.src)&&x.box===T.box?S=function(e,t,i){if(void 0===i&&(i=L.b.hevc),e.mediaType===t.mediaType){var n=ft.getAdaptationIdxByType(e,"audio"),a=ft.getAdaptationIdxByType(t,"audio");if(n>=0&&a>=0||-1===n&&-1===a){var s=ft.getAdaptationIdxByType(e,"video"),o=ft.getAdaptationIdxByType(t,"video");if(-1===s||-1===o)return;var c=e.adaptationSet[s].representation,u=t.adaptationSet[o].representation;if(0===c.length||0===u.length||1===c.length&&1===u.length)return;var d=[],_=[],h={},l=c.length>1?c:u,f=l[0].width<l[l.length-1].width;if(u.forEach((function(e){pt(e.height,e.width,e.frameRate)||(h[e.qualityType]=i,_.push(e))})),c.forEach((function(e){(pt(e.height,e.width,e.frameRate)||0===_.length)&&(h[e.qualityType]=L.b.h264,d.push(e))})),0===d.length&&0===_.length)return;var p=d.concat(_);if(_.length&&p.sort((function(e,t){return f?e.width-t.width:t.width-e.width})),p.length){var v=r()({},t);return v.adaptationSet[o].representation=p,{manifest:v,qualityList:h}}}}}(T.src,x.src,x.codecType):dt.verify(x.src)&&dt.verify(T.src)&&(T.src,x.src,S=void(void 0===x.codecType&&L.b.hevc)),S&&(A.b.i("media-src","mix kwai manifest"),x.src=S.manifest,x.mediaLevels=e.filterLevels(ft.parse(x.src)),x.codecType=L.b.unknown,x.mixQualityList=S.qualityList,o=x))}o||((o=b||E||T)&&(o.nativeFirst=this._getNativeFirstByBox(o.box,d,n)),A.b.i("media-src","select src",null==(y=o)?void 0:y.codecType))}else(o=this._getBoxBySrc(t,s)).nativeFirst=this._getNativeFirstByBox(o.box,d,n);return o||(o={src:t,box:L.g.unknown,srcType:L.i.OTHERS}),u.length&&(o.mixCodecInput=u),o.mixCodecAvailable=c,o},e._getNativeFirstByBox=function(e,t,i){return!t||-1!==bt.indexOf(e)||!(-1!==Tt.indexOf(e)||!tn.isVideoBoxSupported(e))&&(R.a.mobile?e===L.g.mp4||e===L.g.hls||e===L.g.hls_ts||e===L.g.ts?!(void 0!==i&&!i)&&!!tn.isVideoBoxSupported(e):e===L.g.hls_fmp4?!(void 0!==i&&!i)&&!(!tn.isVideoBoxSupported(e)||!R.a.x5&&!R.a.xweb):void 0:i?!!tn.isVideoBoxSupported(e):void 0===i&&!tn.isMSEAvailable())},e._getBoxBySrc=function(t,i){void 0===i&&(i="");var n={src:t,box:L.g.unknown,srcType:L.i.OTHERS};if("string"==typeof t)n.box=He(t),n.mediaLevels={levels:[new oe(t)],def:0},n.isLive=this._getIsLiveByBox(n.box);else if(t instanceof Blob)n.mediaLevels={levels:[new oe(URL.createObjectURL(t))],def:0},n.box=t instanceof File?He(t.name):L.g.unknown,n.srcType=L.i.FILE,n.isLive=!1;else if(ft.verify(t))n.mediaLevels=e.filterLevels(ft.parse(t)),n.box=n.mediaLevels.box||He(t.adaptationSet[0].representation[0].url),n.srcType=L.i.KWAI,n.isLive=this._getIsLiveByBox(n.box);else if(dt.verify(t))n.mediaLevels=e.filterLevels(dt.parse(t)),n.box=L.g.flv,n.isLive=!0,n.srcType=L.i.KWAI_FLV_ABR;else if(_t.verify(t)){var a=_t.parse(t,i);n.mediaLevels=r()({def:0},a),n.box=L.g.flv,n.isLive=!1,n.multipart=!0,n.srcType=L.i.KWAI_FLV_MP}else ht.verify(t)&&(n.mediaLevels=e.filterLevels(ht.parse(t)),n.box=L.g.hls,n.srcType=L.i.KWAI);return mt(n.box)&&(n.multipart=!0),n},e._getIsLiveByBox=function(e){var t;return-1===[L.g.flv,L.g.hls,L.g.unknown,L.g.ivf,L.g.yuv].indexOf(e)&&(t=!1),e===L.g.webrtc&&(t=!0),t},e._formatStrData=function(e){var t=e.trim();if(t){if(!Et.test(t)){try{t=JSON.parse(t)}catch(e){}"string"==typeof t&&(t=Object(ue.buildAbsoluteURL)(location.href,t,{alwaysNormalize:!0}))}return t}},e}(),Lt=function(){function e(){}return e.parse=function(e){return ht.verify(e)?ht.parse(e):ft.verify(e)?ft.parse(e):{levels:[],def:0}},e.parseLevelSlice=function(e,t){if(e.m3u8Slice){var i=xe.parseLevelPlaylist(e.m3u8Slice,e.url[0],e.index,t,0);if(delete e.m3u8Slice,0===i.fragments.length)return;return i}},e}(),Rt=function(e){function t(t){var i;return(i=e.call(this)||this)._playlistLoader=void 0,i._ctx=void 0,i._onManifestLoaded=function(e){var t=i._ctx.lctx;e=Ct.filterLevels(e),i._ctx.stat.drm=e.drm,t.levels=e.levels,t.currentIdx=e.def,e.audioTracks&&(t.audioTracks=e.audioTracks,t.audioIdx=e.defAudio||0),e.subtitleTracks&&(t.subtitleTracks=e.subtitleTracks,t.subtitleIdx=e.defSubtitle||0),i.emit(v.a.MANIFEST_PARSED)},i._onLevelLoaded=function(e){i.emit(v.a.LEVEL_LOADED,e)},i._onAudioLevelLoaded=function(e){i.emit(v.a.AUDIO_TRACK_LOADED,e)},i._onSubtitleLevelLoaded=function(e){i.emit(v.a.SUBTITLE_TRACK_LOADED,e)},i._ctx=t,i._playlistLoader=new Le(i._ctx.config),i._playlistLoader.on(v.a.HLS_MANIFEST_PARSED,i._onManifestLoaded),i._playlistLoader.on(v.a.LEVEL_LOADED,i._onLevelLoaded),i._playlistLoader.on(v.a.AUDIO_TRACK_LOADED,i._onAudioLevelLoaded),i._playlistLoader.on(v.a.SUBTITLE_TRACK_LOADED,i._onSubtitleLevelLoaded),i._playlistLoader.on(v.a.DOWNLOAD,(function(e){i.emit(v.a.DOWNLOAD,e)})),i._playlistLoader.on(v.a.ERROR,(function(e){i.emit(v.a.ERROR,e)})),i}u()(t,e);var i=t.prototype;return i.loadManifest=function(){this._ctx.lctx.levels.length?this.emit(v.a.MANIFEST_PARSED):this._playlistLoader&&this._playlistLoader.load({url:this._ctx.src,type:Se.MANIFEST,level:0,id:null,credentials:this._ctx.config.credentials,headers:this._ctx.config.headers})},i.loadLevel=function(e,t){if(void 0===t&&(t=L.e.MAIN),e.m3u8Slice){var i=Lt.parseLevelSlice(e,t);if(i&&(e.totalduration&&(i.totalduration=e.totalduration),rt(e,i,this._ctx.stat.liveShiftEnabled),t===L.e.MAIN?this.emit(v.a.LEVEL_UPDATED):t===L.e.AUDIO?this.emit(v.a.AUDIO_TRACK_UPDATED):t===L.e.SUBTITLE&&this.emit(v.a.SUBTITLE_TRACK_UPDATED),!i.live))return}if(this._playlistLoader){var n=e.urlId,r={url:e.url[n],type:Ce(t),level:e.index,id:n,credentials:this._ctx.config.credentials,headers:this._ctx.config.headers,levelDetails:e};e.size&&e.http416<d.i&&this._ctx.stat.liveShiftEnabled&&(A.b.i("mp-hls","load m3u8 range start: "+e.size+"."),r.rangeStart=e.size),this._playlistLoader.load(r)}},i.destroy=function(){this._playlistLoader&&(this._playlistLoader.destroy(),this._playlistLoader=void 0)},t}(b.a),Dt=Rt?{hls:Rt,hls_ts:Rt,hls_fmp4:Rt,flv:ut}:{flv:ut},wt=i(21),It=i(35);function Ot(e,t){return t?It.a.searchIndex(t,(function(t){return e<t.start?-1:e>t.start+t.duration?1:0})):-1}var Pt=function(e){function t(t,i){var n;return(n=e.call(this)||this)._loaders=void 0,n._config=void 0,n._loaderConfig=void 0,n._decryptkey=void 0,n._decrypturl=void 0,n._loadEnd=function(e,t,i){if(t&&t instanceof ArrayBuffer){var r=e.frag;n._decryptkey=r.decryptdata.key=new Uint8Array(t),n._loaders[r.type]=null,n.emit(v.a.HLS_KEY_LOADED,{frag:r})}else n._onError({type:p.b.NETWORK_ERROR,details:p.a.KEY_LOAD_ERROR,fatal:!0,reason:"key empty",statusCode:i.code})},n._loadError=function(e,t){var i=e.frag.loader;t.fatal&&(i&&i.abort(),n._loaders[e.frag.type]=null,n._onError({type:p.b.NETWORK_ERROR,details:p.a.KEY_LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code}))},n._onError=function(e){n.emit(v.a.ERROR,e)},n._config=t,n._loaderConfig=i,n._loaders={},n._decryptkey=null,n._decrypturl=null,n}u()(t,e);var i=t.prototype;return i.destroy=function(){for(var e in this._loaders){var t=this._loaders[e];t&&t.destroy()}this._loaders={}},i.load=function(e){var t=e.type,i=this._loaders[t],n=e.decryptdata,r=null;if(n&&(r=n.uri),!r||r===this._decrypturl&&null!==this._decryptkey)this._decryptkey&&(n&&(n.key=this._decryptkey),this.emit(v.a.HLS_KEY_LOADED,{frag:e}));else{var a=this._loaderConfig;i&&(A.b.w("KeyLoader","abort previous key loader for type:"+t),i.abort()),e.loader=this._loaders[t]=new B,this._decrypturl=r,this._decryptkey=null;var s={url:r,frag:e,responseType:"arraybuffer",credentials:this._config.credentials,headers:this._config.headers},o=a,c={onEnd:this._loadEnd,onError:this._loadError};e.loader.load(s,c,o)}},t}(b.a),kt=i(27),Nt={local:0,server:0},Mt=function(){function e(){var e=this;this._loader=void 0,this._callback=void 0,this._loaderConfig=void 0,this._onLoaderError=function(){e._disposeLoader()},this._onLoaderEnd=function(t,i){if(e._disposeLoader(),"string"==typeof i){Nt.local=performance.now();var n=i.split(",");Nt.server=1e3*parseFloat(n[0])+parseInt(n[1],10)/1e3/2}},this._callback={onError:this._onLoaderError,onEnd:this._onLoaderEnd},this._loaderConfig={useFetch:!1,connectionTimeout:5e3}}e.serverMs=function(e){return Nt.server?e-Nt.local+Nt.server:null},e.clear=function(){Nt.local=0,Nt.server=0};var t=e.prototype;return t.load=function(){this._disposeLoader();var e={url:"https://ntp.nc.gifshow.com/",responseType:"text"};(this._loader=new B).load(e,this._callback,this._loaderConfig)},t.destroy=function(){this._disposeLoader()},t._disposeLoader=function(){this._loader&&this._loader.destroy()},s()(e,[{key:"time",get:function(){return r()({},Nt)}}],[{key:"serverNowMs",get:function(){return Nt.server?performance.now()-Nt.local+Nt.server:null}}]),e}(),Bt=function(){function e(){this._ntp=void 0,this._priv={abst:0,originDTS:0},this._vLastExtraInfo=void 0,this._aLastExtraInfo=void 0,this._ntp=new Mt}var t=e.prototype;return t.init=function(){!Mt.serverNowMs&&this._ntp&&this._ntp.load()},t.onPrivNal=function(e){e.abst&&(this._priv.abst=e.abst,this._priv.originDTS=e.originDTS)},t.onParsing=function(e){var t=this;e.segments.forEach((function(e){e.type===L.l.VIDEO?t._vLastExtraInfo={dts:e.startDTS,originDTS:e.originFirstDTS,parseTime:e.firstParseTime}:e.type===L.l.AUDIO&&(t._aLastExtraInfo={dts:e.startDTS,originDTS:e.originFirstDTS,parseTime:e.firstParseTime})}))},t.destroy=function(){this._ntp&&(this._ntp.destroy(),this._ntp=void 0)},t.getDisplayDelay=function(e){return this._renderDelay(e,this._vLastExtraInfo)},t.getAudioRenderDelay=function(e){return this._renderDelay(e,this._aLastExtraInfo)},t.getRecDelay=function(){var t=this._vLastExtraInfo;if(Mt.serverNowMs&&null!=t&&t.parseTime){var i=this._priv,n=Mt.serverMs(1e3*t.parseTime+e._workerStartMs);if(n&&i.originDTS&&i.abst)return Math.round(n-1e3*(t.originDTS-i.originDTS+i.abst))}return 0},t._renderDelay=function(e,t){var i=Mt.serverNowMs,n=this._priv;return i&&t&&n.abst&&n.originDTS?Math.round(1e3*(t.dts-e-(t.originDTS-n.originDTS+n.abst))+i):0},s()(e,null,[{key:"workerTimeOffset",set:function(t){e._workerStartMs=t}}]),e}();Bt._workerStartMs=0;var Vt=Bt,Ft=i(41),Ut=function(){function e(e,t,i){var n=this;if(this._id=void 0,this._evt=void 0,this._ctx=void 0,this._w=void 0,this._internalEvt=void 0,this._chunkIndex=void 0,this._seek=!1,this._mux=void 0,this._progressTime=0,this._lastTRequest=0,this._transmuxData=void 0,this._ended=!1,this._onWorkMessage=function(e){n._onMessage(e.data.event,e.data.data)},this._id=i,this._evt=e,this._ctx=t,t.stat.webWorker&&(this._w=t.stat.muxWorker,t.stat.muxWorker=void 0,!this._w))try{A.b.i("muxer-base","init mux worker"),this._w=f()(45),Vt.workerTimeOffset=performance.now()}catch(e){}this._chunkIndex=0,this._transmuxData={audioCodec:t.stat.audioCodec,videoCodec:"",duration:0,remuxId:1}}var t=e.prototype;return t.init=function(){var e=this,t=this._internalEvt=new b.a,i=this._onMessage.bind(this);if([v.a.PRIV_NAL,v.a.SEI,v.a.INIT_PTS_FOUND,v.a.PARSING_INIT_SEGMENT,v.a.PARSED_DATA,v.a.RAW_DATA,v.a.VIDEO_CODEC_DETECTED,v.a.LOAD_END,v.a.ERROR,v.a.PARSING_DATA,v.a.DEMUXER_DETECTED,v.a.MEDIA_DEMUX,v.a.METADATA,v.a.KEY_FRAME_INDEXS,v.a.KEY_FRAME,v.a.VIDEO_FRAME_INFO,v.a.MP4_NOT_FASTSTART].forEach((function(e){return t.on(e,(function(t){return i(e,t)}))})),A.b.i("muxer-base","TYPE_SUPPORTED","hw: "+tn.isSupportHW,tn.TYPE_SUPPORTED),this._w){this._w.addEventListener("message",this._onWorkMessage),this._w.addEventListener("error",(function(t){A.b.i("muxer-base","worker onerror",t.message),e._evt.emit(v.a.ERROR,{type:p.b.MUX_ERROR,details:p.a.REMUX_WORKER_ERROR,fatal:!0,reason:t.message})}));try{this._w.postMessage({cmd:kt.a.INIT,typeSupported:tn.TYPE_SUPPORTED,config:this._ctx.getRemuxConfig(),vendor:navigator.vendor})}catch(e){A.b.i("muxer-base","worker init error"),this._w.terminate(),this._w=void 0}}this._w||(this._mux=new Ft.a(t,tn.TYPE_SUPPORTED,this._ctx.getRemuxConfig(),navigator.vendor))},t.destroy=function(){this._ctx.stat.muxWorker=void 0,this._w&&(this._w.postMessage({cmd:kt.a.DESTROY}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate(),this._w=void 0),this._internalEvt&&(this._internalEvt.removeAllListeners(),this._internalEvt=void 0)},t.trackInfo=function(e,t){this._transmuxData.hasVideo=e,this._transmuxData.hasAudio=t},t.reset=function(e){A.b.i("muxer-base","reset: "+e),this._transmuxData.remuxId++,this._chunkIndex=0,this._seek=e,this._ended=!1},t.end=function(){this._ended||(this._ended=!0,this._w?this._w.postMessage({cmd:kt.a.LOAD_END}):this._mux&&this._mux.end())},t.updateConfig=function(e){this._w?this._w.postMessage({cmd:kt.a.UPDATE_CONFIG,config:e}):this._mux&&this._mux.updateConfig(e)},t.onFragProgress=function(e){this._demux(e,!1)},t.onFragLoaded=function(e){this._demux(e,!0)},t.updateSuffix=function(e){this._transmuxData.suffix=e},t._demux=function(e,t){var i=e.context.frag,n=!1,r=i.start||0,a=!1,s=!0,o=null;if(this._transmuxData.progress=e.progress,e.data&&e.data.byteLength){var c=performance.now(),u=c-(this._progressTime||e.stats.trequest);e.stats.trequest!==this._lastTRequest&&(this._lastTRequest=e.stats.trequest,u=c-e.stats.trequest),this._progressTime=c,this._evt.emit(v.a.LOADER_CHUNK_ARRIVAL,{progress:e.context.progress,byteLength:e.data.byteLength,timeCost:u,ts:performance.now()})}0===this._chunkIndex&&(n=!0,a=!1,s=e.remuxContiguous||!1,A.b.i("muxer-base","chunk 0 contiguous: "+s)),t?(this._progressTime=0,this._chunkIndex=0,o=e.data?new Uint8Array(e.data):new Uint8Array):(this._chunkIndex++,e.data&&(o=new Uint8Array(e.data))),o&&(this._push(o,i.decryptdata,e.initData,r,s,n,a,!this._seek||0===i.start,t),this._seek=!1)},t._onParsing=function(e){return!(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId)||(A.b.i("muxer-base","parsing data expired"),!1)},t._onParsed=function(e){return!(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId)||(A.b.i("muxer-base","parsed expired"),!1)},t._push=function(e,t,i,n,a,s,o,c,u){a||A.b.i("muxer-base"," demux contiguous false");var d=this._transmuxData;this._w?this._w.postMessage({cmd:kt.a.PUSH,data:e,decryptdata:t,initSegment:i,timeOffset:n||0,contiguous:a,trackSwitch:s,discontinuity:o,accurateTimeOffset:c,fragEnd:u,transmuxData:d},[e.buffer]):this._mux&&this._mux.push(e,t,i,n,a,s,o,c,u,r()({},d))},t._onMessage=function(e,t){switch(e){case v.a.PARSING_DATA:if(!this._onParsing(t))return;break;case v.a.PARSED_DATA:if(!this._onParsed(t))return;t&&(t.trackType=this._id);break;case v.a.RAW_DATA:if(t.extra&&t.extra.remuxId!==this._transmuxData.remuxId)return}this._evt.emit(e,t)},s()(e,[{key:"totalDuration",set:function(e){this._transmuxData.duration=e}},{key:"id",get:function(){return this._id}}]),e}(),Ht=function(e){function t(t,i,n){var r;return(r=e.call(this,t,i,n)||this)._frag=void 0,r._fragInfo=void 0,r._frag=void 0,r._fragInfo={},r}u()(t,e);var i=t.prototype;return i.reset=function(t){e.prototype.reset.call(this,t),this._frag=void 0},i._demux=function(e,t){var i=e.context.frag,n=this._frag,r=!1,a=Object(ie.a)(i.startDTS)?i.startDTS:i.start,s=!1,o=!0,c=null;if(this._transmuxData.progress=e.progress,e.data&&e.data.byteLength){var u=performance.now(),d={progress:e.context.progress,byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest),ts:performance.now()};this._progressTime=u,this._evt.emit(v.a.LOADER_CHUNK_ARRIVAL,d)}if(0===this._chunkIndex){this._fragInfo={},r=!(n&&i.level===n.level),s=!(n&&i.cc===n.cc);var _=n&&i.sn===n.sn+1;o=!(r||!_),this._ctx.stat.isLive&&(s=s||!_),n&&e.remuxContiguous&&(o||(a=Object(ie.a)(n.endDTS)?n.endDTS:n.start+n.duration),o=!0)}t?(this._progressTime=0,this._chunkIndex=0,this._frag=e.context.frag,c=e.data?new Uint8Array(e.data):new Uint8Array,this._frag=i):(this._chunkIndex++,e.data&&(c=new Uint8Array(e.data))),c&&(this._push(c,i.decryptdata,e.initData,a,o,r,s,!this._seek||0===e.context.frag.start,t),this._seek=!1)},i._onParsing=function(e){var t=this;if(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId)return A.b.i("mux-multipart","parsing data expired"),!1;var i=this._fragInfo;return e.segments.forEach((function(e){var n=e.type;n===L.l.VIDEO&&e.adjustedStart&&e.adjustedStart>1?A.b.i("mux-multipart","video segment adjustedStart: "+e.adjustedStart+" > 1"):i.hasOwnProperty(n)?(i[n].endPTS=e.endPTS,i[n].endDTS=e.endDTS):(e.endPTS||e.endDTS||!t._frag||(e.endPTS=e.startPTS+t._frag.duration,e.endDTS=e.startDTS+t._frag.duration),i[n]={startDTS:e.startDTS,startPTS:e.startPTS,endPTS:e.endPTS,endDTS:e.endDTS})})),!0},i._onParsed=function(e){return e.extra&&e.extra.remuxId!==this._transmuxData.remuxId?(A.b.i("mux-multipart","parsed expired"),!1):(e.info=r()({},this._fragInfo),e.frag=this._frag,this._fragInfo={},!0)},t}(Ut),jt="initSegment",zt=function(){function e(e,t,i,n){var r=this;this._evt=void 0,this._type=void 0,this._levels=void 0,this._pos=0,this._failPos=-1,this._mux=void 0,this._loadEnabled=!0,this._newSource=!0,this._startSN=0,this._fragLoadFailSec=0,this._demuxing=!1,this._loader=void 0,this._initFragLoader=void 0,this._keyLoader=void 0,this._remuxContiguous=!1,this._ctx=void 0,this._fragAlign=void 0,this._callback=void 0,this._loadConfig=void 0,this._keyLoadConfig=void 0,this._parallelStartCache=void 0,this._tryLoadNext=function(){var e=r._ctx.lctx.getNextIdx(r._type);r._ctx.lctx.getLevelIdx(r._type)!==e&&r._ctx.lctx.setLevelIdx(e,r._type);var t=r.level;if(t){if(r._fragAlign&&t.hasFrag){var i=r._fragAlign.frag,n=t.fragments[r._pos];n&&r._pos===r._fragAlign.pos&&i&&Object(ie.a)(i.startPTS)&&nt(t,n,i.startPTS,i.endPTS,i.startDTS,i.endDTS)}if(r._loadEnabled&&!r._loader&&!r._demuxing){if(r._isLevelEnd())return void r._mux.end();var a=r._nextFragment();a&&(t.hasFrag&&t.initSegment&&!t.initSegment.data&&r._loadFrag(t.initSegment),r._loadFrag(a))}}},this._fragParsed=function(e){var t=e.frag;if(e.trackType===r._type&&t){for(var i in r._demuxing=!1,r._remuxContiguous=!1,e.info){var n=e.info[i];if(n&&n.endPTS&&n.endDTS){var a=r._levels[t.level];null!=a&&a.hasFrag&&nt(a,t,n.startPTS,n.endPTS,n.startDTS,n.endDTS)}}r._fragAlign&&(r._fragAlign=void 0),r._isLevelEnd()?r._mux.end():r._type===L.e.MAIN&&r._evt.emit(v.a.ABR_NEXT,{startSec:r._getFragStartByPos(r._pos)}),r._tryLoadNext()}},this._tryStartDemux=function(){if(r._parallelStartCache&&r._isReady(r._parallelStartCache.context.frag,r._levels[r._parallelStartCache.context.frag.level])){var e=r._parallelStartCache.data.get(r._parallelStartCache.data.unreadLen);e&&r._startDemux(r._parallelStartCache.context,e.buffer,r._parallelStartCache.stats,r._parallelStartCache.progress),r._parallelStartCache=void 0}},this._onProgress=function(e,t,i){r._levels[e.frag.level],e.frag&&e.frag.sn===jt||t instanceof ArrayBuffer&&r._preprocessed(e,t,i,!0)},this._onEnd=function(e,t,i){r._failPos=-1,r._fragLoadFailSec=0,e.frag&&e.frag.sn===jt?r._destroyInitLoader():r._destroyLoader();var n=r._levels[e.frag.level],a=qe(Ge.SUCCESS,e,i,null==n?void 0:n.qualityType,r._ctx.stat.isPreload,null==n?void 0:n.codec);r._evt.emit(v.a.DOWNLOAD,a),"string"!=typeof t&&(e.frag&&e.frag.sn===jt&&t?(e.frag.data=new Uint8Array(t),r._demuxing=!1,r._tryStartDemux()):r._preprocessed(e,t,i,!1))},this._onError=function(e,t){r._demuxing=!1;var i=r._levels[e.frag.level];if(r._evt.emit(v.a.DOWNLOAD,qe(Ge.FAIL,e,t,null==i?void 0:i.qualityType,r._ctx.stat.isPreload,null==i?void 0:i.codec)),t.fatal)if(r._remuxContiguous=!1,r._failPos<0&&(r._failPos=Math.max(0,r._pos-1)),r._resetIO(),r._fragLoadFailSec+=e.frag.duration||0,e.frag.sn===jt||404!==t.code||r._ctx.config.maxFragFailSec&&r._fragLoadFailSec>=r._ctx.config.maxFragFailSec||r._isLevelEnd()){var n={type:p.b.NETWORK_ERROR,details:p.a.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url.toString()};r._evt.emit(v.a.ERROR,n)}else r._tryLoadNext()},this._onAbort=function(e,t){var i=r._levels[e.frag.level];r._evt.emit(v.a.DOWNLOAD,qe(Ge.ABORT,e,t,i.qualityType,r._ctx.stat.isPreload,i.codec))},this._type=e,this._evt=t,this._ctx=i,this._levels=e===L.e.MAIN?i.lctx.levels:i.lctx.audioTracks,i.lctx.setLevelIdx(n,this._type),i.lctx.setNextIdx(n,this._type),this._callback={onProgress:this._onProgress,onEnd:this._onEnd,onError:this._onError,onAbort:this._onAbort},this._loadConfig={connectionTimeout:i.config.connectionTimeout,transmissionTimeout:i.config.transmissionTimeout,maxRetry:i.config.maxRetry,retryDelay:i.config.retryDelay,breakpointContinuation:i.config.breakpointContinuation},this._keyLoadConfig={connectionTimeout:i.config.keyConnectionTimeout,transmissionTimeout:i.config.keyTransmissionTimeout,maxRetry:i.config.keyLoadingMaxRetry,retryDelay:i.config.keyLoadingRetryDelay},this._evt.on(v.a.PARSED_DATA,this._fragParsed),this._mux=new Ht(t,i,e),i.stat.isPreload||this._mux.init()}var t=e.prototype;return t.levelUpdated=function(){if(this.level&&this.level.hasFrag){var e=this.level.startSN;Object(ie.a)(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._mux.totalDuration=this.level.totalduration,this._tryLoadNext()}},t.seek=function(e,t){void 0===t&&(t=!1),this._remuxContiguous=!1;var i=this.level;if(this._loadEnabled=!0,this._fragAlign=void 0,this._resetIO(),this._parallelStartCache=void 0,i&&i.hasFrag){var n=0===e?0:Ot(e,i.fragments);n>=0?this._pos=n:(this._pos=0,i.hasFrag&&e>=i.fragments[0].start&&(this._pos=i.fragments.length-1)),this._reset(!0),t&&(e=i.fragments[this._pos].start,A.b.i("stream-media","to keyframe: "+e),this._evt.emit(v.a.VIDEO_SEEK,{sec:e})),this._tryLoadNext()}return e},t.destroy=function(){this._resetIO(),this._mux&&this._mux.destroy(),this._keyLoader&&(this._keyLoader.destroy(),this._keyLoader=void 0),this._fragAlign=void 0},t.nextBackup=function(e){if(this._levels)for(var t=0;t<this._levels.length;t++){var i=this._levels[t];if(i.urlId>=i.url.length-1)return!1;i.urlId++,delete i.m3u8Slice,i.fragments=[]}return this._resetIO(),this._newSource=!0,this._failPos>=0&&(this._pos=this._failPos),this._reset(!0),!0},t.trackInfo=function(e,t){this._mux.trackInfo(e,t)},t.setDownloadEnabled=function(e){!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},t.setIndex=function(e){this._resetIO(),this._newSource=!0,this._ctx.lctx.setLevelIdx(e,this._type),this._ctx.lctx.setNextIdx(e,this._type),this._fragAlign=void 0},t.setNext=function(e){this._newSource=!0,this._ctx.lctx.setNextIdx(e,this._type),this._remuxContiguous=!0},t._fragAlignStart=function(e){return e.maxStartPTS||e.startPTS||e.start},t._getFragByPos=function(e){if(this.level&&this.level.hasFrag)return this.level.fragments[e]},t._getFragStartByPos=function(e){var t=this._getFragByPos(e);return t?this._fragAlignStart(t):0},t._reset=function(e){this._demuxing=!1,this._mux.reset(e)},t._resetIO=function(){this._parallelStartCache=void 0,this._destroyLoader(),this._destroyInitLoader()},t._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},t._destroyInitLoader=function(){this._initFragLoader&&(this._initFragLoader.destroy(),this._initFragLoader=void 0)},t._loadKey=function(e){var t=this;this._keyLoader||(this._keyLoader=new Pt({credentials:this._ctx.config.credentials,headers:this._ctx.config.headers},this._keyLoadConfig),this._keyLoader.on(v.a.HLS_KEY_LOADED,this._tryStartDemux),this._keyLoader.on(v.a.ERROR,(function(e){t._evt.emit(v.a.ERROR,e)}))),this._keyLoader.load(e)},t._isLevelEnd=function(){var e=this.level;return!!(e&&e.hasFrag&&!e.live&&this._pos>=e.fragments.length)},t._nextFragment=function(){var e=this.level,t=null;return e&&this._pos<e.fragments.length&&(t=e.fragments[this._pos]),t&&(t.encrypted&&t.decryptdata&&this._loadKey(t),"number"==typeof t.sn&&this._pos++),t},t._loadFrag=function(e){if(e){var t={url:e.url,responseType:"arraybuffer",progress:e.sn!==jt&&this._type===L.e.MAIN&&this._ctx.streamingMux,frag:e,type:"frag",credentials:this._ctx.config.credentials,headers:this._ctx.config.headers},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;if(Object(ie.a)(i)&&Object(ie.a)(n)&&(t.rangeStart=i,t.rangeEnd=n,t.rangeType=this._ctx.config.httpRangeType),e.sn===jt)t.progress=!1,this._destroyInitLoader(),this._initFragLoader=new B,this._initFragLoader.load(t,this._callback,this._loadConfig);else if(this._destroyLoader(),this._loader=new B,this._loader.load(t,this._callback,this._loadConfig),this._demuxing=!0,this._type===L.e.MAIN&&this._newSource){var r=e.start;this._evt.emit(v.a.NEW_SOURCE,{sync:r}),this._newSource=!1}}},t._preprocessed=function(e,t,i,n){if(this._isReady(e.frag,this._levels[e.frag.level])){if(this._parallelStartCache){this._updateParallelStartCache(e,t,i,n);var r=this._parallelStartCache.data.get(this._parallelStartCache.data.unreadLen);this._parallelStartCache=void 0,r&&(t=r)}this._startDemux(e,t,i,n)}else this._parallelStartCache?this._updateParallelStartCache(e,t,i,n):(this._parallelStartCache={context:e,stats:i,data:new wt.a,progress:n},t&&this._parallelStartCache.data.put(new Uint8Array(t)))},t._updateParallelStartCache=function(e,t,i,n){this._parallelStartCache&&(this._parallelStartCache.context=e,this._parallelStartCache.stats=i,this._parallelStartCache.progress=n,t&&this._parallelStartCache.data.put(new Uint8Array(t)))},t._isReady=function(e,t){return!(e.encrypted&&e.decryptdata&&!e.decryptdata.key||null!=t&&t.initSegment&&!t.initSegment.data)},t._startDemux=function(e,t,i,n){var r,a=this._levels[e.frag.level],s={context:e,data:t,initData:null==a||null==(r=a.initSegment)?void 0:r.data,stats:i,audioCodec:null==a?void 0:a.audioCodec,videoCodec:null==a?void 0:a.videoCodec,remuxContiguous:this._remuxContiguous||(null==a?void 0:a.live),progress:n};n?this._mux.onFragProgress(s):this._ctx.stat.isPreload?this._evt.emit(v.a.PRELOAD_COMPLETE):this._mux.onFragLoaded(s)},s()(e,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._ctx.lctx.getLevel(this._type)}},{key:"index",get:function(){return this._ctx.lctx.getLevelIdx(this._type)}},{key:"manualNext",set:function(e){if(this._type===L.e.MAIN){var t=this.level;if(null!=t&&t.hasFrag){var i=Ot(this._ctx.currentTime+(t.targetduration||5)/2,t.fragments)+1;if(i>0&&i<t.fragments.length){i<this._pos&&(this._resetIO(),this._reset(!1),this._pos=i,this._remuxContiguous=!1),this._newSource=!0,this._ctx.lctx.setNextIdx(e,this._type);var n=t.fragments[this._pos],r=this._fragAlignStart(n);return this._evt.emit(v.a.LEVEL_SWITCHING,{id:0,time:r,level:e,smooth:!0,auto:!1}),(this._fragAlign&&this._fragAlign.frag.sn!==n.sn||!this._fragAlign)&&(this._fragAlign={level:this._ctx.lctx.getLevelIdx(this._type),pos:this._pos,frag:n,alignPTS:r}),this._evt.emit(v.a.BUFFER_CLEANING,{startSec:this._fragAlign.alignPTS||r}),void this._tryLoadNext()}}this._evt.emit(v.a.LEVEL_SWITCH_FAILED)}}},{key:"type",get:function(){return this._type}},{key:"lastLoadedFrag",get:function(){var e=this._pos;return this._loader&&e--,this._getFragByPos(e)}}]),e}(),Gt=function(){function e(e,t){var i=this;this._evt=void 0,this._ctx=void 0,this._loader=void 0,this._loadEnabled=!0,this._pos=0,this._startSN=0,this._callback=void 0,this._loadConfig=void 0,this._fullyLoaded=[],this._tryLoadNext=function(){if(!(i.index<0)){var e=i.level;if(i._loadEnabled&&e&&!i._loader){var t=i._nextFragment();t&&i._loadFrag(t)}}},this._onEnd=function(e,t,n){i._destroyLoader();var r=i._ctx.lctx.subtitleTracks[e.frag.level],a=qe(Ge.SUCCESS,e,n,r.qualityType);i._evt.emit(v.a.DOWNLOAD,a),t&&"string"!=typeof t&&(r&&r.hasFrag&&1===r.fragments.length&&!r.live&&-1===i._fullyLoaded.indexOf(e.frag.level)&&i._fullyLoaded.push(e.frag.level),i._evt.emit(v.a.SUBTITLE_LOADED,{data:t,cc:e.frag.cc,start:e.frag.start})),i._tryLoadNext()},this._onError=function(e,t){var n;i._evt.emit(v.a.DOWNLOAD,qe(Ge.FAIL,e,t,null==(n=i._ctx.lctx.subtitleTracks[e.frag.level])?void 0:n.qualityType)),i._destroyLoader(),i._tryLoadNext()},this._evt=e,this._ctx=t,t.lctx.subtitleIdx=t.lctx.subtitleTracks.reduce((function(e,t,i){return t.default?i:e}),-1),this._callback={onEnd:this._onEnd,onError:this._onError},this._loadConfig={connectionTimeout:t.config.connectionTimeout,transmissionTimeout:t.config.transmissionTimeout,maxRetry:t.config.maxRetry,retryDelay:t.config.retryDelay}}var t=e.prototype;return t.levelUpdated=function(){if(this.level&&this.level.hasFrag){var e=this.level.startSN;Object(ie.a)(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._tryLoadNext()}},t.seek=function(e){if(this.index<0)return 0;var t=this.level;if(-1!==this._fullyLoaded.indexOf(this.index))return e;if(this._loadEnabled=!0,t&&t.hasFrag){var i=0===e?0:Ot(e,t.fragments),n=t.fragments[i];this._loader&&n&&this._loader.context.frag.sn===n.sn&&this._loader.context.frag.level===n.level||(this._pos=i>=0?i:t.fragments.length-1,this._destroyLoader(),this._tryLoadNext())}return e},t.setDownloadEnabled=function(e){!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},t.setIndex=function(e){this._destroyLoader(),this._ctx.lctx.subtitleIdx=e},t._nextFragment=function(){var e=this.level;if(e&&e.hasFrag&&this._pos<e.fragments.length){var t=e.fragments[this._pos];if(t&&"number"==typeof t.sn)return this._pos++,t}},t._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},t._loadFrag=function(e){if(e){var t={url:e.url,responseType:"arraybuffer",frag:e,type:"frag",credentials:this._ctx.config.credentials},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;Object(ie.a)(i)&&Object(ie.a)(n)&&(t.rangeStart=i,t.rangeEnd=n),this._destroyLoader(),this._loader=new B,this._loader.load(t,this._callback,this._loadConfig)}},s()(e,[{key:"levels",get:function(){return this._ctx.lctx.subtitleTracks}},{key:"level",get:function(){return this._ctx.lctx.subtitle}},{key:"index",get:function(){return this._ctx.lctx.subtitleIdx}},{key:"lastLoadedFrag",get:function(){var e=this._pos;if(this._loader&&e--,this.level&&this.level.hasFrag)return this.level.fragments[e]}}]),e}(),Wt=function(){function e(e,t){var i=this;this._evt=void 0,this._abr=void 0,this._ctx=void 0,this._main=void 0,this._audio=void 0,this._timer=void 0,this._seekKeyframe=void 0,this._manifestReady=!1,this._mediaProtocol=void 0,this._subtitle=void 0,this._subtitleStarted=!1,this._onManifestLoaded=function(){A.b.i("hls","_onManifestLoaded");var e=i._ctx,t=e.lctx;if(e.stat.drm&&e.stat.isPreload)i._evt.emit(v.a.ERROR,{type:p.b.OTHER_ERROR,details:p.a.UNSUPPORTED,fatal:!0,reason:"drm no supported preload"});else if(t.audioTracks&&t.audioTracks.length&&(i._audio=new zt(L.e.AUDIO,i._evt,e,t.audioIdx)),t.subtitleTracks&&t.subtitleTracks.length&&(i._subtitle||(i._subtitle=new Gt(i._evt,e)),i._startSubtitle()),t.levels.length>0){var n=0;i._abr&&(n=i._abr.init()||0),i._main=new zt(L.e.MAIN,i._evt,e,n),"boolean"==typeof e.stat.hasVideo&&"boolean"==typeof e.stat.hasAudio&&i._main.trackInfo(e.stat.hasVideo,e.stat.hasAudio),i._evt.emit(v.a.MANIFEST_PARSED),i._abr&&i._ctx.lctx.abr&&i._main.setIndex(i._abr.abrInitLevel),i._manifestReady=!0;var r,a=e.lctx.current;if(!a)return;if(a.hasFrag){if(e.stat.isLive=a.live,i._updateLiveShiftEnabled(a),i._updateLiveDelay(a),i._updateStartSecByLiveDelay(a),i._levelUpdated(L.e.MAIN),a.live){var s=st(null,a,0);i._timer=setTimeout((function(e){return i._loadLevel(e,L.e.MAIN)}),s,i._main.index)}}else i._loadLevel(e.lctx.currentIdx,L.e.MAIN,!0);i._audio&&e.lctx.audioTracks.length&&(null!=(r=e.lctx.audio)&&r.hasFrag?(i._levelUpdated(L.e.AUDIO),a.live&&i._loadLevel(e.lctx.audioIdx,L.e.AUDIO,!0)):i._loadLevel(e.lctx.audioIdx,L.e.AUDIO,!0))}else t.levels.length?i._evt.emit(v.a.ERROR,{type:p.b.MUX_ERROR,details:p.a.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"}):i._evt.emit(v.a.ERROR,{type:p.b.MUX_ERROR,details:p.a.UNSUPPORTED,fatal:!0,reason:"no supported codec"})},this._onAudioLevelLoaded=function(e){i._onLevelLoaded(e,L.e.AUDIO)},this._onSubtitleLevelLoaded=function(e){i._onLevelLoaded(e,L.e.SUBTITLE)},this._onLevelLoaded=function(e,t){void 0===t&&(t=L.e.MAIN);var n=e.level,r=i._ctx,a=i._getTrack(t);if(a&&a.level&&n===a.index){var s=a.level,o=e.details;if((t===L.e.MAIN&&void 0===r.stat.isLive||r.stat.isLive&&!o.live)&&(r.stat.isLive=o.live),t===L.e.MAIN&&0===s.fragments.length&&i._updateLiveShiftEnabled(o),r.stat.isLive){var c=st(s,e.details,e.stats?e.stats.trequest:0);i._updateLiveDelay(o),s.hasFrag?o.endSN!==s.endSN&&(rt(s,o,r.stat.liveShiftEnabled),i._levelUpdated(t)):(rt(s,o,r.stat.liveShiftEnabled),i._updateStartSecByLiveDelay(s),i._levelUpdated(t)),A.b.v("live playlist, reload in "+Math.round(c)+" ms"),i._timer=setTimeout((function(e){return i._loadLevel(e,t)}),c,a.index)}else i._clearLevelTimer(),rt(s,o,r.stat.liveShiftEnabled),i._levelUpdated(t)}},this._onLevelUpdated=function(){i._levelUpdated(L.e.MAIN)},this._onAudioTrackUpdated=function(){i._levelUpdated(L.e.AUDIO)},this._onSubtitleTrackUpdated=function(){i._levelUpdated(L.e.SUBTITLE)},this._levelUpdated=function(e){void 0===e&&(e=L.e.MAIN);var t=i._getTrack(e);if(i._ctx.stat.startFromSec>=0&&i.seek(i._ctx.stat.startFromSec,i._seekKeyframe),t&&t.level&&t.level.hasFrag){t.setDownloadEnabled(!0);var n=[],r=[];t.level.live||t.level.fragments.forEach((function(e){n.push(e.start),"number"==typeof e.programDateTime&&r.push(e.programDateTime)}));var a=t.level.timeInfo;e===L.e.MAIN?i._evt.emit(v.a.LEVEL_UPDATED,a):e===L.e.AUDIO&&i._evt.emit(v.a.AUDIO_TRACK_UPDATED,a),t.levelUpdated(),e!==L.e.SUBTITLE||t.level.live||t.seek(i._ctx.currentTime)}},this._abrNext=function(e){if(i._abr&&i._ctx.lctx.abr&&i._main){var t=i._abr.nextBitrateIndex();t>=0&&t!==i._ctx.lctx.currentIdx&&(i._evt.emit(v.a.LEVEL_SWITCHING,{id:0,time:e.startSec,level:t,smooth:!0,auto:!0}),i.setNextLevel(t))}},this._syncStream=function(e,t){var i=e.lastLoadedFrag,n=t.lastLoadedFrag;i?n&&(n.start+n.duration>i.start+i.duration-.5?t.setDownloadEnabled(!1):t.setDownloadEnabled(!0)):t.setDownloadEnabled(!0)},this._getTrack=function(e){return void 0===e&&(e=L.e.MAIN),e===L.e.MAIN?i._main:e===L.e.AUDIO?i._audio:i._subtitle},this._getTrackLevels=function(e){return void 0===e&&(e=L.e.MAIN),e===L.e.MAIN?i._ctx.lctx.levels:e===L.e.AUDIO?i._ctx.lctx.audioTracks:i._ctx.lctx.subtitleTracks},this._evt=e,this._ctx=t,this._seekKeyframe=t.config.startFromKeyframe}var t=e.prototype;return t.init=function(){var e=this;this._evt.on(v.a.DOWNLOAD,(function(t){e._abr&&e._abr.onDownload(t),e._main&&(e._audio&&e._syncStream(e._main,e._audio),e._subtitle&&e._syncStream(e._main,e._subtitle))})),this._evt.on(v.a.BUFFER_CLEANING,(function(t){e._audio&&e._audio.seek(t.startSec)})),this._initMultirate();var t=Dt[this._ctx.stat.box||L.g.hls];t?(this._mediaProtocol=new t(this._ctx),this._mediaProtocol.on(v.a.MANIFEST_PARSED,this._onManifestLoaded),this._mediaProtocol.on(v.a.LEVEL_LOADED,this._onLevelLoaded),this._mediaProtocol.on(v.a.LEVEL_UPDATED,this._onLevelUpdated),this._mediaProtocol.on(v.a.AUDIO_TRACK_LOADED,this._onAudioLevelLoaded),this._mediaProtocol.on(v.a.AUDIO_TRACK_UPDATED,this._onAudioTrackUpdated),this._mediaProtocol.on(v.a.SUBTITLE_TRACK_LOADED,this._onSubtitleLevelLoaded),this._mediaProtocol.on(v.a.SUBTITLE_TRACK_UPDATED,this._onSubtitleTrackUpdated),this._mediaProtocol.on(v.a.DOWNLOAD,(function(t){e._evt.emit(v.a.DOWNLOAD,t)})),this._mediaProtocol.on(v.a.ERROR,(function(t){var i=e._ctx.lctx.current;!i||e._ctx.stat.isLive||i.hasFrag&&i.live||(t.fatal=!0),e._evt.emit(v.a.ERROR,t)}))):this._evt.emit(v.a.ERROR,{type:p.b.OTHER_ERROR,details:p.a.UNSUPPORTED,fatal:!0,reason:"unsupported box: "+this._ctx.stat.box})},t.destroy=function(){this._mediaProtocol&&(this._mediaProtocol.destroy(),this._mediaProtocol=void 0),this._clearLevelTimer(),this._main&&(this._main.destroy(),this._main=void 0),this._audio&&(this._audio.destroy(),this._audio=void 0),this._abr&&(this._abr.removeAllListeners(),this._abr.destory(),this._abr=void 0)},t.loadSource=function(){this._mediaProtocol&&this._mediaProtocol.loadManifest(this._ctx.src)},t.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._ctx.stat.isNetworkInUse=e,this._main&&this._main.setDownloadEnabled(e),this._abr&&this._abr.setDownloadEnabled(e)},t.isSeekable=function(){return!this._ctx.stat.isLive||!!this._ctx.stat.liveShiftEnabled},t.seek=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),this._abr&&this._abr.onSeek({isInBuffer:i}),!i&&this._main){if(this._main.level&&this._main.level.hasFrag){if(!this._audio)return this._main.seek(e,t),this._subtitle&&this._subtitle.seek(e),void(this._ctx.stat.startFromSec=-1);if(this._audio.level&&this._audio.level.hasFrag&&!this._audio.level.live){var n=this._main.seek(e,t);return this._audio.seek(n),this._subtitle&&this._subtitle.seek(n),void(this._ctx.stat.startFromSec=-1)}}this._ctx.stat.startFromSec=e,this._seekKeyframe=t}},t.nextBackup=function(){if(this._main){var e=this._main.nextBackup(this._ctx.currentTime);if(this._audio&&e&&(e=this._main.nextBackup(this._ctx.currentTime)),e)return this._main.setDownloadEnabled(!1),this._seekKeyframe=!1,this._loadLevel(this._ctx.lctx.currentIdx,L.e.MAIN),this._audio&&(this._audio.setDownloadEnabled(!1),this._loadLevel(this._ctx.lctx.audioIdx,L.e.AUDIO)),!0}return!1},t.onAbrLevelsUpdated=function(){this._abr&&this._abr.onAbrLevelsUpdated()},t.setAudioTrack=function(e){this._audio&&(e=Math.min(e,this._audio.levels.length-1),this._audio.setIndex(e),this._manifestReady&&(this.seek(this._ctx.currentTime),this._checkNextLevel(e,L.e.AUDIO),this._evt.emit(v.a.AUDIO_TRACK_SWITCHING,{id:0,time:this._ctx.currentTime,level:e,smooth:!1,auto:!1})))},t.setSubtitleTrack=function(e){this._subtitle&&(e=Math.min(e,this._subtitle.levels.length-1),this._subtitle.setIndex(e),this._manifestReady&&e>=0&&(this._checkNextLevel(e,L.e.SUBTITLE)||this._subtitle.seek(this._ctx.currentTime)))},t._loadLevel=function(e,t,i){void 0===i&&(i=!1);var n=this._getTrackLevels(t);if(n.length){var r=n[e];r&&"object"==typeof r&&r.url.length>0&&this._mediaProtocol&&this._mediaProtocol.loadLevel(r,t)}},t._clearLevelTimer=function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)},t._initMultirate=function(){var e=this;this._ctx.lctx.abr&&!this._abr&&(this._abr=new tt(this._ctx),this._evt.on(v.a.ABR_NEXT,this._abrNext),this._evt.on(v.a.NEW_SOURCE,(function(t){var i;null==(i=e._abr)||i.onNewSource()})))},t.setCurrentLevel=function(e){e>=0?(this._abrActive(!1),this._main&&(e=Math.min(e,this._main.levels.length-1),this._main.setIndex(e),this._manifestReady&&(this.seek(this._ctx.currentTime),this._checkNextLevel(e),this._evt.emit(v.a.LEVEL_SWITCHING,{id:0,time:this._ctx.currentTime,level:e,smooth:!1,auto:!1})))):this._abrActive(!0)},t.setManualNextLevel=function(e){var t;this._abrActive(e<0),this._manifestReady?null!=(t=this._main)&&t.level&&this._main.level.hasFrag&&e>=0&&(e=Math.min(e,this._main.levels.length-1),this._main.manualNext=e,this._checkNextLevel(e)||this.setDownloadEnabled(!0)):this.setCurrentLevel(e)},t.setNextLevel=function(e){this._main&&this._ctx.lctx.nextIdx!==e&&(this._main.setNext(e),this._checkNextLevel(e))},t._checkNextLevel=function(e,t){void 0===t&&(t=L.e.MAIN);var i=this._getTrack(t);return!(!i||!i.levels||i.levels[e].hasFrag&&!i.levels[e].live)&&(i.setDownloadEnabled(!1),this._loadLevel(e,t),!0)},t._abrActive=function(e){this._abr&&(e&&!this._ctx.lctx.abr&&this._ctx.isAbrAvailable&&this._evt.emit(v.a.LEVEL_SWITCHING,{id:0,time:this._ctx.currentTime,level:-1,smooth:!0,auto:!1}),this._ctx.lctx.abr=e&&this._ctx.isAbrAvailable)},t._startSubtitle=function(){if(!this._subtitleStarted&&this._subtitle){var e=this._ctx.lctx.subtitle;e&&(e.hasFrag?this._levelUpdated(L.e.SUBTITLE):this._loadLevel(this._ctx.lctx.subtitleIdx,L.e.SUBTITLE,!0)),this._subtitleStarted=!0}},t._updateLiveDelay=function(e){if(this._ctx.stat.isLive){var t=this._ctx.config.liveDelayFragNum;t&&t>0?this._ctx.stat.multipartLiveDelay=-t*(e.averagetargetduration?e.averagetargetduration:e.targetduration)*1e3:this._ctx.stat.liveShift=!0}},t._updateStartSecByLiveDelay=function(e){var t=this._ctx;t.stat.isLive&&(t.stat.multipartLiveDelay&&-1===t.stat.startFromSec&&e.totalduration?(t.stat.startFromSec=t.liveStartLocalTime,A.b.i("hls","live delay: "+t.stat.multipartLiveDelay/1e3+" start src: "+t.stat.startFromSec),t.stat.liveShiftEnabled&&(t.stat.liveShift=!1)):t.stat.startFromSec>=0&&t.stat.liveShiftEnabled&&(t.stat.liveShift=!0))},t._updateLiveShiftEnabled=function(e){var t=this._ctx,i=e.fragments.length&&0===e.startSN;t.stat.liveShiftEnabled=!!(i&&e.live&&t.config.liveShiftEnabled),e.live&&!t.stat.liveShiftEnabled&&(t.stat.startFromSec=-1)},s()(e,[{key:"mediaTrackNum",get:function(){return this._audio?2:1}},{key:"audioTracks",get:function(){return this._audio?this._audio.levels:[]}}]),e}();function Kt(e,t){if(void 0===t)return e;var i=new C.a(e,!0);return t&&(i.query.kabr_spts=""+t),i.toString()}var Qt,Yt=function(){function e(){var e=this;this._context=void 0,this._result=void 0,this._callback=void 0,this._loader=void 0,this._loaderConf=void 0,this._loaderCallbacks=void 0,this._timer=void 0,this._startTime=0,this._testEnd=function(){e._stopTimer(),e._loader&&e._loader.destroy(),e._context&&e._result&&e._callback&&(e._result.firstPackageDuration=Math.round(e._result.firstPackageDuration),e._result.duration=Math.round(performance.now()-e._startTime),e._callback.onEnd(e._context,e._result))},this._onProgress=function(t,i,n){e._result&&(e._result.firstPackageDuration=n.tfirst?n.tfirst-n.trequest:0,e._result.loaded=n.loaded)},this._onLoaderError=function(t,i){e._result&&(e._result.succeeded=!1),e._testEnd()},this._onLoaderEnd=function(){e._testEnd()},this._loaderConf={connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0,useFetch:!0},this._loaderCallbacks={onProgress:this._onProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd}}var t=e.prototype;return t.start=function(e,t){this._context=e,this._callback=t,this._result={loaded:0,duration:0,firstPackageDuration:0,succeeded:!0},this._startTime=performance.now(),this._loader&&this._loader.destroy();var i=Math.min(1e4,e.timeout);this._loaderConf.connectionTimeout=i;var n={url:e.url,progress:!0,responseType:"arraybuffer"};this._loader=new B,this._startTimer(i),this._loader.load(n,this._loaderCallbacks,this._loaderConf)},t.cancel=function(){this._stopTimer(),this._loader&&this._loader.destroy()},t.destroy=function(){this.cancel()},t._startTimer=function(e){var t=this;this._timer=setTimeout((function(){return t._testEnd()}),e)},t._stopTimer=function(){clearTimeout(this._timer)},e}(),Xt={stableBufferDiffThresholdSecond:.15,stableBufferIntervalMs:2e3,speedTestTimeoutMs:500,generateSpeedGapMs:3e3,bufferCheckIntervalMs:500,smoothedSpeedUtilizationRatio:.8,smallSpeedToBitrateRatio:.7,enoughSpeedToBitrateRatio:.9,bufferLowerLimitSecond:.8,recentBufferedSize:16,smoothedSpeedRatio:.9,isSpeedFullyUsed:!1},qt=function(){function e(e){this._ctx=void 0,this._conf=void 0,this._pastBuffer=void 0,this._levels=void 0,this._current=0,this._next=0,this._stableBufferStartTime=performance.now(),this._speedTester=new Yt,this._generatedSpeed=0,this._lastCheckBuffer=0,this._lastSpeed=0,this._timer=void 0,this._ctx=e}var t=e.prototype;return t.init=function(e){var t=this;this._conf=r()({},Xt),r()(this._conf,e),A.b.i("algorithm-simple","init",e,this._conf),this._pastBuffer=[0],this._timer=setInterval((function(){t._checkBuffer()}),this._conf.bufferCheckIntervalMs)},t.onManifestUpdated=function(){this._levels=this._ctx.lctx.abrLevels.slice(0),this._next=this._ctx.lctx.abrDefault},t.onKeyPoint=function(e){var t=e.byteLength/Math.max(e.spendTime,.05)*8/1024;A.b.i("algorithm-simple","buffered: "+e.byteLength.toFixed(2)+", size: "+e.byteLength+", time: "+e.spendTime.toFixed(2)),this._next=this._nextRateIndex(t,e.buffered)},t.onLevelLoad=function(e){this._current=Math.max(0,e)},t.onSeek=function(e){},t.onDownloadEnabled=function(e){},t.destroy=function(){this._speedTester.destroy(),clearInterval(this._timer)},t._updateStableBuffer=function(e){var t=e-this._lastCheckBuffer,i=t/e,n=performance.now();return(t<-this._conf.stableBufferDiffThresholdSecond||i<-.2)&&(A.b.v("algorithm-simple","bufferDiffDown: "+t.toFixed(2)+"s, diffRatio: "+i.toFixed(2)),this._stableBufferStartTime=Math.max(n,this._stableBufferStartTime)),t>this._conf.stableBufferDiffThresholdSecond&&n-this._stableBufferStartTime+this._conf.bufferCheckIntervalMs>this._conf.stableBufferIntervalMs&&(this._stableBufferStartTime=Math.max(n-2*this._conf.bufferCheckIntervalMs,this._stableBufferStartTime+2*this._conf.bufferCheckIntervalMs),A.b.v("algorithm-simple","bufferDiffUp: "+t.toFixed(2)+"s")),this._lastCheckBuffer=e,n-this._stableBufferStartTime>this._conf.stableBufferIntervalMs},t._isSpeedFullyUsed=function(){return this._conf.isSpeedFullyUsed},t._checkBuffer=function(){var e=this._ctx.bufferedSec,t=this._updateStableBuffer(e);this._isSpeedFullyUsed()?t&&this._current+1<this._levels.length?this._generatedSpeed=this._levels[this._current+1].bitrate:this._generatedSpeed=0:t&&this._current+1<this._levels.length&&this._ctx.lctx.abr&&this._ctx.config.abrSpeedTest&&(this._startTesting(),this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),this._pastBuffer.push(e),this._pastBuffer.length>this._conf.recentBufferedSize&&this._pastBuffer.shift()},t._startTesting=function(){var e=this;A.b.v("algorithm-simple","start speed testing on index: "+(this._current+1));var t=this._ctx.loadRec.traffic,i=this._levels[this._current+1].bitrate;this._speedTester.start({url:this._levels[this._current+1].url[this._levels[this._current+1].urlId],timeout:this._conf.speedTestTimeoutMs},{onEnd:function(n,r){var a=e._ctx.loadRec.traffic-t;if(r.succeeded&&r.duration>0&&r.firstPackageDuration>0){var s=8*(a+r.loaded)/r.duration;A.b.v("algorithm-simple","testSpeed: "+s.toFixed(0)),s>=i&&(e._generatedSpeed=i)}A.b.v("algorithm-simple","succeeded: "+r.succeeded+", firstPackageDuration: "+r.firstPackageDuration+", originalDownloadSize: "+a+", downloadSize: "+r.loaded+", downloadTime: "+r.duration)}})},t._quantization=function(e){for(var t=0,i=this._levels.length-1;i>=0;i--)if(e>=this._levels[i].bitrate){t=i;break}return t},t._nextRateIndex=function(e,t){var i=this._nextRateBySpeedAndBuffered(e,t);return i!=this._current&&(this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),i<this._current?(this._speedTester.cancel(),this._generatedSpeed=0,this._lastSpeed=e,this._pastBuffer=[t]):this._lastSpeed=this._getSmoothedSpeed(e),i},t._getSmoothedSpeed=function(e){return this._lastSpeed>0?e*(1-this._conf.smoothedSpeedRatio)+this._lastSpeed*this._conf.smoothedSpeedRatio:e},t._getPredictedBuffer=function(e){return e+(e-Math.max.apply(Math,this._pastBuffer))},t._getBufferSpeed=function(e){var t=Math.max.apply(Math,this._pastBuffer);return(1+(e-t)/t)*this._levels[this._current].bitrate},t._isSpeedTooSmall=function(e){return e/this._levels[this._current].bitrate<this._conf.smallSpeedToBitrateRatio},t._isSpeedEnough=function(e){return e/this._levels[this._current].bitrate>this._conf.enoughSpeedToBitrateRatio},t._nextRateBySpeedAndBuffered=function(e,t){var i=this._getBufferSpeed(t),n=this._getSmoothedSpeed(e);A.b.v("algorithm-simple","gopSpeed: "+e.toFixed(0)+", smoothedSpeed: "+n.toFixed(0));var r=this._getPredictedBuffer(t);A.b.v("algorithm-simple","bufferSpeed: "+i.toFixed(0)+", predictedBuffered: "+r.toFixed(1));var a=this._current;return r<this._conf.bufferLowerLimitSecond||this._isSpeedTooSmall(i)?a=Math.min(this._current,this._quantization(i)):this._isSpeedEnough(i)&&(this._generatedSpeed>0?(A.b.i("algorithm-simple","generatedSpeed used"),a=this._quantization(this._generatedSpeed),this._generatedSpeed=0):a=this._quantization(n*this._conf.smoothedSpeedUtilizationRatio),a=Math.min(this._current+1,Math.max(a,this._current))),a},s()(e,[{key:"nextLevel",get:function(){return A.b.v("algorithm-simple","nextLevel: "+this._next),this._next}},{key:"lowProfile",get:function(){return!1}}]),e}(),Zt=function(){function e(e,t){this._evt=void 0,this._ctx=void 0,this._smooth=void 0,this._downloadSize=0,this._downloadStartTime=0,this._keyCount=0,this._index=0,this._algorithm=void 0,this._evt=e,this._ctx=t,t.lctx.abr=t.isAbrAvailable,this._algorithm=new qt(t)}var t=e.prototype;return t.init=function(){return this._downloadSize=0,this._downloadStartTime=performance.now(),this._keyCount=0,this._algorithm.init(this._ctx.config.liveAdaptiveConfig),this._algorithm.onManifestUpdated(),this._ctx.lctx.levels.length&&(this._ctx.lctx.abr?this._index=this._ctx.lctx.abrIndexToOrign(this._algorithm.nextLevel):this._index=this._ctx.lctx.default,this._evt.emit(v.a.MANIFEST_PARSED)),this._index},t.destory=function(){this._algorithm&&this._algorithm.destroy()},t.onAbrLevelsUpdated=function(){this._algorithm.onManifestUpdated(),this._index=this._ctx.lctx.abrIndexToOrign(this._algorithm.nextLevel)},t.onLoaderChunk=function(e){this._downloadSize+=e},t.onLevelLoad=function(e){var t=this._ctx.lctx;t.levels.length&&e>=0&&e<t.levels.length&&(this._keyCount=0,this._downloadStartTime=performance.now(),this._downloadSize=0,this._index=e,this._algorithm.onLevelLoad(t.orignIndexToAbr(e)))},t.onKeyFrame=function(e){var t=this._ctx,i=t.lctx.levels;if(this._keyCount++,(t.lctx.abr||"number"==typeof this._smooth)&&this._keyCount>1&&i){var n=this._index,r=!1,a=performance.now();if(this._algorithm.onKeyPoint({buffered:t.bufferedSec,byteLength:this._downloadSize,spendTime:(a-this._downloadStartTime)/1e3}),this._downloadSize=0,this._downloadStartTime=a,"number"==typeof this._smooth)n=this._smooth,this._smooth=void 0;else{if(!t.lctx.abr||!this._algorithm)return;n=t.lctx.abrIndexToOrign(this._algorithm.nextLevel),r=!0}if(n!==this._index)return{url:this.getRequestUrl(n,e),level:n,auto:r}}},t.getRequestUrl=function(e,t){var i=this._ctx.src,n=this._ctx.lctx.levels[e];return n&&(i=n.currentUrl),this._ctx.stat.box===L.g.flv?Kt(i,t||this._ctx.config.defaultSpts):i},s()(e,[{key:"nextLevel",get:function(){return"number"==typeof this._smooth?this._smooth:this._index},set:function(e){var t=this._ctx.lctx;A.b.i("single-abr","next level: "+e),e>=0?(e=Math.min(t.levels.length-1,e),t.setNextIdx(e),t.abr=!1,this._smooth=e):-1===e&&(t.abr=this._ctx.isAbrAvailable)}},{key:"currentLevel",get:function(){return this._index},set:function(e){var t=this._ctx.lctx;A.b.i("single-abr","current level: "+e),e>=0?(e=Math.min(t.levels.length-1,e),t.setLevelIdx(e),t.abr=!1,this._index=e):-1===e&&(t.abr=this._ctx.isAbrAvailable)}}]),e}(),Jt=i(16);!function(e){e[e.tagType=0]="tagType",e[e.tagSize=1]="tagSize",e[e.timestamp=2]="timestamp",e[e.frameType=3]="frameType",e[e.packetType=4]="packetType"}(Qt||(Qt={}));var $t,ei=function(){function e(){this._pos=0,this._isFlv=void 0,this._header=new Uint8Array(Jt.a),this._headerPos=0,this._detectType=Qt.tagType,this._tagSize=0,this._tagSizeLen=0,this._timestamp=0,this._timestampLen=0,this._tagType=0,this._frameType=0,this._keyframeList=[],this.reset()}var t=e.prototype;return t.reset=function(){A.b.i("flv-key-detector","reset"),this._pos=Jt.a,this._isFlv=void 0,this._header=new Uint8Array(Jt.a),this._headerPos=0,this._detectType=Qt.tagType,this._tagSize=0,this._tagSizeLen=3,this._timestamp=0,this._timestampLen=4,this._tagType=0,this._frameType=0,this._keyframeList=[]},t.append=function(e){if(!1===this._isFlv)return[];if(void 0===this._isFlv&&(e.length+this._headerPos>=Jt.a?(this._header.set(e.subarray(0,Jt.a-this._headerPos),this._headerPos),this._headerPos=Jt.a,this._isFlv=70===this._header[0]&&76===this._header[1]&&86===this._header[2],A.b.i("flv-key-detector","get header: "+this._isFlv)):(this._header.set(e,this._headerPos),this._headerPos+=e.length)),this._pos>e.byteLength)return this._pos-=e.byteLength,[];this._keyframeList=[];for(var t=this._pos,i=0;t<e.byteLength;)switch(this._detectType){case Qt.tagType:this._tagType=e[t],this._tagSize=0,this._tagSizeLen=3,i=t,t++,this._detectType=Qt.tagSize;break;case Qt.tagSize:if(this._tagSize=this._tagSize+(e[t]<<8*(this._tagSizeLen-1)),this._tagSizeLen--,t++,this._tagSizeLen>0)break;this._tagType===Jt.f.VIDEO?(this._timestamp=0,this._timestampLen=4,this._detectType=Qt.timestamp):(t+=7+this._tagSize+4,this._detectType=Qt.tagType);break;case Qt.timestamp:this._timestamp+=1===this._timestampLen?e[t]<<24:e[t]<<8*(this._timestampLen-2),this._timestampLen--,t++,0===this._timestampLen&&(t+=3,this._frameType=0,this._detectType=Qt.frameType);break;case Qt.frameType:this._frameType=e[t]>>4,t++,this._detectType=Qt.packetType;break;case Qt.packetType:1===this._frameType&&1===e[t]&&this._keyframeList.push({timestamp:this._timestamp,pos:i}),t+=this._tagSize-1+4,this._detectType=Qt.tagType}return this._pos=t-e.byteLength,this._keyframeList},s()(e,[{key:"isFlv",get:function(){return this._isFlv}},{key:"header",get:function(){return this._isFlv?this._header:void 0}}]),e}(),ti=i(23),ii=i(31),ni=i(19),ri=i(29),ai=i(11),si=i(33),oi=i(15),ci=["mono","4:2:0","4:2:2","4:4:4"],ui={colorRange:oi.b.AVCOL_RANGE_JPEG,colourPrimaries:oi.a.AVCOL_PRI_BT2020,transferCharacteristics:oi.d.AVCOL_TRC_SMPTEST2084,matrixCoefficients:oi.c.AVCOL_SPC_BT2020_CL},di=function(){function e(e,t,i){this._id=void 0,this._evt=void 0,this._internalEvt=void 0,this._ctx=void 0,this._cache=new wt.a,this._ended=!1,this._timeOffset=-1,this._frameIdx=0,this._remuxer=void 0,this._firstRemux=!0,this._videoTrack=void 0,this._audioTrack=void 0,this._slientAudio=void 0,this._contiguous=!1,this._accurateTimeOffset=!1,this._frameDuration=0,this._params=void 0,this._progressTime=0,this._decode=0,this._fullFrameInfo=void 0,this._duration=0,this._id=i,this._evt=e,this._ctx=t,this._slientAudio=new ii.a,this._internalEvt=new b.a,this._remuxer=new ri.b(this._evt,t.getRemuxConfig(),tn.TYPE_SUPPORTED)}var t=e.prototype;return t.init=function(){this._evt.emit(v.a.DEMUXER_DETECTED,{type:ai.b.YUV}),this._ctx.cOutput.updateRendererType(L.o.canvas),this._initTrack(0)},t.destroy=function(){this._cache.clear(),this._internalEvt.removeAllListeners(),this._remuxer.destroy()},t.trackInfo=function(e,t){},t.reset=function(e){A.b.i("yuv","reset: "+e),this._ended=!1,this._timeOffset=-1,this._slientAudio&&this._slientAudio.reset(),this._firstRemux=!1},t.end=function(){this._ended||(this._ended=!0,this._evt.emit(v.a.LOAD_END))},t.onFragProgress=function(e){this._append(e,!1)},t.onFragLoaded=function(e){this._append(e,!0)},t.updateConfig=function(){},t.updateSuffix=function(e){},t._append=function(e,t){if(e.data&&e.data.byteLength){var i=performance.now(),n={progress:e.context.progress,byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest),ts:performance.now()};this._progressTime=i,this._evt.emit(v.a.LOADER_CHUNK_ARRIVAL,n)}var r=e.context.frag,a=this._videoTrack;if(a)if(this._checkParams(),this._params){var s=this._params;if(s){var o,c=r.start||0;for(this._timeOffset!==c?(this._frameIdx=Math.floor(c/(1/s.fps)),this._timeOffset=c,this._contiguous=!1,this._accurateTimeOffset=!1,this._remuxer.resetInitSegment({duration:this._duration,remuxId:0})):this._accurateTimeOffset=!0,e.data&&this._cache.put(new Uint8Array(e.data)),a.width||(a.width=s.width,a.height=s.height,a.fps=s.fps,a.bitDepth=s.bpp,a.codecType=L.b.rawvideo);o=this._getFrame();){var u=Math.floor(this._frameIdx*this._frameDuration);o.format.pts=u/a.inputTimescale*d.a,this._frameIdx++,a.samples.push({units:[],dts:u,cts:0,pts:u,originDTS:u,key:!0,yuv:o,duration:this._frameDuration}),this._decode++}this._ctx.updateVideoPlaybackQuality(this._decode,0),this._remux(t),t&&(this._progressTime=0,this._duration||(this._duration=this._frameIdx/s.fps,this._evt.emit(v.a.METADATA,{duration:this._duration})))}}else this._evt.emit(v.a.ERROR,{type:p.b.MUX_ERROR,details:p.a.PARSING_ERROR,fatal:!0,reason:"yuv params error. "+JSON.stringify(this._params)})},t._initTrack=function(e){this._videoTrack=Object(ni.b)(e),this._videoTrack.active=!0,this._videoTrack.outputRaw=!0,this._videoTrack.codec="yuv",this._audioTrack=Object(ni.a)(e),ti.a.initAudioForFillSilent(this._audioTrack,this._ctx.stat.audioCodec)},t._getFrame=function(){if(this._params){var e=this._params.dataSize;if(e)return this._cache.unreadLen>=e?this._getFrameData():void 0;this._evt.emit(v.a.ERROR,{type:p.b.MUX_ERROR,details:p.a.REMUX_ERROR,fatal:!0,reason:"yuv params error, can not get img size. "+JSON.stringify(this._params)})}},t._checkParams=function(){if(!this._params){var e;if(this._params=this._ctx.yuvParams,this._params&&this._videoTrack){this._params.bpp>8&&(this._videoTrack.colorInfo=ui);var t={};if(this._frameDuration=Math.round(this._videoTrack.inputTimescale/this._params.fps),this._videoTrack&&(this._videoTrack.chromaFormat=ci[this._params.chroma]),this._ctx.loadRec.contentLen){this._fullFrameInfo=[];var i=Math.floor(this._ctx.loadRec.contentLen/this._params.dataSize);this._duration=t.duration=i/this._params.fps;for(var n=[],r=0;r<i;r++){var a=r*this._frameDuration/this._videoTrack.inputTimescale;this._fullFrameInfo.push({index:r,dts:a,pts:a,duration:this._frameDuration}),n.push({time:a,position:this._params.dataSize*r})}t.keyframes=n}this._evt.emit(v.a.METADATA,t),this._fullFrameInfo&&this._evt.emit(v.a.VIDEO_FRAME_INFO,{videoFramesInfo:this._fullFrameInfo})}return this._evt.emit(v.a.VIDEO_CODEC_DETECTED,{decoder:L.c.none,enabled:!0,codecType:L.b.yuv,bitDepth:null==(e=this._params)?void 0:e.bpp,timeOffset:0}),this._params}},t._getFrameData=function(){var e=this._params;if(e){var t=this._cache,i=e.bpp>8?2:1,n=t.get(e.width*e.height*i),a=t.get(e.chromaWidth*e.chromaHeight*i),s=t.get(e.chromaWidth*e.chromaHeight*i);return n&&a&&s?{format:r()({},e),y:{bytes:n,stride:e.width*i,bits:e.bpp},u:{bytes:a,stride:e.chromaWidth*i,bits:e.bpp},v:{bytes:s,stride:e.chromaWidth*i,bits:e.bpp}}:void 0}},t._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack;if(i&&t)if(this._slientAudio.update(t,i),0!==t.samples.length||0!==i.samples.length){if(e||!(t.active&&0===t.samples.length||i.active&&i.samples.length<2)){if(this._firstRemux&&(this._duration||this._evt.emit(v.a.KEY_FRAME_INDEXS,{keyframes:[{time:0,position:0}]}),this._firstRemux=!1,this._evt.emit(v.a.MEDIA_DEMUX,{type:ai.b.YUV})),!this._fullFrameInfo){var n=Object(si.a)(i,this._frameIdx-i.samples.length);this._evt.emit(v.a.VIDEO_FRAME_INFO,{videoFramesInfo:n})}try{this._remuxer.remux(t,i,this._timeOffset,this._contiguous,this._accurateTimeOffset,e),this._contiguous=!0}catch(e){A.b.e("yuv",e),this._evt.emit(v.a.ERROR,{type:p.b.MUX_ERROR,details:p.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},s()(e,[{key:"totalDuration",set:function(e){}},{key:"id",get:function(){return this._id}}]),e}(),_i=i(4);!function(e){e[e.flvHeader=0]="flvHeader",e[e.scriptData=1]="scriptData",e[e.audio=2]="audio",e[e.video=3]="video",e[e.seliceSeq=4]="seliceSeq"}($t||($t={}));var hi,li=function(){function e(){this._cache=new wt.a,this._slices=[],this._current=this._newSlice(),this._flvHead=0}var t=e.prototype;return t.reset=function(){A.b.i("kwai-slice","reset"),this._cache.clear(),this._slices=[],this._current=this._newSlice(),this._flvHead=0},t.append=function(e){for(this._cache.put(new Uint8Array(e));this._cache.unreadLen>=(this._current.bodyLen||15);)this._current.bodyLen?this._readSliceBody():this._readSliceHead();var t=this._slices.reduce((function(e,t){var i;return((null==(i=t.data)?void 0:i.byteLength)||0)+e}),0);if(t){var i=new Uint8Array(t),n=0;return this._slices.forEach((function(e){e.data&&(i.set(e.data,n),n+=e.data.byteLength)})),this._slices=[],i.buffer}},t._readSliceHead=function(){if(this._cache.unreadLen>=15){var e=this._cache.get(15);if(!e)throw new Error("kwai-slice read slice_header fail");var t=this._current;if(t.bodyLen=(e[0]<<4)+(e[1]>>4)-15,t.type=15&e[1],t.sliceSeq=Object(_i.h)(e,2),t.segmentId=Object(_i.g)(e,10),t.posFlag=e[14]>>6,t.frameType=e[14]>>4&3,t.extended=1&e[14],t.bodyLen<=0)throw this._current=this._newSlice(),new Error("kwai-slice slice body len: "+t.bodyLen)}},t._readSliceBody=function(){var e=this._current;if(e.bodyLen&&this._cache.unreadLen>=e.bodyLen){var t=this._cache.get(e.bodyLen);if(!t)throw new Error("kwai-slice read slice_body fail");var i=0;e.extended&&(i+=Object(_i.e)(t));var n=t.subarray(i);t.length>3&&70===t[i]&&76===t[i+1]&&86===t[i+2]&&(this._flvHead>0&&(n=n.subarray(13)),this._flvHead++),e.data=n,this._slices.push(e),this._current=this._newSlice()}},t._newSlice=function(){return{bodyLen:0,type:$t.flvHeader,sliceSeq:0,segmentId:0,posFlag:0,frameType:0,extended:0}},e}(),fi=function(){function e(e,t){var i=this;this._callback=void 0,this._ctx=void 0,this._context=void 0,this._contentTotalLen=0,this._loader=void 0,this._internalCallback=void 0,this._loaderConfig=void 0,this._slice=void 0,this._firstReq=!0,this._ended=!1,this._pos=void 0,this._nextRangeStart=0,this._downloadEnabled=!0,this._currentReqLen=0,this._connetced=!1,this._rangeWithoutPreflight=!1,this._defaultRangeLen=d.d,this._onLoaderConnect=function(e,t){i._updateContentLen(t),!i._connetced&&i._callback.onConnect&&i._callback.onConnect(e,t),i._connetced=!0},this._onLoaderProgress=function(e,t,n){var r;"string"!=typeof t&&(i._currentReqLen+=t.byteLength,!e.rangeEnd&&i._currentReqLen>=i._defaultRangeLen&&!1===i._ctx.stat.isLive&&(!i._contentTotalLen||i._contentTotalLen&&i._currentReqLen<i._contentTotalLen)&&(null==(r=i._loader)||r.abort(),i._destroyLoader(),i._nextRangeStart=i._currentReqLen,i._request()),i._callbackProgress(e,t,n))},this._onLoaderAbort=function(e,t){i._callback.onAbort&&i._callback.onAbort(e,t),i._destroyLoader()},this._onLoaderError=function(e,t){t.fatal&&(i._destroyLoader(),i._ctx.stat.isNetworkInUse=!1),416===t.code&&(!i._contentTotalLen||e.rangeEnd&&e.rangeEnd>=i._contentTotalLen)?(A.b.i("media-loader","416 end"),i._ended=!0,i._destroyLoader(),i._callbackEnd(e,null,t)):i._callback.onError&&i._callback.onError(e,t)},this._onLoaderEnd=function(e,t,n){if(e.range&&i._callback.onRangeEnd&&i._callback.onRangeEnd(e,n),i._updateContentLen(n),i._destroyLoader(),"string"!=typeof t){var r=(null==t?void 0:t.byteLength)||0;!i._ctx.stat.isLive&&t&&i._callbackProgress(e,t,n),(!e.range||"number"==typeof e.rangeStart&&e.rangeEnd&&e.rangeEnd-e.rangeStart>i._currentReqLen+r||i._contentTotalLen&&e.rangeEnd&&e.rangeEnd>=i._contentTotalLen)&&(A.b.i("media-loader","end true"),i._ended=!0),i._ended||i._ctx.stat.isLive?(n.fatal&&(i._ctx.stat.isNetworkInUse=!1),i._callbackEnd(e,null,n)):(e.rangeEnd&&(i._nextRangeStart=e.rangeEnd),i._request())}},this._callback=e,this._ctx=t,this._internalCallback={onConnect:this._onLoaderConnect,onEnd:this._onLoaderEnd,onError:this._onLoaderError,onAbort:this._onLoaderAbort,onProgress:this._onLoaderProgress},this._loaderConfig={connectionTimeout:t.config.connectionTimeout,transmissionTimeout:t.config.transmissionTimeout};var n=this._ctx.src instanceof Blob;t.stat.box===L.g.yuv&&t.yuvParams?this._defaultRangeLen=t.yuvParams.dataSize:this._defaultRangeLen=n?d.b:d.d,n&&(this._ctx.loadRec.contentLen=this._contentTotalLen=this._ctx.src.size),R.a.version&&(this._rangeWithoutPreflight="chrome"===R.a.name&&R.a.version.major>=99),A.b.i("media-loader","without preflight: "+this._rangeWithoutPreflight+"; range size: "+this._defaultRangeLen,this._contentTotalLen),this.updateConfig()}var t=e.prototype;return t.load=function(e){A.b.i("media-loader","load"),this._destroyLoader(),this._firstReq=!0,this._connetced=!1,this._context=e,je(e.url)?(A.b.i("media-loader","kwai slice"),this._ctx.stat.isKwaiSlice=!0,this._slice?this._slice.reset():this._slice=new li):this._ctx.stat.isKwaiSlice=!1,this._context.progress=this._ctx.streamingMux,this._context.responseType="arraybuffer",this._context.credentials=this._ctx.config.credentials,this._context.headers=this._ctx.config.headers,this._request()},t.seek=function(e){var t;A.b.i("media-loader","seek time:"+e.time+", pos:"+e.position),null==(t=this._loader)||t.abort(),this._destroyLoader(),this._downloadEnabled=!0,this._pos=e,this._ended=!1,this._request()},t.updateConfig=function(){var e=this._ctx;A.b.i("media-loader","update loader config"),this._loaderConfig.maxRetry=e.stat.isLive?0:e.config.maxRetry,this._loaderConfig.retryDelay=e.stat.isLive?0:e.config.retryDelay,this._loaderConfig.useFetch=e.stat.isLive||void 0===e.stat.isLive,this._loaderConfig.breakpointContinuation=!(e.stat.box===L.g.flv&&e.stat.isLive)&&e.config.breakpointContinuation},t.destroy=function(){this._destroyLoader()},t.ended=function(){return this._ended},t.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._downloadEnabled!==e&&(this._downloadEnabled=e,e&&!this._loader&&this._request())},t._request=function(){if(this._downloadEnabled&&!this._ended&&this._context)if(this._destroyLoader(),this._pos&&(this._nextRangeStart=this._pos.position,this._context.frag.start=this._pos.time,this._pos=void 0),this._contentTotalLen&&this._nextRangeStart>=this._contentTotalLen)this._ctx.stat.isNetworkInUse=!1;else{var e=this._context;this._ctx.stat.isLive?this._firstReq=!1:(this._context.progress=this._ctx.streamingMux,!this._firstReq||!e.progress||"string"!=typeof e.url||this._rangeWithoutPreflight&&void 0!==this._ctx.stat.isLive?(this._firstReq=!1,e.rangeStart=this._nextRangeStart,e.rangeEnd=(Math.floor(this._nextRangeStart/this._defaultRangeLen)+1)*this._defaultRangeLen,e.rangeType=this._ctx.config.httpRangeType,this._checkEnd(e)):this._firstReq=!1),this._ctx.stat.isNetworkInUse=!0,this._currentReqLen=0,this._loader=new B,this._loader.load(e,this._internalCallback,this._loaderConfig)}else this._ctx.stat.isNetworkInUse=!1},t._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},t._callbackProgress=function(e,t,i){if(this._callback.onProgress)if(this._ctx.stat.isKwaiSlice){var n=this._unpackSlice(e,t,i);n&&this._callback.onProgress(e,n,i)}else this._callback.onProgress(e,t,i)},t._callbackEnd=function(e,t,i){if(this._ctx.stat.isKwaiSlice&&t){var n=this._unpackSlice(e,t,i)||null;this._callback.onEnd(e,n,i)}else this._callback.onEnd(e,t,i)},t._unpackSlice=function(e,t,i){if(this._ctx.stat.isKwaiSlice&&this._slice)try{return this._slice.append(new Uint8Array(t))}catch(t){i.fatal=!0,i.text=t.message,this._callback.onError&&this._callback.onError(e,i)}},t._checkEnd=function(e){e.rangeEnd&&this._contentTotalLen&&e.rangeEnd>this._contentTotalLen&&(this._ended=!0)},t._updateContentLen=function(e){!this._contentTotalLen&&e.contentTotalLength&&(this._ctx.loadRec.contentLen=this._contentTotalLen=e.contentTotalLength)},e}(),pi=i(40),vi=/\.(\w)+$/,mi=function(){function e(e,t){var i=this;this._evt=void 0,this._ctx=void 0,this._loader=void 0,this._loaderCallbacks=void 0,this._multirate=void 0,this._baseTimeSec=0,this._ready=!1,this._remuxContiguous=!1,this._flvKeyDetector=void 0,this._metadata=void 0,this._keyframes=void 0,this._appendFLVHead=!1,this._faststart=!0,this._loadEndCallbackonMeta=!1,this._hasContentLength=!1,this._mux=void 0,this._onLoaderProgress=function(e,t,n){if(t instanceof ArrayBuffer){var a,s;if(i._multirate&&i._multirate.onLoaderChunk(t.byteLength),i._flvKeyDetector&&!1!==i._flvKeyDetector.isFlv){var o=i._flvKeyDetector.append(new Uint8Array(t));if(i._multirate&&i._ctx.lctx.levels.length>1)for(var c=0;c<o.length;c++)if(void 0===i._ctx.localTimeOffset&&(i._ctx.localTimeOffset=o[c].timestamp/d.f),i._multirate&&(a=i._multirate.onKeyFrame(o[c].timestamp))){var u=new Uint8Array(o[c].pos);u.set(new Uint8Array(t).subarray(0,o[c].pos)),t=u.buffer;var _=r()({},a);_.smooth=!0,_.timestamp=o[c].timestamp,_.startSec=i._baseTimeSec||i._ctx.currentTime,i._evt.emit(v.a.LEVEL_SWITCHING,_),i._baseTimeSec=i._ctx.getLocalTime(o[c].timestamp/d.f)||0;break}}i._appendFLVHead&&(null!=(s=i._flvKeyDetector)&&s.header&&(t=i._onFlvSeekFirstChunk(t)),i._appendFLVHead=!1);var h={context:e,data:t,stats:n,remuxContiguous:i._remuxContiguous,progress:!0};a?(i._remuxContiguous||(i._remuxContiguous=!0),i._mux.onFragLoaded(h),i._flvKeyDetector&&i._flvKeyDetector.reset(),i._load(a.url,a.level)):i._mux.onFragProgress(h)}},this._onLoaderConnect=function(e,t){if(void 0===i._ctx.stat.box||i._ctx.stat.box===L.g.unknown){var n,r=null==(n=e.responseHeader)?void 0:n["content-type"];r&&(i._ctx.stat.box=yt(Array.isArray(r)?r[0]:r).box)}i._hasContentLength=!(!t.contentLength&&!t.contentTotalLength),A.b.i("single","on connect. contentLength: "+t.contentLength+" contentTotalLength: "+t.contentTotalLength),i._evt.emit(v.a.MEDIA_CONNECTED,{headers:e.responseHeader})},this._onLoaderAbort=function(e,t){i._onDownload(Ge.ABORT,e,t)},this.onLoaderRangeEnd=function(e,t){i._onDownload(Ge.SUCCESS,e,t)},this._onLoaderError=function(e,t){if(i._onDownload(Ge.FAIL,e,t),t.fatal){var n={type:p.b.NETWORK_ERROR,details:p.a.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url};i._evt.emit(v.a.ERROR,n)}},this._onLoaderEnd=function(e,t,n){i._ctx.config.flvLoadEndError&&i._ctx.stat.isLive&&i._ctx.stat.box===L.g.flv?i._evt.emit(v.a.ERROR,{type:p.b.NETWORK_ERROR,details:p.a.LIVE_DISCONNECTED_ERROR,fatal:!0,reason:"flv live load end",statusCode:n.code,url:e.url}):(i._mux.onFragLoaded({context:e,data:null,stats:n,remuxContiguous:!1,progress:!0}),i._onDownload(Ge.SUCCESS,e,n),i._metadata?i._mux.end():i._loadEndCallbackonMeta=!0)},this._onMetadata=function(e){var t=i._ctx.stat;i._metadata=r()({},e),i._metadata.keyframes&&(i._keyframes=i._metadata.keyframes,A.b.i("single","metadata keyframe",i._keyframes)),i._metadata.keyframes||i._metadata.duration?(t.isLive=!1,i._mux.updateConfig(i._ctx.getRemuxConfig())):t.box===L.g.flv&&void 0===t.isLive&&(t.isLive=!0,i._mux.updateConfig(i._ctx.getRemuxConfig())),i._loader.updateConfig(),i._faststart?t.startFromSec>0&&!t.isLive&&i._keyframes&&i._keyframes.length>1?i.seek(t.startFromSec,!0):i._loadEndCallbackonMeta&&i._mux.end():i.seek(t.startFromSec,!0),t.startFromSec=-1,t.box===L.g.mp4&&(e.mp4FastStart=i._faststart),i._loadEndCallbackonMeta=!1},this._onParsing=function(e){i._loadEndCallbackonMeta&&(i._mux.end(),i._loadEndCallbackonMeta=!1)},this._onKeyFrameIndex=function(e){A.b.i("single","get key index"),i._keyframes=e.keyframes},this._onNotFaststart=function(e){A.b.i("single","not faststart",e.pos),i._loader.seek({position:e.pos,time:0}),i._mux.reset(!0),i._faststart=!1,i._loadEndCallbackonMeta=!1},this._onDemuxerDetected=function(e){i._ctx.demuxerType=e.type,i._hasContentLength&&(i._ctx.stat.isLive=!1),A.b.i("single","demuxer detected: "+e.type+", box:"+i._ctx.stat.box+" isLive:"+i._ctx.stat.isLive),i._loader.updateConfig()},this._evt=e,this._ctx=t,this._flvKeyDetector=new ei,this._loaderCallbacks={onConnect:this._onLoaderConnect,onProgress:this._onLoaderProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd,onAbort:this._onLoaderAbort,onRangeEnd:this.onLoaderRangeEnd},this._loader=new fi(this._loaderCallbacks,t),this._mux=di&&t.stat.box===L.g.yuv?new di(this._evt,t,L.e.MAIN):new Ut(this._evt,t,L.e.MAIN),this._mux.init(),this._evt.prependListener(v.a.METADATA,this._onMetadata),this._evt.on(v.a.PARSING_INIT_SEGMENT,this._onParsing),this._evt.on(v.a.KEY_FRAME_INDEXS,this._onKeyFrameIndex),this._evt.on(v.a.MP4_NOT_FASTSTART,this._onNotFaststart),this._evt.on(v.a.DEMUXER_DETECTED,this._onDemuxerDetected)}var t=e.prototype;return t.init=function(){this._ctx.stat.box===L.g.yuv&&this._mux instanceof Ut&&this._evt.emit(v.a.ERROR,{type:p.b.MUX_ERROR,details:p.a.UNSUPPORTED,fatal:!0,reason:"yuv is not unsupported."}),this._multirate||(this._multirate=new Zt(this._evt,this._ctx),this._ctx.lctx.currentIdx=this._multirate.init()),this._ready=!0},t.destroy=function(){this._evt.off(v.a.METADATA,this._onMetadata),this._evt.off(v.a.PARSING_INIT_SEGMENT,this._onParsing),this._evt.off(v.a.KEY_FRAME_INDEXS,this._onKeyFrameIndex),this._evt.off(v.a.MP4_NOT_FASTSTART,this._onNotFaststart),this._evt.off(v.a.DEMUXER_DETECTED,this._onDemuxerDetected),this._loader&&this._loader.destroy(),this._multirate&&this._multirate.destory(),this._flvKeyDetector=void 0,this._mux.destroy()},t.loadSource=function(){var e=this._multirate;if(e){var t=this._ctx.lctx.current;t?this._load(this._ctx.stat.isLive?Kt(t.currentUrl,this._ctx.config.defaultSpts):t.currentUrl,e.currentLevel):this._evt.emit(v.a.ERROR,{type:p.b.OTHER_ERROR,details:p.a.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parse error."})}else this._load(this._ctx.src)},t.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._loader.setDownloadEnabled(e)},t.isSeekable=function(){return!(!this._keyframes||!this._keyframes.length||this._ctx.stat.isLive||this._ctx.stat.isKwaiSlice)},t.seek=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),A.b.i("single","seek: "+e+" "+t+" "+i);var n=this._keyframes;if((n||e<d.m)&&!i){var r=n?pi.a.getPosByTime(n,e):{time:0,position:0};r&&(this._loader.seek(r),this._baseTimeSec=r.time,this._mux.reset(!0),this._appendFLVHead=r.position>0,t&&this._evt.emit(v.a.VIDEO_SEEK,{sec:r.time}))}else A.b.w("single","no keyframe index"),this._evt.emit(v.a.ERROR,{type:p.b.MEDIA_ERROR,details:p.a.CANNOT_SEEK,fatal:!1,reason:"can not seek"})},t.nextBackup=function(){return!1},t.onAbrLevelsUpdated=function(){var e;null==(e=this._multirate)||e.onAbrLevelsUpdated()},t.setCurrentLevel=function(e){var t=this._multirate;if(t){var i=e>=0||e!==t.currentLevel;t.currentLevel=e;var n=this._ctx.lctx.current;if(i&&n&&this._ready){var r=this._ctx.stat.isLive?Kt(n.currentUrl,this._ctx.config.defaultSpts):n.currentUrl;this._flvKeyDetector&&this._flvKeyDetector.reset(),this._remuxContiguous=!1,this._baseTimeSec=this._ctx.currentTime,this._evt.emit(v.a.LEVEL_SWITCHING,{id:0,level:t.currentLevel,time:this._baseTimeSec,smooth:!1,auto:!1}),this._mux.reset(!0),this._load(r,t.currentLevel)}}},t.setManualNextLevel=function(e){this.setNextLevel(e)},t.setNextLevel=function(e){this._ready||this.setCurrentLevel(e);var t=this._multirate;t&&(-1===e&&this._evt.emit(v.a.LEVEL_SWITCHING,{id:0,level:-1,time:this._ctx.currentTime,smooth:!0,auto:!0}),t.nextLevel=e)},t.setAudioTrack=function(e){},t.setSubtitleTrack=function(e){},t._load=function(e,t){void 0===t&&(t=0),this._multirate&&this._multirate.onLevelLoad(t),this._ctx.lctx.currentIdx=t;var i=this._ctx.lctx.current;this._ctx.stat.audioCodec=this._ctx.stat.audioCodec||(i?i.audioCodec:""),this._evt.emit(v.a.NEW_SOURCE,{sync:this._baseTimeSec});var n=new C.a("string"==typeof this._ctx.src?e:this._ctx.src instanceof File?this._ctx.src.name:"").pathname.match(vi);n&&this._mux.updateSuffix(n[0]);var r={url:e,responseType:"arraybuffer",credentials:this._ctx.config.credentials,headers:this._ctx.config.headers,frag:{start:this._baseTimeSec,type:"frag"}};this._loader.load(r)},t._onDownload=function(e,t,i){var n,r=qe(e,t,i,null==(n=this._ctx.lctx.current)?void 0:n.qualityType);this._evt.emit(v.a.DOWNLOAD,r)},t._onFlvSeekFirstChunk=function(e){var t,i=null==(t=this._flvKeyDetector)?void 0:t.header;if(i){var n=new Uint8Array(e.byteLength+i.length);return n.set(i),n.set(new Uint8Array(e),i.length),n.buffer}return e},s()(e,[{key:"mediaTrackNum",get:function(){return 1}}]),e}(),Ai=function(e){function t(t){var i;return(i=e.call(this)||this)._evt=void 0,i._trans=void 0,i._ctx=void 0,i._initSegments={main:void 0,audio:void 0},i._initSegmentReady=!1,i._loadEnd=0,i._mediaSegmentsBuffer=[],i._onMessage=function(e,t){switch(e){case v.a.PARSING_INIT_SEGMENT:var n=i._getInitSegment(t);if(n){if(i.emit(v.a.PARSING_INIT_SEGMENT,n),!i._initSegmentReady)for(;i._mediaSegmentsBuffer.length;)i.emit(v.a.PARSING_DATA,i._mediaSegmentsBuffer.shift());i._initSegmentReady=!0}break;case v.a.PARSING_DATA:var r=t;r.segments.forEach((function(e){e.type===L.l.AUDIO&&e.originFirstDTS&&(i._ctx.localTimeOffset=e.originFirstDTS-e.startDTS)})),i._initSegmentReady?i.emit(e,t):i._mediaSegmentsBuffer.push(r);break;case v.a.MANIFEST_PARSED:i._initSegmentReady=1===i._trans.mediaTrackNum,i.emit(e,t);break;case v.a.ERROR:if(i._ctx.config.retryWithBackup&&i._trans.nextBackup()){var a=t;i.emit(v.a.RETRY,{type:L.h.BACKUP,message:"trans error, use backup.",code:ae((null==a?void 0:a.details)||0,(null==a?void 0:a.reason)||"",null==a?void 0:a.statusCode)})}else i.emit(e,t);break;case v.a.LOAD_END:i._loadEnd++,i._loadEnd>=i._trans.mediaTrackNum&&i.emit(e,t);break;case v.a.DEMUXER_DETECTED:i._ctx.demuxerType=t.type,A.b.i("transmuxer",e+", box:"+i._ctx.stat.box+" isLive:"+i._ctx.stat.isLive),i.emit(e,t);break;case v.a.MEDIA_DEMUX:i._ctx.demuxerType=t.type,i.emit(e,t);break;default:i.emit(e,t)}},i._evt=new b.a,i._ctx=t,t.stat.multipart?i._trans=new Wt(i._evt,t):i._trans=new mi(i._evt,t),i}u()(t,e);var i=t.prototype;return i.init=function(){this._bindEvents(this._evt),this._trans.init()},i.destroy=function(){this._trans.destroy(),this._mediaSegmentsBuffer=[],this._evt.removeAllListeners()},i.loadSource=function(){this._trans.loadSource()},i.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._trans.setDownloadEnabled(e)},i.seek=function(e,t,i){void 0===i&&(i=!1),this._trans.seek(e,t,i)},i.heartbeat=function(){},i.isSeekable=function(){return this._trans.isSeekable()},i.setNextLevel=function(e){e>=0&&e!==this._ctx.lctx.nextIdx&&this._resetInitSegments(),this._trans.setManualNextLevel(e)},i.setCurrentLevel=function(e){e>=0&&e!==this._ctx.lctx.currentIdx&&this._resetInitSegments(),this._trans.setCurrentLevel(e)},i.onAbrLevelsUpdated=function(){this._trans.onAbrLevelsUpdated()},i.setAudioTrack=function(e){this._resetInitSegments(),this._ctx.lctx.audioTracks.length&&this._trans.setAudioTrack(e)},i.setSubtitleTrack=function(e){this._ctx.lctx.subtitleTracks.length&&this._trans.setSubtitleTrack(e)},i._bindEvents=function(e){var t=this._onMessage;[v.a.PRIV_NAL,v.a.SEI,v.a.PARSING_INIT_SEGMENT,v.a.PARSING_DATA,v.a.RAW_DATA,v.a.VIDEO_CODEC_DETECTED,v.a.ERROR,v.a.LEVEL_UPDATED,v.a.LEVEL_SWITCH_FAILED,v.a.LEVEL_SWITCHING,v.a.SUBTITLE_LOADED,v.a.MANIFEST_PARSED,v.a.LOAD_END,v.a.BUFFER_CLEANING,v.a.VIDEO_SEEK,v.a.PRELOAD_COMPLETE,v.a.LOADER_CHUNK_ARRIVAL,v.a.MEDIA_CONNECTED,v.a.MEDIA_DEMUX,v.a.NEW_SOURCE,v.a.DOWNLOAD,v.a.DISCONTINUITY,v.a.KEY_FRAME,v.a.METADATA,v.a.VIDEO_FRAME_INFO,v.a.DEMUXER_DETECTED,v.a.AUDIO_TRACK_UPDATED,v.a.AUDIO_TRACK_SWITCHING,v.a.AUDIO_TRACK_SWITCHED,v.a.AUDIO_TRACK_LOADED].forEach((function(i){return e.on(i,(function(e){return t(i,e)}))}))},i._resetInitSegments=function(){this._initSegments.audio=this._initSegments.main=void 0,this._initSegmentReady=1===this._trans.mediaTrackNum,this._loadEnd=0,this._mediaSegmentsBuffer=[],A.b.i("transmuxer","reset initSegment ready: "+this._initSegmentReady)},i._getInitSegment=function(e){var t=e;if(1===this._trans.mediaTrackNum);else{if(e.tracks.hasOwnProperty("video")?this._initSegments.main=e.tracks.video:this._initSegments.audio=e.tracks.audio,!this._initSegments.main||!this._initSegments.audio)return;t={tracks:{video:this._initSegments.main,audio:this._initSegments.audio}}}var i=this._ctx.lctx.current;return i&&t.tracks&&t.tracks.video&&!i.codec&&(i.codec=t.tracks.video.codec),t},t}(b.a);!function(e){e[e.waiting=0]="waiting",e[e.working=1]="working",e[e.ready=2]="ready",e[e.error=3]="error"}(hi||(hi={}));var gi=function(e){function t(t){var i;return(i=e.call(this)||this)._data=void 0,i._trans=void 0,i._data=t,i}u()(t,e);var i=t.prototype;return i.start=function(e,t){if(!this._trans){A.b.i("preload-task","start preload task"),void 0===e&&(e=this._data.abr),void 0===t&&(t=this._data.qualityType);var i=this._data.ctx;this._data.abr=e,this._data.qualityType=t,this._data.stat=hi.working,this._trans=new Ai(i),this._bind(this._trans),this._trans.init(),this._trans.loadSource()}},i.destroy=function(){A.b.i("preload-task","destroy"),this._trans&&(this._trans.removeAllListeners(),this._trans.destroy(),this._trans=void 0),this.removeAllListeners()},i._bind=function(e){var t=this,i=this._data;e.on(v.a.PRELOAD_COMPLETE,(function(){var n;i.qualityType=(null==(n=i.ctx.lctx.current)?void 0:n.qualityType)||"",i.stat=hi.ready,e.removeAllListeners(),t.emit(v.a.PRELOAD_COMPLETE),t.removeAllListeners()})),e.on(v.a.DOWNLOAD,(function(e){t.emit(v.a.DOWNLOAD,e)})),e.on(v.a.MANIFEST_PARSED,(function(){if(i.levelCnt=i.ctx.lctx.levels.length,"string"==typeof i.qualityType&&i.qualityType){if(i.levelCnt<=1)return;var t=i.ctx.lctx.levels.reduce((function(e,t,n){return t.qualityType===i.qualityType?n:e}),-1);t>=0&&i.ctx.lctx.currentIdx!==t&&e.setCurrentLevel(t)}else"number"==typeof i.level&&i.level>=0&&i.level<i.ctx.lctx.levels.length&&e.setCurrentLevel(i.level)})),e.on(v.a.ERROR,this._onError.bind(this))},i._onError=function(e){this.emit(v.a.ERROR,e),this._data.stat=hi.error,this.destroy()},s()(t,[{key:"trans",get:function(){return this._trans}}]),t}(b.a),yi=function(e){function t(t){var i;return(i=e.call(this)||this)._waiting=[],i._running=void 0,i._active=!1,i._updateTimer=void 0,i._timeout=void 0,i._ctx=void 0,i._onPreloadComplete=function(){var e;i._stopTimeout(),i._running&&(A.b.i("preload-m","preload task done",i._waiting.length),null==(e=i._running.app)||e.destroy(),i.emit(v.a.PRELOAD_COMPLETE)),i._running=void 0,i._update()},i._onPreloadError=function(e){var t;i._stopTimeout(),i._running&&(null==(t=i._running.app)||t.destroy()),i._running=void 0,i._update()},i._onPreloadDownload=function(e){i.emit(v.a.DOWNLOAD,e)},i._ctx=t,i}u()(t,e);var i=t.prototype;return i.add=function(e,t){A.b.i("preload-m","add preload task");var i=this._ctx.getNewCtx();if(i.setSrc(e),!i.stat.isLive&&(i.stat.isPreload=!0,i.streamingMux=!1,i.src)){var n={data:{ctx:i,levelCnt:1,stat:hi.waiting,level:t},ts:performance.now()};this._waiting.push(n),this._update()}},i.active=function(e){void 0===e&&(e=!1),this._active!==e&&(e?(this._active=e,this._update()):(this._active=e,this._stopUpdateTimer()))},i.clean=function(){A.b.i("preload-m","clean"),this._waiting=[],this._running&&(this._running.app&&this._running.app.destroy(),this._running=void 0),this._active=!1},i.destroy=function(){A.b.i("preload-m","destroy"),this.clean(),this._stopUpdateTimer(),this.removeAllListeners()},i._stopUpdateTimer=function(){this._updateTimer&&(clearTimeout(this._updateTimer),this._updateTimer=void 0)},i._update=function(){if(!this._running&&this._waiting.length&&this._active){var e=this._ctx.lctx.current,t=this._running=this._waiting.shift();t&&(this._startTimeout(5e3),t.app=new gi(t.data),t.app.on(v.a.PRELOAD_COMPLETE,this._onPreloadComplete),t.app.on(v.a.ERROR,this._onPreloadError),t.app.on(v.a.DOWNLOAD,this._onPreloadDownload),t.app.start(this._ctx.lctx.abr,null==e?void 0:e.qualityType),A.b.i("preload-m","preload task start"))}},i._startTimeout=function(e){var t=this;this._timeout=setTimeout((function(){t._running&&t._running.app&&t._running.app.destroy(),t._running=void 0,t._update(),t._stopTimeout()}),e)},i._stopTimeout=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0)},t}(b.a),Ei=i(37),bi=i(26),Ti=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var i=t.toLowerCase();return!!~e.indexOf(i)&&i}function n(e){return i(t,e)}function r(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)e[s]=a[s]}return e}function a(t,a,s){if("undefined"!=typeof self){var o=self,c={enumerable:!0};o.hasBeenReset=!1;var u="",d=!1,_=t,h=a,l=s,f=null,p="",v=!0,m="auto",A="start",g=50,y="middle",E=50,b="middle";Object.defineProperty(o,"id",r({},c,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},c,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",r({},c,{get:function(){return _},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},c,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},c,{get:function(){return l},set:function(e){l=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},c,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},c,{get:function(){return p},set:function(t){var n=function(t){return i(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},c,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},c,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},c,{get:function(){return A},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");A=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},c,{get:function(){return g},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},c,{get:function(){return y},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},c,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},c,{get:function(){return b},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),o.displayState=void 0}}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),Si=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}(),xi=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},e}();function Ci(e,t,i,n){var r=n?e.split(n):[e];for(var a in r)if("string"==typeof r[a]){var s=r[a].split(i);2===s.length&&t(s[0],s[1])}}var Li=new Ti(0,0,""),Ri="middle"===Li.align?"middle":"center";function Di(e,t,i){var n=e;function r(){var t=function(e){function t(e,t,i,n){return 3600*(0|e)+60*(0|t)+(0|i)+parseFloat(n||0)}var i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.substr(3),a(),t.endTime=r(),a(),function(e,t){var n=new xi;Ci(e,(function(e,t){var r;switch(e){case"region":for(var a=i.length-1;a>=0;a--)if(i[a].id===t){n.set(e,i[a].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),n.integer(e,r[0]),n.percent(e,r[0])&&n.set("snapToLines",!1),n.alt(e,r[0],["auto"]),2===r.length&&n.alt("lineAlign",r[1],["start",Ri,"end"]);break;case"position":r=t.split(","),n.percent(e,r[0]),2===r.length&&n.alt("positionAlign",r[1],["start",Ri,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",Ri,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var r=n.get("line","auto");"auto"===r&&-1===Li.line&&(r=-1),t.line=r,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",Ri);var a=n.get("position","auto");"auto"===a&&50===Li.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}var wi=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new Si,this.regionList=[],this.cue=null,this.style="",this.oncue=void 0,this.onstyle=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function i(){var e=t.buffer,i=0;for(e=e.replace(/<br(?: \/)?>/gi,"\n");i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;var n=e.substr(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.substr(i),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var r=(n=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=i(),t.state){case"HEADER":/:/.test(n)?Ci(n,(function(e,t){}),/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"STYLE":n?t.style+=n:(t.style&&(t.onstyle&&t.onstyle(t.style),t.style=""),t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(/^STYLE($|[ \t])/.test(n)){t.state="STYLE";break}if(!n)continue;if(t.cue=new Ti(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Di(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==n.indexOf("--\x3e");if(!n||s&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this},e}(),Ii=/\r\n|\n\r|\n|\r/g,Oi=function(e,t,i){return void 0===i&&(i=0),e.substr(i,t.length)===t},Pi=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function ki(e,t,i,n,r,a,s,o){var c,u=new wi,_=Object(Ei.a)(new Uint8Array(e)).trim().replace(Ii,"\n").split("\n"),h=[],l=Object(bi.a)(t,i),f="",p="00:00.000",v=0,m=0,A=!0,g=!1;u.onstyle=function(e){f+=e},u.oncue=function(e){var t=n[r],i=n.ccOffset,s=(v-l)/d.l;if(null!=t&&t.new&&(void 0!==m?i=n.ccOffset=t.start:function(e,t,i){var n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(a=r)&&a.new;){var a;e.ccOffset+=n.start-r.start,n.new=!1,r=e[(n=r).prevCC]}e.presentationOffset=i}(n,r,s)),s&&(i=s-n.presentationOffset),g){var o=e.endTime-e.startTime,c=Object(ri.a)((e.startTime+i-m)*d.l,a*d.l)/d.l;e.startTime=c,e.endTime=c+o}var u=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(u)),e.id||(e.id=function(e,t,i){return Pi(e.toString())+Pi(t.toString())+Pi(i)}(e.startTime,e.endTime,u)),e.endTime>0&&h.push(e)},u.onparsingerror=function(e){c=e},u.onflush=function(){c?o(c):s(h,f)},_.forEach((function(e){if(A){if(Oi(e,"X-TIMESTAMP-MAP=")){A=!1,g=!0,e.substr(16).split(",").forEach((function(e){Oi(e,"LOCAL:")?p=e.substr(6):Oi(e,"MPEGTS:")&&(v=parseInt(e.substr(7)))}));try{m=function(e){var t=parseInt(e.substr(-3)),i=parseInt(e.substr(-6,2)),n=parseInt(e.substr(-9,2)),r=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(ie.a)(t)&&Object(ie.a)(i)&&Object(ie.a)(n)&&Object(ie.a)(r)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*i,t+=6e4*n,t+36e5*r}(p)/1e3}catch(e){g=!1,c=e}return}""===e&&(A=!1)}u.parse(e+"\n")})),u.flush()}var Ni=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._current=-1,i._list=[],i._listPos=0,i._vttCCs=void 0,i._styleNode=void 0,i._onTextTrackChange=function(){var e=i._list.reduce((function(e,t,i){return"showing"===t.track.mode?i:e}),-1);e!==i._current&&(i._current=e,A.b.i("subtitle","subtitle switching"),i.emit(v.a.SUBTITLE_TRACK_SWITCHED,{level:e}))},i._ctx=t,i._vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},i._ctx.video&&i._ctx.video.textTracks.addEventListener("change",i._onTextTrackChange),i}u()(t,e);var i=t.prototype;return i.addTracks=function(e){var t=this;e.forEach((function(e,i){var n=t._getTextTrack();n&&t._ctx.video&&(e.default?(t._current=i,n.mode="showing"):n.mode="hidden")}))},i.select=function(e){if(this._removeStyle(),e!==this._current){var t=this._list[e],i=this._list[this._current];i&&(i.track.mode="hidden"),t?(this._applyStyle(t.style),t.track.mode="showing",this._current=e):this._current=-1,this.emit(v.a.SUBTITLE_TRACK_SWITCHED,{level:this._current})}},i.reset=function(){A.b.i("subtitle","reset"),this._list.forEach((function(e){!function(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues){for(var i=e.cues.length;i--;)e.removeCue(e.cues[i]);"disabled"===t&&(e.mode=t)}}(e.track),e.track.mode="hidden"})),this._listPos=0,this._current=-1,this._vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._removeStyle()},i.parseVTTs=function(e,t,i){var n=this,r=this._list[this._current];r&&ki(e,i,t,this._vttCCs,i,t,(function(e,t){e.forEach((function(e){!function(e,t){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(i){A.b.d("[texttrack-utils]: "+i);var n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}"disabled"===i&&(e.mode=i)}(r.track,e)})),t&&(r.style+=t,n._applyStyle(r.style))}),(function(e){}))},i.destroy=function(){this._ctx.video&&this._ctx.video.textTracks.removeEventListener("change",this._onTextTrackChange),this.reset(),this._list=[],this.removeAllListeners()},i._getTextTrack=function(){var e;if(this._listPos<this._list.length)e=this._list[this._listPos].track,this._listPos++;else{var t=this._ctx.video;t&&(e=t.addTextTrack("subtitles"),this._list.push({track:e,style:""}),this._listPos++)}return e},i._applyStyle=function(e){e&&(this._styleNode||(this._styleNode=document.createElement("style"),document.head.appendChild(this._styleNode)),this._styleNode.innerHTML=e)},i._removeStyle=function(){this._styleNode&&(this._styleNode.innerHTML="",document.head.removeChild(this._styleNode),this._styleNode=void 0)},t}(b.a),Mi=function(){function e(e){this._ctx=void 0,this._sec1LoadDuration=0,this._ctx=e,A.b.i("auto-lazyload",e.stat.autoLazyLoad,e.stat.lazyLoadMaxDuration,e.stat.lazyLoadRecoverDuration)}var t=e.prototype;return t.update=function(){var e=this._ctx.lctx.current;!this._ctx.stat.isLive&&this._ctx.stat.autoLazyLoad&&e&&(e.maxBitrate||e.bitrate)&&(this._checkLazyLoadConf(e,8*this._ctx.loadRec.smoothedDownloadSpeed/1e3),this.checkStreamingMux())},t.checkStreamingMux=function(){var e,t=this._ctx,i=this._ctx.stat;if(i.box===L.g.flv&&i.isLive)t.streamingMux=!0;else{var n=t.bufferedSec+((null==(e=t.mse)?void 0:e.getBufferQueueSec())||0),r=this._getLazyloadRange();if(i.lazyLoadRecoverDuration<=r.min+.001){var a=i.multipart?this._currentTargetDurationMP():this._currentTargetDuration();t.streamingMux=!(a&&a/this._sec1LoadDuration*3<n)}else t.streamingMux=n<i.lazyLoadRecoverDuration+(i.lazyLoadMaxDuration-i.lazyLoadRecoverDuration)/2}},t._checkLazyLoadConf=function(e,t){var i=this._ctx,n=0;if(e.maxBitrate)n=t/e.maxBitrate;else{if(!e.bitrate)return;n=t/(1.5*e.bitrate)}n/=Math.max(1,i.playbackRate),this._sec1LoadDuration=n;var r=this._getLazyloadRange();n>5?this._updateLazyloadConf(Math.max(r.min,i.stat.lazyLoadMaxDuration-2)):n<3&&this._updateLazyloadConf(Math.min(r.max,i.stat.lazyLoadMaxDuration+2))},t._updateLazyloadConf=function(e){this._ctx.stat.lazyLoadMaxDuration=e,this._ctx.stat.lazyLoadRecoverDuration=.8*this._ctx.stat.lazyLoadMaxDuration},t._getLazyloadRange=function(){var e=16,t=30;if(this._ctx.stat.multipart){var i=this._currentTargetDurationMP();i&&(e=Math.max(16,2*i),t=Math.max(30,4*i))}return{min:e,max:t}},t._currentTargetDuration=function(){var e=this._ctx.lctx.current;if(e){var t=8*d.d/1e3,i=e.maxBitrate||1.5*e.bitrate||0;if(i)return t/i}return 0},t._currentTargetDurationMP=function(){var e=this._ctx;if(e.stat.multipart){var t=e.lctx.current;if(t)return t.targetduration||t.averagetargetduration||0}return 0},s()(e,[{key:"streamingMuxThreshold",get:function(){var e=this._ctx.stat;if(e.box===L.g.flv&&e.isLive)return 0;var t=this._getLazyloadRange();return e.lazyLoadRecoverDuration<=t.min+.001?0:e.lazyLoadRecoverDuration+(e.lazyLoadMaxDuration-e.lazyLoadRecoverDuration)/2}}]),e}();function Bi(){for(var e=document,t=0,i=["hidden","webkitHidden","mozHidden"];t<i.length;t++){var n=i[t];if(n in e)return e[n]}return null}var Vi,Fi=function(){function e(e){this._ctx=void 0,this._config=void 0,this._startDelay=5e3,this._enabled=!1,this._lastTickTime=0,this._ctx=e,this._config=e.config.autoPlaybackRateConf}var t=e.prototype;return t.tick=function(){if(this._enabled&&this._ctx.video&&!this._ctx.video.paused){if(this._startDelay>0){var e=performance.now();return this._startDelay-=e-this._lastTickTime,void(this._lastTickTime=e)}this._nextPlayBackRate(this._ctx.bufferedSec,this._ctx.video)}},t._nextPlayBackRate=function(e,t){if(this._config){var i=1,n=this._config.rule,r=0;for(r=0;r<n.length&&!(t.playbackRate>=n[r].rate);r++);if(n[r]){var a=r<n.length-1?n[r+1]:null,s=r>0?n[r-1]:null;i=n[r].rate,s&&e>s.lower&&(i=s.rate),a&&e<a.upper&&(i=a.rate),t.playbackRate!==i&&(A.b.i("playback-rate-manager","auto change playback rate from "+t.playbackRate+" to "+i),t.playbackRate=i)}}},s()(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(e!==this._enabled)if(e){if(!this._config)return;this._enabled=!0,this._lastTickTime=performance.now(),this._startDelay=this._config.startDelay?1e3*this._config.startDelay:this._startDelay}else this._enabled&&this._ctx.video&&(this._ctx.video.playbackRate=1),this._enabled=!1}}]),e}(),Ui=function(){function e(e){this._info=void 0,this._info=e}var t=e.prototype;return t.update=function(e){var t=this;e.forEach((function(e){t._info[e.index]=e}))},t.timeToIndex=function(e){if(this._info.length){if(e<this._info[0].pts)return 0;if(e>this._info[this._info.length-1].pts)return this._info.length-1;for(var t,i,n,r=0,a=this._info.length-1;r<=a;)if(t=(r+a)/2|0,i=this._info[t],(n=this._info[t+1])&&n.pts-.001<e)r=t+1;else{if(!(i&&i.pts-.001>e))return t;a=t-1}}return-1},t.isIndexInRange=function(e){return e>=0&&e<this._info.length},t.indexToTime=function(e){return this._info[e]?this._info[e].pts:-1},t.getNextFramePTSByTime=function(e){var t=this.timeToIndex(e);return t>=0&&this._info[t+1]?this._info[t+1].pts:-1},t.getPrevFramePTSByTime=function(e){var t=this.timeToIndex(e)-1;return t>=0&&this._info[t]?this._info[t].pts:-1},s()(e,[{key:"totalVideoFrames",get:function(){return this._info.length}}]),e}(),Hi=function(){function e(e){this._media=void 0,this._lastPlayTime=void 0,this._lastCheckTime=0,this._waiting=!1,this._start=!1,this._media=e}var t=e.prototype;return t.check=function(){var e=this._media,t=performance.now();if(!e.paused&&!e.seeking&&!e.ended&&t-this._lastCheckTime>=100){if(this._lastCheckTime=t,!this._start)return"number"==typeof this._lastPlayTime&&Math.abs(e.currentTime-this._lastPlayTime)>.017&&(this._start=!0),void(this._lastPlayTime=e.currentTime);e.currentTime===this._lastPlayTime?this._waiting||(this._waiting=!0,this._customEvent(e,"waiting")):this._waiting&&(this._waiting=!1,this._customEvent(e,"playing")),this._lastPlayTime=e.currentTime}},t.reset=function(){this._lastPlayTime=void 0,this._start=!1,this._waiting=!1},t._customEvent=function(e,t){if(e&&e.dispatchEvent){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,!0,!0,{}),e.dispatchEvent(i)}},e}(),ji=i(20),zi=i.n(ji);!function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.SEEK=2]="SEEK",e[e.SELECT_BITRATE=3]="SELECT_BITRATE",e[e.INIT=4]="INIT",e[e.LOADING=5]="LOADING"}(Vi||(Vi={}));var Gi="kernel-base",Wi=function(e){function t(t){var i;if((i=e.call(this)||this)._video=void 0,i._error=void 0,i._hbTimer=void 0,i._stat=Vi.INIT,i._mediaInfo=void 0,i._levelSwitchId=0,i._nextLevel=[],i._nextAudio=void 0,i._eventHandlers=void 0,!t)throw new Error("video is null");return i._video=t,i._eventHandlers={loadedmetadata:i._onVideoLoadedmetadata.bind(zi()(i)),loadeddata:i._onVideoLoadeddata.bind(zi()(i)),canplay:i._onVideoCanplay.bind(zi()(i)),seeking:i._onVideoSeeking.bind(zi()(i)),seeked:i._onVideoSeeked.bind(zi()(i)),waiting:i._onVideoWaiting.bind(zi()(i)),playing:i._onVideoPlaying.bind(zi()(i)),pause:i._onVideoPause.bind(zi()(i)),play:i._onVideoPlay.bind(zi()(i)),error:i._onVideoError.bind(zi()(i)),ended:i._onVideoEnded.bind(zi()(i)),ratechange:i._onVideoRatechange.bind(zi()(i)),durationchange:i._onVideoDurationchange.bind(zi()(i)),timeupdate:i._onVideoTimeupdate.bind(zi()(i)),progress:i._onVideoProgress.bind(zi()(i)),emptied:i._onVideoEmptied.bind(zi()(i)),resize:i._onVideoResize.bind(zi()(i))},i._bindVideoEvents(),i}u()(t,e);var i=t.prototype;return i.destroy=function(){this._stopHeartbeat(),this._unbindVideoEvents(),this.removeAllListeners()},i.getError=function(){return this._error},i.setAudioTrack=function(e){},i.setSubtitleTrack=function(e){},i.seekToNextFrame=function(){var e=this._getNextFrameTime();e>0&&(this._video.currentTime=e)},i.seekToPrevFrame=function(){var e=this._getPrevFrameTime();e&&(this._video.currentTime=e)},i.getTotalVideoFrames=function(){return-1},i.getCurrentVideoFrame=function(){return-1},i.setCurretVideoFrame=function(e){this._onError({type:p.b.MEDIA_ERROR,details:p.a.CANNOT_SEEK_BY_FRAME_INDEX,fatal:!1,reason:"unsupported"})},i.getTrackBufInfo=function(){},i._getNextFrameTime=function(){var e=this._mediaInfo&&this._mediaInfo.fps?this._mediaInfo.fps:30;return this._video.duration&&!this._video.ended?this._video.currentTime+1/e:-1},i._getPrevFrameTime=function(){var e=this._mediaInfo&&this._mediaInfo.fps?this._mediaInfo.fps:30;return this._video.duration&&this._video.currentTime-1/e>=0?this._video.currentTime-1/e:-1},i._bindVideoEvents=function(){if(this._video)for(var e in this._eventHandlers)this._video.addEventListener(e,this._eventHandlers[e])},i._unbindVideoEvents=function(){if(this._video)for(var e in this._eventHandlers)this._video.removeEventListener(e,this._eventHandlers[e])},i._onVideoLoadedmetadata=function(e){A.b.i(Gi,"loadedmetadata")},i._onVideoLoadeddata=function(){A.b.i(Gi,"loadeddata"),this.emit(v.a.LOADEDDATA)},i._onVideoCanplay=function(){A.b.i(Gi,"canplay "+!!this._stat),this.emit(v.a.CANPLAY)},i._onVideoSeeking=function(){A.b.i(Gi,"seeking "+this._video.currentTime),this.emit(v.a.SEEKING)},i._onVideoSeeked=function(){A.b.i(Gi,"seeked"),this.emit(v.a.SEEKED)},i._onVideoWaiting=function(){},i._onVideoPlaying=function(){A.b.i(Gi,"playing"),this._error||(this._stat=Vi.NONE,this._startHeartbeat(),this.emit(v.a.PLAYING))},i._onVideoPause=function(){A.b.i(Gi,"pause. seeking: "+this._video.seeking),this._video.ended||this.emit(v.a.PAUSE)},i._onVideoPlay=function(){A.b.i(Gi,"play",this._error),this.emit(v.a.PLAY)},i._onVideoError=function(e){},i._onVideoEnded=function(){A.b.i(Gi,"ended"),this.emit(v.a.ENDED),this._stopHeartbeat()},i._onVideoRatechange=function(){A.b.v(Gi,"ratechange "+this._video.playbackRate),this.emit(v.a.RATE_CHANGE)},i._onVideoDurationchange=function(){this.emit(v.a.DURATION_CHANGE)},i._onVideoTimeupdate=function(){this.emit(v.a.TIMEUPDATE)},i._onVideoProgress=function(){this.emit(v.a.PROGRESS)},i._onVideoEmptied=function(){A.b.i(Gi,"video emptied")},i._onVideoResize=function(){A.b.i(Gi,"video resize")},i._onError=function(e){e.fatal&&(this._error=e.details||p.a.UNKNOWN),A.b.i(Gi,"error",this._error,e),this.emit(v.a.ERROR,e)},i._heartbeat=function(){this.emit(v.a.HEARTBEAT)},i._startHeartbeat=function(){this._hbTimer||(this._hbTimer=setInterval(this._heartbeat.bind(this),d.g))},i._stopHeartbeat=function(){this._hbTimer&&(clearInterval(this._hbTimer),this._hbTimer=void 0)},t}(b.a),Ki=function(e){function t(t){var i;return(i=e.call(this,t)||this)._decId=1,i._audioSegmentCnt=0,i._state={streamTime:0,stoped:!1,frameBufLen:0,maxFrameBufLen:0},i._onDecVideoReady=function(){i._waiting=!1,i.emit(v.a.DEC_VIDEO_READY),i._pausedOnWaiting=void 0},i._onDecWaiting=function(){var e,t;null!=(e=i._ctx.video)&&e.ended||(i._bufRules.onWaiting(),i._waiting=!0,void 0===i._pausedOnWaiting&&(i._pausedOnWaiting=!(null==(t=i._ctx.video)||!t.paused)),i.emit(v.a.DECODER_WAITING))},i._onRenBufUpdate=function(e){},i._onRenSeek=function(e){A.b.i("yuv-renderer","renderer seek event",e),e.hitCache?i._waiting=!1:(i._reset(!0),i._updateState()),i._seeking=!1,i.emit(v.a.DECODER_SEEK,e)},i._onRenError=function(e){i.emit(v.a.ERROR,e)},i._state.maxFrameBufLen=i._bufRules.maxFrameBufLen,i}u()(t,e);var i=t.prototype;return i.init=function(e,t){var i=this,n=this._evt;n.on(v.a.DEC_VIDEO_READY,this._onDecVideoReady),n.on(v.a.STEP,(function(e){return i.emit(v.a.STEP,e)})),n.on(v.a.DECODER_WAITING,this._onDecWaiting),n.on(v.a.RENDERER_BUF_UPDATE,this._onRenBufUpdate),n.on(v.a.RENDERER_SEEK,this._onRenSeek),n.on(v.a.ERROR,this._onRenError),this._r.id=this._decId,this._r.init(!1),this._ready=!0,this.start()},i.setMediaInfo=function(e){this._r.updateMediaInfo(e)},i.appendData=function(e){var t=this;e.samples.forEach((function(e){e.yuv&&t._r.append(e.yuv)}))},i.endOfData=function(){A.b.i("yuv-renderer","endOfData"),this._r.endOfData()},i.seek=function(e){A.b.i("yuv-renderer","seek: "+e+" "+this._seeking),e*=d.a,this._r.seek(e),this.start()},i.seekWithLoad=function(){A.b.i("yuv-renderer","seekWithLoad"),this._reset(!0),this._updateState()},i.clean=function(e){void 0===e&&(e=0),A.b.i("yuv-renderer","clean"),e?this._r.flush(e):this._reset(!1)},i.decoderChange=function(e,t){},i.onParsingData=function(e){var t=this;e.segments.forEach((function(e){e.type===L.l.AUDIO&&t._audioSegmentCnt++}))},i._reset=function(e){void 0===e&&(e=!1),this._decId++,this._audioSegmentCnt=0,e||(this._seeking=!1),this._r.id=this._decId,this._r.reset(e),this._waiting=!0},i._updateState=function(){var e=this._ctx.cOutput.canvas;if(e instanceof HTMLCanvasElement){var t,i=this._ctx.currentTime*d.a,n=!(null==(t=this._ctx.video)||!t.ended),r=!1,a=this._checkResize(e),s=this._state;if(0!==i||this._audioSegmentCnt||(i=-1),s.streamTime===i&&s.stoped===n&&s.frameBufLen===this._r.frameBufLen&&s.maxFrameBufLen===this._bufRules.maxFrameBufLen||(s.streamTime=i,s.stoped=n,s.frameBufLen=this._r.frameBufLen,s.maxFrameBufLen=this._bufRules.maxFrameBufLen,r=!0),!r&&!this._waiting&&!a)return;(r||a)&&this._r.update(i,this._size.w,this._size.h,n,L.o.canvas,s.maxFrameBufLen)}},s()(t,[{key:"isCanvasRenderer",get:function(){return!0}},{key:"decBufLow",get:function(){return!1}}]),t}(T),Qi=[v.a.PRIV_NAL,v.a.SEI,v.a.LEVEL_SWITCH_FAILED,v.a.DEMUXER_DETECTED,v.a.MEDIA_DEMUX,v.a.MEDIA_CONNECTED,v.a.KEY_FRAME,v.a.RETRY,v.a.NEW_SOURCE,v.a.DISCONTINUITY,v.a.DOWNLOAD],Yi="kernel-base-mse",Xi=function(e){function t(t){var i;return(i=e.call(this,t.video)||this)._mse=void 0,i._trans=void 0,i._ctx=void 0,i._seekOnCanplay=!1,i._internalSeekFlag=!1,i._waitingHelper=void 0,i._audioCodecSwap=!1,i._mainTimer=void 0,i._skipSeekEvent=!1,i._subtitle=void 0,i._nextLevelMinBuffer=3,i._seekRollbackTime=0,i._videoDecProxy=void 0,i._recoverMediaErrorTime=0,i._eme=void 0,i._autoLazyload=void 0,i._nativeVideoFunc=void 0,i._internalPauseFlag=!1,i._playingLevel=0,i._preloader=void 0,i._playbackRateManager=void 0,i._flvLiveRetry=0,i._flvLiveRetryTimer=void 0,i._liveEnd=!1,i._catchUpLive=!0,i._videoFrameMap=void 0,i._lastTimeupdateTime=0,i._onMSEBufferFull=function(){i.emit(v.a.MSE_BUFFER_FULL),i._ctx.live?i._video.paused&&(i.stopLoad(),i._initMSE()):i._trans&&i._trans.setDownloadEnabled(!1)},i._onMSEUpdate=function(){i.emit(v.a.MSE_UPDATE),i._stat!==Vi.NONE&&i._ctx.isTimeinBuffered(i._video.currentTime)&&i._video.readyState>=3?(i._onVideoCanplay(),A.b.v(Yi,"canplay polyfill")):i._seekOnCanplay&&i._detectSeekOnCanplay()},i._seekWithLoad=function(){var e;if(A.b.i(Yi,"seek with load"),(!i._ctx.stat.isLive||i._ctx.stat.liveShiftEnabled)&&i._trans&&i._mse){var t=i._video.currentTime;if(!i._trans.isSeekable()&&t>=d.m)return A.b.i(Yi,"seek disabled, rollback: "+i._seekRollbackTime+" seekTime: "+t),void(t!==i._seekRollbackTime&&i._internalSeek(i._seekRollbackTime));i._preloader&&i._preloader.active(!1),i._videoDecProxy&&i._videoDecProxy.seekWithLoad(),i.emit(v.a.SEEK_WITH_LOAD),i._stat=Vi.SEEK,i._nextLevel.length&&(i._nextLevel=i._nextLevel.slice(i._nextLevel.length-1),i._nextLevel[0].data.time=t),i._mse.clean(),i._mse.setAppendEnabled(!1),null!=(e=i._videoDecProxy)&&e.isCanvasRenderer&&(i._seekOnCanplay=!1),i._trans.seek(t,R.a.msie||i._ctx.config.alwaysSeekKeyframe,!1)}},i._ctx=t,i._autoLazyload=new Mi(i._ctx),i._catchUpLive=!!i._ctx.config.catchUpPausedLive,i._eme=new te(i._ctx),i._eme.on(v.a.ERROR,(function(e){i._onError(e)})),t.video instanceof HTMLVideoElement&&R.a.x5&&R.a.android&&(i._waitingHelper=new Hi(i._video)),i._initMSE(),i}u()(t,e);var i=t.prototype;return i.load=function(e){this._startHeartbeat(),this._playingLevel=void 0,this._load(e),this._preloader&&(this._preloader.active(!1),this._preloader.clean())},i.stopLoad=function(){A.b.i(Yi,"call kernel stopLoad"),this._stopFlvLiveRetryTimer(),this._preloader&&this._preloader.clean(),this._playbackRateManager&&(this._playbackRateManager.enabled=!1),this._videoDecProxy&&this._videoDecProxy.stop(),this._trans&&(this._onLoadEnd(!0),this._destroyTrans(),this._stopHeartbeat(),this.emit(v.a.STOP_LOAD))},i.destroy=function(){var t,i;this._stopFlvLiveRetryTimer(),this._waitingHelper=void 0,this._stopMainTimer(),this._stopVideo(),this._destroyDecoder(),null==(t=this._subtitle)||t.destroy(),this._eme.destory(),this._nativeVideoFunc&&(this._video.play=this._nativeVideoFunc.play,this._video.pause=this._nativeVideoFunc.pause),this._videoFrameMap=void 0,De(),null==(i=this._preloader)||i.destroy(),e.prototype.destroy.call(this)},i.resume=function(){A.b.i(Yi,"call resume"),this._ctx.live&&this._liveEnd||(this._trans||this._load(L.f.internal),this._video.paused&&this._video.play())},i.refresh=function(){if(this._ctx.live){if(this._liveEnd)return;this._flvLiveRetry=0}else this._ctx.stat.startFromSec=this._video.currentTime;this._reload(),this._error=void 0},i.onAbrLevelsUpdated=function(){var e;null==(e=this._trans)||e.onAbrLevelsUpdated()},i.setCurrentLevel=function(e){var t;if(A.b.i(Yi,"set currentLevel",e),!this._verifyLevel(e)||e===this._ctx.lctx.currentIdx&&!this._ctx.lctx.abr||this._error)this.emit(v.a.LEVEL_SWITCH_FAILED);else if(e<0)this.setNextLevel(-1);else{if(this._isSwitchLevelByReload())return this._playingLevel=e,void this._reload();this._stat!==Vi.INIT&&this._stat!==Vi.LOADING&&(this._stat=Vi.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.clean(),this._ctx.streamingMux=!0),null==(t=this._trans)||t.setCurrentLevel(e),this._videoDecProxy&&this._videoDecProxy.clean(),!this._ctx.stat.isLive&&this._preloader&&this._preloader.active(!1)}},i.setNextLevel=function(e){var t;A.b.i(Yi,"set nextLevel",e),this._verifyLevel(e)&&!this._error?this._ctx.bufferedSec<this._nextLevelMinBuffer&&e>=0||e>=0&&this._isSwitchLevelByReload()?this.setCurrentLevel(e):null==(t=this._trans)||t.setNextLevel(e):this.emit(v.a.LEVEL_SWITCH_FAILED)},i.setAudioTrack=function(e){this._trans&&e!==this._ctx.lctx.audioIdx&&this._ctx.lctx.audioTracks.length>1&&(this._trans.setAudioTrack(e),this._stat!==Vi.INIT&&this._stat!==Vi.LOADING&&(this._stat=Vi.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.clean(),this._ctx.streamingMux=!0))},i.setSubtitleTrack=function(e){this._trans&&e!==this._ctx.lctx.subtitleIdx&&this._ctx.lctx.subtitleTracks.length>=1&&this._subtitle&&this._subtitle.select(e)},i.liveEnd=function(){A.b.i(Yi,"liveEnd",this._ctx.stat.isLive),this._ctx.stat.isLive&&(this._ctx.stat.isLive=!1,this._liveEnd=!0,this._stopFlvLiveRetryTimer())},i.jumpToLiveTime=function(){var e=this._ctx;if(e.stat.isLive&&e.stat.liveShiftEnabled){var t=e.liveStartLocalTime;t&&(A.b.i(Yi,"jumpToLiveTime: "+t),this._video.currentTime=t,e.stat.liveShift=!1)}},i.getTotalVideoFrames=function(){return this._videoFrameMap?this._videoFrameMap.totalVideoFrames:-1},i.getCurrentVideoFrame=function(){return this._videoFrameMap?this._videoFrameMap.timeToIndex(this._video.currentTime):-1},i.preload=function(e,t){var i=this,n=this._ctx;!this._preloader&&yi&&(this._preloader=new yi(n),this._preloader.on(v.a.PRELOAD_COMPLETE,(function(){return i.emit(v.a.PRELOAD_COMPLETE)})),this._preloader.on(v.a.DOWNLOAD,(function(e){return i.emit(v.a.DOWNLOAD,e)}))),this._preloader&&(this._preloader.add(e,t),this._trans||this._preloader.active(!0))},i.seekToNextFrame=function(){if(!(this.getCurrentVideoFrame()>=this.getTotalVideoFrames()-1))if(this._videoDecProxy)this._videoDecProxy.step(L.j.NEXT);else if(this._videoFrameMap){var t=this._videoFrameMap.getNextFramePTSByTime(this._video.currentTime);t>=0&&(this._video.currentTime=t+.001)}else e.prototype.seekToNextFrame.call(this)},i.seekToPrevFrame=function(){if(0!==this.getCurrentVideoFrame())if(this._videoDecProxy)this._videoDecProxy.step(L.j.PREV);else if(this._videoFrameMap){var t=this._videoFrameMap.getPrevFramePTSByTime(this._video.currentTime);t>=0&&(this._video.currentTime=t+.001)}else e.prototype.seekToPrevFrame.call(this)},i.setCurretVideoFrame=function(t){this._videoFrameMap&&this._videoFrameMap.isIndexInRange(t)?this._videoFrameMap.indexToTime(t)>=0?this._video.currentTime=this._videoFrameMap.indexToTime(t)+.001:this._onError({type:p.b.MEDIA_ERROR,details:p.a.CANNOT_SEEK_BY_FRAME_INDEX,fatal:!1,reason:t+" out of range: [0, "+this.getTotalVideoFrames()+"]"}):e.prototype.setCurretVideoFrame.call(this,t)},i.getTrackBufInfo=function(){var e;return null==(e=this._mse)?void 0:e.trackBufInfo},i._onVideoLoadedmetadata=function(){!this._video.videoWidth&&this._ctx.canCodecFallback&&this.emit(v.a.FALLBACK_H264,{type:L.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec no width.",code:0})},i._onVideoPause=function(){e.prototype._onVideoPause.call(this),this._ctx.config.catchUpPausedLive&&!this._ctx.stat.liveShift&&(this._catchUpLive=!0)},i._onVideoPlaying=function(){if(!this._error&&this._ctx.live){var t=mt(this._ctx.stat.box)?this._ctx.stat.multipartLiveDelay||0:this._ctx.config.defaultSpts;if(t<0&&this._ctx.bufferedSec>-t/1e3+1&&this._catchUpLive){var i=this._ctx.bufferedEnd+t/1e3;this._ctx.isTimeinBuffered(i)&&this._internalSeek(i)}this._catchUpLive=!1}e.prototype._onVideoPlaying.call(this)},i._onVideoPlay=function(){this._error||this._trans||this.load(),this._videoDecProxy&&(this._videoDecProxy.start(),this._videoDecProxy.waiting&&this._videoDecProxy.isCanvasRenderer&&(this._videoDecProxy.pausedOnWaiting=!1,this._internalPause())),e.prototype._onVideoPlay.call(this)},i._onVideoEnded=function(){this._seekRollbackTime=0,this._internalSeekFlag=!1,this._skipSeekEvent=!1,e.prototype._onVideoEnded.call(this)},i._initMSE=function(){var e=this;(this._mse&&(this._mse.hasTrackInfo()||this._video.error)||this._eme.isActive)&&(A.b.i(Yi,"rebuild mse"),URL.revokeObjectURL(this._video.src),this._destroyMSE(),this._eme.isActive&&(A.b.i(Yi,"eme reset src"),this._video.src="",this._eme.reset())),this._mse?this._mse.clean():(this._mse=new ne(this._ctx.config,this._ctx.stat),this._mse.attach(this._video),this._ctx.mse=this._mse,this._mse.on(v.a.ERROR,(function(t){e._onError(t)})),this._mse.on(v.a.MSE_BUFFER_FULL,this._onMSEBufferFull),this._mse.on(v.a.MSE_UPDATE,this._onMSEUpdate))},i._verifyLevel=function(e){return!(!(this._trans&&this._ctx.lctx.levels.length>0&&e<this._ctx.lctx.levels.length&&this._mse&&this._video)||this._video.ended)},i._detectSeekOnCanplay=function(){this._seekOnCanplay&&this._mse&&!this._mse.hasCleanUpTask()&&this._ctx.isTimeinBuffered(this._video.currentTime+.001)&&(A.b.i(Yi,"seek on canplay "+this._video.currentTime+" + 0.001"),this._seekOnCanplay=!1,this._internalSeek(this._video.currentTime+.001))},i._internalSeek=function(e){this._internalSeekFlag=!0;try{this._video.currentTime=e}catch(e){}},i._initTrans=function(){this._trans=new Ai(this._ctx),this._trans&&(this._transmuxerEvent(this._trans),this._trans.init()),this._waitingHelper&&this._waitingHelper.reset()},i._transmuxerEvent=function(e){var t=this,i=this._mse,n=this._ctx;e.on(v.a.PARSING_DATA,this._onParsingData.bind(this)),e.on(v.a.PARSING_INIT_SEGMENT,(function(e){var a;if(t._nextLevel.length){var s=t._nextLevel.filter((function(e){return!e.switched}))[0];s&&(s.switched=!0,t.emit(v.a.LEVEL_SWITCHED,r()({},s.data)))}t._nextAudio&&(t.emit(v.a.AUDIO_TRACK_SWITCHED,t._nextAudio),t._nextAudio=void 0);var o=e.tracks.rawVideo||e.tracks.video,c=e.tracks.audio,u={};if(c){var d=c.metadata;u.hasAudio=!0,u.channel=d.channel,u.audioBitrate=d.audioBitrate,u.audioSampleRate=d.audioSampleRate,u.audioCodec=c.codec,u.audioCodecType=c.codecType}if(o){var _=o.metadata;u.hasVideo=!0,o.metadata.isFillVideo||(u.width=_.width,u.height=_.height,u.rotation=_.rotation,u.fps=_.fps,u.profile=_.profile,u.level=_.level,u.chromaFormat=_.chromaFormat,u.bitDepth=_.bitDepth,u.videoBitrate=_.videoBitrate,_.colorInfo&&(u.colorSpace=Object(oi.e)(_.colorInfo)),u.videoCodec=o.codec,u.videoCodecType=o.codecType),r()(u,o.metadata)}n.stat.codecType=u.videoCodecType=(null==o?void 0:o.codecType)||L.b.unknown,t._ctx.stat.audioCodec=(null==(a=t._ctx.lctx.current)?void 0:a.audioCodec)||u.audioCodec||"",n.lctx.current&&(!n.lctx.current.bitrate&&u.videoBitrate&&u.audioBitrate&&(n.lctx.current.bitrate=u.videoBitrate+u.audioBitrate),!n.lctx.current.maxBitrate&&null!=o&&o.metadata.videoMaxBitrate&&null!=c&&c.metadata.audioMaxBitrate&&(n.lctx.current.maxBitrate=o.metadata.videoMaxBitrate+c.metadata.audioMaxBitrate)),u.videoDecoder=n.stat.decoder,t._videoDecProxy&&t._videoDecProxy.setMediaInfo(r()({},u)),t.emit(v.a.MEDIA_INFO,u),t._mediaInfo=u,A.b.i(Yi,"mediainfo",u),i&&i.trackInfo(e),t._startMainTimer()})),e.on(v.a.ERROR,(function(e){t._onError(e)})),e.on(v.a.LOAD_END,this._onLoadEnd.bind(this)),e.on(v.a.SUBTITLE_LOADED,(function(e){t._subtitle&&t._subtitle.parseVTTs(e.data,e.start,e.cc)})),e.on(v.a.AUDIO_TRACK_SWITCHING,(function(e){e.id=t._levelSwitchId,t._levelSwitchId++,e.auto=n.lctx.abr,!e.smooth&&i&&(i.clean(),t._ctx.streamingMux=!0),t.emit(v.a.AUDIO_TRACK_SWITCHING,{time:e.time,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),t._nextAudio=e})),e.on(v.a.LEVEL_SWITCHING,(function(e){var r;e.id=t._levelSwitchId,t._levelSwitchId++,e.auto=n.lctx.abr,!e.smooth&&i&&(i.clean(),t._ctx.streamingMux=!0),"number"==typeof e.level&&(e.bitrate=e.level<0?-1:(null==(r=n.lctx.levels[e.level])?void 0:r.bitrate)||0),t.emit(v.a.LEVEL_SWITCHING,{time:e.time,bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),-1===e.level?t.emit(v.a.LEVEL_SWITCHED,{time:e.time,bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}):(e.smooth?t._nextLevel=t._nextLevel.sort((function(e,t){return e.data.time-t.data.time})).filter((function(t){return t.data.time<e.time-.5})):t._nextLevel=[],t._nextLevel.push({switched:!1,data:e}))})),e.on(v.a.BUFFER_CLEANING,(function(e){i&&i.clean(e.startSec,t._video.duration),t._videoDecProxy&&t._videoDecProxy.clean(1e3*e.startSec)})),e.on(v.a.METADATA,this._onMetadata.bind(this)),e.on(v.a.VIDEO_FRAME_INFO,this._onVideoFrameInfo.bind(this)),e.on(v.a.MANIFEST_PARSED,(function(){if(A.b.i(Yi,"manifest parsed"),"number"!=typeof t._playingLevel){var i=n.lctx.startIdx;"number"==typeof i&&(-1===i&&n.lctx.abr||e.setCurrentLevel(i)),t._playingLevel=n.lctx.currentIdx,n.lctx.subtitleTracks.length&&t._initSubtitle(),n.config.emeEnabled&&t._eme.onManifestParsed(n.lctx.levels,n.stat.drm),t.emit(v.a.MANIFEST_PARSED)}else e.setCurrentLevel(t._playingLevel)})),e.on(v.a.AUDIO_TRACK_UPDATED,(function(e){e&&((!n.stat.isLive||n.stat.liveShiftEnabled)&&e.duration&&i&&i.updateDuration(e.duration),A.b.i(Yi,"audio track update",e),t.emit(v.a.AUDIO_TRACK_UPDATED,e))})),e.on(v.a.LEVEL_UPDATED,(function(e){e&&((!n.stat.isLive||n.stat.liveShiftEnabled)&&e.duration&&i&&i.updateDuration(e.duration),A.b.i(Yi,"level update",e),t.emit(v.a.LEVEL_UPDATED,e))})),e.on(v.a.VIDEO_SEEK,(function(e){if(e.sec!==n.currentTime){t._skipSeekEvent=!0;try{t._internalSeek(e.sec)}catch(e){}}})),e.on(v.a.RAW_DATA,(function(e){t._videoDecProxy&&t._videoDecProxy.appendData(e),t._ctx.loadRec.onRaw(e)})),e.on(v.a.VIDEO_CODEC_DETECTED,(function(e){if(A.b.i(Yi,"video codec detected. dec:"+e.decoder+", codec:"+e.codecType+", bitDepth:"+e.bitDepth+" "+e.timeOffset),e.decoder&&(t._ctx.stat.decoder=e.decoder),t._videoDecProxy&&e.decoder===L.c.buildin)return t._videoDecProxy.decoderChange(L.c.buildin,e.timeOffset||0),void(n.config.ensureVideo?t._customWaitingEnded():(n.config.ensureVideo=!0,n.cOutput.updateRendererType(L.o.video),n.cOutput.rendererType===L.o.video&&t.emit(v.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:void 0,type:L.o.video}),t._reload(!t._videoDecProxy.pausedOnWaiting)));e.decoder===L.c.buildin&&(n.cOutput.updateRendererType(L.o.video),n.cOutput.rendererType===L.o.canvas&&t.emit(v.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:n.cOutput.canvas,type:L.o.canvas})),e.enabled&&e.decoder===L.c.wasm&&on?(t._initCanvasRenderer(on,e.codecType,e.bitDepth),t._videoDecProxy&&t._videoDecProxy.decoderChange(L.c.wasm,e.timeOffset||0)):e.enabled&&e.decoder===L.c.none&&n.stat.box===L.g.yuv&&Ki&&t._initCanvasRenderer(Ki,e.codecType,e.bitDepth)})),e.on(v.a.LOADER_CHUNK_ARRIVAL,(function(e){t.emit(v.a.LOADER_CHUNK_ARRIVAL,e),t._autoLazyload.update()})),Qi.forEach((function(i){return e.on(i,(function(e){return t.emit(i,e)}))}))},i._initCanvasRenderer=function(e,t,i){var n=this;void 0===i&&(i=8);var r=this._mse,a=this._ctx;if(!this._videoDecProxy){var s;r&&r.setAppendEnabled(!1),a.stat.mainThreadRendering=!!a.cOutput.hasVPP||a.config.mainThreadRendering,a.cOutput.updateRendererType(L.o.canvas);var o=this._videoDecProxy=new e(a);this._injectVideo(),o.on(v.a.ERROR,(function(e){return n._onError(e)})),o.on(v.a.DEC_LIB_LOADED,(function(e){return n.emit(v.a.DEC_LIB_LOADED,e)})),o.on(v.a.DEC_VIDEO_READY,this._videoDecFrameReady.bind(this)),o.on(v.a.STEP,this._videoDecStep.bind(this)),o.on(v.a.DECODER_SEEK,this._h265Seek.bind(this)),o.on(v.a.DECODER_WAITING,this._videoDecWaiting.bind(this)),o.on(v.a.VIDEO_RENDERER_CHANGE,(function(e){a.cOutput.updateRendererType(e.type)&&(e.type=a.cOutput.rendererType,n.emit(v.a.VIDEO_RENDERER_CHANGE,e))})),o.init(t,i),null!=(s=this._mse)&&s.ended()&&o.endOfData(),this.emit(v.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:a.cOutput.canvas,type:L.o.canvas})}},i._videoDecFrameReady=function(){A.b.i(Yi,"h265 video ready"),this._customWaitingEnded(),this._ctx.live?this._updateBufferControl():this._mse&&this._mse.setAppendEnabled(!0)},i._videoDecStep=function(e){if(A.b.i(Yi,"h265 step frame",e),e.type){var t=e.time/1e3;e.type===L.j.NEXT?(t<0&&(t=this._getNextFrameTime()),t!==this._video.currentTime&&(this._skipSeekEvent=!0,this._internalSeek(t))):t>=0?t!==this._video.currentTime&&(this._skipSeekEvent=!0,this._internalSeek(t)):this._video.currentTime=this._getPrevFrameTime()}},i._updateBufferControl=function(){var e=this._ctx;if(this._trans&&this._mse)if(e.stat.multipart||e.stat.isLive||this._stat!==Vi.WAITING){var t=e.bufferedSec,i=this._mse.getBufferQueueSec(),n=!0;if((t<e.stat.lazyLoadRecoverDuration||e.live&&!this._mse.getAppendEnabled())&&this._mse.setAppendEnabled(!this._videoDecProxy||!this._videoDecProxy.isCanvasRenderer||!this._videoDecProxy.waiting),e.stat.lazyLoadMaxDuration>0&&t+i>=("closed"===this._mse.readyState?1:e.stat.lazyLoadMaxDuration))n=!1;else{if(!(t+i<e.stat.lazyLoadRecoverDuration))return void this._autoLazyload.checkStreamingMux();this._autoLazyload.checkStreamingMux(),n=!0}!e.live&&this._trans&&(A.b.v(Yi,"download: "+n+" buffered:"+t+" mse:"+i),!n&&this._videoDecProxy&&this._videoDecProxy.decBufLow&&(A.b.i(Yi,"dec data empty, download enable."),n=!0),this._trans.setDownloadEnabled(n)),this._mse.pendingNum()&&this._mse.refresh()}else this._trans.setDownloadEnabled(!0)},i._onVideoSeeking=function(){if(A.b.i(Yi,"seek to "+this._video.currentTime+" internal:"+this._internalSeekFlag),this._mediaInfo&&!(this._video&&this._video.currentTime>=this._video.duration&&this._mse&&this._mse.ended())){this._ctx.streamingMux=!0;var e=this._internalSeekFlag;if(this._internalSeekFlag=!1,this._skipSeekEvent)this._skipSeekEvent=!1;else{this.emit(v.a.SEEKING,{internal:e});var t=this._video.currentTime;if(e||this._ctx.updateLiveShiftStatuByTime(t),this._videoDecProxy&&this._videoDecProxy.isCanvasRenderer){if(e)return;this._videoDecProxy.seek(t)}else this._ctx.isTimeinBuffered(t)?e||(R.a.msedge||R.a.msie?(this._seekOnCanplay=!0,this._seekWithLoad()):this._trans&&mt(this._ctx.stat.box)&&this._trans.seek(t,!1,!0)):0===t&&this._video.buffered.length>0&&this._video.buffered.start(0)<1?e||this._internalSeek(this._video.buffered.start(0)):this._seekWithLoad()}}},i._h265Seek=function(e){A.b.i(Yi,"h265 seek frame",e),e.hitCache?this._updateBufferControl():this._seekWithLoad()},i._videoDecWaiting=function(){A.b.i(Yi,"h265 render buf empty"),this._customWaiting()},i._customWaiting=function(){!this._video.ended&&this._videoDecProxy&&this._videoDecProxy.isCanvasRenderer&&(this._video.paused||this._internalPause(),function(e,t,i){if(e&&e.dispatchEvent&&window.CustomEvent){var n=new CustomEvent(t,i);e.dispatchEvent(n)}}(this._video,"waiting"))},i._customWaitingEnded=function(){this._videoDecProxy&&!1===this._videoDecProxy.pausedOnWaiting&&this._video.play()},i._destroyTrans=function(){this._trans&&(this._trans.destroy(),this._trans.removeAllListeners(),this._trans=void 0)},i._destroyMSE=function(){this._ctx.mse=void 0,this._mse&&(this._mse.removeAllListeners(),this._mse.destroy(),this._mse=void 0)},i._destroyDecoder=function(){this._videoDecProxy&&(this._videoDecProxy.destroy(),this._videoDecProxy=void 0)},i._reload=function(e){void 0===e&&(e=!0),A.b.i(Yi,"reload. play: "+e),this._ctx.cOutput.reset(),this._ctx.live||(this._ctx.stat.startFromSec=this._video.currentTime),this._trans&&(this._ctx.lctx.startIdx=this._ctx.lctx.currentIdx),this._ctx.streamingMux=!0,this._nextLevel=[],this._internalSeekFlag=!1,this._stopVideo(),this._load(L.f.retry),e?this._video.play():this._video.pause()},i._startMainTimer=function(){this._mainTimer||(this._mainTimer=setInterval(this._mainLoop.bind(this),100))},i._stopMainTimer=function(){this._mainTimer&&(clearInterval(this._mainTimer),this._mainTimer=void 0)},i._stopVideo=function(){A.b.i(Yi,"stop video"),this._video&&(this._destroyTrans(),this._destroyDecoder(),this._destroyMSE(),URL.revokeObjectURL(this._video.src),this._video.src&&(this._video.src=""))},i._mainLoop=function(){var e=this._ctx;e.stat.isLive?(!this._playbackRateManager&&e.config.autoPlaybackRateConf&&(this._playbackRateManager=new Fi(e)),this._playbackRateManager&&(this._playbackRateManager.enabled=!e.stat.liveShift,this._playbackRateManager.tick())):this._playbackRateManager&&(this._playbackRateManager.enabled=!1);var t=this._video;this._waitingHelper&&e.stat.firstFrameLoaded&&this._waitingHelper.check();var i=t.buffered.length>1,n=this._stat===Vi.WAITING&&!t.seeking||this._stat===Vi.LOADING||this._stat===Vi.INIT||this._stat===Vi.SEEK||this._stat===Vi.SELECT_BITRATE;if((i||n)&&!t.ended&&this._mse&&!this._mse.hasCleanUpTask()&&this._mse.hasSourceBufferAppendStarted()){var r=t.currentTime,a=e.currentBuffer(r),s=e.nextBuffer(r);n?!a||a.end-r<1?(s&&A.b.i(Yi,"try jump next A"),this._jumpToBuf(s)):this._video.buffered.length>1&&a.end-r>1&&(a&&A.b.i(Yi,"try jump next B"),this._jumpToBuf(a)):i&&a&&a.end-r<=.1&&(s&&A.b.i(Yi,"try jump next C"),this._jumpToBuf(s))}this._nextLevel.length&&this._checkLevelChange()},i._jumpToBuf=function(e){if(e){var t=e.start+(R.a.safari?.3:.001);t>e.end&&(t=e.start),this._internalSeek(t),A.b.i(Yi,"jump to "+t)}},i._checkLevelChange=function(){var e=this._nextLevel[0];e&&this._video.currentTime>=e.data.time&&this._ctx.isTimeinBuffered(this._video.currentTime)&&(e.switched||this.emit(v.a.LEVEL_SWITCHED,r()({},e.data)),this.emit(v.a.LEVEL_SWITCH_PLAYING,e.data),this._playingLevel=e.data.level,this._nextLevel.shift())},i._load=function(e){A.b.i(Yi,"_load start sec:",this._ctx.stat.startFromSec),this._mediaInfo=void 0,this._error=void 0,this._internalSeekFlag=!1,this._stat=Vi.LOADING,this._nextLevel=[],this._stopMainTimer(),this._videoFrameMap=void 0,this._stopFlvLiveRetryTimer(),this.emit(v.a.LOAD,{type:e}),this._subtitle&&this._subtitle.reset(),this._trans&&this._destroyTrans(),this._destroyDecoder(),this._initMSE(),this._ctx.config.startPlayBufferSec&&!e&&this._mse&&this._mse.setStartBufSec(this._ctx.config.startPlayBufferSec),this._startHeartbeat(),this._initTrans(),this._trans&&this._trans.loadSource(),this._ctx.stat.isLive&&(this._liveEnd=!1,this._ctx.config.autoPlaybackRate&&this._playbackRateManager&&(this._playbackRateManager.enabled=!0))},i._onParsingData=function(e){this._ctx.mse&&this._ctx.mse.mediaSegment(e.segments),this._ctx.liveDelay.onParsing(e),this._ctx.loadRec.onParsing(e),this.emit(v.a.PARSING_DATA,e),this._videoDecProxy&&this._videoDecProxy.onParsingData(e),this._updateBufferControl()},i._onMetadata=function(e){!this._ctx.stat.isLive&&e.videoFramesInfo&&(this._videoFrameMap=new Ui(e.videoFramesInfo)),delete e.videoFramesInfo,"number"==typeof e.duration&&this._mse&&(delete e.keyframes,this._trans&&!this._ctx.stat.multipart&&this._mse.updateDuration(e.duration)),this.emit(v.a.METADATA,e)},i._onVideoFrameInfo=function(e){!this._ctx.stat.isLive&&e.videoFramesInfo&&(this._videoFrameMap?this._videoFrameMap.update(e.videoFramesInfo):this._videoFrameMap=new Ui(e.videoFramesInfo))},i._onLoadEnd=function(e){void 0===e&&(e=!1),e||(this._ctx.stat.isLive=!1),this._mse&&this._mse.endOfData(),this._videoDecProxy&&this._videoDecProxy.endOfData(),this.emit(v.a.LOAD_END)},i._onVideoCanplay=function(){e.prototype._onVideoCanplay.call(this),this._stat!==Vi.NONE&&(this._stat=Vi.NONE,this._detectSeekOnCanplay(),this._checkLevelChange(),this._video.paused||this._onVideoPlaying())},i._onVideoTimeupdate=function(){this._video.seeking||(this._seekRollbackTime=this._video.currentTime),e.prototype._onVideoTimeupdate.call(this),Bi()&&performance.now()-this._lastTimeupdateTime>d.g&&(this._updateBufferControl(),this._lastTimeupdateTime=performance.now())},i._onVideoSeeked=function(){this._mediaInfo&&e.prototype._onVideoSeeked.call(this)},i._onVideoWaiting=function(){if(this._liveEnd&&this._ctx.stat.box===L.g.flv&&this._ctx.stat.isLive)this.stopLoad();else{this._stat=this._stat||Vi.WAITING;var e=this._ctx.bufferedSec,t=!this._video.ended&&!this._video.seeking&&this._stat===Vi.WAITING;this.emit(v.a.WAITING,{block:t,bufferedSec:e})}},i._onVideoError=function(e){var t;if(A.b.e(Yi,"video error",e),!this._error&&this._mediaInfo){var i="video error";this._video&&this._video.error&&(i+=" code:"+this._video.error.code+" message:"+this._video.error.message);var n=(null==(t=this._video.error)?void 0:t.code)||0,r=ae(p.c[n],i);if(4===n){if(this._ctx.canCodecFallback)return void this.emit(v.a.FALLBACK_H264,{type:L.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec error. video error: "+n,code:r});if(on&&this._ctx.stat.codecType===L.b.hevc&&this._ctx.stat.decoder===L.c.buildin&&this._ctx.config.wasmDecoderEnabled&&tn.TYPE_SUPPORTED.hevc&&!R.a.mobile)return A.b.i(Yi,"buildin hevc dec error"),tn.TYPE_SUPPORTED.hevc=!1,this.emit(v.a.RETRY,{type:L.h.HEVC_DEC,message:"buildin "+(tn.isSupportHW?"hardware":"software")+" hevc dec error. video error: "+n,code:r}),void this._reload()}if(3===n){var a=performance.now();if((!this._recoverMediaErrorTime||a-this._recoverMediaErrorTime>3e3)&&this._recoverSwapRemuxType(r))return void(this._recoverMediaErrorTime=a);if(this._recoverSwapAudioCodec(r))return}this._onError({type:p.b.MEDIA_ERROR,details:(n?p.c[n]:p.a.VIDEO_ERROR)||p.a.VIDEO_ERROR,fatal:!0,reason:i})}},i._heartbeat=function(){var t;e.prototype._heartbeat.call(this),this._trans&&this._trans.heartbeat(),this._updateBufferControl(),this._trans&&this._preloader&&!this._ctx.stat.isLive&&this._preloader.active(!this._ctx.stat.isNetworkInUse&&"closed"!==(null==(t=this._mse)?void 0:t.readyState))},i._onError=function(t){if(t.type===p.b.NETWORK_ERROR&&this._ctx.stat.isLive&&this._ctx.stat.box===L.g.flv&&this._flvLiveRetry<this._ctx.config.maxRetry)this._startFlvLiveRetryTimer(Math.max(this._ctx.config.retryDelay,1e3*this._ctx.bufferedSec),t);else{if(!this._ctx.stat.multipart&&t.fatal){var i=this._ctx.lctx.current;if(i&&i.urlId<i.url.length-1){var n=ae(t.details,t.reason,t.statusCode);return this.emit(v.a.RETRY,{type:L.h.BACKUP,message:"trans error. use backup url.",code:n}),i.urlId++,void this._reload()}}if(t.fatal){if(t.details===p.a.REMUX_WORKER_ERROR&&this._ctx.stat.webWorker)return this._ctx.stat.webWorker=!1,this.emit(v.a.RETRY,{type:L.h.REMUX,message:"remux worker error",code:ae(t.details,t.reason,t.statusCode)}),void this._reload();this._video.error&&this._destroyMSE(),this._stopMainTimer()}e.prototype._onError.call(this,t)}},i._recoverSwapRemuxType=function(e){var t,i=this._ctx.stat.gopRemux,n=this._ctx.streamingMux;return this._ctx.stat.box===L.g.flv&&this._ctx.stat.isLive?this._ctx.stat.gopRemux=!0:this._ctx.streamingMux=!1,(i!==this._ctx.stat.gopRemux||n!==this._ctx.streamingMux)&&(A.b.i(Yi,"recover swap remux type"),this.emit(v.a.RETRY,{type:L.h.CODEC_REMUX_TYPE,message:"change remux type. video error: "+(null==(t=this._video.error)?void 0:t.code),code:e}),this._reload(),!0)},i._recoverSwapAudioCodec=function(e){var t,i=this._ctx.stat.audioCodec;return!(this._audioCodecSwap||!i)&&(i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5",this._ctx.stat.audioCodec=i,this._audioCodecSwap=!0,this.emit(v.a.RETRY,{type:L.h.CODEC_AUDIO,message:"change audio codec: "+i+". video error: "+(null==(t=this._video.error)?void 0:t.code),code:e}),A.b.i(Yi,"recover swap audio codec"),this._reload(),!0)},i._initSubtitle=function(){var e=this;this._trans&&(!this._subtitle&&Ni&&(this._subtitle=new Ni(this._ctx),this._subtitle.on(v.a.SUBTITLE_TRACK_SWITCHED,(function(t){e._trans&&(e._trans.setSubtitleTrack(t.level),e.emit(v.a.SUBTITLE_TRACK_SWITCHED,t))}))),this._subtitle&&this._subtitle.addTracks(this._ctx.lctx.subtitleTracks))},i._internalPause=function(){this._internalPauseFlag=!0,this._video.pause()},i._injectVideo=function(){var e=this;!this._nativeVideoFunc&&this._videoDecProxy&&(this._nativeVideoFunc={play:this._video.play,pause:this._video.pause},this._video.pause=function(){e._nativeVideoFunc.pause.call(e._video),e._videoDecProxy&&e._videoDecProxy.waiting&&e._videoDecProxy.isCanvasRenderer&&!e._internalPauseFlag&&(e._videoDecProxy.pausedOnWaiting=!0),e._internalPauseFlag=!1},this._video.play=function(){return e._videoDecProxy&&e._videoDecProxy.waiting&&e._videoDecProxy.isCanvasRenderer?(e._videoDecProxy.pausedOnWaiting=!1,new Promise((function(e,t){return e()}))):e._nativeVideoFunc.play.call(e._video)})},i._startFlvLiveRetryTimer=function(e,t){var i=this;if(!this._flvLiveRetryTimer){var n=ae(t.details,t.reason,t.statusCode);this._flvLiveRetryTimer=setTimeout((function(e){A.b.i(Yi,"live retry:"+i._flvLiveRetry),i._flvLiveRetry++,i.emit(v.a.RETRY,{type:L.h.LIVE,message:"reason: "+(null==e?void 0:e.reason)+". retry: "+i._flvLiveRetry,code:n}),i._reload()}),e,t)}},i._stopFlvLiveRetryTimer=function(){this._flvLiveRetryTimer&&(clearTimeout(this._flvLiveRetryTimer),this._flvLiveRetryTimer=void 0)},i._isSwitchLevelByReload=function(){return this._ctx.stat.box!==L.g.flv&&!mt(this._ctx.stat.box)},s()(t,[{key:"type",get:function(){return L.a.mse}}]),t}(Wi),qi="undefined"==typeof document?void 0:document.createElement("video"),Zi={av1:['video/mp4; codecs="av01.0.15M.10,mp4a.40.2"'],hevc:['video/mp4; codecs="hev1.1.6.L150.90,mp4a.40.2"','video/mp4; codecs="hvc1.1.6.L150.90,mp4a.40.2"'],h264:['video/mp4; codecs="avc1.42E01E,mp4a.40.2"'],opus:['video/mp4; codecs="opus"'],mp3:['video/mp4; codecs="mp3"'],aac:['video/mp4; codecs="mp4a.40.2"']},Ji={mp4:["video/mp4","video/quicktime"],flv:["video/x-flv"],ts:["video/mp2t"],matroska:["video/x-matroska","video/webm"],hls:["application/vnd.apple.mpegURL","application/x-mpegURL"],hls_ts:["application/vnd.apple.mpegURL","application/x-mpegURL"],hls_fmp4:["application/vnd.apple.mpegURL","application/x-mpegURL"],aac:["audio/aac"],mp3:["audio/mpeg","audio/mp3"]},$i=function(){function e(){}return e.isMSEAvailable=function(){if(void 0!==e.MSE_AVAILABLE)return e.MSE_AVAILABLE;if(!Xi)return e.MSE_AVAILABLE=!1,!1;var t=X(),i=q();if(e.MSE_API_AVAILABLE=!!(t&&i&&i.prototype&&"function"==typeof i.prototype.appendBuffer&&"function"==typeof i.prototype.remove),t&&R.a.mobile&&e.MSE_API_AVAILABLE)try{var n=new t,r=document.createElement("video");r.src=URL.createObjectURL(n),URL.revokeObjectURL(r.src),e.MSE_AVAILABLE=!0}catch(t){e.MSE_AVAILABLE=!1}else e.MSE_AVAILABLE=e.MSE_API_AVAILABLE;return e.MSE_AVAILABLE},e.isSupported=function(t){return void 0===t&&(t=L.b.h264),e.isMSECodecSupported(t)&&e.isMSEAvailable()},e.isMSECodecSupported=function(t){if(void 0===t&&(t=L.b.h264),R.a.msedge||R.a.msie)return e.isMSEAvailable()&&t===L.b.h264;if(t===L.b.hevc&&!1===e.playHEVCTest)return!1;var i=Zi[t];return!!i&&i.reduce((function(t,i){return t||e.isMSECodecStrSupported(i)}),!1)},e.isVideoCodecSupported=function(t){if(void 0===t&&(t=L.b.h264),R.a.msedge||R.a.msie)return t===L.b.h264;if(t===L.b.hevc&&!1===e.playHEVCTest)return!1;var i=Zi[t];return!!i&&i.reduce((function(e,t){return e||!(!qi||!qi.canPlayType(t))}),!0)},e.isVideoBoxSupported=function(e){if(void 0===e&&(e=L.g.mp4),e===L.g.unknown)return!0;var t=Ji[e];return!!t&&t.reduce((function(e,t){return e||!(!qi||!qi.canPlayType(t))}),!1)},e.isVideoCodecStrSupportedInMp4=function(e,t){return void 0===t&&(t=""),!(!qi||!qi.canPlayType((t||"video")+'/mp4;codecs="'+e+'"'))},e.isWebRTCSupported=function(){return"RTCPeerConnection"in window&&"RTCRtpTransceiver"in window},e.isMSECodecStrSupportedInMp4=function(e,t){var i;return void 0===t&&(t=""),!(null==(i=X())||!i.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"'))},e.isMSECodecStrSupported=function(e){var t=X();return!(!t||"function"!=typeof t.isTypeSupported||!t.isTypeSupported(e))},e.isChangeTypeSupported=function(){if(void 0===e._changeTypeSupported){var t=q();e._changeTypeSupported=!(!t||void 0===t.prototype.changeType)}return e._changeTypeSupported},e.getVideoCodecCompatibilityByCodec=function(t){var i=L.c.unsupported,n=!0;t===L.b.h264?i=e.isMSECodecSupported(L.b.h264)?L.c.buildin:L.c.unsupported:t===L.b.av1?(i=e.isMSECodecSupported(L.b.av1)?L.c.buildin:L.c.unsupported,n=Y()>=2):t===L.b.hevc?(i=e.isMSECodecSupported(L.b.hevc)?L.c.buildin:L.c.unsupported)===L.c.buildin?(R.a.msedge&&(i=L.c.unsupported),n=Y()>=2||R.a.safari):n=e.wasmSmooth:t!==L.b.kvc3&&t!==L.b.kvc4&&t!==L.b.kvc5&&t!==L.b.kvc6&&t!==L.b.vvc&&t!==L.b.kvc30&&t!==L.b.bvc2||(i="undefined"!=typeof WebAssembly?L.c.wasm:L.c.unsupported,n=e.wasmSmooth);var r=!1;return i===L.c.buildin&&(r=e.isChangeTypeSupported(),t===L.b.hevc&&!1===this.playHEVCTest&&(i=L.c.wasm)),{decoder:i,smooth:i!==L.c.unsupported&&n,mix:r}},e._threads=function(){try{return"undefined"!=typeof WebAssembly&&"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}},e._simd=function(){return"undefined"!=typeof WebAssembly&&WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))},s()(e,null,[{key:"isSupportSimd",get:function(){return void 0===e._isSupportSimd&&(e._isSupportSimd=e._simd()),e._isSupportSimd}},{key:"isSupportThreads",get:function(){return void 0===e._isSupportThreads&&(e._isSupportThreads=e._threads()),e._isSupportThreads}},{key:"wasmSmooth",get:function(){if(void 0===e._wasmSmooth){var t=Y();e._wasmSmooth=!!(e.isSupportHW&&e.isSupportThreads&&t&&t>=6)}return e._wasmSmooth}},{key:"isSupportHW",get:function(){return!!Object($.a)().performance}},{key:"playHEVCTest",get:function(){return this._playHEVCTest},set:function(e){this._playHEVCTest=e}}]),e}();$i._changeTypeSupported=void 0,$i.MSE_AVAILABLE=void 0,$i.MSE_API_AVAILABLE=void 0,$i._isSupportSimd=void 0,$i._isSupportThreads=void 0,$i._wasmSmooth=void 0,$i._playHEVCTest=void 0,$i.TYPE_SUPPORTED={mpeg:$i.isMSECodecStrSupported("audio/mpeg"),mp3:$i.isMSECodecSupported(L.b.mp3),opus:$i.isMSECodecSupported(L.b.opus),hevc:$i.isMSECodecSupported(L.b.hevc),av1:$i.isMSECodecSupported(L.b.av1)};var en,tn=$i,nn=i(42),rn=function(){function e(e,t){var i=this;this._evt=void 0,this._ctx=void 0,this._decInline=void 0,this._decW=void 0,this._id=0,this._onWorkMessage=function(e){var t=e.data;i._onMessage(e.data.event,t.data)},this._onMessage=function(e,t){i._decW&&i._evt.emit(e,t)},this._evt=e,this._ctx=t}var t=e.prototype;return t.init=function(e){void 0===e&&(e=!0),A.b.i("dec-wrapper","init worker: "+e),e&&(this._decW=f()(50)),this._decW?this._decW.addEventListener("message",this._onWorkMessage):this._decInline=new nn.a(this._evt)},t.start=function(e,t,i,n,r){A.b.i("dec-wrapper","start");var a=this._ctx.getDecConfig();this._decW?this._decW.postMessage({cmd:m.a.INIT_265,id:this._id,lib:e,config:a,simd:i,threads:t,codecType:n,decoderType:r}):this._decInline&&this._decInline.init(this._id,e,a,i,t,n,r)},t.destroy=function(){this._decW?(this._decW.postMessage({cmd:m.a.DESTROY}),this._decW.removeEventListener("message",this._onWorkMessage),this._decW.terminate()):this._decInline&&(this._decInline.destroy(),this._decInline=void 0)},t.append=function(e){this._decW?this._decW.postMessage({cmd:m.a.APPEND_DATA,data:e}):this._decInline&&this._decInline.appendData(e)},t.endOfData=function(){this._decW?this._decW.postMessage({cmd:m.a.END_OF_DATA}):this._decInline&&this._decInline.endOfData()},t.updateMediaInfo=function(e){this._decW?this._decW.postMessage({cmd:m.a.MEDIA_INFO,mediaInfo:e}):this._decInline&&this._decInline.updateMediaInfo(e)},t.reset=function(e){this._decW?this._decW.postMessage({cmd:m.a.RESET,decId:this._id,seeking:e}):this._decInline&&this._decInline.reset(this._id,e)},t.clean=function(e){this._decW?this._decW.postMessage({cmd:m.a.CLEAN,startTime:e}):this._decInline&&this._decInline.clean(e)},t.seek=function(e){this._decW?this._decW.postMessage({cmd:m.a.SEEK,time:e}):this._decInline&&this._decInline.seek(e)},t.update=function(e,t,i,n,r,a){this._decW?this._decW.postMessage({cmd:m.a.UPDATE_STATE,streamTime:e,output:t,active:i,frameBufLen:n,playbackRate:r,maxFrameBufLen:a}):this._decInline&&this._decInline.updateState(e,t,i,n,r,a)},s()(e,[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"isUseingWorker",get:function(){return!!this._decW}}]),e}(),an=[4,2],sn=[8,6,4,2];!function(e){e[e.data=0]="data",e[e.end=1]="end"}(en||(en={}));var on=function(e){function t(t){var i;return(i=e.call(this,t)||this)._initCache=[],i._d=void 0,i._audioSegmentCnt=0,i._decAppendActive=!0,i._libCacheHit=!1,i._activeTimes=[],i._state={streamTime:0,stoped:!1,output:L.o.canvas,decAppendActive:!0,frameBufLen:0,maxFrameBufLen:0},i._simdEnabled=void 0,i._threadsEnabled=void 0,i._codecType=L.b.hevc,i._decoderType=L.p.kw265,i._decId=1,i._lastDecoder=void 0,i._nextSeek=-1,i._libLoader=void 0,i._decBufLow=!1,i._onDecLibLoaded=function(e){A.b.i("v-dec-proxy","dec lib loaded"),i.emit(v.a.DEC_LIB_LOADED,e),i._libCacheHit=e.hitCache,i._initDecoder(e.lib)},i._onDecImg=function(e){i._ctx.updateVideoPlaybackQuality(e.decoded,e.droped),e.decId===i._decId&&i._r.append(e.frame)},i._onDecSeek=function(e){A.b.i("v-dec-proxy","decoder seek event",e),e.hitCache&&(i._waiting=!1),e.hitCache||(i._reset(!0),i._updateState()),i._onSeeked(e)},i._onDecSeekAbort=function(){if(A.b.i("v-dec-proxy","seek abort"),i._seeking=!1,-1!==i._nextSeek){var e=i._nextSeek;i._nextSeek=-1,i.seek(e)}},i._onDecVideoReady=function(){i._waiting=!1,i.emit(v.a.DEC_VIDEO_READY),i._pausedOnWaiting=void 0},i._onDecWaiting=function(e){var t,n;null!=(t=i._ctx.video)&&t.ended||(i._bufRules.onWaiting(),i._waiting=!0,void 0===i._pausedOnWaiting&&(i._pausedOnWaiting=!(null==(n=i._ctx.video)||!n.paused)),i.emit(v.a.DECODER_WAITING,e))},i._onDecInitComplete=function(e){for(i._ready=!0,i._updateMediaInfo();i._initCache.length;){var t=i._initCache.shift();t&&(t.type===en.data?i._d.append(t.data):t.type===en.end&&i._d.endOfData())}i._ctx.stat.wasmSimd=e.simd,i._ctx.stat.wasmThreads=e.threads,i._ctx.stat.wasmDecoder=e.decoderType},i._onDecBufLow=function(){i._decBufLow=!0},i._onDecError=function(e){if(e.details===p.a.DECODER_INIT_ERROR&&(i._libCacheHit||i._threadsEnabled))return i._threadsEnabled&&(i._threadsEnabled=!1),void i._loadLib(!0);i.emit(v.a.ERROR,e)},i._onRenSeek=function(e){A.b.i("v-dec-proxy","renderer seek event",e),e.hitCache?(i._waiting=!1,i._onSeeked(e)):(i._onDecWaiting(),i._d.seek(e.time))},i._onRenExp=function(){A.b.i("v-dec-proxy","renderer buf expired"),i._r.flush(0)},i._onRenBufUpdate=function(e){i._decAppendActive=!!e.needMore},i._libLoader=new Q(i._ctx.config),i._libLoader.on(v.a.DEC_LIB_LOADED,i._onDecLibLoaded),i._libLoader.on(v.a.ERROR,(function(e){return i.emit(v.a.ERROR,e)})),i._state.maxFrameBufLen=i._bufRules.maxFrameBufLen,i._simdEnabled=tn.isSupportSimd,i._threadsEnabled=!!(tn.isSupportThreads&&i._ctx.config.maxVideoDecThreads>1),i._d=new rn(i._evt,t),i._d.id=i._r.id=i._decId,i}u()(t,e);var i=t.prototype;return i.init=function(e,t){var i=this;A.b.i("v-dec-proxy","init codecType: "+e+" bitDepth: "+t),e&&(this._codecType=e),e===L.b.kvc3?this._decoderType=L.p.kvc3:e===L.b.kvc4?this._decoderType=L.p.kvc4:e===L.b.kvc5?this._decoderType=L.p.kvc5:e===L.b.kvc6?this._decoderType=L.p.kvc6:e===L.b.hevc?(this._decoderType=L.p.kw265,t&&t>8&&(this._decoderType=L.p.h265)):e!==L.b.bvc2&&e!==L.b.kvc30&&e!==L.b.vvc||(this._decoderType=L.p.kvc30);var n=this._evt;n.on(v.a.DEC_INIT_COMPLETE,this._onDecInitComplete),n.on(v.a.DECODER_IMG,this._onDecImg),n.on(v.a.DEC_VIDEO_READY,this._onDecVideoReady),n.on(v.a.STEP,(function(e){return i.emit(v.a.STEP,e)})),n.on(v.a.DECODER_SEEK,this._onDecSeek),n.on(v.a.DECODER_SEEK_ABORT,this._onDecSeekAbort),n.on(v.a.DECODER_WAITING,this._onDecWaiting),n.on(v.a.DECODER_DATA_END,(function(){return i._r.endOfData()})),n.on(v.a.DECODER_BUF_LOW,(function(){return i._onDecBufLow()})),n.on(v.a.DECODER_DROP_FRAME,(function(e){return i._r.dropFrame(e)})),n.on(v.a.RENDERER_BUF_UPDATE,this._onRenBufUpdate),n.on(v.a.RENDERER_BUF_EXPIRED,this._onRenExp),n.on(v.a.RENDERER_SEEK,this._onRenSeek),n.on(v.a.ERROR,this._onDecError),this._r.id=this._decId,this._r.init(R.a.chrome&&!1===this._ctx.stat.mainThreadRendering),this._d.init(),this._loadLib()},i.setMediaInfo=function(t){e.prototype.setMediaInfo.call(this,t),this._updateMediaInfo()},i.destroy=function(){this._d.destroy(),e.prototype.destroy.call(this)},i.appendData=function(e){this._ready?(this._decBufLow=!1,this._d.append(e)):this._initCache.push({type:en.data,data:e})},i.endOfData=function(){A.b.i("v-dec-proxy","endOfData"),this._ready?this._d.endOfData():this._initCache.push({type:en.end})},i.decoderChange=function(e,t){A.b.i("v-dec-proxy","decoderChange type: "+e+" time: "+t),this._lastDecoder=e;var i=this._activeTimes;e===L.c.wasm?(!i.length||i.length&&-1!==i[i.length-1].end)&&i.push({start:t,end:-1}):e===L.c.buildin&&i.length&&-1===i[i.length-1].end&&(i[i.length-1].end=t)},i.onParsingData=function(e){var t=this;e.segments.forEach((function(e){e.type===L.l.AUDIO&&t._audioSegmentCnt++}))},i.seek=function(e){A.b.i("v-dec-proxy","seek: "+e+" "+this._seeking),e*=d.a,this._seeking?this._nextSeek=e:(this._seeking=!0,this._r.seek(e),this.start())},i.seekWithLoad=function(){A.b.i("v-dec-proxy","seekWithLoad"),this._ready?(this._reset(!0),this._updateState()):this._initCache=[]},i.clean=function(e){void 0===e&&(e=0),A.b.i("v-dec-proxy","flush"),(e*=d.a)?(this._d.clean(e),this._r.flush(e)):this._reset(!1)},i._updateState=function(){var e=this._ctx.cOutput.canvas;if(e instanceof HTMLCanvasElement){var t,i,n=this._ctx.currentTime*d.a,r=!(null==(t=this._ctx.video)||!t.ended),a=(null==(i=this._ctx.video)?void 0:i.playbackRate)||1,s=this.isCanvasRenderer?L.o.canvas:L.o.video,o=!1,c=this._checkResize(e),u=this._decAppendActive,_=this._state;if(_.output!==s&&(_.output=s,o=!0,this.emit(v.a.VIDEO_RENDERER_CHANGE,{type:_.output,canvas:e,enabled:!0})),0!==n||this._audioSegmentCnt||(n=-1),_.streamTime===n&&_.stoped===r&&_.decAppendActive===u&&_.frameBufLen===this._r.frameBufLen&&_.maxFrameBufLen===this._bufRules.maxFrameBufLen||(_.streamTime=n,_.stoped=r,_.decAppendActive=u,_.frameBufLen=this._r.frameBufLen,_.maxFrameBufLen=this._bufRules.maxFrameBufLen,o=!0),!o&&!this._waiting&&!c)return;(o||this._waiting)&&this._d.update(n,s,u,this._r.frameBufLen,a,_.maxFrameBufLen),(o||c)&&this._r.update(n,this._size.w,this._size.h,r,s,_.maxFrameBufLen)}},i._updateMediaInfo=function(){if(this._mediaInfo.length&&this._ready){var e=this._mediaInfo.shift();if(e){var t={};e.rotation&&(t.rotation=((null==e?void 0:e.rotation)||0)%360,t.rotation<0&&(t.rotation+=360)),e.fps&&(t.fps=e.fps),e.colorInfo&&(t.colorInfo=JSON.parse(JSON.stringify(e.colorInfo))),this._d.updateMediaInfo(t),this._r.updateMediaInfo(t)}}},i._reset=function(e){void 0===e&&(e=!1),this._decId++,this._decAppendActive=!0,this._audioSegmentCnt=0,this._activeTimes=[],e||(this._seeking=!1,this._nextSeek=-1),this._lastDecoder===L.c.wasm&&this._activeTimes.push({start:0,end:-1}),this._d.id=this._r.id=this._decId,this._d.reset(e),this._r.reset(e),this._waiting=!0},i._loadLib=function(e){void 0===e&&(e=!1),void 0===this._simdEnabled||void 0===this._threadsEnabled?(this._simdEnabled=!!tn.isSupportSimd,this._threadsEnabled=!!(tn.isSupportThreads&&this._ctx.config.maxVideoDecThreads>1),this._libLoader.load(e,this._decoderType,this._simdEnabled,this._threadsEnabled)):this._libLoader.load(e,this._decoderType,this._simdEnabled,this._threadsEnabled)},i._initDecoder=function(e){A.b.i("v-dec-proxy","init dec"),this.start();var t=this._threadsEnabled?this._getThreadNum():1;this._d.id=this._decId,this._d.start(e,t,!!this._simdEnabled,this._codecType,this._decoderType)},i._getThreadNum=function(){var e=Math.min(Y(),this._ctx.config.maxVideoDecThreads),t=sn;this._decoderType===L.p.kw265&&(t=an);for(var i=0;i<t.length;i++)if(e>=t[i])return t[i];return t[t.length-1]},i._onSeeked=function(e){if(A.b.i("v-dec-proxy","seeked"),this._seeking=!1,-1===this._nextSeek)this.emit(v.a.DECODER_SEEK,e);else{var t=this._nextSeek;this._nextSeek=-1,this.seek(t)}},s()(t,[{key:"isCanvasRenderer",get:function(){var e=this._activeTimes.length;if(e)for(var t=this._ctx.currentTime,i=e-1;i>=0;i--)if(t>=this._activeTimes[i].start&&(t<this._activeTimes[i].end||-1===this._activeTimes[i].end))return!0;return!1}},{key:"decBufLow",get:function(){return this._decBufLow}}]),t}(T),cn={alwaysSeekKeyframe:!1,lazyLoadMaxDuration:-1,lazyLoadRecoverDuration:20,webWorker:!0,appendErrorMaxRetry:3,credentials:!1,streamingMux:!0,autoPlaybackRate:!0,autoPlaybackRateConf:void 0,enableSoftwareAES:!0,startPlayBufferSec:0,startFromSec:0,startFromKeyframe:!0,defaultSpts:-5e3,kwaiKernelLog:A.a.LEVEL_ERROR,retryWithBackup:!0,resourceBuffer:!0,resourceBufferSize:500,ntp:!0,ensureVideo:!1,adaptive:!0,abrSpeedTest:!0,httpRangeType:L.d.STANDARD,maxAudioFramesDrift:5,forceKeyFrameOnDiscontinuity:!1,videoDropFramePolicy:L.n.AUTO,videoDecBlockPolicy:L.m.WAITING,videoFrameBufferSize:536870912,maxVideoDecThreads:8,mainThreadRendering:!1,wasmDecoderEnabled:!0,maxRetry:3,connectionTimeout:1e4,transmissionTimeout:3e4,retryDelay:100,maxFragFailSec:11,flvLoadEndError:!0,catchUpPausedLive:!0,breakpointContinuation:!0,manifestLoadingMaxRetry:3,manifestConnectionTimeout:1e4,manifestTransmissionTimeout:1e4,manifestLoadingRetryDelay:1,levelLoadingMaxRetry:3,levelConnectionTimeout:1e4,levelTransmissionTimeout:1e4,levelLoadingRetryDelay:100,emeEnabled:!0,widevineLicenseUrl:"",playreadyLicenseUrl:"",fairplayLicenseUrl:"",keyLoadingMaxRetry:3,keyConnectionTimeout:1e4,keyTransmissionTimeout:5e3,keyLoadingRetryDelay:300,sdpConnectionTimeout:1e4,peerConnectionTimeout:1e4,peerConnectionMaxRetry:5,peerConnectionRetryDelay:3e3,decLibLoadingMaxRetry:2,decLibConnectionTimeout:5e3,liveDelayFragNum:3,liveShiftEnabled:!1},un={maxRetry:1,retryDelay:100,connectionTimeout:1e4,levelConnectionTimeout:1e4,manifestConnectionTimeout:1e4},dn={startDelay:10,interval:.6,rule:[{rate:1.25,lower:27,upper:Number.MAX_SAFE_INTEGER},{rate:1.1,lower:17,upper:21},{rate:1,lower:5,upper:11}]},_n=function(){function e(){}return e.isStreamingSupported=function(){return void 0===e._streamingSupported&&(e._streamingSupported=P.isSupported()||!!N.isSupportChunk()),e._streamingSupported},e.processConfig=function(e){if(e){var t=e.src;(e=JSON.parse(JSON.stringify(e))).src=t}e.isLive?cn.videoFrameBufferSize=104857600:cn.videoFrameBufferSize=536870912;var i=mt(e.box)?r()({},cn,un):r()({},cn);return r()(i,e),i.wasmDecoderEnabled=i.wasmDecoderEnabled&&!!on,i.startPlayBufferSec=Math.min(5,Math.max(0,i.startPlayBufferSec)),this._initPlayBackRateRule(i),Worker||(i.webWorker=!1),i},e._initPlayBackRateRule=function(e){var t=e.autoPlaybackRateConf;if(t){var i=t.rule;if(i&&Array.isArray(i)&&((i=i.filter((function(e){return e.upper>e.lower&&e.rate>0}))).sort((function(e,t){return t.rate-e.rate})),i.length>1))return t.rule=i,void(e.autoPlaybackRateConf=t)}else{var n=-e.defaultSpts/1e3,r={startDelay:n,interval:.6,rule:[{rate:1.5,lower:n+7,upper:Number.MAX_SAFE_INTEGER},{rate:1.25,lower:n+4,upper:n+6},{rate:1.1,lower:n+1,upper:n+3},{rate:1,lower:0,upper:n}]};e.autoPlaybackRateConf=e.adaptive&&e.box===L.g.flv?r:dn}},e}();_n._streamingSupported=void 0;var hn=function(){function e(){this._lastDroppedFrames=0,this._lastDecodedFrames=0,this._lastTime=0,this._decoded=0,this._dropped=0}var t=e.prototype;return t.reset=function(){this._lastTime=performance.now(),this._lastDroppedFrames=this._lastDecodedFrames=this._decoded=this._dropped=0},t.getFPS=function(e){if(e){var t,i=performance.now(),n=e.totalVideoFrames,r=e.droppedVideoFrames;if(n){n<this._lastDecodedFrames&&(this._lastDecodedFrames=0,this._lastDroppedFrames=0);var a=i-this._lastTime,s=r-this._lastDroppedFrames,o=n-this._lastDecodedFrames,c=0,u=0;this._lastTime&&(c=parseFloat((1e3*s/a).toFixed(2)),u=parseFloat((1e3*o/a).toFixed(2))),this._decoded=this._decoded+=o,this._dropped=this._dropped+=s,this._lastTime=i,this._lastDroppedFrames=r,this._lastDecodedFrames=n,t={decoded:this._decoded,dropped:this._dropped,decodedFPS:u,droppedFPS:c}}return this._lastTime=i,t}},e}(),ln=function(){function e(){this._traffic=0,this._streams=[],this._download=[],this._trafficGroupedByVCodecType={},this._trafficGroupedByLevel={},this._currentLoad=void 0,this._contentLen=0,this._fillA=0,this._fillV=0}var t=e.prototype;return t.onStreamOpen=function(e,t,i,n){if(this._streams.length>10){var r=this._streams.shift();if(r){this._trafficGroupedByVCodecType[r.vCodecType]=(this._trafficGroupedByVCodecType[r.vCodecType]||0)+r.traffic;var a=r.qualityType||"unknown";this._trafficGroupedByLevel[a]=(this._trafficGroupedByLevel[a]||0)+r.traffic}}var s=this._currentLoad?this._currentLoad.index+1:0;this._currentLoad={index:s,startPos:e,url:t,bitrate:i,qualityType:n,traffic:0,loadTimeCost:0,keyFrame:0,videoDataRate:0,audioDataRate:0,speed:0,vCodecType:L.b.unknown,segments:[]},this._streams.push(this._currentLoad)},t.onMediaInfo=function(e){var t=this._streams[this._streams.length-1];t&&(e.videoCodecType&&(t.vCodecType=e.videoCodecType),t.mediaInfo=r()({},e))},t.setRTCStats=function(e){var t=this._currentLoad;t&&(t.traffic=e.totalReceive,t.audioDataRate=e.audioDataRate,t.videoDataRate=e.videoDataRate,t.speed=e.speed,t.keyFrame=e.key,this._traffic=t.traffic)},t.onDataReceive=function(e){this._traffic+=e.byteLength;var t=this._download;t.length>200&&t.pop(),t.unshift(e);var i=this._currentLoad;i&&(i.traffic+=e.byteLength,i.loadTimeCost+=e.timeCost,i.speed=Math.round(i.traffic/i.loadTimeCost*1e3)||0)},t.onParsing=function(e){var t=this;e.segments.forEach((function(e){t._calculateDataRate(e.type,1e3*(e.endDTS-e.startDTS),e.payload.byteLength),e.type===L.l.VIDEO&&e.fillDuration&&(t._fillV+=Math.round(1e3*e.fillDuration)),e.type===L.l.AUDIO&&e.fillDuration&&(t._fillA+=Math.round(1e3*e.fillDuration))}))},t.onRaw=function(e){if(e.samples.length){var t=e.samples.reduce((function(e,t){return t.yuv?e+t.yuv.y.bytes.length+t.yuv.u.bytes.length+t.yuv.v.bytes.length:e+t.units.reduce((function(e,t){return e+t.data.byteLength}),0)}),0),i=e.samples[e.samples.length-1].dts-e.samples[0].dts+(e.samples[e.samples.length-1].duration||0);this._calculateDataRate(L.l.VIDEO,i/90,t)}},t.downloadInfoByRange=function(e){void 0===e&&(e=1e3);var t={size:0,timeCost:0};if(this._download.length)for(var i=performance.now(),n=0;n<this._download.length&&this._download[n].ts>i-e;n++)t.size+=this._download[n].byteLength,t.timeCost+=this._download[n].timeCost;return t},t._calculateDataRate=function(e,t,i){var n=this._streams[this._streams.length-1],r=n.segments;r.push({type:e,duration:t,byteLength:i}),r.length>200&&r.shift();for(var a=0,s=0,o=0;o<r.length;o++)r[o].type===e&&(s+=r[o].byteLength,a+=r[o].duration);a>0&&(e===L.l.VIDEO?n.videoDataRate=Math.round(8*s/a):e===L.l.AUDIO&&(n.audioDataRate=Math.round(8*s/a)))},s()(e,[{key:"smoothedDownloadSpeed",get:function(){var e=this._download,t=e[0];return t&&!t.progress?t.byteLength/t.timeCost*1e3:1e3*e.reduceRight((function(e,t){var i=t.byteLength/t.timeCost;return e>0?i*(1-.9)+.9*e:i}),0)}},{key:"trafficGroupedByVCodecType",get:function(){var e=r()({},this._trafficGroupedByVCodecType);return e.total=this._traffic,this._streams.forEach((function(t){e[t.vCodecType]=(e[t.vCodecType]||0)+t.traffic})),e}},{key:"trafficGroupedByLevel",get:function(){var e=r()({},this._trafficGroupedByLevel);return e.total=this._traffic,this._streams.forEach((function(t){var i=t.qualityType||"unknown";e[i]=(e[i]||0)+t.traffic})),e}},{key:"traffic",get:function(){return this._traffic}},{key:"speed",get:function(){var e=this._currentLoad,t=this.downloadInfoByRange();return this._download.length?t.timeCost?Math.round(t.size/t.timeCost*1e3):0:(null==e?void 0:e.speed)||0}},{key:"currentLoad",get:function(){return this._currentLoad}},{key:"streams",get:function(){return this._streams}},{key:"contentLen",get:function(){return this._contentLen},set:function(e){this._contentLen=e}},{key:"fillA",get:function(){return this._fillA}},{key:"fillV",get:function(){return this._fillV}}]),e}(),fn=i(22),pn=new RegExp("_([0-9]+)x([0-9]+)(_([0-9]+))?(_([0-9]+))?(_(420|422|444|mono))?"),vn=["mono","420","422","444"],mn=i(34),An=function(){function e(e){this._abr=!1,this._startIdx=0,this._currentIdx=0,this._nextIdx=0,this._levels=[],this._audioIdx=0,this._audioTracks=[],this._subtitleIdx=0,this._subtitleTracks=[],this._abrLevels=[],this._default=void 0,this._availableList=void 0,this._startIdx=e?-1:0,this._abr=e}var t=e.prototype;return t.getLevel=function(e){return void 0===e&&(e=L.e.MAIN),e===L.e.MAIN?this._levels[this._currentIdx]:e===L.e.AUDIO?this._audioTracks[this._audioIdx]:e===L.e.SUBTITLE?this._subtitleTracks[this._subtitleIdx]:void 0},t.setLevelIdx=function(e,t){void 0===t&&(t=L.e.MAIN),t===L.e.MAIN?this.currentIdx=e:t===L.e.AUDIO?this.audioIdx=e:t===L.e.SUBTITLE&&(this.subtitleIdx=e)},t.getLevelIdx=function(e){return void 0===e&&(e=L.e.MAIN),e===L.e.MAIN?this._currentIdx:e===L.e.AUDIO?this._audioIdx:e===L.e.SUBTITLE?this._subtitleIdx:-1},t.setNextIdx=function(e,t){void 0===t&&(t=L.e.MAIN),t===L.e.MAIN&&(this.nextIdx=e)},t.getNextIdx=function(e){return void 0===e&&(e=L.e.MAIN),e===L.e.MAIN?this._nextIdx:-1},t.abrIndexToOrign=function(e){var t=this._abrLevels[e];return t?t.index:0},t.orignIndexToAbr=function(e){var t=0;return this._abrLevels.forEach((function(i,n){i.index!==e||(t=n)})),t},t._generateAbrList=function(){var e=this,t=this._availableList;this._default=0,this._abrLevels=[],this._levels.forEach((function(i,n){i.default&&!t&&(e._default=n),i.enableAdaptive&&(!t||t&&-1!==t.indexOf(n))&&e._abrLevels.push(i)})),this._abrLevels.sort((function(e,t){return e.bitrate-t.bitrate}))},s()(e,[{key:"abr",get:function(){return this._abr},set:function(e){this._abr=e}},{key:"startIdx",get:function(){return this._startIdx},set:function(e){this._startIdx=e}},{key:"currentIdx",get:function(){return this._currentIdx},set:function(e){e>=0&&(this._currentIdx=e)}},{key:"nextIdx",get:function(){return this._nextIdx},set:function(e){e>=0&&(this._nextIdx=e)}},{key:"levels",get:function(){return this._levels},set:function(e){this._levels=e,this._generateAbrList()}},{key:"current",get:function(){return this._levels[this._currentIdx]}},{key:"currentUrl",get:function(){var e=this._levels[this._currentIdx];return e?e.url[e.urlId]:""}},{key:"audioIdx",get:function(){return this._audioIdx},set:function(e){e>=0&&(this._audioIdx=e)}},{key:"audioTracks",get:function(){return this._audioTracks},set:function(e){this._audioTracks=e}},{key:"audio",get:function(){return this._audioTracks[this._audioIdx]}},{key:"subtitleIdx",get:function(){return this._subtitleIdx},set:function(e){e>=0&&(this._subtitleIdx=e)}},{key:"subtitleTracks",get:function(){return this._subtitleTracks},set:function(e){this._subtitleTracks=e}},{key:"subtitle",get:function(){return this._subtitleTracks[this._subtitleIdx]}},{key:"abrLevels",get:function(){return this._abrLevels}},{key:"availableList",set:function(e){this._availableList=e,this._generateAbrList()}},{key:"default",get:function(){return this._default||0},set:function(e){this._default=e}},{key:"abrDefault",get:function(){var e=0;return this._abrLevels.forEach((function(t,i){t.default&&(e=i)})),e}}]),e}(),gn=function(){function e(e,t){this.video=void 0,this.mse=void 0,this.stat=void 0,this.loadRec=void 0,this.lctx=void 0,this.localTimeOffset=void 0,this._src=void 0,this._srcUpdateTime=0,this._originSrc=void 0,this._config=void 0,this._streamingMuxEnabled=!1,this._streamingMux=!1,this._cOutput=void 0,this._liveDelay=new Vt,this._fps=new hn,this._yuvParams=void 0,this.video=t,this.lctx=new An(!0),this._setConfig(_n.processConfig(e))}var t=e.prototype;return t.destroy=function(){var e;A.b.i("av-ctx","destroy"),null==(e=this.stat.muxWorker)||e.terminate(),this._destroyLevels(),this._destroyCanvasOutput(),this._liveDelay.destroy()},t.getNewCtx=function(){return new e(this._config)},t.updateVideoPlaybackQuality=function(e,t){this.stat.videoPlaybackQuality?(this.stat.videoPlaybackQuality.droppedVideoFrames=t,this.stat.videoPlaybackQuality.totalVideoFrames=e):this.stat.videoPlaybackQuality={corruptedVideoFrames:0,creationTime:0,droppedVideoFrames:t,totalVideoFrames:e}},t.isTimeinBuffered=function(e){if(this.video)for(var t=this.video.buffered,i=0;i<t.length;i++)if(e>=t.start(i)&&e<t.end(i))return!0;return!1},t.currentBuffer=function(e){if(this.video)for(var t=this.video.buffered,i=0;i<t.length;i++){var n=t.start(i),r=t.end(i);if(n<=e&&e<r)return{start:n,end:r}}},t.nextBuffer=function(e){if(this.video)for(var t=this.video.buffered,i=0;i<t.length;i++){var n=t.start(i),r=t.end(i);if(n>e)return{start:n,end:r}}},t.getLocalTime=function(e){return"number"==typeof this.localTimeOffset?e-this.localTimeOffset:void 0},t.getStreamTime=function(e){return"number"==typeof this.localTimeOffset?e+this.localTimeOffset:void 0},t.getRemuxConfig=function(){var e=this._config;return{isLive:this.stat.isLive,kwaiKernelLog:e.kwaiKernelLog,enableSoftwareAES:e.enableSoftwareAES,gopRemux:this.stat.gopRemux,preferDecoder:e.preferDecoder,streamingMux:this.streamingMux,ensureVideo:e.ensureVideo,maxAudioFramesDrift:e.maxAudioFramesDrift,forceKeyFrameOnDiscontinuity:e.forceKeyFrameOnDiscontinuity,wasmDecoderEnabled:e.wasmDecoderEnabled}},t.getDecConfig=function(){var e=this._config;return{kwaiKernelLog:e.kwaiKernelLog,videoDropFramePolicy:e.videoDropFramePolicy,videoFrameBufferSize:e.videoFrameBufferSize,videoDecBlockPolicy:e.videoDecBlockPolicy,maxVideoDecThreads:e.maxVideoDecThreads,mainThreadRendering:e.mainThreadRendering}},t.hasChangeCore=function(){return this.stat.retryInfos.reduce((function(e,t){return t.change||e}),!1)},t.setSrc=function(e,t){e&&(this._resetStat(),this._yuvParams=void 0,this.loadRec=new ln),this._processSrc(e,t)},t.reProcessSrc=function(e){this._originSrc&&this._processSrc(this._originSrc,e)},t.updateLiveShiftStatuByTime=function(e){var t;if(this.stat.liveShiftEnabled&&(void 0===e&&(e=null==(t=this.video)?void 0:t.currentTime),this.lctx.current&&"number"==typeof e)){var i=this.liveStartLocalTime;this.stat.liveShift=!!(i&&e<i-.1)}},t._setConfig=function(e){this._config=e,this._streamingMuxEnabled=this._streamingMux=!(!e.streamingMux||!_n.isStreamingSupported()||R.a.msie||R.a.safari&&e.isLive||R.a.msedge&&e.isLive),this._resetStat(),this._yuvParams=void 0,this.stat.startFromSec=e.startFromSec||(e.startFrom||-1e3)/1e3,this.stat.webWorker=e.webWorker;try{this.stat.webWorker&&(this.stat.muxWorker=f()(45)),Vt.workerTimeOffset=performance.now(),A.b.i("av-ctx","init mux worker")}catch(e){}e.lazyLoadMaxDuration>0&&e.lazyLoadRecoverDuration>0&&e.lazyLoadMaxDuration>=e.lazyLoadRecoverDuration&&(this.stat.lazyLoadMaxDuration=e.lazyLoadMaxDuration,this.stat.lazyLoadRecoverDuration=e.lazyLoadRecoverDuration),this.loadRec=new ln,e.src&&this._processSrc(e.src)},t._resetStat=function(){A.b.i("av-ctx","reset stat");var e=this._config,t=this.stat||{},i=R.a.safari&&!e.isLive||R.a.opera&&R.a.version.major<37;this._streamingMux=this._streamingMuxEnabled,t.isLive=e.isLive,t.native=e.nativeFirst,t.coreType=L.a.unknown,t.codecType=L.b.unknown,t.gopRemux=i,t.audioCodec="",t.box=L.g.unknown,t.autoLazyLoad=!0,t.firstFrameLoaded=!1,t.isNetworkInUse=!1,t.srcType=L.i.OTHERS,t.retryInfos=[],t.decoder=L.c.buildin,t.lazyLoadMaxDuration=16,t.lazyLoadRecoverDuration=.8*t.lazyLoadMaxDuration,t.drm=t.hasVideo=t.hasAudio=t.isPreload=t.videoPlaybackQuality=t.mixContainerInput=t.mixCodecInput=t.mixCodecAvailable=t.mixQualityList=t.multipart=t.stereoType=t.mainThreadRendering=t.wasmDecoder=t.wasmSimd=t.wasmThreads=t.fallback264=void 0,this.stat=t},t._processSrc=function(e,t){var i;e&&(this._originSrc=this._src=e);var n=this.config,r=this.stat,a=Ct.preParse(this._src,n.mixManifestEnabled,n.nativeFirst,t,n.baseURL);this._src=a.src,this._src&&(this._srcUpdateTime=Date.now(),this._cOutput&&this._cOutput.reset(),this.stat.srcType===L.i.FILE&&this._destroyLevels(),this.lctx=new An(n.adaptive),r.codecType=a.codecType?a.codecType:L.b.unknown,r.box=n.box||a.box||L.g.unknown,r.srcType=a.srcType,r.mixContainerInput=a.mixContainerInput,r.mixCodecInput=a.mixCodecInput,r.mixCodecAvailable=a.mixCodecAvailable,r.mixQualityList=a.mixQualityList,r.multipart=a.multipart,r.stereoType=null==(i=a.mediaLevels)?void 0:i.stereoType,n.liveDelayFragNum&&n.liveDelayFragNum>0&&(r.multipartLiveDelay=-1e4*n.liveDelayFragNum),void 0!==a.nativeFirst&&(r.native=a.nativeFirst),"boolean"==typeof a.isLive&&(r.isLive=a.isLive),!a.mediaLevels||a.srcType===L.i.OTHERS&&mt(r.box)&&!r.native||(r.hasAudio=a.mediaLevels.hasAudio,r.hasVideo=a.mediaLevels.hasVideo,r.drm=a.mediaLevels.drm,this.lctx.levels=a.mediaLevels.levels,this.lctx.default=this.lctx.currentIdx=a.mediaLevels.def,a.mediaLevels.audioTracks&&(this.lctx.audioTracks=a.mediaLevels.audioTracks,this.lctx.audioIdx=a.mediaLevels.defAudio||0),a.mediaLevels.subtitleTracks&&(this.lctx.subtitleTracks=a.mediaLevels.subtitleTracks,this.lctx.subtitleIdx=a.mediaLevels.defSubtitle||0)),a.box===L.g.yuv&&(this._yuvParams=function(e){if(e){var t=e.match(pn);if(t&&t.length>2){var i=parseInt(t[1]),n=parseInt(t[2]),r=t[4]?parseInt(t[4]):d.e,a=t[6]?parseInt(t[6]):8,s=fn.a.AV_PIX_FMT_YUV420P;if(t[8]){var o=vn.indexOf(t[8]);-1!==o&&(s=o)}var c=-1===[fn.a.AV_PIX_FMT_YUV420P,fn.a.AV_PIX_FMT_YUV422P].indexOf(s)?i:i/2,u=s===fn.a.AV_PIX_FMT_YUV420P?n/2:n;return{width:i,height:n,chroma:fn.a.AV_PIX_FMT_YUV420P,chromaWidth:c,chromaHeight:u,cropLeft:0,cropTop:0,cropWidth:i,cropHeight:n,displayWidth:i,displayHeight:n,pts:0,fps:r,bpp:a,dataSize:(i*n+c*u*2)*(a>8?2:1)}}}}(a.src instanceof File?a.src.name:this.lctx.currentUrl)),A.b.i("av-ctx","set src:"+r.box+" live: "+r.isLive+" mobile: "+!!R.a.mobile+" gopRemux: "+r.gopRemux+" streamingMux "+this.streamingMux))},t._destroyLevels=function(){this.lctx&&this.lctx.levels.forEach((function(e){e.url.forEach((function(e){0===e.indexOf("blob:")&&URL.revokeObjectURL(e)}))}))},t._destroyCanvasOutput=function(){this._cOutput&&(this._cOutput.destroy(),this._cOutput=void 0)},s()(e,[{key:"live",get:function(){return!(!this.stat.isLive||this.stat.liveShift)}},{key:"liveStartLocalTime",get:function(){var e=this.lctx.current;return e&&e.totalduration&&this.stat.multipartLiveDelay?e.totalduration+this.stat.multipartLiveDelay/d.e+.1:0}},{key:"yuvParams",get:function(){return this._yuvParams}},{key:"canCodecFallback",get:function(){return!(!this.stat.mixCodecInput||this.stat.codecType===L.b.h264||-1===this.stat.mixCodecInput.indexOf(L.b.h264)||this.stat.decoder!==L.c.buildin)}},{key:"fps",get:function(){return this._fps}},{key:"liveDelay",get:function(){return this._liveDelay}},{key:"cOutput",get:function(){return this._cOutput||(this._cOutput=new mn.a),this._cOutput}},{key:"isAbrAvailable",get:function(){return this._config.adaptive&&this.lctx.levels.length>1&&!this.stat.isPreload}},{key:"mediaBufferedSec",get:function(){return this.video&&this.video.buffered&&this.video.buffered.length?{start:this.video.buffered.start(0),end:this.video.buffered.end(this.video.buffered.length-1)}:{start:0,end:0}}},{key:"bufferedEnd",get:function(){return this.video&&this.video.buffered.length?this.video.buffered.end(this.video.buffered.length-1):0}},{key:"bufferedSec",get:function(){return this.video&&this.video.buffered.length>0?Math.max(0,this.video.buffered.end(this.video.buffered.length-1)-this.video.currentTime):0}},{key:"bufferSliceNum",get:function(){return this.video?this.video.buffered.length:0}},{key:"currentTime",get:function(){return this.video?this.video.currentTime:0}},{key:"playbackRate",get:function(){return this.video?this.video.playbackRate:1}},{key:"config",get:function(){return this._config}},{key:"src",get:function(){return this._src}},{key:"srcUpdateTime",get:function(){return this._srcUpdateTime}},{key:"originSrc",get:function(){return this._originSrc}},{key:"videoPlaybackQuality",get:function(){return this.stat.videoPlaybackQuality?this.stat.videoPlaybackQuality:this.video?void 0!==this.video.getVideoPlaybackQuality?this.video.getVideoPlaybackQuality():{corruptedVideoFrames:0,creationTime:0,droppedVideoFrames:this.video.webkitDecodedFrameCount||0,totalVideoFrames:this.video.webkitDroppedFrameCount||0}:void 0}},{key:"demuxerType",get:function(){return this.stat.demuxerType},set:function(e){var t=this.stat;if(e!==t.demuxerType){var i=void 0===t.box||t.box===L.g.unknown;e===ai.b.RAW?(t.box=L.g.raw,t.isLive=!1):e===ai.b.FLV?(t.box=L.g.flv,t.multipart&&(t.isLive=!1)):e===ai.b.MP4||e===ai.b.FMP4?(i&&(t.box=L.g.mp4),t.multipart||(t.isLive=!1)):e===ai.b.TS?i&&(t.box=L.g.ts):e===ai.b.IVF&&(t.box=L.g.ivf,t.isLive=!1),t.demuxerType=e}}},{key:"streamingMuxEnabled",get:function(){return this._streamingMuxEnabled&&!(this._src instanceof Blob)}},{key:"streamingMux",get:function(){return this.stat.box===L.g.flv&&this.stat.isLive||this.streamingMuxEnabled&&this._streamingMux},set:function(e){this._streamingMux=e}}],[{key:"packName",get:function(){return"es"}},{key:"version",get:function(){return"3.3.6"}}]),e}();gn.instanceCount=0;var yn,En=gn;!function(e){e.METADATA="metadata",e.MEDIA_INFO="mediaInfo",e.HEARTBEAT="heartbeat",e.DOWNLOAD="download",e.REALTIME_BEACON="realtimeBeacon",e.DISCONTINUITY="discontinuity",e.KEY_FRAME="keyFrame",e.PRIV_NAL="privNal",e.SEI="sei",e.EVENT="event"}(yn||(yn={}));var bn,Tn,Sn=i(32),xn=i.n(Sn);!function(e){e.NORMEL="normal",e.SEEK="seek",e.END="end",e.LEVEL_SWITCH="levelSwitch",e.FIRST_FRAME="firstFrame",e.LOAD="load",e.BACKUP="backup"}(bn||(bn={}));var Cn=new Uint8Array(16);function Ln(){if(!Tn&&!(Tn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tn(Cn)}for(var Rn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Dn=function(e){return"string"==typeof e&&Rn.test(e)},wn=[],In=0;In<256;++In)wn.push((In+256).toString(16).substr(1));var On,Pn,kn,Nn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(wn[e[t+0]]+wn[e[t+1]]+wn[e[t+2]]+wn[e[t+3]]+"-"+wn[e[t+4]]+wn[e[t+5]]+"-"+wn[e[t+6]]+wn[e[t+7]]+"-"+wn[e[t+8]]+wn[e[t+9]]+"-"+wn[e[t+10]]+wn[e[t+11]]+wn[e[t+12]]+wn[e[t+13]]+wn[e[t+14]]+wn[e[t+15]]).toLowerCase();if(!Dn(i))throw TypeError("Stringified UUID is invalid");return i},Mn=function(e,t,i){var n=(e=e||{}).random||(e.rng||Ln)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return Nn(n)},Bn=/\/([A-Za-z0-9]+)[_A-Za-z0-9]*.flv/,Vn="",Fn="";function Un(){return On||(On={support_mse:tn.isMSEAvailable()?1:0,support_aac:tn.isVideoCodecSupported(L.b.aac)?1:0,support_h264:tn.isVideoCodecSupported(L.b.h264)?1:0,support_h265_mse:tn.isMSECodecSupported(L.b.hevc)?1:0,support_h265:tn.isVideoCodecSupported(L.b.hevc)?1:0,support_av1_mse:tn.isMSECodecSupported(L.b.av1)?1:0,support_simd:tn.isSupportSimd?1:0,support_thread:tn.isSupportThreads?1:0,support_hw:tn.isSupportHW?1:0,support_change_type:tn.isChangeTypeSupported()?1:0,support_streaming:_n.isStreamingSupported()?1:0,hardware_concurrency:Y()||0,wasm_dec_smooth:tn.wasmSmooth?1:0}),On}function Hn(e,t){var i={session_id:t.sessionId,kernel_version:En.version,pack_name:En.packName,creation_time:t.creationTime,src_update_time:e.srcUpdateTime,load_start_time:t.loadStartTime,instance_count:En.instanceCount};return"undefined"!=typeof navigator&&(navigator.webdriver&&(i.webdriver=navigator.webdriver),void 0!==navigator.onLine&&(i.on_line=navigator.onLine?1:0)),i}function jn(){var e={};if("undefined"!=typeof navigator){void 0!==navigator.onLine&&(e.network_on_line=navigator.onLine?1:0);var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;void 0!==(null==t?void 0:t.rtt)&&(e.network_rtt=t.rtt),void 0!==(null==t?void 0:t.rtt)&&(e.network_downlink=t.downlink),void 0!==(null==t?void 0:t.effectiveType)&&(e.network_effective_type=t.effectiveType),void 0!==(null==t?void 0:t.saveData)&&(e.network_save_data=t.saveData?1:0)}return e}function zn(e,t){var i,n,a,s=null==(i=e.video)?void 0:i.duration,o=e.lctx.current,c=(null==o?void 0:o.currentUrl)||"",u=r()({play_url:c,url_id:(null==o?void 0:o.urlId)||0,stream_host:c?new C.a(c).host:"",reuse:t.reuse,play_start_time:t.playStartTime,stream_duration:Math.round(1e3*(s&&Object(ie.a)(s)?s:0)),max_bitrate:(null==o?void 0:o.maxBitrate)||0,codec:t.codecs,play_pos:t.playPos||0,v_data_rate:Math.round((null==(n=e.loadRec.currentLoad)?void 0:n.audioDataRate)||0),a_data_rate:Math.round((null==(a=e.loadRec.currentLoad)?void 0:a.videoDataRate)||0),drm:e.stat.drm?1:0,adaptive_multi_rate:e.lctx.abr?1:0,use_backup:t.useBackup,play_to_end:t.playToEnd,v_decoder:e.stat.decoder,video_codec_type:e.stat.codecType||L.b.unknown,start_codec:t.startCodec,demuxer:e.stat.demuxerType||ai.b.UNKNOWN,core_type:e.stat.coreType,box:e.stat.box,kwai_slice:e.stat.isKwaiSlice?1:0},Hn(e,t),jn(),function(e){var t=e.video;return t?{elem_crossorigin:t.crossOrigin,elem_autoplay:t.autoplay?1:0,elem_loop:t.loop?1:0,elem_volume:t.volume,elem_muted:t.muted?1:0,elem_preload:t.preload,elem_controls:t.controls?1:0,elem_ready_state:t.readyState,elem_network_state:t.networkState}:{}}(e));"boolean"==typeof tn.playHEVCTest&&(u.play_hevc_test=tn.playHEVCTest?1:0),void 0!==e.stat.isLive&&(u.live=e.stat.isLive?1:0),void 0!==e.stat.liveShiftEnabled&&(u.live_shift_enabled=e.stat.liveShiftEnabled?1:0),e.stat.box===L.g.flv&&!1!==e.stat.isLive&&(u.stream_id=function(e){if("string"!=typeof e)return"";if(e!==Vn){Vn=e;var t=e.match(Bn);Fn=t&&t.length>1?t[1]:""}return Fn}(c),t.cdnIP&&(u.cdn_ip=t.cdnIP)),t.customeHttpHeader&&(u.custom_http_header=t.customeHttpHeader),null!=o&&o.bitrate&&(u.bitrate=o.bitrate),null!=o&&o.qualityType&&(u.quality_type=o.qualityType),null!=o&&o.qualityLabel&&(u.quality_label=o.qualityLabel),t.startQualityType&&(u.start_quality_type=t.startQualityType);var d=Qe(c);d&&(u.transcoding_template=d),"undefined"!=typeof navigator&&navigator.deviceMemory&&(u.device_memory=navigator.deviceMemory);var _=Object($.a)();return _.renderer&&(u.gpu_renderer=_.renderer),e.stat.wasmDecoder&&(u.wasm_dec=e.stat.wasmDecoder,u.wasm_dec_simd=e.stat.wasmSimd?1:0,u.wasm_dec_threads=e.stat.wasmThreads||0),u}function Gn(){var e={};return"undefined"!=typeof window&&window.screen&&(window.screen.width&&(e.screen_w=window.screen.width),window.screen.height&&(e.screen_h=window.screen.height),window.screen.colorDepth&&(e.screen_color_depth=window.screen.colorDepth)),e}function Wn(e){var t={src_type:e.stat.srcType};return e.stat.stereoType&&(t.stereo_type=e.stat.stereoType),e.stat.mixCodecInput&&e.stat.mixCodecInput.length&&(t.mix_codec_input=e.stat.mixCodecInput),e.stat.mixContainerInput&&e.stat.mixContainerInput.length&&(t.mix_container_input=e.stat.mixContainerInput),e.stat.mixCodecAvailable&&(t.mix_codec_available=e.stat.mixCodecAvailable),e.stat.mixQualityList&&(t.mix_codec_available=e.stat.mixQualityList),e.stat.fallback264&&(t.fallback_264=1),t}function Kn(e){var t=performance.now();return{play:Math.round(e.playDuration+(e.playStartMS?t-e.playStartMS:0)),actualPlay:Math.round(e.actualPlayDuration+(e.actualPlayStartMS?t-e.actualPlayStartMS:0)),pause:Math.round(e.pauseDuration+(e.pauseStartMS?t-e.pauseStartMS:0)),buffer:Math.round(e.bufferTime+(e.bufferingStartMS?t-e.bufferingStartMS:0))}}!function(e){e.PLAY="PLAY",e.END="END",e.PAUSE="PAUSE",e.LOAD="LOAD",e.BLOCK_START="BLOCK_START",e.BLOCK_END="BLOCK_END",e.SEEK_START="SEEK_START",e.SEEK_END="SEEK_END",e.LIVE_STOP="LIVE_STOP",e.STOP="STOP",e.ERROR="ERROR",e.DESTORY="DESTORY",e.QUALITY_CHANGE="QUALITY_CHANGE",e.QUALITY_CHANGE_DATA="QUALITY_CHANGE_DATA",e.QUALITY_CHANGE_RENDER="QUALITY_CHANGE_RENDER",e.SPEED_CHANGE="SPEED_CHANGE",e.RETRY="RETRY",e.AUDIO_OUTPUT_DEVICE_CHANGE="AUDIO_OUTPUT_DEVICE_CHANGE",e.NETWORK_CHANGE="NETWORK_CHANGE",e.VIDEO_DOM_EVENT="VIDEO_DOM_EVENT",e.FIRST_SCREEN_RENDER="FIRST_SCREEN_RENDER",e.PREPARED="PREPARED",e.METADATA_LOAD="METADATA_LOAD"}(Pn||(Pn={})),function(e){e.START="start",e.MANIFEST="manifest",e.LEVEL="level",e.DATA="data",e.DEMUX="demux",e.SEGMENT="segment",e.CANPLAY="canplay",e.LOADEDDATA="loadeddata",e.SEEKED="seeked"}(kn||(kn={}));var Qn=[{event:kn.START,detailName:"first-loader-open"},{event:kn.MANIFEST,detailName:"manifest-duration"},{event:kn.LEVEL,detailName:"level-duration"},{event:kn.DATA,detailName:"first-package-duration"},{event:kn.DEMUX,detailName:"first-remux-duration"},{event:kn.SEGMENT,detailName:"first-segment-duration"},{event:[kn.LOADEDDATA,kn.CANPLAY,kn.SEEKED],detailName:"first-frame-duration"}],Yn=function(){function e(e){this._complete=0,this._duration=0,this._events=void 0,this._start=0,this._lastEventTime=0,this._details={},this._ctx=void 0,this._events=Qn.slice(0),this._ctx=e}var t=e.prototype;return t.start=function(){A.b.i("first-frame","start"),this._complete=0,this._start=performance.now(),this._duration=0,this._events=Qn.slice(0),this._lastEventTime=0,this._details={},this.process(kn.START,this._start)},t.process=function(e,t){var i;if(void 0===t&&(t=0),A.b.i("first-frame","process type: "+e+" "+t+" complete: "+this._complete),this._complete)return!1;var n=this._events,r=-1;t=t||performance.now();for(var a=0;a<n.length;a++){var s=n[a];if(Array.isArray(s.event)){if(-1!==s.event.indexOf(e)){r=a;break}}else if(s.event===e){r=a;break}}if(-1===r)return!1;var o=n.splice(0,r+1).pop(),c="closed"===(null==(i=this._ctx.mse)?void 0:i.readyState);if((0===n.length||c&&e===kn.SEGMENT)&&(this._duration=t-this._start,this._complete=Date.now(),A.b.i("first-frame","complete "+this._duration+" "+this._complete)),o){var u=Math.round(t-this._lastEventTime);0===this._lastEventTime&&(u=Date.now()),this._lastEventTime=t,this._details[o.detailName]=u}return!!this._complete},t.onDownloadError=function(){this._details.download_retry?this._details.download_retry++:this._details.download_retry=1},t.onRetry=function(){this._details.retry?this._details.retry++:this._details.retry=1},s()(e,[{key:"complete",get:function(){return this._complete}},{key:"duration",get:function(){return this._duration}},{key:"details",get:function(){return this._details}}]),e}(),Xn=function(){function e(e,t){this._data=void 0,this._ctx=void 0,this._snapshot=void 0,this._tickIndex=1,this._statTimestampMillis=0,this._statTimestampMillisUTC=0,this._firstScreen=!0,this._firstScreenDetails=void 0,this._firstScreenDuration=null,this._clickToFirstFrame=0,this._errorCode=0,this._errorMessage="",this._data=e,this._ctx=t,this._tickIndex=1,this._snapshot={play:0,actualPlay:0,pause:0,buffer:0,blockCount:0,pauseCnt:0,renderBlockCount:0,seekCnt:0,seekLoadCnt:0,decodedFrames:0,droppedFrames:0,traffic:0,download:0,mseUpdate:0,mseRemove:0,segment:0,preloadCount:0,fillA:0,fillV:0,keyFrame:0,onLineChange:0,visibilityChange:0,heartbeatTimeout:0},this._resetForNewInterval()}var t=e.prototype;return t._updateSnapshot=function(e,t){var i={};for(var n in t)"number"==typeof e[n]&&(i[n]=e[n]-t[n],t[n]=e[n]);return i},t._resetForNewInterval=function(){this._statTimestampMillis=performance.now(),this._statTimestampMillisUTC=Date.now(),this._firstScreenDuration=null,this._firstScreenDetails=void 0,this._errorCode=0,this._errorMessage=""},t.setFirstScreenDuration=function(e,t,i){this._firstScreenDuration=Math.round(e),this._firstScreenDetails=t,this._firstScreen=!0,this._clickToFirstFrame=i},t.setError=function(e,t){this._errorCode=e,this._errorMessage=t},t.build=function(){var e=this._data,t=this._ctx,i=this._ctx.stat,n=performance.now(),a=Math.round(n-this._statTimestampMillis),s=this._updateSnapshot(e,this._snapshot),o=this._updateSnapshot(Kn(this._data),this._snapshot),c=this._updateSnapshot(this._ctx.loadRec,this._snapshot),u=this._updateSnapshot({fillA:this._ctx.loadRec.fillA,fillV:this._ctx.loadRec.fillV},this._snapshot),d=this._ctx.loadRec.downloadInfoByRange(a),_=d.timeCost?Math.round(d.size/d.timeCost*1e3):0,h={tick_index:this._tickIndex,tick_start:this._statTimestampMillisUTC,tick_duration:a,error_code:this._errorCode,error_message:this._errorMessage,block_cnt:s.blockCount||0,render_block_cnt:s.renderBlockCount||0,decoded_video_frames:s.decodedFrames||0,dropped_video_frames:s.droppedFrames||0,segment_cnt:s.segment||0,play_duration:o.play||0,buffer_time:o.buffer||0,actual_play_duration:o.actualPlay||0,played_video_duration:o.play||0,traffic:c.traffic>>10,hidden:Bi()?1:0,load_cnt:s.download,download_speed:_,seek_cnt:s.seekCnt,seek_load_cnt:s.seekLoadCnt,pause_duration:o.pause,pause_cnt:s.pauseCnt,preload_cnt:s.preloadCount,on_line_change:s.onLineChange,visibility_change:s.visibilityChange,heartbeat_timeout:s.heartbeatTimeout};return r()(h,zn(t,e),function(e){var t,i,n,r,a;return e.mse?(r=e.mse.bufferedByType(L.l.VIDEO),a=e.mse.bufferedByType(L.l.AUDIO)):r=a=e.mediaBufferedSec,{a_buf_start:Math.round(1e3*a.start)||0,a_buf_end:Math.round(1e3*a.end)||0,a_buf_len:Math.round(1e3*Math.max(0,a.end-e.currentTime))||0,a_buf_slices:(null==(t=e.mse)?void 0:t.bufferSliceNumByType(L.l.AUDIO))||e.bufferSliceNum||0,v_buf_start:Math.round(1e3*r.start)||0,v_buf_end:Math.round(1e3*r.end)||0,v_buf_len:Math.round(1e3*Math.max(0,r.end-e.currentTime))||0,v_buf_slices:(null==(i=e.mse)?void 0:i.bufferSliceNumByType(L.l.VIDEO))||e.bufferSliceNum||0,buffer_queue_cnt:(null==(n=e.mse)?void 0:n.pendingNum())||0}}(t),function(e){if(e.stat.isLive&&e.stat.box===L.g.flv){var t=e.liveDelay.getDisplayDelay(e.currentTime);if(t)return{v_rec_delay:e.liveDelay.getRecDelay(),v_render_delay:t||0,a_render_delay:e.liveDelay.getAudioRenderDelay(e.currentTime)||0}}return{}}(t)),u.fillA&&(h.fill_a=u.fillA),u.fillV&&(h.fill_v=u.fillV),i.coreType===L.a.mse&&(h.mse_update_cnt=s.mseUpdate||0,h.mse_remove_cnt=s.mseRemove||0,h.key_frame_cnt=s.keyFrame,i.isLive?(t.stat.liveShiftEnabled,h.live_shift=t.stat.liveShift?1:0):(h.lazyload_min=Math.floor(i.lazyLoadRecoverDuration),h.lazyload_max=Math.floor(i.lazyLoadMaxDuration))),this._firstScreen&&(null===this._firstScreenDuration?h.first_screen_total_duration=0:(h.first_screen_total_duration=this._firstScreenDuration,h.first_screen_details=this._firstScreenDetails,i.coreType===L.a.mse&&i.box===L.g.mp4&&(h.mp4_moov_size=e.mp4MoovSize,void 0!==e.mp4FastStart&&(h.mp4_fast_start=e.mp4FastStart?0:1)),this._firstScreenDetails=null,this._firstScreenDuration=null,this._firstScreen=!1)),"number"==typeof this._clickToFirstFrame&&e.playStartTime&&(h.click_to_first_frame=this._clickToFirstFrame,this._clickToFirstFrame>0&&(this._clickToFirstFrame=void 0)),1===this._tickIndex&&r()(h,Un(),Wn(this._ctx),Gn()),this._resetForNewInterval(),this._tickIndex++,h},e}();function qn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Zn(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(i),!0).forEach((function(t){xn()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Jn=function(e){function t(t){var i;return(i=e.call(this)||this)._beaconTimer=void 0,i._creationTime=void 0,i._runningStartTime=void 0,i._ctx=void 0,i._firstFrame=void 0,i._data=void 0,i._realtimeBeacon=void 0,i._hiddenStart=!1,i._playing=!1,i._seeking=!1,i._seekLoadFlag=!1,i._seekingThrottle=null,i._seekedDebounce=null,i._onOnlineChange=function(){i._data.onLineChange++,i.triggerEventReport(Pn.NETWORK_CHANGE,{online:void 0!==navigator.onLine?navigator.onLine?1:0:null})},i._onVisibilityChange=function(){i._data.visibilityChange++},i._sendRealtimeBeacon=function(e){var t;void 0===e&&(e=bn.NORMEL);var n=null==(t=i._realtimeBeacon)?void 0:t.build();n&&(e===bn.NORMEL&&n.first_screen_total_duration>0?n.type=bn.FIRST_FRAME:n.type=e,i._ctx.stat.isLive||(n.seek_record=i._data.seekRecord.slice(0),i._data.seekRecord=[]),A.b.i("monitor","realtime beacon",n),i.emit(v.a.REPORT,{type:yn.REALTIME_BEACON,value:n}))},i._beaconTimer=null,i._runningStartTime=performance.now(),i._creationTime=Date.now(),i._firstFrame=new Yn(t),i._ctx=t,i._reset(),"undefined"!=typeof window&&(window.addEventListener("online",i._onOnlineChange),window.addEventListener("offline",i._onOnlineChange)),"undefined"!=typeof document&&document.addEventListener("visibilitychange",i._onVisibilityChange),i}u()(t,e);var i=t.prototype;return i._reset=function(){this._playing=!1,this._seeking=!1,this._seekLoadFlag=!1,this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekingThrottle&&clearTimeout(this._seekingThrottle),this._data={decodedFrames:0,droppedFrames:0,sessionId:Mn(),creationTime:0,startTime:0,loadStartTime:0,playStartTime:0,playDuration:0,actualPlayDuration:0,pauseDuration:0,pauseCnt:0,bufferTime:0,blockCount:0,renderBlockCount:0,seekCnt:0,seekDuration:0,seekLoadCnt:0,seekLoadDuration:0,seekStartTime:0,unknownTSPacketCount:0,audioNonMonotonous:0,startBitrate:0,smoothBitrate:-1,useBackup:0,aacOverhead:0,errorCode:0,errorMessage:"",download:0,preloadCount:0,reuse:0,playPos:0,seekRecord:[],codecs:"",firstScreenTotalDuration:0,clickToFirstFrame:0,playToEnd:0,fillA:0,fillV:0,keyFrame:0,onLineChange:0,visibilityChange:0,lastHeartbeatTime:0,heartbeatTimeout:0},this._data.creationTime=this._creationTime,A.b.i("monitor","reset",this._data.sessionId),this._ctx.fps.reset(),this._ctx.fps.getFPS(this._ctx.videoPlaybackQuality)},i.onLoaderChunkArrival=function(e){this._ctx.loadRec.onDataReceive(e),this._processFirstFrame(kn.DATA)},i.onMediaConnect=function(e){e.headers&&(this._data.customeHttpHeader=I(e.headers))},i.onMediaDemux=function(e){this._processFirstFrame(kn.DEMUX,performance.now())},i.onKeyFrame=function(e){this._ctx.loadRec.currentLoad&&this._ctx.loadRec.currentLoad.keyFrame++,this.data.keyFrame++,e&&this.emit(v.a.REPORT,{type:yn.KEY_FRAME,value:e})},i.onDecLibLoaded=function(e){this._data.decLibLoadDuration=e.duration,this._data.decLibCacheHit=e.hitCache},i.onNewSource=function(e){var t=this._data,i=this._ctx.lctx.current;i?(this._ctx.loadRec.onStreamOpen(e.sync,i.currentUrl,i.bitrate,i.qualityType),t.level=this._ctx.lctx.currentIdx,t.startQualityType||(t.startQualityType=i.qualityType)):this._ctx.loadRec.onStreamOpen(e.sync,"",0,"unknown")},i.onDiscontinuity=function(e){this.emit(v.a.REPORT,{type:yn.DISCONTINUITY,value:e})},i.onDownload=function(e){var t=this,i=this._data;e.error_code&&!this._firstFrame.complete&&this._firstFrame.onDownloadError(),i.download++;var n=r()({use_backup:i.useBackup,first_screen:i.firstScreenTotalDuration?1:0},Hn(this._ctx,i),jn(),e);1009===e.error_code?setTimeout((function(){t.emit(v.a.REPORT,{type:yn.DOWNLOAD,value:n})}),0):this.emit(v.a.REPORT,{type:yn.DOWNLOAD,value:n})},i.heartbeat=function(){var e,t,i=this._data,n=this._ctx,r=n.fps.getFPS(this._ctx.videoPlaybackQuality),a={},s=n.loadRec,o=performance.now();i.lastHeartbeatTime&&o-i.lastHeartbeatTime>d.h&&i.heartbeatTimeout++,i.lastHeartbeatTime=performance.now(),(n.stat.coreType===L.a.mse||n.stat.coreType===L.a.rtc)&&(a.totalReceive=s.traffic,a.speed=s.speed,a.videoDataRate=(null==(e=s.currentLoad)?void 0:e.videoDataRate)||0,a.audioDataRate=(null==(t=s.currentLoad)?void 0:t.audioDataRate)||0),n.mse&&(a.videoBuffered=Math.round(Math.max(0,1e3*(n.mse.bufferedEndByType(L.l.VIDEO)-n.currentTime))),a.audioBuffered=Math.round(Math.max(0,1e3*(n.mse.bufferedEndByType(L.l.AUDIO)-n.currentTime))),a.fillAudio=i.fillA,a.fillVideo=i.fillV,a.keyFrame=i.keyFrame,n.stat.isLive?(a.isLive=n.stat.isLive,n.stat.liveShiftEnabled&&(a.liveShift=n.stat.liveShift)):(a.lazyloadMin=n.stat.lazyLoadRecoverDuration,a.lazyloadMax=n.stat.lazyLoadMaxDuration)),a.buffered=Math.round(1e3*n.bufferedSec),a.decodedFPS=(null==r?void 0:r.decodedFPS)||0,a.droppedFPS=(null==r?void 0:r.droppedFPS)||0,i.decodedFrames=a.decodedFrames=(null==r?void 0:r.decoded)||0,i.droppedFrames=a.droppedFrames=(null==r?void 0:r.dropped)||0,n.stat.isLive&&n.stat.box===L.g.flv&&(a.audioRenderDelay=n.liveDelay.getAudioRenderDelay(n.currentTime),a.displayDelay=n.liveDelay.getDisplayDelay(n.currentTime),a.recDelay=n.liveDelay.getRecDelay()),this.emit(v.a.REPORT,{type:yn.HEARTBEAT,value:a})},i.destroy=function(){A.b.i("monitor","destroy"),this.triggerEventReport(Pn.DESTORY),this._sendRealtimeBeacon(bn.END),this._stopBeaconTimer(),"undefined"!=typeof window&&(window.removeEventListener("online",this._onOnlineChange),window.removeEventListener("offline",this._onOnlineChange)),"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this._onVisibilityChange),this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekingThrottle&&clearTimeout(this._seekingThrottle),this.removeAllListeners()},i.onPreload=function(){this._data.preloadCount++},i.onLoad=function(e){if(A.b.i("monitor","on load: "+e.type),e.type)e.type!==L.f.internal&&e.type!==L.f.retry||this._firstFrame.complete||this._firstFrame.start(),this._data.errorCode=0,this._data.errorMessage="";else{var t,i=(null==(t=this._ctx.lctx.current)?void 0:t.currentUrl)||"";if(this._data.startTime){var n=this._data.reuse;this._reset(),this._data.reuse=n+1}this.triggerEventReport(Pn.LOAD,{url:i,protocol:this._ctx.stat.box,initial_speed:String(this._ctx.video&&this._ctx.video.playbackRate)}),this._data.startTime=performance.now(),this._data.loadStartTime=Date.now(),this._firstFrame.start(),this._hiddenStart=Bi(),this._stopBeaconTimer(),this._realtimeBeacon=new Xn(this._data,this._ctx),this._sendRealtimeBeacon(bn.LOAD)}},i.onStopLoad=function(){this._sendRealtimeBeacon(bn.END),this._stopBeaconTimer(),this._waitingEnd(),this._ctx.stat.isLive&&this.triggerEventReport(Pn.LIVE_STOP)},i.onManifest=function(e){var t=this._ctx.lctx.current;t&&(this._data.startBitrate||(this._data.startBitrate=t.bitrate)),this._processFirstFrame(kn.MANIFEST)},i.onLevel=function(e){void 0===e&&(e=0),this._processFirstFrame(kn.LEVEL,e)},i.onAudioTrack=function(){},i.onMediaInfo=function(e){var t=this._ctx;e.box=t.stat.box,"boolean"==typeof t.stat.isLive&&(e.isLive=t.stat.isLive),"boolean"==typeof t.stat.liveShiftEnabled&&(e.liveShiftEnabled=t.stat.liveShiftEnabled),e.packName=En.packName,t.loadRec.onMediaInfo(e);var i=[];e.videoCodec&&i.push(e.videoCodec),e.audioCodec&&i.push(e.audioCodec),this._data.codecs=i.join(","),this._data.startCodec||(this._data.startCodec=this._data.codecs),e.sid=this._data.sessionId,e.hardwareAccelerated=tn.isSupportHW,e.coreType=t.stat.coreType,!e.streamHost&&t.lctx.currentUrl&&(e.streamHost=new C.a(t.lctx.currentUrl).host);var n=Object($.a)();n.renderer&&(e.gpu=n.renderer),t.loadRec.currentLoad&&(t.loadRec.currentLoad.mediaInfo=e),t.stat.isLive&&t.stat.box===L.g.flv&&t.config.ntp&&t.liveDelay.init(),t.stat.isKwaiSlice&&(e.isKwaiSlice=t.stat.isKwaiSlice);var r=JSON.stringify(e);A.b.i("monitor","mediainfo",r),this.emit(v.a.REPORT,{type:yn.MEDIA_INFO,value:JSON.parse(r)})},i.onSegment=function(e){if(e.extra&&e.extra.stat){var t=this._data;t.unknownTSPacketCount=t.unknownTSPacketCount||e.extra.stat.unknownTSPacketCount||0,t.audioNonMonotonous=t.audioNonMonotonous||e.extra.stat.audioNonMonotonous||0,t.aacOverhead=t.aacOverhead||e.extra.stat.aacOverhead||0}this._processFirstFrame(kn.SEGMENT)},i.onPrivNal=function(e){this._ctx.liveDelay.onPrivNal(e),this.emit(v.a.REPORT,{type:yn.PRIV_NAL,value:{info:e.info}})},i.onSEI=function(e){this.emit(v.a.REPORT,{type:yn.SEI,value:e})},i.onPlay=function(){this._data.playStartTime||(this._data.playStartTime=Date.now()),this._startBeaconTimer()},i.onLoadeddata=function(){this._processFirstFrame(kn.LOADEDDATA),this._waitingEnd()},i.onCanplay=function(){this._processFirstFrame(kn.CANPLAY),R.a.safari&&this._ctx.stat.coreType!==L.a.mse||this._waitingEnd()},i.onPlaying=function(){var e;R.a.ios&&4!==(null==(e=this._ctx.video)?void 0:e.readyState)||(this._playing||(this._playing=!0,this.triggerEventReport(Pn.PLAY)),this._playStart(),this._pauseEnd(),this._waitingEnd())},i.onPause=function(){var e;null!=(e=this._ctx.video)&&e.seeking||!this._playing||(this._playEnd(),this._pauseStart(),this.triggerEventReport(Pn.PAUSE),this._playing=!1)},i.onEnd=function(){this._data.playToEnd++,this._playing=!1,this._playEnd(),this._pauseEnd(),this._waitingEnd(),this._sendRealtimeBeacon(bn.END),this._stopBeaconTimer(),this.triggerEventReport(Pn.END)},i.onWaiting=function(e){this._data.playPos=Math.round(1e3*this._ctx.currentTime),this._playing&&this._firstFrame.complete&&e.block&&(this._waitingStart(e.bufferedSec),this.triggerEventReport(Pn.BLOCK_START))},i.onSeek=function(e){var t,i,n=this;this._data.seekRecord.push({from:this._data.playPos,to:Math.round(1e3*this._ctx.currentTime),time:Date.now()}),this._data.seekRecord.length>50&&this._data.seekRecord.shift(),this._ctx.stat.isLive||null!=e&&e.internal||(this._data.seekStartTime=performance.now(),this._seeking?!this._seekingThrottle&&this._seeking&&(this._seekingThrottle=+setTimeout((function(e){var t,i;n.triggerEventReport(Pn.SEEK_START,{paused:null==(t=n._ctx.video)?void 0:t.paused,seeking:null==(i=n._ctx.video)?void 0:i.seeking,position:e}),n._seekingThrottle=null}),500,this._data.playPos/1e3)):(this.triggerEventReport(Pn.SEEK_START,{paused:null==(t=this._ctx.video)?void 0:t.paused,seeking:null==(i=this._ctx.video)?void 0:i.seeking,position:this._data.playPos/1e3}),this._seeking=!0))},i.onSeekWithLoad=function(){this._firstFrame.complete&&(this._sendRealtimeBeacon(bn.SEEK),this._resetBeaconTimer(),this._seekLoadFlag=!0)},i.onSeeked=function(){var e=this;if(this._ctx.fps.getFPS(this._ctx.videoPlaybackQuality),this._data.seekStartTime){var t;this._data.seekCnt++;var i=Math.round(performance.now()-this._data.seekStartTime);this._data.seekDuration+=i,this._data.seekStartTime=0,this._seekLoadFlag&&(this._data.seekLoadCnt++,this._data.seekLoadDuration+=i),this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekedDebounce=+setTimeout((function(t){var i,n,r;null!=(i=e._ctx.video)&&i.seeking||(e._seeking=!1,e.triggerEventReport(Pn.SEEK_END,{paused:null==(n=e._ctx.video)?void 0:n.paused,seeking:null==(r=e._ctx.video)?void 0:r.seeking,position:t}))}),500,null==(t=this._ctx.video)?void 0:t.currentTime)}this._seekLoadFlag=!1,this._firstFrame.complete||this._ctx.stat.coreType===L.a.mse||!R.a.safari&&!R.a.msie||this._processFirstFrame(kn.SEEKED)},i.onTimeupdate=function(){var e,t,i=this._ctx,n=i.video;if(n){n.loop&&!i.stat.isLive&&0===i.currentTime&&Object(ie.a)(n.duration)&&n.duration>0&&n.duration-this._data.playPos/1e3<1&&this._data.playToEnd++;var r=Math.round(1e3*i.currentTime);R.a.msie&&i.stat.coreType!==L.a.mse&&this._data.bufferingStartMS&&this._data.playPos!==r&&this.onPlaying(),this._data.playPos=r,!R.a.ios||"number"!=typeof this._data.bufferingStartMS||4!==(null==(e=this._ctx.video)?void 0:e.readyState)||null!=(t=this._ctx.video)&&t.paused||this.onPlaying()}},i.onProgress=function(){var e;R.a.safari&&this._ctx.stat.coreType!==L.a.mse&&this._data.bufferingStartMS&&4===(null==(e=this._ctx.video)?void 0:e.readyState)&&this._waitingEnd()},i.mediaCapabilities=function(e){this._data.smoothBitrate=e},i.levelSwitching=function(e){e.smooth||(this._sendRealtimeBeacon(bn.LEVEL_SWITCH),this._resetBeaconTimer());var t=this._ctx.lctx.current;t&&this.triggerEventReport(Pn.QUALITY_CHANGE,{quality_type:t.qualityType,trigger_mode:e.auto?"abr":"user",play_url:t.currentUrl,is_smooth:e.smooth?1:0})},i.levelSwitched=function(){this.triggerEventReport(Pn.QUALITY_CHANGE_DATA)},i.levelSwitchPlaying=function(){this.triggerEventReport(Pn.QUALITY_CHANGE_RENDER)},i.onAudioSwitching=function(){},i.onAudioSwitched=function(){},i.onRetry=function(e){e.type===L.h.BACKUP&&(this._data.useBackup=1),this._firstFrame.onRetry(),this.triggerEventReport(Pn.RETRY,{retry_type:e.type,retry_message:e.message,error_code:e.code||0}),e.type===L.h.BACKUP&&(this._realtimeBeacon&&this._realtimeBeacon.setError(e.code||0,e.message||""),this._sendRealtimeBeacon(bn.BACKUP),this._realtimeBeacon&&this._realtimeBeacon.setError(0,""))},i.onMetaData=function(e){e.mp4MoovSize&&(this._data.mp4MoovSize=e.mp4MoovSize),"number"==typeof e.mp4FastStart&&(this._data.mp4FastStart=e.mp4FastStart),"string"==typeof e.cdn_ip&&(this._data.cdnIP=e.cdn_ip),this.emit(v.a.REPORT,{type:yn.METADATA,value:e}),this.triggerEventReport(Pn.METADATA_LOAD,Zn({},e))},i.triggerEventReport=function(e,t){this.emit(v.a.REPORT,{type:yn.EVENT,value:r()(Zn({type:e,position:this._ctx.currentTime},t),Hn(this._ctx,this._data))})},i.onRateChange=function(){var e;!this._ctx.video||null!=(e=this._ctx.video)&&e.seeking||this.triggerEventReport(Pn.SPEED_CHANGE,{speed:this._ctx.video.playbackRate})},i.onError=function(e,t){this._data.errorCode=e,this._data.errorMessage=t,this.triggerEventReport(Pn.ERROR,{error_message:t,error_type:e}),this._realtimeBeacon&&this._realtimeBeacon.setError(e,t),this._playEnd(),this._pauseEnd(),this._waitingEnd()},i._processFirstFrame=function(e,t){void 0===t&&(t=0),!this._firstFrame.complete&&this._firstFrame.process(e,t)&&this._onFirstFrame()},i._playStart=function(){this._data.playStartMS=this._data.playStartMS||performance.now(),this._data.actualPlayStartMS=this._data.actualPlayStartMS||performance.now()},i._playEnd=function(){this._data.playStartMS&&(this._data.playDuration+=performance.now()-this._data.playStartMS),this._data.actualPlayStartMS&&(this._data.actualPlayDuration+=performance.now()-this._data.actualPlayStartMS),this._data.playStartMS=void 0,this._data.actualPlayStartMS=void 0},i._pauseStart=function(){this._data.pauseCnt++,this._data.pauseStartMS=this._data.pauseStartMS||performance.now()},i._pauseEnd=function(){this._data.pauseStartMS&&(this._data.pauseDuration+=performance.now()-this._data.pauseStartMS),this._data.pauseStartMS=void 0},i._waitingStart=function(e){this._data.bufferingStartMS||(this._data.blockCount++,this._data.bufferingStartMS=performance.now(),e>.6&&this._data.renderBlockCount++),this._data.actualPlayStartMS&&(this._data.actualPlayDuration+=performance.now()-this._data.actualPlayStartMS),this._data.actualPlayStartMS=void 0},i._waitingEnd=function(){this._data.bufferingStartMS&&(this._data.bufferTime+=performance.now()-this._data.bufferingStartMS,this._data.bufferingStartMS=void 0,this.triggerEventReport(Pn.BLOCK_END))},i._onFirstFrame=function(){var e,t,i,n,r,a;A.b.i("monitor","first frame"),this._ctx.stat.firstFrameLoaded=!0;var s=this._data,o=this._ctx.loadRec.currentLoad;s.firstScreenTotalDuration=s.firstScreenTotalDuration||Math.round(this._firstFrame.duration),s.firstScreenDetails=s.firstScreenDetails||this._firstFrame.details,this.triggerEventReport(Pn.FIRST_SCREEN_RENDER,{initial_rate:Math.round((null==(e=this._ctx.loadRec.currentLoad)?void 0:e.videoDataRate)||0),inital_quality_type:this._data.startQualityType,fps:null==o||null==(t=o.mediaInfo)?void 0:t.fps,a_codec:null==o||null==(i=o.mediaInfo)?void 0:i.audioCodec,v_codec:null==o||null==(n=o.mediaInfo)?void 0:n.videoCodec,channels:null==o||null==(r=o.mediaInfo)?void 0:r.channelCount,sample_rate:null==o||null==(a=o.mediaInfo)?void 0:a.audioSampleRate}),s.playStartTime&&this._firstFrame.complete?s.clickToFirstFrame=s.clickToFirstFrame||Math.max(1,this._firstFrame.complete-s.playStartTime):s.clickToFirstFrame=1,this._realtimeBeacon&&this._realtimeBeacon.setFirstScreenDuration(this._firstFrame.duration,this._firstFrame.details,s.clickToFirstFrame),this._ctx.video&&!this._ctx.video.paused&&this._playStart()},i._startBeaconTimer=function(){null===this._beaconTimer&&(this._beaconTimer=setInterval(this._sendRealtimeBeacon,1e4))},i._stopBeaconTimer=function(){this._beaconTimer&&(clearTimeout(this._beaconTimer),this._beaconTimer=null)},i._resetBeaconTimer=function(){this._stopBeaconTimer(),this._startBeaconTimer()},s()(t,[{key:"runningStartTime",get:function(){return this._runningStartTime}},{key:"sid",get:function(){return this._data.sessionId}},{key:"snapshot",get:function(){var e=this._ctx.loadRec,t=this._ctx.stat;return r()({streams:e.streams,live:t.isLive,liveShift:t.liveShift,demuxer:t.demuxerType,decSimd:t.wasmSimd,decThreads:t.wasmThreads,decoderType:t.wasmDecoder},this._data)}},{key:"data",get:function(){return this._data}},{key:"audienceStat",get:function(){var e,t,i,n=this._data,a=Kn(n),s=this._ctx.stat,o=this._ctx.loadRec,c={play_duration:a.play,actual_play_duration:a.actualPlay,traffic:o.traffic>>10,buffer_time:a.buffer,block_cnt:n.blockCount,render_block_cnt:n.renderBlockCount,click_to_first_frame:n.playStartTime&&n.clickToFirstFrame||0,first_screen_total_duration:Math.round(n.firstScreenTotalDuration)||0,first_screen_details:n.firstScreenDetails||this._firstFrame.details||null,error_code:n.errorCode||0,error_message:n.errorMessage||"",remux_process_type:(this._ctx.streamingMuxEnabled?1:0)+(s.gopRemux?1:0),hidden_start:this._hiddenStart?1:0,current_running_time:Math.round(performance.now()-n.startTime),running_time:Math.round(performance.now()-this._runningStartTime),smooth_bitrate:n.smoothBitrate,start_bitrate:n.startBitrate||0,abr:this._ctx.config.adaptive?1:0,pause_cnt:n.pauseCnt,preload_cnt:n.preloadCount,retry_record:s.retryInfos,traffic_vcodec:o.trafficGroupedByVCodecType,traffic_level:o.trafficGroupedByLevel,decoded_video_frames:n.decodedFrames||0,dropped_video_frames:n.droppedFrames||0,pause_duration:a.pause,seek_cnt:n.seekCnt,seek_duration:n.seekDuration,seek_load_cnt:n.seekLoadCnt,seek_load_duration:n.seekLoadDuration,start_sec:s.isLive?0:Math.round(this._ctx.config.startFromSec||0),on_line_change:n.onLineChange,visibility_change:n.visibilityChange,heartbeat_timeout:n.heartbeatTimeout};return R.a.version&&(c.browser_name=R.a.name||"",c.browser_major=R.a.version.major||0),r()(c,Un(),zn(this._ctx,n),(t=null==(e=this._ctx.loadRec.currentLoad)?void 0:e.mediaInfo,i={},t&&(t.fps&&(i.fps=t.fps),t.width&&(i.width=t.width),t.height&&(i.height=t.height)),i),Wn(this._ctx),Gn()),s.coreType===L.a.mse&&this._ctx.mse&&(c.mse_buffer_full=this._ctx.mse.stat.mseBufferFull,c.mse_remove=this._ctx.mse.stat.mseRemove,c.key_frame_cnt=n.keyFrame,s.box===L.g.mp4&&(c.mp4_moov_size=n.mp4MoovSize,void 0!==n.mp4FastStart&&(c.mp4_fast_start=n.mp4FastStart?0:1))),n.fillA&&(c.fill_a=n.fillA),n.fillV&&(c.fill_v=n.fillV),mt(s.box)&&(c.unknown_ts_packet_count=n.unknownTSPacketCount,c.audio_non_monotonous=n.audioNonMonotonous,c.aac_overhead=n.aacOverhead),"number"==typeof n.decLibLoadDuration&&(c.dec_lib_load_duration=Math.round(n.decLibLoadDuration),c.dec_lib_hit=n.decLibCacheHit?1:0),c}}]),t}(b.a),$n=function(){function e(){var e=this;this._timer=void 0,this._xhr=void 0,this._callbackFunc=void 0,this._onEnd=function(){e._detectEnd()},this._onReadystatechange=function(){e._xhr&&e._xhr.readyState>=2&&e._detectEnd()},this._detectEnd=function(){e._xhr&&e._callbackFunc&&e._callbackFunc(e._xhr.status),e.stop()}}var t=e.prototype;return t.start=function(e,t){this._callbackFunc=t,this._xhr&&this.stop();var i=this._xhr=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=this._onReadystatechange,i.onerror=this._onEnd,i.onload=this._onEnd,i.send(),this._timer=setTimeout(this._detectEnd,1e3)},t.stop=function(){this._timer&&(clearTimeout(this._timer),this._timer=void 0),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=void 0),this._callbackFunc=void 0},e}(),er=function(e){function t(t){var i;return(i=e.call(this,t.video)||this)._ctx=void 0,i._httpStatusDetector=void 0,i._setStartFromOnTimeupdate=!1,i._ctx=t,i}u()(t,e);var i=t.prototype;return i.load=function(e){var t;A.b.i("kernel-native","load",this._ctx.stat.startFromSec);var i=this._ctx.lctx.levels;i.length||this._onError({type:p.b.OTHER_ERROR,details:p.a.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parse error."});var n=0,r=this._ctx.lctx.startIdx;"number"==typeof r&&r>=0&&r<i.length&&(n=r),A.b.i("kernel-native","level: "+n+" "+(null==(t=i[n])?void 0:t.qualityType)),this._ctx.lctx.currentIdx=this._ctx.lctx.nextIdx=n,this._ctx.lctx.abr=!1,this.emit(v.a.MANIFEST_PARSED),this._load(e)},i.onAbrLevelsUpdated=function(){},i.resume=function(){},i.refresh=function(){this._ctx.stat.startFromSec=this._video.currentTime,this._load(L.f.retry),this._video.play()},i.stopLoad=function(){this.emit(v.a.STOP_LOAD),this._stopHeartbeat()},i.setCurrentLevel=function(e){A.b.i("kernel-native","set current level: "+e+" @ "+this._video.currentTime);var t=this._ctx;if(t.lctx.levels.length){if(e>=0&&e<t.lctx.levels.length&&t.lctx.currentIdx!==e){t.lctx.currentIdx=t.lctx.nextIdx=e;var i=t.lctx.current;if(i)return this._stat=Vi.SELECT_BITRATE,i.currentUrl,t.stat.startFromSec=this._video.currentTime,this._levelSwitchId++,this.emit(v.a.LEVEL_SWITCHING,{time:t.currentTime,bitrate:i.bitrate,level:e,smooth:!1,auto:!1,id:this._levelSwitchId}),this._startLoadLevel(t.lctx.currentIdx),this._video.paused||this._video.play(),void this.emit(v.a.LEVEL_SWITCHED,{time:t.currentTime,bitrate:i.bitrate,level:e,smooth:!1,auto:!1,id:this._levelSwitchId})}this.emit(v.a.LEVEL_SWITCH_FAILED)}else t.lctx.currentIdx=t.lctx.nextIdx=e},i.setNextLevel=function(e){this.setCurrentLevel(e)},i.preload=function(e){},i.getTotalVideoFrames=function(){return 0},i.getCurrentVideoFrame=function(){return 0},i.setCurretVideoFrame=function(e){},i.seekToNextFrame=function(){},i.seekToPrevFrame=function(){},i.destroy=function(){A.b.i("kernel-native","destroy"),this._httpStatusDetector&&(this._httpStatusDetector.stop(),this._httpStatusDetector=void 0),e.prototype.destroy.call(this)},i._onVideoPlay=function(){this._error||this._video.src||this.load(),e.prototype._onVideoPlay.call(this)},i._onVideoCanplay=function(){var t=this._ctx,i=t.lctx.current;i&&this._stat===Vi.SELECT_BITRATE&&this.emit(v.a.LEVEL_SWITCH_PLAYING,{time:t.currentTime,bitrate:i.bitrate,level:t.lctx.currentIdx,smooth:!1,auto:!1,id:this._levelSwitchId}),this._stat!==Vi.NONE&&(this._stat=Vi.NONE),e.prototype._onVideoCanplay.call(this)},i._onVideoTimeupdate=function(){var t=this._ctx;e.prototype._onVideoTimeupdate.call(this),this._setStartFromOnTimeupdate&&(A.b.i("kernel-native","timeupdate start from: "+t.stat.startFromSec),this._applyStartFrom(),this._setStartFromOnTimeupdate=!1)},i._onVideoWaiting=function(){A.b.i("kernel-native","video waiting"),this._stat=this._stat||Vi.WAITING;var e=this._ctx.bufferedSec,t=!this._video.ended&&!this._video.seeking&&this._stat===Vi.WAITING;this.emit(v.a.WAITING,{block:t,bufferedSec:e})},i._onVideoLoadeddata=function(){if(A.b.i("kernel-native","video loadeddata"),this._video.videoWidth||!this._ctx.canCodecFallback){this._mediaInfo={width:this._video.videoWidth,height:this._video.videoHeight};var e=this._ctx,t=e.lctx.current;if(e.cOutput.updateRendererType(L.o.video),e.cOutput.rendererType===L.o.canvas&&this.emit(v.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:e.cOutput.canvas,type:L.o.canvas}),t&&t.codec){var i=ve(t.codec);this._mediaInfo.audioCodec=i.audio,this._mediaInfo.videoCodec=i.video,i.video&&(0===i.video.indexOf("avc1")&&(this._mediaInfo.videoCodecType=L.b.h264),0!==i.video.indexOf("hev1")&&0!==i.video.indexOf("hvc1")||(this._mediaInfo.videoCodecType=L.b.hevc),0===i.video.indexOf("av01")&&(this._mediaInfo.videoCodecType=L.b.av1),this._mediaInfo.videoCodecType&&(e.stat.codecType=this._mediaInfo.videoCodecType))}this._mediaInfo.videoCodecType=e.stat.codecType,R.a.android?e.stat.startFromSec&&(this._setStartFromOnTimeupdate=!0):this._applyStartFrom(),this.emit(v.a.MEDIA_INFO,this._mediaInfo)}else this.emit(v.a.FALLBACK_H264,{type:L.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec no width.",code:0})},i._onVideoSeeking=function(){A.b.i("kernel-native","seeking "+this._video.currentTime);var e=this._video.currentTime;this.emit(v.a.SEEKING),this._ctx.isTimeinBuffered(e)||this.emit(v.a.SEEK_WITH_LOAD)},i._onVideoError=function(e){var t,i=this,n=(null==(t=this._video.error)?void 0:t.code)||0,r=ae(p.c[n],"video error");if(4===n&&this._ctx.canCodecFallback)this.emit(v.a.FALLBACK_H264,{type:L.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec error. video error: "+n,code:r});else{var a=this._ctx.lctx.current;if(a&&a.urlId<a.url.length-1)return a.urlId++,this.emit(v.a.RETRY,{type:L.h.BACKUP,message:"video error: "+n+". use backup url.",code:r}),void this._load(L.f.retry);var s="video error";this._video&&this._video.error&&(s+=" code:"+n+" message:"+this._video.error.message);var o={type:p.b.MEDIA_ERROR,details:(n?p.c[n]:p.a.VIDEO_ERROR)||p.a.VIDEO_ERROR,fatal:!0,url:this._video.src,reason:s};2===n||4===n?(this._httpStatusDetector||(this._httpStatusDetector=new $n),this._httpStatusDetector.start(this._video.src,(function(e){A.b.i("kernel-native","video error check http status code:",e),(2===n||4===n&&e>0)&&(e<200||e>299)?i._onError({type:p.b.NETWORK_ERROR,details:p.a.LOAD_ERROR,fatal:!0,url:i._video.src,statusCode:e,reason:s}):i._onError(o)}))):this._onError(o)}},i._load=function(e){A.b.i("kernel-native","_load"),this._mediaInfo=void 0,this._error=void 0,this._stat=Vi.LOADING,this.emit(v.a.LOAD,{type:e}),this._startLoadLevel(this._ctx.lctx.currentIdx),this._startHeartbeat()},i._startLoadLevel=function(e){var t=this._ctx,i=t.lctx.current;if(i){A.b.i("kernel-native","level",e);var n=i.currentUrl;this.emit(v.a.NEW_SOURCE,{sync:t.stat.startFromSec||0}),this._video.src=n}},i._applyStartFrom=function(){var e=this._ctx;e.stat.startFromSec>0&&(A.b.i("kernel-native","start from: "+e.stat.startFromSec),this._video.currentTime=e.stat.startFromSec,e.stat.startFromSec=0)},s()(t,[{key:"type",get:function(){return L.a.native}}]),t}(Wi),tr=function(){function e(){this._prevVideoTimestamp=0,this._prevAudioTimestamp=0,this._prevVideoReceived=0,this._prevAudioReceived=0,this._result=void 0,this._result=this._newInfo()}var t=e.prototype;return t.reset=function(){this._result=this._newInfo(),this._prevVideoTimestamp=0,this._prevAudioTimestamp=0,this._prevVideoReceived=0,this._prevAudioReceived=0},t.parse=function(e){var t=this,i=this._result,n=0,r=0,a="",s="",o="",c="";i.totalReceive=0,e.forEach((function(e){if("inbound-rtp"===e.type){if("video"===e.mediaType){var u=e.timestamp-t._prevVideoTimestamp;t._prevVideoTimestamp&&(n=(e.bytesReceived-t._prevVideoReceived)/u),t._prevVideoReceived=e.bytesReceived,t._prevVideoTimestamp=e.timestamp,i.key=e.keyFramesDecoded,i.videoPacketsLost=e.packetsLost,s=e.codecId,c=e.trackId}else if("audio"===e.mediaType){var d=e.timestamp-t._prevAudioTimestamp;t._prevAudioReceived&&(r=(e.bytesReceived-t._prevAudioReceived)/d),t._prevAudioReceived=e.bytesReceived,i.audioPacketsLost=e.packetsLost,a=e.codecId,o=e.trackId}i.totalReceive+=e.bytesReceived,t._prevAudioTimestamp=e.timestamp}})),i.audioDataRate=Math.round(7.8125*r),i.videoDataRate=Math.round(7.8125*n),i.speed=1e3*(n+r),e.forEach((function(e){"codec"===e.type?e.id===s?i.videoCodec=e.mimeType:e.id===a&&(i.audioCodec=e.mimeType,i.audioChannelCount=e.channels,i.audioSampleRate=e.clockRate):"track"===e.type&&(e.id===c?(i.width=e.frameWidth,i.height=e.frameHeight,i.videoAvgJitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount):e.id===o&&(i.audioAvgJitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount))}));var u=null,d=null;return e.forEach((function(t){"transport"===t.type&&(u=null==e?void 0:e.get(t.selectedCandidatePairId))})),u||e.forEach((function(e){"candidate-pair"===e.type&&e.selected&&(u=e)})),u&&u.remoteCandidateId&&(d=null==e?void 0:e.get(u.remoteCandidateId)),d&&(i.rtcRemoteAddress=d.address||d.ip||d.ipAddress,i.rtcRemotePort=d.port||d.portNumber),this._result=i,i},t._newInfo=function(){return{totalReceive:0,speed:0,rtcRemoteAddress:"",rtcRemotePort:0,width:0,height:0,audioCodec:"",videoCodec:"",audioChannelCount:0,audioSampleRate:0,videoDataRate:0,audioDataRate:0,key:0,audioPacketsLost:0,videoPacketsLost:0,audioAvgJitterBufferDelay:0,videoAvgJitterBufferDelay:0}},s()(e,[{key:"result",get:function(){return this._result}}]),e}();function ir(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function nr(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(i),!0).forEach((function(t){xn()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ir(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var rr,ar=function(e){function t(t){var i;return(i=e.call(this,t.video)||this)._ctx=void 0,i._loader=void 0,i._pc=void 0,i._loaderConfig=void 0,i._stream=void 0,i._src="",i._rtcStatParser=void 0,i._retrying=!1,i._retryTimer=null,i._retryCount=0,i.transmissionTimeoutTimer=null,i.transmissionTimeout=void 0,i.peerConnectionTimeout=void 0,i.peerConnectionMaxRetry=void 0,i.peerConnectionRetryDelay=void 0,i._parseStats=function(e){i._pc&&i._pc.getStats(null).then((function(t){var n=i._rtcStatParser.parse(t);e(n)}),(function(e){return console.log(e)}))},i._ctx=t,i._loaderConfig={useFetch:!0,connectionTimeout:i._ctx.config.sdpConnectionTimeout||1e4,maxRetry:0,retryDelay:i._ctx.config.retryDelay||1e3},i.transmissionTimeout=i._ctx.config.transmissionTimeout||1e4,i.peerConnectionTimeout=i._ctx.config.peerConnectionTimeout||1e5,i.peerConnectionMaxRetry=i._ctx.config.peerConnectionMaxRetry||5,i.peerConnectionRetryDelay=i._ctx.config.peerConnectionRetryDelay||3e3,i._rtcStatParser=new tr,i}u()(t,e);var i=t.prototype;return i.load=function(e){A.b.i("kernel-rtc","load");var t=this._ctx.lctx.current;t&&(this._src=t.url[t.urlId]),this._load(e)},i.onAbrLevelsUpdated=function(){},i.resume=function(){},i.destroy=function(){e.prototype.destroy.call(this),this._stopRetry(),this._disposeLoader(),this._video&&(this._video.srcObject=null),this._disconnect(),this._stream=void 0,this._stopVideo()},i.refresh=function(){this._disconnect(),this._load(L.f.retry)},i.stopLoad=function(){this.emit(v.a.STOP_LOAD),this._pc&&(this._pc.close(),this._pc=null),this._stopRetry(),this._stopHeartbeat()},i.setCurrentLevel=function(e){},i.setNextLevel=function(e){},i.liveEnd=function(){},i.jumpToLiveTime=function(){},i.getTotalVideoFrames=function(){return 0},i.getCurrentVideoFrame=function(){return 0},i.setCurretVideoFrame=function(e){},i.seekToNextFrame=function(){},i.seekToPrevFrame=function(){},i._onVideoLoadedmetadata=function(){var e=this;this._ctx.cOutput.updateRendererType(L.o.video),this._ctx.cOutput.rendererType===L.o.canvas&&this.emit(v.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:this._ctx.cOutput.canvas,type:L.o.canvas}),this._parseStats((function(t){e._mediaInfo||(e._mediaInfo={}),e._mediaInfo.width=t.width,e._mediaInfo.height=t.height,e._mediaInfo.audioCodec=t.audioCodec,e._mediaInfo.audioSampleRate=t.audioSampleRate,e._mediaInfo.channel=t.audioChannelCount,e._mediaInfo.videoCodec=t.videoCodec,e._mediaInfo.hasVideo=!!t.videoCodec,e._mediaInfo.hasAudio=!!t.audioCodec,e._mediaInfo.streamHost=t.rtcRemoteAddress}))},i._heartbeat=function(){var e=this;this._parseStats((function(t){var i;t.speed||e.transmissionTimeoutTimer||"connected"!==(null==(i=e._pc)?void 0:i.connectionState)?t.speed&&(e.transmissionTimeoutTimer&&clearTimeout(e.transmissionTimeoutTimer),e.transmissionTimeoutTimer=null):e.transmissionTimeoutTimer=+setTimeout((function(){var t={type:p.b.NETWORK_ERROR,details:p.a.WEBRTC_TRANSMISSION_DATA_NULL,reason:"transmission timeout "+e.transmissionTimeout,fatal:!1,url:e._src};e._onError(t),e._retry(t.reason)}),e.transmissionTimeout),e._ctx.loadRec.setRTCStats(t),e.emit(v.a.HEARTBEAT)}))},i._onVideoCanplay=function(){this._stat!==Vi.NONE&&(this._stat=Vi.NONE),e.prototype._onVideoCanplay.call(this)},i._load=function(e){var t=this;this._rtcStatParser.reset(),this._stat=Vi.LOADING,this.emit(v.a.LOAD,{type:e}),this.emit(v.a.NEW_SOURCE,{sync:0}),this._pc&&this._pc.close(),this._createPeerConnection(),this._connect().catch((function(e){t._retry(null==e?void 0:e.reason)}))},i._stopVideo=function(){this._video&&(this._video.srcObject=null)},i._retry=function(e){var t=this;this._retrying=!0,this._pc&&this._pc.close(),this._stopRetry(),this._retryCount<this.peerConnectionMaxRetry&&(this.transmissionTimeoutTimer&&clearTimeout(this.transmissionTimeoutTimer),this._retryTimer&&clearTimeout(this._retryTimer),this._retryTimer=+setTimeout((function(){t._retryCount++,A.b.i("kernel-rtc","retry",t._retryCount,e,t._src),t.emit(v.a.RETRY,{type:L.h.RTC,message:"reason: "+e+". retry: "+t._retryCount,code:p.a.WEBRTC_FAILED_ERROR}),t._retryTimer=null,t._createPeerConnection(),t._connect().then((function(){t._retryCount=0,t._retrying=!1}),(function(i){t._retryCount<t.peerConnectionMaxRetry?t._retry(e):t._onError(nr(nr({},i),{},{fatal:!0,url:t._src}))}))}),this.peerConnectionRetryDelay))},i._stopRetry=function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)},i.fetchAnwserSdp=function(e){var t=this;this._disposeLoader();var i=this._loader=new B,n={url:this._src,responseType:"text",requestBody:e,requestMethod:"POST",headers:[{header:"Content-type",value:"application/json"}]};return new Promise((function(e,r){i.load(n,{onEnd:function(i,n){if(t._disposeLoader(),"string"==typeof n){var r=JSON.parse(n);t.emit(v.a.LEVEL_UPDATED),e(r.sdp)}},onError:function(e,i){if(A.b.e("kernel-rtc","loadSdp",i),i.fatal){var n={type:p.b.NETWORK_ERROR,details:p.a.RTC_SDP_LOAD_ERROR,reason:i.text,fatal:i.fatal,url:t._src};t._disposeLoader(),r(n)}},onAbort:function(){t._disposeLoader(),r()}},t._loaderConfig)})).catch((function(e){return Promise.reject(e)}))},i._createPeerConnection=function(){var e=this,t=this._pc=new RTCPeerConnection;return t.addEventListener("track",(function(t){return e._onPCTrack(t)})),t.addEventListener("connectionstatechange",(function(t){return e._onPCConnectionStateChange(t)})),t.addEventListener("icecandidateerror",(function(t){return e._onPCIceCandidateError(t)})),t.addEventListener("signalingstatechange",(function(t){return e._onPCSignalingStateChange(t)})),t.addEventListener("iceconnectionstatechange",(function(t){return e._onPCIceConnecttionStateChange(t)})),t.addEventListener("icegatheringstatechange",(function(t){return e._onIceGatheringStateChange(t)})),t.addTransceiver("audio",{direction:"recvonly"}),t.addTransceiver("video",{direction:"recvonly"}),t},i._disconnect=function(){this._pc&&this._pc.close(),this._pc=null},i._connect=function(){var e=this,t=this._pc;return t||Promise.reject("PeerConnection isn't exist"),this._createOffer().then((function(t){return e.fetchAnwserSdp(JSON.stringify({sdp:t.sdp}))})).then((function(t){return e._setAnwser(t)})).then((function(){return t?new Promise((function(i,n){var r=setTimeout((function(){var t={type:p.b.NETWORK_ERROR,details:p.a.WEBRTC_CONNECT_TIMEOUT,fatal:!1,reason:"webrtc connect timeout",url:e._src};e._onError(t),n(t)}),e.peerConnectionTimeout);t.addEventListener("connectionstatechange",(function e(){switch(t.connectionState){case"connected":i(void 0),clearTimeout(r),t.removeEventListener("connectionstatechange",e);break;case"closed":case"disconnected":case"failed":clearTimeout(r),t.removeEventListener("connectionstatechange",e),n({type:p.b.NETWORK_ERROR,details:p.a.WEBRTC_CONNECT_FAILED,fatal:!1,reason:t.onconnectionstatechange})}}))})):Promise.reject("PeerConnection isn't exist")})).catch((function(e){return A.b.e("kernel-rtc",e),Promise.reject(e)}))},i._createOffer=function(){var e=this,t=this._pc;return t?t.createOffer().then((function(e){return A.b.i("kernel-rtc","offer",e),t.setLocalDescription(e).then((function(){return e}))}),(function(t){A.b.e("kernel-rtc","offer",t);var i={type:p.b.NETWORK_ERROR,details:p.a.WEBRTC_OFFER_ERROR,fatal:!1,url:e._src,reason:"webrtc createoffer error"+t};return e._onError(i),Promise.reject(i)})):Promise.reject()},i._setAnwser=function(e){var t=this,i=this._pc;if(!i||"closed"===i.signalingState)return Promise.reject();var n=new RTCSessionDescription({type:"answer",sdp:e});return i.setRemoteDescription(n).then((function(e){A.b.i("kernel-rtc","answer",n)}),(function(e){A.b.e("kernel-rtc","answer",e);var i={type:p.b.NETWORK_ERROR,details:p.a.WEBRTC_ANSWER_ERROR,fatal:!1,url:t._src,reason:"webrtc answer error"};return t._onError(i),Promise.reject(i)}))},i._onPCTrack=function(e){if(this._ctx.video&&e.streams&&this._stream!==e.streams[0]){var t=this._stream=e.streams[0];this._ctx.video.srcObject=t;var i=this._mediaInfo={};e.streams[0].getTracks().forEach((function(e){var t=e.getSettings();i.width=t.width||i.width,i.height=t.height||i.height,i.fps=t.frameRate||i.fps}))}},i._onPCConnectionStateChange=function(e){var t=this._pc;if(t)switch(A.b.i("kernel-rtc","pcConnectionStateChange",t.connectionState),t.connectionState){case"connecting":case"connected":break;case"disconnected":case"failed":case"closed":this._onError({type:p.b.NETWORK_ERROR,details:p.a.WEBRTC_DISCONNECTED_ERROR,reason:t.connectionState,fatal:!1,url:this._src}),!this._retrying&&this._retry("PeerConnection state is "+t.connectionState)}},i._onPCIceCandidateError=function(e){var t;A.b.i("kernel-rtc","iceCandidateError",e),this._onError({type:p.b.NETWORK_ERROR,details:p.a.WEBRTC_ICE_CANDIDATE_ERROR,fatal:!1,reason:(null==(t=this._pc)?void 0:t.iceConnectionState)||""}),!this._retrying&&this._retry("iceCandidateError")},i._onPCSignalingStateChange=function(e){var t;A.b.i("kernel-rtc","signalingStateChange",null==(t=this._pc)?void 0:t.signalingState)},i._onPCIceConnecttionStateChange=function(e){var t;A.b.i("kernel-rtc","iceConnecttionStateChange",null==(t=this._pc)?void 0:t.iceConnectionState)},i._onIceGatheringStateChange=function(e){var t;A.b.i("kernel-rtc","iceGatheringStateChange",null==(t=this._pc)?void 0:t.iceGatheringState)},i._onIcecandidate=function(e){var t;A.b.i("kernel-rtc","icecandidate",e.candidate),e.candidate&&(null==(t=this._pc)||t.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"0",candidate:e.candidate})).then((function(){return A.b.i("kernel-rtc","addIceCandidate success")}),(function(e){return A.b.e("kernel-rtc","addIceCandidate failed",e)})))},i._disposeLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},s()(t,[{key:"type",get:function(){return L.a.rtc}}]),t}(Wi),sr=function(){function e(){var e=this;this._ls=new F,this._timeout=void 0,this._onVideoEvent=function(){var t,i;A.b.i("play-hevc-test","on video event. "+(null==(t=rr)?void 0:t.videoWidth)+" "+(null==(i=rr)?void 0:i.error)),e._onComplete(!!rr&&rr.videoWidth>0&&!rr.error)};var t=this._ls.read("kwai-kernel-hevc",864e5);void 0!==t&&(tn.playHEVCTest=!!t),A.b.i("play-hevc-test",t)}var t=e.prototype;return t.start=function(){var e;void 0===tn.playHEVCTest&&(null!=(e=rr)&&e.src||this._startVideoTest())},t.destroy=function(){this._stopTimer(),this._clearTestVideo()},t._onComplete=function(e){A.b.i("play-hevc-test","complete result: "+e+" "+performance.now()),this._stopTimer(),this._clearTestVideo(),tn.playHEVCTest=e,this._ls.write("kwai-kernel-hevc",e)},t._startVideoTest=function(){A.b.i("play-hevc-test","start video test"),"undefined"!=typeof document?(rr||(rr=document.createElement("video")),rr.preload="metadata",rr.addEventListener("error",this._onVideoEvent),rr.addEventListener("loadeddata",this._onVideoEvent),rr.addEventListener("loadedmetadata",this._onVideoEvent),this._startTimer(),rr.src="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAA01tb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAD6AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAACd3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAD6AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAFAAAAAtAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAA+gAAAAAAAEAAAAAAe9tZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAEk+AABJPgFXEAAAAAAAhaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAAAAAAGmbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABZnN0YmwAAAECc3RzZAAAAAAAAAABAAAA8mh2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAFAALQAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAB4aHZjQwEBYAAAAJAAAAAAAF3wAPz9+PgAAA8DoAABABhAAQwB//8BYAAAAwCQAAADAAADAF2VmAmhAAEAK0IBAQFgAAADAJAAAAMAAAMAXaACgIAtFllZpJMrwFoCAAADAAIAAAMAAhCiAAEAB0QBwXK0YkAAAAAQcGFzcAAAAAEAAAABAAAAFGJ0cnQAAAAAAAALyAAAC8gAAAAYc3R0cwAAAAAAAAABAAAAAQAST4AAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAABeQAAAAEAAAAUc3RjbwAAAAAAAAABAAADeQAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTkuMjcuMTAwAAAACGZyZWUAAAGBbWRhdAAAABhAAQwB//8BYAAAAwCQAAADAAADAF2VmAkAAAArQgEBAWAAAAMAkAAAAwAAAwBdoAKAgC0WWVmkkyvAWgIAAAMAAgAAAwACEAAAAAdEAcFytGJAAAABHygBrxMYaRpdZVRRRNJK5mjj//0Xz8f2QC1YmO2u+AJADNDyAAADAAADAAADAAADAAAMqKXvcrgFwB8iYAAAAwAAAwAAAwAAAwAAAwAHnJMChCpAAAADAAADAAADAAADAAADAAAgIIcAAAMAAAMAAAMAAAMAAAMAAAMAABEwAAADAAADAAADAAADAAADAAADAAAYsAAAAwAAAwAAAwAAAwAAAwAAAwAEpAAAAwAAAwAAAwAAAwAAAwAAAwAwYAAAAwAAAwAAAwAAAwAAAwAAAwDggAAAAwAAAwAAAwAAAwAAAwAAAwKyAAADAAADAAADAAADAAADAAAEZAAAAwAAAwAAAwAAAwAAAwAAB8QAAAMAAAMAAAMAAAMAAAMAACeg",rr.play()):this._onComplete(!1)},t._clearTestVideo=function(){rr&&(rr.removeEventListener("error",this._onVideoEvent),rr.removeEventListener("loadeddata",this._onVideoEvent),rr.removeEventListener("loadedmetadata",this._onVideoEvent),rr.src="")},t._startTimer=function(){var e=this;this._stopTimer(),this._timeout=setTimeout((function(){A.b.i("play-hevc-test","timeout"),e._onComplete(!1)}),1e3)},t._stopTimer=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0)},e}(),or="kernel",cr=function(){function e(e,t){var i=this;this._video=void 0,this._ctx=void 0,this._monitor=void 0,this._error=void 0,this._evt=new o.EventEmitter,this._hevcTest=void 0,this._avcore=void 0;var n=this._parseUrlConfig();n&&A.b.level(n),A.b.i(or,En.packName+", "+En.version+" cors: "+e.crossOrigin+" autoplay: "+e.autoplay,t),this._video=e,this._hevcTest=new sr,this._ctx=new En(t||{},this._video),this._ctx.cOutput.setVideo(e),this._ctx.config||setTimeout((function(){i._onError({type:p.b.OTHER_ERROR,details:p.a.CONFIG_ERROR,fatal:!0,reason:"config data error"})}),0),n&&(this._ctx.config.kwaiKernelLog=n),this._monitor=this._initLogger(),this._ctx.config.src&&(this._avcore=this._initAVCore()),A.b.i(or,"config",this._ctx.config),En.instanceCount++}e.isSupport=function(e){if(L.g.webrtc===(null==e?void 0:e.box))return tn.isWebRTCSupported();if(null!=e&&e.nativeFirst)return tn.isVideoBoxSupported(null==e?void 0:e.box);var t=tn.isSupported();if(t){var i=!0;e&&(i=!(!e.isLive||e.box!==L.g.flv));var n=!i||_n.isStreamingSupported();return t&&!!n}return tn.isVideoBoxSupported(null==e?void 0:e.box)},e.videoCodecCapabilities=function(e){return tn.getVideoCodecCompatibilityByCodec(e)};var t=e.prototype;return t.on=function(e,t){A.b.i(or,"call on "+e),this._evt.on(e,t)},t.once=function(e,t){A.b.i(or,"call once "+e),this._evt.once(e,t)},t.removeAllListeners=function(e){A.b.i(or,"call removeAllListeners"),this._evt.removeAllListeners(e)},t.off=function(e,t){A.b.i(or,"call off "+e),this._evt.off(e,t)},t.listeners=function(e){return this._evt.listeners(e)},t.emit=function(e,t){return this._evt.emit(e,t)},t.listenerCount=function(e){return this._evt.listenerCount(e)},t.load=function(t,i){var n,r,a,s=this;(A.b.i(or,"call kernel load",t),t&&this._ctx.setSrc(t),this._ctx.src)?(e.isSupport({box:this._ctx.stat.box,isLive:this._ctx.stat.isLive,nativeFirst:this._ctx.stat.native})||setTimeout((function(){s._onError({type:p.b.OTHER_ERROR,details:p.a.UNSUPPORTED,fatal:!0,reason:"unsupported: "+s._ctx.stat.box+" live: "+s._ctx.stat.isLive+" native: "+s._ctx.stat.native})}),0),"number"==typeof(null==i?void 0:i.startFromSec)?this._ctx.stat.startFromSec=i.startFromSec:t&&(this._ctx.stat.startFromSec=-1),this._ctx.stat.multipart&&this._ctx.config.resourceBuffer&&Re(this._ctx.config.resourceBufferSize),t&&(null==(n=this._avcore)?void 0:n.type)!==((a=this._ctx).stat.box===L.g.webrtc?L.a.rtc:a.stat.native?L.a.native:L.a.mse)&&(null==(r=this._avcore)||r.destroy(),this._avcore=void 0),this._load()):this._onError({type:p.b.OTHER_ERROR,details:p.a.SRC_EMPTY,fatal:!0,reason:"url empty"})},t.getTimeNow=function(){return Mt.serverNowMs},t.setAvailableAbrLevels=function(e){var t;A.b.i(or,"setAvailableAbrLevels",e),this._ctx.lctx.availableList=e.splice(0),null==(t=this._avcore)||t.onAbrLevelsUpdated()},t.preload=function(e,t){A.b.i(or,"call preload"),this._avcore&&"preload"in this._avcore&&this._avcore.preload(e,t)},t.isTimeinBuffered=function(e){return this._ctx.stat.box!==L.g.webrtc&&this._ctx.isTimeinBuffered(e)},t.resume=function(){var e;A.b.i(or,"call resume"),null==(e=this._avcore)||e.resume(),this._video.paused&&this._video.play()},t.destroy=function(){var e,t;A.b.i(or,"call kernel destroy"),En.instanceCount--,De(),this._ctx.destroy(),null==(e=this._avcore)||e.destroy(),null==(t=this._monitor)||t.destroy(),this._hevcTest.destroy(),this.removeAllListeners()},t.refresh=function(){var e;A.b.i(or,"call kernel refresh"),this._error=void 0,this._ctx.cOutput.reset(),null==(e=this._avcore)||e.refresh()},t.stopLoad=function(){var e;A.b.i(or,"call kernel stopLoad"),null==(e=this._avcore)||e.stopLoad()},t.getStreamTime=function(e){var t=this._ctx.getStreamTime(e/1e3);return t?1e3*t:NaN},t.getAudienceStat=function(){return this._monitor.audienceStat},t.getMediaInfo=function(){var e;return r()({},null==(e=this._ctx.loadRec.currentLoad)?void 0:e.mediaInfo)},t.experiment=function(e){e&&null!=typeof e.startBitrateLimit&&(this._ctx.config.hlsAdaptiveConfig?this._ctx.config.hlsAdaptiveConfig.startBitrateLimit=e.startBitrateLimit:this._ctx.config.hlsAdaptiveConfig={startBitrateLimit:e.startBitrateLimit})},t.liveEnd=function(){A.b.i(or,"call liveEnd"),this._avcore&&"liveEnd"in this._avcore&&this._avcore.liveEnd()},t.seekToNextFrame=function(){var e;A.b.i(or,"call seekToNextFrame"),null==(e=this._avcore)||e.seekToNextFrame()},t.seekToPrevFrame=function(){var e;A.b.i(or,"call seekToPrevFrame"),null==(e=this._avcore)||e.seekToPrevFrame()},t.seekByFrameIndex=function(e){var t;return A.b.i(or,"call seekByFrameIndex",e),null==(t=this._avcore)?void 0:t.setCurretVideoFrame(e)},t.bindVPP=function(e){return A.b.i(or,"bind vpp. config.mainThreadRendering: "+this._ctx.stat.mainThreadRendering),!1!==this._ctx.stat.mainThreadRendering?(this._ctx.cOutput.bindVPP(e)&&this._rendererChanged(),!0):(A.b.w(or,"offscreen causes binding failure. set config.mainThreadRendering=true or bindVpp before play."),!1)},t.unbindVPP=function(e){this._ctx.cOutput.unbindVPP(e)&&this._rendererChanged()},t.jumpToLiveTime=function(){A.b.i(or,"call jumpToLiveTime"),this._avcore&&"jumpToLiveTime"in this._avcore&&this._avcore.jumpToLiveTime()},t._load=function(e){this._error=void 0,this._avcore||(this._avcore=this._initAVCore()),this._avcore&&(this._avcore.load(e),this._ctx.stat.coreType=this._avcore.type)},t._initAVCore=function(){var e=this,t=this._ctx,i=function(e){return e.stat.native?new er(e):e.stat.box!==L.g.webrtc&&Xi?new Xi(e):e.stat.box===L.g.webrtc&&ar?new ar(e):void 0}(t);if(i)return t.stat.coreType=i.type,i.on(v.a.ERROR,(function(t){e._onError(t)})),i.on(v.a.MANIFEST_PARSED,(function(){var i={levels:t.lctx.levels.map((function(e){return e.getKLevel()})),currentLevel:t.lctx.currentIdx,auto:t.lctx.abr};i.levels=t.lctx.levels.map((function(e){return e.getKLevel()}));var n=t.lctx.audioTracks;n&&n.length&&(i.audioTrack=t.lctx.audioIdx,i.audioTracks=n.map((function(e){return{lang:e.lang,qualityLabel:e.qualityLabel,qualityType:e.qualityType,bitrate:e.bitrate,groupId:e.groupId}})));var r=t.lctx.subtitleTracks;r&&r.length&&(i.subtitleTrack=t.lctx.subtitleIdx,i.subtitleTracks=r.map((function(e){return{lang:e.lang,name:e.name,groupId:e.groupId}}))),i.currentLevel=t.lctx.currentIdx,i.auto=t.lctx.abr,void 0!==t.stat.stereoType&&(i.stereoType=t.stat.stereoType),e._monitor.onManifest(i),e.emit(v.a.MANIFEST_PARSED,i)})),i.on(v.a.LEVEL_SWITCHING,(function(t){e._monitor.levelSwitching(t),e.emit(v.a.LEVEL_SWITCHING,t)})),i.on(v.a.LEVEL_SWITCHED,(function(t){e._monitor.levelSwitched(),e.emit(v.a.LEVEL_SWITCHED,t)})),i.on(v.a.LEVEL_SWITCH_PLAYING,(function(t){e._monitor.levelSwitchPlaying(),e.emit(v.a.LEVEL_SWITCH_PLAYING,t)})),i.on(v.a.AUDIO_TRACK_SWITCHING,(function(t){e._monitor.onAudioSwitching(),e.emit(v.a.AUDIO_TRACK_SWITCHING,t)})),i.on(v.a.AUDIO_TRACK_SWITCHED,(function(t){e._monitor.onAudioSwitched(),e.emit(v.a.AUDIO_TRACK_SWITCHED,t)})),i.on(v.a.LEVEL_SWITCH_FAILED,(function(){return e.emit(v.a.LEVEL_SWITCH_FAILED)})),i.on(v.a.STOP_LOAD,(function(){return e._monitor.onStopLoad()})),i.on(v.a.LOAD_END,(function(){return e.emit(v.a.LOAD_END)})),i.on(v.a.LEVEL_UPDATED,(function(t){e._monitor.onLevel(),e.emit(v.a.LEVEL_UPDATED,t)})),i.on(v.a.AUDIO_TRACK_UPDATED,(function(t){e._monitor.onAudioTrack(),e.emit(v.a.AUDIO_TRACK_UPDATED,t)})),i.on(v.a.SUBTITLE_TRACK_SWITCHED,(function(t){e.emit(v.a.SUBTITLE_TRACK_SWITCHED,t)})),i.on(v.a.PRELOAD_COMPLETE,(function(){e._monitor.onPreload()})),i.on(v.a.VIDEO_RENDERER_CHANGE,(function(t){e._rendererChanged(t)})),i.on(v.a.DEC_LIB_LOADED,(function(t){e._monitor.onDecLibLoaded(t)})),i.on(v.a.LOAD,(function(t){return e._monitor.onLoad(t)})),i.on(v.a.PRIV_NAL,(function(t){return e._monitor.onPrivNal(t)})),i.on(v.a.SEI,(function(t){return e._monitor.onSEI(t)})),i.on(v.a.PARSING_DATA,(function(t){return e._monitor.onSegment(t)})),i.on(v.a.WAITING,(function(t){return e._monitor.onWaiting(t)})),i.on(v.a.LOADEDDATA,(function(){return e._monitor.onLoadeddata()})),i.on(v.a.CANPLAY,(function(){return e._monitor.onCanplay()})),i.on(v.a.SEEKING,(function(t){return e._monitor.onSeek(t)})),i.on(v.a.SEEKED,(function(){return e._monitor.onSeeked()})),i.on(v.a.SEEK_WITH_LOAD,(function(){return e._monitor.onSeekWithLoad()})),i.on(v.a.PLAYING,(function(){return e._monitor.onPlaying()})),i.on(v.a.PAUSE,(function(){return e._monitor.onPause()})),i.on(v.a.PLAY,(function(){return e._monitor.onPlay()})),i.on(v.a.ENDED,(function(){return e._monitor.onEnd()})),i.on(v.a.RATE_CHANGE,(function(){return e._monitor.onRateChange()})),i.on(v.a.MEDIA_INFO,(function(t){return e._monitor.onMediaInfo(t)})),i.on(v.a.TIMEUPDATE,(function(){return e._monitor.onTimeupdate()})),i.on(v.a.PROGRESS,(function(){return e._monitor.onProgress()})),i.on(v.a.HEARTBEAT,(function(){return e._monitor.heartbeat()})),i.on(v.a.LOADER_CHUNK_ARRIVAL,(function(t){return e._monitor.onLoaderChunkArrival(t)})),i.on(v.a.MEDIA_DEMUX,(function(t){return e._monitor.onMediaDemux(t)})),i.on(v.a.MEDIA_CONNECTED,(function(t){return e._monitor.onMediaConnect(t)})),i.on(v.a.KEY_FRAME,(function(t){return e._monitor.onKeyFrame(t)})),i.on(v.a.NEW_SOURCE,(function(t){return e._monitor.onNewSource(t)})),i.on(v.a.DISCONTINUITY,(function(t){return e._monitor.onDiscontinuity(t)})),i.on(v.a.METADATA,(function(t){return e._monitor.onMetaData(t)})),i.on(v.a.DOWNLOAD,(function(t){return e._monitor.onDownload(t)})),i.on(v.a.FALLBACK_H264,(function(i){A.b.i(or,"fallback h264"),t.canCodecFallback&&(t.stat.fallback264=!0,t.reProcessSrc(L.b.h264),e._recover(i.type,i.message,!1),void 0===tn.playHEVCTest&&(A.b.i(or,"play hevc test start"),e._hevcTest.start()))})),i.on(v.a.RETRY,(function(t){return e._recodeRetry(t.type,t.message,!1,t.code)})),i},t._initLogger=function(){var e=this,t=new Jn(this._ctx);return t.on(v.a.REPORT,(function(t){e.emit(v.a.REPORT,t)})),t},t._recover=function(e,t,i,n){var r;void 0===i&&(i=!0),A.b.i(or,"recover: "+e+" native:"+this._ctx.stat.native),null==(r=this._avcore)||r.destroy(),this._avcore=void 0,this._recodeRetry(e,t,i,n),i&&(this._ctx.stat.native=!this._ctx.stat.native),this._load(L.f.retry),this._video.play()},t._recodeRetry=function(e,t,i,n){var r={type:e,code:n,change:i,message:t,pos:Math.floor(this._video.currentTime),ts:Math.floor(performance.now())};this._monitor.onRetry(r),this._ctx.stat.retryInfos.push(r)},t._onError=function(e){A.b.i(or,"on error",e);var t=this._ctx.hasChangeCore();if(t&&!this._ctx.stat.native){if(e.details===p.a.DEMUX_NOT_FOUND)return A.b.i(or,"demux not found. switch to native"),void this._recover(L.h.REMUX,"demux not found");if(this._ctx.stat.box===L.g.mp4&&this._ctx.stat.decoder===L.c.buildin&&(e.details===p.a.SOURCEBUFFER_ERROR||e.details===p.a.MEDIASOURCE_ERROR||e.details===p.a.ADDSOURCEBUFFER_ERROR))return A.b.i(or,"mse error. switch to native",this._ctx.stat.box),void this._recover(L.h.MSE,e.reason)}if(t&&mt(this._ctx.stat.box)&&this._ctx.stat.native&&this._video.readyState>=2&&tn.isMSEAvailable())return A.b.i(or,"hls native startup failed. switch to mse"),void this._recover(L.h.HLS_NATIVE,"hls native startup failed");var i=r()({},e);if(i.details===p.a.MANIFEST_PARSING_ERROR)try{Ct.isSrcEmpty(this._ctx.src)&&(A.b.i(or,"src empty",this._ctx.src),i.details=p.a.SRC_EMPTY),this._ctx.src?"string"==typeof this._ctx.src?i.reason+="src str:"+this._ctx.src.slice(0,1024):this._ctx.src instanceof Blob?i.reason+="src: blob":i.reason+="src other:"+JSON.stringify(this._ctx.src).slice(0,1024):i.reason+="src:"+this._ctx.src}catch(e){i.reason+=e.message}if(i.fatal){var n=ae(i.details,i.reason,i.statusCode||0);if(this._monitor.onError(n,i.reason),this.stopLoad(),i.code=n,!this._error){this._error=i.details;try{this.emit(v.a.ERROR,i)}catch(e){}}}},t._parseUrlConfig=function(){if(location.href){var e=location.href.match(/kwaiKernelLog=([a-z]{1})/);if(e&&e.length>1)return e[1]}return(new F).read("kwai-kernel-log")},t._rendererChanged=function(e){var t=this._ctx.cOutput;void 0===e&&(e={enabled:!0,type:t.rendererType,canvas:t.rendererType===L.o.canvas&&t.canvas?t.canvas:void 0}),A.b.i(or,"video renderer change",e),this.emit(v.a.VIDEO_RENDERER_CHANGE,e),e.canvas&&this.emit(v.a.H265_DETECTED,e)},s()(e,[{key:"currentVideoFrame",get:function(){var e;return(null==(e=this._avcore)?void 0:e.getCurrentVideoFrame())||0},set:function(e){var t;A.b.i(or,"call set currentVideoFrame",e),null==(t=this._avcore)||t.setCurretVideoFrame(e)}},{key:"totalVideoFrames",get:function(){var e;return(null==(e=this._avcore)?void 0:e.getTotalVideoFrames())||0}},{key:"audioTrack",get:function(){return this._ctx.lctx.audioIdx||0},set:function(e){var t;A.b.i(or,"call set audioTrack",e),null==(t=this._avcore)||t.setAudioTrack(e)}},{key:"subtitleTrack",get:function(){return this._ctx.lctx.subtitleIdx||0},set:function(e){var t;A.b.i(or,"call set subtitleTrack",e),null==(t=this._avcore)||t.setSubtitleTrack(e)}},{key:"currentLevel",get:function(){return this._ctx.lctx.currentIdx||0},set:function(e){var t;A.b.i(or,"call set currentLevel",e),null==(t=this._avcore)||t.setCurrentLevel(e)}},{key:"nextLevel",get:function(){return this._ctx.lctx.nextIdx||0},set:function(e){var t;A.b.i(or,"call set nextLevel",e),null==(t=this._avcore)||t.setNextLevel(e)}},{key:"startLevel",get:function(){return this._ctx.lctx.startIdx||0},set:function(e){A.b.i(or,"call set startLevel",e),this._ctx.lctx.startIdx=e}},{key:"autoLevelEnabled",get:function(){return this._ctx.lctx.abr}},{key:"monitorData",get:function(){return this._monitor&&this._avcore?r()(this._monitor.snapshot,{trackBufInfo:this._avcore.getTrackBufInfo()}):null}},{key:"currentLevelTimeInfo",get:function(){var e=this._ctx.lctx.current;if(e&&e.timeInfo)return e.timeInfo}}],[{key:"version",get:function(){return En.version}},{key:"MediaBox",get:function(){return L.g}},{key:"Events",get:function(){return{REPORT:v.a.REPORT,ERROR:v.a.ERROR,LEVEL_SWITCHING:v.a.LEVEL_SWITCHING,LEVEL_SWITCHED:v.a.LEVEL_SWITCHED,LEVEL_SWITCH_PLAYING:v.a.LEVEL_SWITCH_PLAYING,LEVEL_SWITCH_FAILED:v.a.LEVEL_SWITCH_FAILED,AUDIO_TRACK_SWITCHING:v.a.AUDIO_TRACK_SWITCHING,AUDIO_TRACK_SWITCHED:v.a.AUDIO_TRACK_SWITCHED,AUDIO_TRACK_UPDATED:v.a.AUDIO_TRACK_UPDATED,SUBTITLE_TRACK_SWITCHED:v.a.SUBTITLE_TRACK_SWITCHED,MANIFEST_PARSED:v.a.MANIFEST_PARSED,LEVEL_UPDATED:v.a.LEVEL_UPDATED,LOAD_END:v.a.LOAD_END,VIDEO_RENDERER_CHANGE:v.a.VIDEO_RENDERER_CHANGE}}},{key:"Reports",get:function(){return{METADATA:yn.METADATA,MEDIA_INFO:yn.MEDIA_INFO,HEARTBEAT:yn.HEARTBEAT,DOWNLOAD:yn.DOWNLOAD,REALTIME_BEACON:yn.REALTIME_BEACON,DISCONTINUITY:yn.DISCONTINUITY,PRIV_NAL:yn.PRIV_NAL}}}]),e}();function ur(e,t){return new cr(e,t)}}]);void 0===n&&console.error("esm-webpack-plugin: nothing exported!"),t["a"]=n.default;n.createKernel,n.DownloadStatus,n.LOG_LEVEL,n.KEvents,n.REPORT_TYPES,n.CodecType,n.Decoder,n.DemuxerType,n.HttpRangeType,n.MediaBox,n.VideoDecBlockPolicy,n.VideoDropFramePolicy,n.VideoRendererType,n.WasmDecoder,n.StereoType},d253:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"c",(function(){return y})),i.d(t,"h",(function(){return E})),i.d(t,"d",(function(){return T})),i.d(t,"e",(function(){return S})),i.d(t,"f",(function(){return x})),i.d(t,"b",(function(){return R})),i.d(t,"g",(function(){return D}));var n=i("4795"),r=i.n(n),a=i("48d1"),s=i("5433"),o=i.n(s),c=i("33cc"),u=i.n(c);function d(e,t){return p(e)||f(e,t)||h(e,t)||_()}function _(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){if(e){if("string"===typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function f(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var i=[],n=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)if(i.push(s.value),t&&i.length===t)break}catch(c){r=!0,a=c}finally{try{n||null==o["return"]||o["return"]()}finally{if(r)throw a}}return i}}function p(e){if(Array.isArray(e))return e}function v(e,t,i,n,r,a,s){try{var o=e[a](s),c=o.value}catch(u){return void i(u)}o.done?t(c):Promise.resolve(c).then(n,r)}function m(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function s(e){v(a,n,r,s,o,"next",e)}function o(e){v(a,n,r,s,o,"throw",e)}s(void 0)}))}}var A="playDegradeTipsTime",g={needDegradeTips:!0,videoDegradeTipsText:"目前浏览器版本过低，建议及时更新",liveDegradeTipsText:"目前浏览器版本过低，请及时更新"};function y(e,t){var i,n;Object(a["l"])((function(){i=o()(document,"keydown",!1).filter((function(e){return 32===e.keyCode})),n=i.compose(u()(500)).subscribe({next:function(t){e(),t.preventDefault()}})})),Object(a["j"])((function(){n.unsubscribe()})),t("input-focus",(function(t){t?n.unsubscribe():n=i.subscribe({next:function(t){e(),t.preventDefault()}})}))}function E(e){var t,i;Object(a["l"])((function(){t=o()(window,"keydown",!1).filter((function(e){return 38===e.keyCode||40===e.keyCode})),i=t.subscribe({next:function(t){e(t),t.preventDefault()}})})),Object(a["j"])((function(){i.unsubscribe()}))}function b(e,t,i){var n=e.value;if(37===i){if(n<=10)return void(e.value=0);e.value=n-10}else{if(n>=t.value-10)return void(e.value=t.value-.1);e.value=n+10}}function T(e,t,i){var n,r;Object(a["l"])((function(){n=o()(window,"keydown",!1).filter((function(e){return 37===e.keyCode||39===e.keyCode})),r=n.subscribe({next:function(i){b(e,t,i.keyCode),i.preventDefault()}})})),i("input-focus",(function(i){i?r.unsubscribe():r=n.subscribe({next:function(i){b(e,t,i.keyCode),i.preventDefault()}})})),Object(a["j"])((function(){r.unsubscribe()}))}function S(e,t){e&&e.on("report",(function(e){var i=e.type,n=e.value;"realtimeBeacon"===i&&t({type:"VIDEO_VISION_QOS",event_name:"VIDEO_VISION_QOS",event_value:{type:i,value:n}})}))}function x(e,t){var i=e.summaryData,n=e.waitingTime,r=e.pageLoadTime,a=Object.assign({},i,{waiting_kernel_time:n,page_load_time:r});t({type:"VIDEO_VISION_QOS",event_name:"VIDEO_VISION_QOS",event_value:{type:"summary",value:a}})}function C(e){var t=e.includes("Windows NT 6.1"),i=e.includes("Chrome/45.0.2454")||e.includes("Trident/7.0");return t&&i}function L(){var e=Object(a["q"])(!1),t=Number(localStorage.getItem(A));if(t){var i=new Date(t).setHours(0,0,0,0),n=new Date(t).setHours(23,59,59,999),r=Date.now();r>=i&&r<=n&&(e.value=!0)}return e}function R(e,t){var i=t.state,n=t.live,r=Object(a["q"])(!1);return Object(a["l"])((function(){var t=C(navigator.userAgent)&&e.needDegradeTips;if(n&&t)return i.showError=!0,i.errorInfo.errorTitle=e.liveDegradeTipsText,i.errorInfo.retryText="",void(r.value=!0);var a=L();!a.value&&t?(i.showError=!0,localStorage.setItem(A,String(Date.now())),r.value=!0,i.errorInfo.errorTitle=e.videoDegradeTipsText):r.value=!1})),r}function D(e,t,i){var n=i.src,s=i.fullbackPlayUrl,o=i.muted,c=i.showDegradeTips,u=i.isRecoVideo,_=Object(a["q"])(!1);function h(i,n,r){var a;e.kernelInitTime=+new Date;var s=i,c="[object Object]"===Object.prototype.toString.call(i);(_.value||c&&0===Object.keys(i).length)&&(s=n),null===(a=t.value)||void 0===a||a.load({resource:s,muted:o.value,needPlay:r}).catch((function(e){e.message.indexOf("play() request was interrupted by a new load request")>-1||setTimeout((function(){var e;null===(e=t.value)||void 0===e||e.load({resource:s,muted:!0,needPlay:r})}),100)}))}return Object(a["l"])((function(){_.value=C(navigator.userAgent),!(null===u||void 0===u?void 0:u.value)&&n&&s&&Object(a["t"])((function(){return[n.value,c.value,s.value]}),function(){var e=m(r.a.mark((function e(t){var i,n,a,s;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=d(t,3),n=i[0],a=i[1],s=i[2],!a){e.next=3;break}return e.abrupt("return");case 3:(n||s)&&h(n,s);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{immediate:!0})})),{loadVideo:h}}},f112:function(e,t,i){"use strict";function n(e){return e<10?"0"+e:e+""}function r(e){var t=Math.round(e),i=Math.floor(t/3600),r=Math.floor(t%3600/60),a=t%60;return i?"".concat(n(i),":").concat(n(r),":").concat(n(a)):"".concat(n(r),":").concat(n(a))}i.d(t,"a",(function(){return r}))}}]);
//# sourceMappingURL=NewReco-csr-movie-video-short-video-tesla-home-tesla-video-video.47b970c3.js.map